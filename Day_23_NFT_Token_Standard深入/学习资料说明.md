# Day 23 学习资料说明

## 📚 资料概览

本目录包含 Day 23（NFT Token Standard 深入）的完整学习资料，涵盖 Aptos Token Standard v2 的核心概念、实践示例和评估体系。

---

## 📂 目录结构

```
Day_23_NFT_Token_Standard深入/
├── Move.toml                           # 项目配置文件
├── README.md                           # 课程大纲与学习指南
├── 学习资料说明.md                     # 本文件
├── 01_理论学习/
│   ├── 核心概念.md                     # NFT 理论知识（8大核心主题）
│   └── 代码示例.move                   # 完整的 NFT 实现代码
├── 02_实践任务/
│   └── 任务说明.md                     # 5个递进式实践任务
└── 03_每日考试/
    ├── 选择题.md                       # 20道选择题（基础+进阶+综合）
    ├── 编程题.md                       # 5道编程题（100分）
    └── 答案解析.md                     # 详细答案与解析
```

---

## 🎯 学习目标

### 核心能力
1. **理解 Aptos Token Standard v2**
   - Object Model 架构
   - Token 与 Collection 关系
   - 引用（Refs）系统

2. **掌握 NFT 完整生命周期**
   - Collection 创建与配置
   - Token 铸造与属性管理
   - 转移与交易逻辑
   - 版税计算与分配

3. **实战能力**
   - 实现完整的 NFT 项目
   - 优化 Gas 消耗
   - 处理复杂业务逻辑

---

## 📖 学习路径

### 第一阶段：理论学习（3小时）

#### 1. 阅读核心概念（2小时）
**文件**：`01_理论学习/核心概念.md`

**学习顺序**：
1. **NFT 基础概念**（30分钟）
   - NFT 定义与特性
   - Token v1 vs v2 对比
   - 使用场景分析

2. **Aptos Token Standard 演进**（20分钟）
   - Token v1 的限制
   - Token v2 的改进
   - 迁移建议

3. **对象模型详解**（30分钟）⭐ 重点
   - Object 核心概念
   - 所有权机制
   - 引用类型（DeleteRef, ExtendRef, TransferRef, MutatorRef）
   
4. **Collection 深度解析**（20分钟）
   - 固定供应量 vs 无限供应量
   - 版税配置
   - Collection 可变性

5. **Token 对象结构**（20分钟）
   - Token 创建方式
   - 元数据管理
   - 生命周期控制

6. **元数据与属性系统**（30分钟）⭐ 重点
   - Property Map 详解
   - 支持的数据类型
   - 动态属性更新

7. **NFT 生命周期管理**（15分钟）
   - 铸造流程
   - 转移机制
   - 销毁逻辑

8. **实际案例分析**（15分钟）
   - 艺术品 NFT
   - 游戏道具
   - 会员卡系统

#### 2. 学习代码示例（1小时）
**文件**：`01_理论学习/代码示例.move`

**阅读重点**：
```move
// 1. Collection 创建（5分钟）
create_fixed_collection(...)
create_unlimited_collection(...)

// 2. Token 铸造（10分钟）
mint_nft(...)
mint_and_transfer(...)
batch_mint(...)

// 3. 属性管理（15分钟）⭐ 重点
set_property_u64(...)
set_property_string(...)
read_property_u64(...)

// 4. 转移与交易（15分钟）⭐ 重点
transfer_token(...)
burn(...)

// 5. 查询函数（10分钟）
get_collection_stats(...)
get_token_owner(...)

// 6. 测试用例（5分钟）
test_create_collection()
test_mint_nft()
```

**实践建议**：
- 在本地运行测试：`aptos move test`
- 尝试修改参数观察行为
- 添加自己的测试用例

---

### 第二阶段：实践任务（10小时）

**文件**：`02_实践任务/任务说明.md`

#### 任务一：创建艺术品 NFT Collection（2小时）
**目标**：
- 创建固定供应量 Collection
- 配置版税（5%）
- 实现 Collection 信息修改

**关键技术**：
```move
collection::create_fixed_collection(
    creator,
    description,
    1000,  // max_supply
    name,
    option::some(royalty::create(500, 10000, creator_addr)),  // 5%
    uri,
);
```

**验收标准**：
- ✅ Collection 创建成功
- ✅ 版税信息正确
- ✅ 可以修改描述和 URI

---

#### 任务二：实现 NFT 铸造系统（2.5小时）
**目标**：
- 基础铸造功能
- 批量铸造优化
- 铸造并转移

**关键技术**：
```move
// 供应量检查
let stats = borrow_global_mut<CollectionStats>(collection_addr);
assert!(stats.minted_count < stats.max_supply, ERROR_MAX_SUPPLY);
stats.minted_count = stats.minted_count + 1;

// 创建 Token
let constructor_ref = token::create_named_token(...);
```

**性能优化**：
- 批量操作时只借用一次全局资源
- 减少重复计算

---

#### 任务三：属性管理系统（2小时）⭐ 重点
**目标**：
- 初始化艺术品属性（艺术家、年份、媒介等）
- 更新所有权历史
- 添加展览记录

**关键技术**：
```move
// 添加属性
property_map::add_typed(&mutator_ref, &key, value);

// 更新属性
property_map::update_typed(&mutator_ref, &key, new_value);

// 读取属性
let value = property_map::read_u64(&token, &key);
```

**数据类型支持**：
- `u64`, `u128`, `u256`
- `bool`
- `address`
- `String`
- `vector<u8>`

---

#### 任务四：NFT 转移与交易（2小时）⭐ 重点
**目标**：
- 实现安全转移
- 版税自动分配
- 交易历史记录

**关键技术**：
```move
// 版税计算
let royalty = token::royalty(token);
let royalty_amount = (price * numerator) / denominator;
let seller_amount = price - royalty_amount;

// 先转账，后转 Token（保证原子性）
coin::transfer<APT>(buyer, creator, royalty_amount);
coin::transfer<APT>(buyer, seller, seller_amount);
object::transfer(seller, token, buyer_addr);
```

**安全要点**：
- 先验证所有权
- 先完成资金转移
- 最后转移 Token
- 记录转移历史

---

#### 任务五：NFT 查询与统计系统（1.5小时）
**目标**：
- Collection 统计查询
- Token 详细信息查询
- 所有权验证

**关键技术**：
```move
// Collection 统计
public fun get_collection_info(collection: Object<Collection>): CollectionInfo {
    let name = collection::name(collection);
    let description = collection::description(collection);
    let stats = borrow_global<CollectionStats>(collection_addr);
    // ...
}

// Token 查询
public fun get_token_details(token: Object<Token>): TokenDetails {
    let owner = object::owner(token);
    let name = token::name(token);
    // 读取所有属性
}
```

---

### 第三阶段：每日考试（3小时）

#### 1. 选择题（45分钟）
**文件**：`03_每日考试/选择题.md`

**题目分布**：
- 基础概念（8题，40分）
- 进阶知识（6题，30分）
- 实战应用（4题，30分）
- 综合分析（2题，20分）

**重点题目**：
- 第 10 题：如何禁止 Token 转移
- 第 16 题：带版税转移的正确顺序
- 第 18 题：项目需求与引用选择
- 第 19 题：批量操作性能优化
- 第 20 题：交易原子性保证

**答题建议**：
1. 先做基础概念题（快速得分）
2. 重点关注代码分析题
3. 综合题需要仔细思考
4. 时间分配：基础15分钟，进阶15分钟，应用15分钟

---

#### 2. 编程题（3小时）
**文件**：`03_每日考试/编程题.md`

**题目分布**：
| 题目 | 分数 | 时间 | 难度 |
|------|------|------|------|
| 题一：艺术品 NFT Collection | 20分 | 40分钟 | ⭐⭐⭐ |
| 题二：带属性的 NFT 铸造 | 25分 | 50分钟 | ⭐⭐⭐⭐ |
| 题三：NFT 交易与版税分配 | 30分 | 60分钟 | ⭐⭐⭐⭐⭐ |
| 题四：批量操作优化 | 15分 | 30分钟 | ⭐⭐⭐⭐ |
| 题五：可升级 NFT | 10分 | 20分钟 | ⭐⭐⭐ |

**做题顺序建议**：
1. **先做题一**（Collection 创建）→ 建立基础
2. **再做题二**（铸造与属性）→ 掌握核心
3. **后做题三**（交易逻辑）→ 突破难点
4. **最后做题四和题五**（优化与应用）

**关键注意事项**：
- 题三（交易）最复杂，预留充足时间
- 题四（批量优化）考察性能意识
- 所有题目都需要编写测试用例

---

#### 3. 答案解析（学习时间）
**文件**：`03_每日考试/答案解析.md`

**使用建议**：
1. **先独立完成考试**，不要提前看答案
2. **对比答案时**：
   - 理解每道题的考点
   - 学习最佳实践
   - 记录自己的错误
3. **重点学习**：
   - 选择题 18-20（综合分析）
   - 编程题三的完整实现
   - 性能优化技巧

---

## 🛠️ 实践环境配置

### 1. 安装 Aptos CLI
```bash
# Windows (PowerShell)
iwr "https://aptos.dev/scripts/install_cli.py" -useb | iex

# 验证安装
aptos --version
```

### 2. 初始化项目
```bash
# 进入 Day 23 目录
cd Day_23_NFT_Token_Standard深入

# 测试代码示例
aptos move test --filter nft_example

# 编译
aptos move compile
```

### 3. 本地开发网络
```bash
# 启动本地节点
aptos node run-local-testnet --with-faucet

# 创建测试账户
aptos init --network local

# 获取测试币
aptos account fund-with-faucet --account default
```

---

## 📊 学习评估

### 自我检测清单

#### 理论知识
- [ ] 能解释 Object Model 的核心概念
- [ ] 理解 Token v1 和 v2 的区别
- [ ] 掌握所有引用（Ref）的作用
- [ ] 理解版税计算公式
- [ ] 知道如何禁止 Token 转移

#### 实践能力
- [ ] 能独立创建 Collection
- [ ] 能实现带属性的 NFT 铸造
- [ ] 能处理 NFT 转移与交易
- [ ] 能优化批量操作的性能
- [ ] 能编写完整的测试用例

#### 综合应用
- [ ] 能设计一个完整的 NFT 项目
- [ ] 理解交易的原子性保证
- [ ] 能处理复杂的业务逻辑
- [ ] 能分析和优化 Gas 消耗

### 评分标准
- **优秀（90-100分）**：理论扎实，代码规范，能独立完成复杂项目
- **良好（80-89分）**：理论清晰，代码正确，需要少量指导
- **及格（70-79分）**：基础概念掌握，能完成基本功能
- **不及格（<70分）**：概念模糊，代码错误较多

---

## 🔗 扩展资源

### 官方文档
1. **Aptos Token Standard**
   - 标准规范：https://aptos.dev/standards/aptos-token/
   - Object Model：https://aptos.dev/standards/aptos-object/
   - API 文档：https://aptos.dev/reference/move

2. **开源项目参考**
   - Aptos Token Objects：https://github.com/aptos-labs/aptos-core/tree/main/aptos-move/framework/aptos-token-objects
   - Digital Asset Example：https://github.com/aptos-labs/aptos-core/tree/main/aptos-move/move-examples/token_objects

### 社区资源
1. **教程与博客**
   - Aptos Learn：https://learn.aptoslabs.com
   - Aptos Developer Discussions：https://github.com/aptos-labs/aptos-core/discussions

2. **工具**
   - Aptos Explorer：https://explorer.aptoslabs.com
   - Aptos Scan：https://aptoscan.com

### 进阶阅读
1. **NFT 最佳实践**
   - 元数据标准（JSON Schema）
   - IPFS 集成
   - 链下索引方案

2. **高级话题**
   - NFT 租赁协议
   - 碎片化 NFT
   - 动态 NFT

---

## 💡 学习建议

### 1. 时间安排
**建议学习周期**：2-3天

**Day 1**（5-6小时）：
- 上午：理论学习（3小时）
- 下午：实践任务一、二（3小时）

**Day 2**（5-6小时）：
- 上午：实践任务三、四（4小时）
- 下午：实践任务五（1.5小时）

**Day 3**（3小时）：
- 上午：选择题（45分钟）
- 下午：编程题（3小时）
- 晚上：对照答案，总结复盘（1小时）

### 2. 常见问题

#### Q1: Property Map 无法存储复杂类型？
**A**: 
- 可以序列化为 `vector<u8>` 存储
- 或使用 `ExtendRef` 在 Object 内部存储自定义资源

#### Q2: 如何实现批量转移？
**A**:
```move
public entry fun batch_transfer(
    owner: &signer,
    tokens: vector<Object<Token>>,
    recipients: vector<address>,
) {
    let len = vector::length(&tokens);
    let i = 0;
    while (i < len) {
        let token = *vector::borrow(&tokens, i);
        let recipient = *vector::borrow(&recipients, i);
        object::transfer(owner, token, recipient);
        i = i + 1;
    };
}
```

#### Q3: 版税支付失败怎么办？
**A**:
- 使用托管合约模式
- 先锁定资金，再执行转移
- 确保事务的原子性

### 3. 调试技巧

#### 使用 `debug::print`
```move
use std::debug;

public entry fun test_function() {
    let value = 100;
    debug::print(&value);  // 输出到控制台
}
```

#### 运行特定测试
```bash
# 运行所有测试
aptos move test

# 运行特定模块
aptos move test --filter nft_example

# 显示详细输出
aptos move test --verbose
```

#### 检查编译错误
```bash
# 编译并显示详细错误
aptos move compile --verbose
```

---

## 🎓 学习成果

完成本课程后，你应该能够：

1. **理论层面**
   - 深入理解 Aptos Token Standard v2 架构
   - 掌握 Object Model 的设计思想
   - 理解 NFT 生命周期的各个环节

2. **实践层面**
   - 独立开发完整的 NFT 项目
   - 实现复杂的 NFT 业务逻辑
   - 优化 Gas 消耗和性能

3. **工程能力**
   - 编写高质量的 Move 代码
   - 设计合理的数据结构
   - 编写全面的测试用例

---

## 📝 反馈与改进

如果在学习过程中遇到问题，或有改进建议，欢迎：
1. 记录问题和解决方案
2. 总结学习心得
3. 分享实践经验

---

**祝学习顺利！🚀**

记住：NFT 不仅仅是技术，更是创造力和商业逻辑的结合。理解底层实现的同时，也要思考 NFT 的实际应用场景和价值创造。
