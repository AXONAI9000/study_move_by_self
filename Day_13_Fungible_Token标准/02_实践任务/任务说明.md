# Day 13 å®è·µä»»åŠ¡ï¼šåˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªä»£å¸

## ğŸ“‹ ä»»åŠ¡æ¦‚è¿°

é€šè¿‡ä¸‰ä¸ªé€’è¿›å¼ä»»åŠ¡ï¼Œä½ å°†ä»é›¶å¼€å§‹åˆ›å»ºã€éƒ¨ç½²å’Œç®¡ç†ä¸€ä¸ªå®Œæ•´çš„ä»£å¸ç³»ç»Ÿã€‚

**é¢„è®¡æ—¶é—´**ï¼š3.5 å°æ—¶

---

## ä»»åŠ¡ 1ï¼šåˆ›å»ºåŸºç¡€ä»£å¸ï¼ˆåŸºç¡€ï¼‰â­â­â­â˜†â˜†

### ğŸ¯ ç›®æ ‡
åˆ›å»ºä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ä»£å¸ï¼ŒåŒ…æ‹¬åˆå§‹åŒ–ã€æ³¨å†Œã€è½¬è´¦ç­‰åŸºæœ¬åŠŸèƒ½ã€‚

### ğŸ“ éœ€æ±‚

#### 1.1 ä»£å¸ä¿¡æ¯
åˆ›å»ºä¸€ä¸ªåä¸º `LearningCoin` çš„ä»£å¸ï¼š
- **åç§°**: "Learning Coin"
- **ç¬¦å·**: "LEARN"
- **å°æ•°ä½æ•°**: 8
- **åˆå§‹ä¾›åº”é‡**: 1,000,000 ä¸ªï¼ˆè¿½è¸ªæ€»ä¾›åº”é‡ï¼‰

#### 1.2 å¿…éœ€åŠŸèƒ½

**åˆå§‹åŒ–ä»£å¸**
```move
fun init_module(account: &signer)
```
- ä½¿ç”¨ `coin::initialize` åˆ›å»ºä»£å¸
- ä¿å­˜ MintCapability å’Œ BurnCapability
- å¯é€‰æ‹©é”€æ¯ FreezeCapability

**ç”¨æˆ·æ³¨å†Œ**
```move
public entry fun register(account: &signer)
```
- ä¸ºç”¨æˆ·åˆ›å»º CoinStore

**é“¸é€ ä»£å¸**
```move
public entry fun mint(
    admin: &signer,
    recipient: address,
    amount: u64
)
```
- åªæœ‰ç®¡ç†å‘˜å¯ä»¥é“¸é€ 
- é“¸é€ åˆ°æŒ‡å®šåœ°å€

**è½¬è´¦**
```move
public entry fun transfer(
    from: &signer,
    to: address,
    amount: u64
)
```
- ä» from è½¬è´¦åˆ° to

**æŸ¥è¯¢ä½™é¢**
```move
#[view]
public fun balance(addr: address): u64
```
- è¿”å›æŒ‡å®šåœ°å€çš„ä½™é¢

**æŸ¥è¯¢æ€»ä¾›åº”é‡**
```move
#[view]
public fun total_supply(): Option<u128>
```
- è¿”å›ä»£å¸æ€»ä¾›åº”é‡

### ğŸ’» èµ·å§‹ä»£ç 

åœ¨ `sources/learning_coin.move` åˆ›å»ºï¼š

```move
module my_coin::learning_coin {
    use std::signer;
    use std::string;
    use std::option::{Self, Option};
    use aptos_framework::coin::{Self, MintCapability, BurnCapability};

    /// ä»£å¸ç±»å‹
    struct LearningCoin {}

    /// å­˜å‚¨æƒé™
    struct Capabilities has key {
        mint_cap: MintCapability<LearningCoin>,
        burn_cap: BurnCapability<LearningCoin>,
    }

    /// é”™è¯¯ç 
    const ERROR_NOT_ADMIN: u64 = 1;
    const ERROR_ALREADY_INITIALIZED: u64 = 2;

    /// TODO: å®ç° init_module
    fun init_module(account: &signer) {
        // ä½ çš„ä»£ç 
    }

    /// TODO: å®ç°æ³¨å†Œå‡½æ•°
    public entry fun register(account: &signer) {
        // ä½ çš„ä»£ç 
    }

    /// TODO: å®ç°é“¸é€ å‡½æ•°
    public entry fun mint(
        admin: &signer,
        recipient: address,
        amount: u64
    ) acquires Capabilities {
        // ä½ çš„ä»£ç 
    }

    /// TODO: å®ç°è½¬è´¦å‡½æ•°
    public entry fun transfer(
        from: &signer,
        to: address,
        amount: u64
    ) {
        // ä½ çš„ä»£ç 
    }

    /// TODO: å®ç°ä½™é¢æŸ¥è¯¢
    #[view]
    public fun balance(addr: address): u64 {
        // ä½ çš„ä»£ç 
    }

    /// TODO: å®ç°æ€»ä¾›åº”é‡æŸ¥è¯¢
    #[view]
    public fun total_supply(): Option<u128> {
        // ä½ çš„ä»£ç 
    }
}
```

### âœ… éªŒè¯æ ‡å‡†
- [ ] ä»£ç èƒ½å¤Ÿç¼–è¯‘
- [ ] å¯ä»¥åˆå§‹åŒ–ä»£å¸
- [ ] ç”¨æˆ·å¯ä»¥æ³¨å†Œ
- [ ] ç®¡ç†å‘˜å¯ä»¥é“¸é€ 
- [ ] ç”¨æˆ·å¯ä»¥è½¬è´¦
- [ ] å¯ä»¥æŸ¥è¯¢ä½™é¢å’Œæ€»ä¾›åº”é‡

---

## ä»»åŠ¡ 2ï¼šæ·»åŠ é«˜çº§åŠŸèƒ½ï¼ˆä¸­çº§ï¼‰â­â­â­â­â˜†

### ğŸ¯ ç›®æ ‡
åœ¨ä»»åŠ¡ 1 çš„åŸºç¡€ä¸Šæ·»åŠ é”€æ¯ã€æ‰¹é‡æ“ä½œå’Œäº‹ä»¶ç³»ç»Ÿã€‚

### ğŸ“ éœ€æ±‚

#### 2.1 é”€æ¯ä»£å¸

```move
public entry fun burn(
    account: &signer,
    amount: u64
) acquires Capabilities
```
- ç”¨æˆ·å¯ä»¥é”€æ¯è‡ªå·±çš„ä»£å¸
- å‡å°‘æ€»ä¾›åº”é‡
- å‘å°„ Burn äº‹ä»¶

#### 2.2 æ‰¹é‡è½¬è´¦

```move
public entry fun batch_transfer(
    from: &signer,
    recipients: vector<address>,
    amounts: vector<u64>
)
```
- ä¸€æ¬¡äº¤æ˜“è½¬è´¦ç»™å¤šä¸ªæ¥æ”¶æ–¹
- recipients å’Œ amounts é•¿åº¦å¿…é¡»ç›¸åŒ
- ä»»ä½•ä¸€ç¬”å¤±è´¥åˆ™å…¨éƒ¨å›æ»š

#### 2.3 äº‹ä»¶ç³»ç»Ÿ

å®šä¹‰å¹¶å‘å°„äº‹ä»¶ï¼š

```move
struct MintEvent has drop, store {
    recipient: address,
    amount: u64,
    timestamp: u64,
}

struct BurnEvent has drop, store {
    burner: address,
    amount: u64,
    timestamp: u64,
}

struct Events has key {
    mint_events: EventHandle<MintEvent>,
    burn_events: EventHandle<BurnEvent>,
}
```

#### 2.4 æƒé™è½¬ç§»

```move
public entry fun transfer_admin(
    current_admin: &signer,
    new_admin: address
) acquires Capabilities
```
- å°† Capabilities è½¬ç§»åˆ°æ–°ç®¡ç†å‘˜

### ğŸ’» æ‰©å±•ä»£ç 

```move
module my_coin::learning_coin {
    use aptos_framework::event::{Self, EventHandle};
    use aptos_framework::account;
    use aptos_framework::timestamp;
    use std::vector;

    // ... ä¹‹å‰çš„ä»£ç  ...

    /// äº‹ä»¶ç»“æ„
    struct MintEvent has drop, store {
        recipient: address,
        amount: u64,
        timestamp: u64,
    }

    struct BurnEvent has drop, store {
        burner: address,
        amount: u64,
        timestamp: u64,
    }

    struct Events has key {
        mint_events: EventHandle<MintEvent>,
        burn_events: EventHandle<BurnEvent>,
    }

    /// TODO: ä¿®æ”¹ init_module æ·»åŠ äº‹ä»¶
    fun init_module(account: &signer) {
        // ... åˆå§‹åŒ–ä»£å¸ ...

        // åˆ›å»ºäº‹ä»¶å¥æŸ„
        move_to(account, Events {
            mint_events: account::new_event_handle<MintEvent>(account),
            burn_events: account::new_event_handle<BurnEvent>(account),
        });
    }

    /// TODO: å®ç°é”€æ¯åŠŸèƒ½
    public entry fun burn(
        account: &signer,
        amount: u64
    ) acquires Capabilities, Events {
        // ä½ çš„ä»£ç 
    }

    /// TODO: å®ç°æ‰¹é‡è½¬è´¦
    public entry fun batch_transfer(
        from: &signer,
        recipients: vector<address>,
        amounts: vector<u64>
    ) {
        // ä½ çš„ä»£ç 
    }

    /// TODO: å®ç°æƒé™è½¬ç§»
    public entry fun transfer_admin(
        current_admin: &signer,
        new_admin: address
    ) acquires Capabilities {
        // ä½ çš„ä»£ç 
    }
}
```

### âœ… éªŒè¯æ ‡å‡†
- [ ] å¯ä»¥é”€æ¯ä»£å¸
- [ ] æ‰¹é‡è½¬è´¦æ­£å¸¸å·¥ä½œ
- [ ] äº‹ä»¶æ­£ç¡®å‘å°„
- [ ] å¯ä»¥è½¬ç§»ç®¡ç†å‘˜æƒé™

---

## ä»»åŠ¡ 3ï¼šåˆ›å»ºä»£å¸æ°´é¾™å¤´ï¼ˆé«˜çº§ï¼‰â­â­â­â­â­

### ğŸ¯ ç›®æ ‡
åˆ›å»ºä¸€ä¸ªä»£å¸æ°´é¾™å¤´ï¼ˆFaucetï¼‰ï¼Œç”¨æˆ·å¯ä»¥å®šæœŸé¢†å–æµ‹è¯•ä»£å¸ã€‚

### ğŸ“ éœ€æ±‚

#### 3.1 æ°´é¾™å¤´é…ç½®

```move
struct FaucetConfig has key {
    amount_per_request: u64,      // æ¯æ¬¡é¢†å–æ•°é‡
    cooldown_seconds: u64,        // å†·å´æ—¶é—´ï¼ˆç§’ï¼‰
    max_per_user: u64,            // æ¯ä¸ªç”¨æˆ·æœ€å¤§é¢†å–æ¬¡æ•°
    is_active: bool,              // æ°´é¾™å¤´æ˜¯å¦å¼€å¯
}

struct UserClaim has key {
    last_claim_time: u64,         // ä¸Šæ¬¡é¢†å–æ—¶é—´
    total_claimed: u64,           // æ€»é¢†å–æ¬¡æ•°
}
```

#### 3.2 å¿…éœ€åŠŸèƒ½

**åˆå§‹åŒ–æ°´é¾™å¤´**
```move
public entry fun init_faucet(
    admin: &signer,
    amount_per_request: u64,
    cooldown_seconds: u64,
    max_per_user: u64
)
```

**é¢†å–ä»£å¸**
```move
public entry fun claim_from_faucet(user: &signer) 
acquires FaucetConfig, UserClaim, Capabilities
```
- æ£€æŸ¥å†·å´æ—¶é—´
- æ£€æŸ¥é¢†å–æ¬¡æ•°é™åˆ¶
- è‡ªåŠ¨æ³¨å†Œï¼ˆå¦‚æœæœªæ³¨å†Œï¼‰
- é“¸é€ ä»£å¸åˆ°ç”¨æˆ·è´¦æˆ·
- æ›´æ–°é¢†å–è®°å½•

**æŸ¥è¯¢ç”¨æˆ·é¢†å–ä¿¡æ¯**
```move
#[view]
public fun get_user_claim_info(user: address): (u64, u64, u64)
```
è¿”å›ï¼š(ä¸Šæ¬¡é¢†å–æ—¶é—´, æ€»é¢†å–æ¬¡æ•°, è·ç¦»ä¸‹æ¬¡é¢†å–å‰©ä½™ç§’æ•°)

**æ›´æ–°æ°´é¾™å¤´é…ç½®**
```move
public entry fun update_faucet_config(
    admin: &signer,
    amount_per_request: u64,
    cooldown_seconds: u64,
    max_per_user: u64
) acquires FaucetConfig
```

**æš‚åœ/æ¢å¤æ°´é¾™å¤´**
```move
public entry fun set_faucet_active(
    admin: &signer,
    is_active: bool
) acquires FaucetConfig
```

### ğŸ’» æ°´é¾™å¤´ä»£ç æ¡†æ¶

```move
module my_coin::faucet {
    use std::signer;
    use aptos_framework::timestamp;
    use aptos_framework::coin;
    use my_coin::learning_coin::{Self, LearningCoin};

    /// é”™è¯¯ç 
    const ERROR_NOT_ADMIN: u64 = 1;
    const ERROR_COOLDOWN_NOT_PASSED: u64 = 2;
    const ERROR_MAX_CLAIMS_REACHED: u64 = 3;
    const ERROR_FAUCET_INACTIVE: u64 = 4;

    /// æ°´é¾™å¤´é…ç½®
    struct FaucetConfig has key {
        admin: address,
        amount_per_request: u64,
        cooldown_seconds: u64,
        max_per_user: u64,
        is_active: bool,
    }

    /// ç”¨æˆ·é¢†å–è®°å½•
    struct UserClaim has key {
        last_claim_time: u64,
        total_claimed: u64,
    }

    /// TODO: åˆå§‹åŒ–æ°´é¾™å¤´
    public entry fun init_faucet(
        admin: &signer,
        amount_per_request: u64,
        cooldown_seconds: u64,
        max_per_user: u64
    ) {
        // ä½ çš„ä»£ç 
    }

    /// TODO: é¢†å–ä»£å¸
    public entry fun claim_from_faucet(user: &signer) 
    acquires FaucetConfig, UserClaim {
        // ä½ çš„ä»£ç 
    }

    /// TODO: æŸ¥è¯¢é¢†å–ä¿¡æ¯
    #[view]
    public fun get_user_claim_info(user: address): (u64, u64, u64) 
    acquires UserClaim, FaucetConfig {
        // è¿”å›ï¼š(ä¸Šæ¬¡æ—¶é—´, æ€»æ¬¡æ•°, å‰©ä½™ç§’æ•°)
        // ä½ çš„ä»£ç 
    }

    /// TODO: æ›´æ–°é…ç½®
    public entry fun update_faucet_config(
        admin: &signer,
        amount_per_request: u64,
        cooldown_seconds: u64,
        max_per_user: u64
    ) acquires FaucetConfig {
        // ä½ çš„ä»£ç 
    }

    /// TODO: è®¾ç½®æ¿€æ´»çŠ¶æ€
    public entry fun set_faucet_active(
        admin: &signer,
        is_active: bool
    ) acquires FaucetConfig {
        // ä½ çš„ä»£ç 
    }

    /// è¾…åŠ©å‡½æ•°ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºç®¡ç†å‘˜
    fun assert_admin(caller: address) acquires FaucetConfig {
        let config = borrow_global<FaucetConfig>(@my_coin);
        assert!(caller == config.admin, ERROR_NOT_ADMIN);
    }
}
```

### âœ… éªŒè¯æ ‡å‡†
- [ ] æ°´é¾™å¤´å¯ä»¥åˆå§‹åŒ–
- [ ] ç”¨æˆ·å¯ä»¥é¢†å–ä»£å¸
- [ ] å†·å´æ—¶é—´æ­£ç¡®å·¥ä½œ
- [ ] é¢†å–æ¬¡æ•°é™åˆ¶æœ‰æ•ˆ
- [ ] å¯ä»¥æš‚åœ/æ¢å¤æ°´é¾™å¤´
- [ ] ç®¡ç†å‘˜å¯ä»¥æ›´æ–°é…ç½®

---

## ğŸ§ª æµ‹è¯•æŒ‡å—

### ç¼–è¯‘æµ‹è¯•
```bash
cd Day_13_Fungible_Tokenæ ‡å‡†
aptos move compile
```

### å•å…ƒæµ‹è¯•ç¤ºä¾‹

åœ¨ `tests/learning_coin_tests.move` åˆ›å»ºï¼š

```move
#[test_only]
module my_coin::learning_coin_tests {
    use std::signer;
    use aptos_framework::coin;
    use my_coin::learning_coin;

    #[test(admin = @my_coin)]
    fun test_init_and_mint(admin: &signer) {
        // åˆå§‹åŒ–ï¼ˆè‡ªåŠ¨è°ƒç”¨ init_moduleï¼‰
        learning_coin::init_module(admin);

        // æ³¨å†Œç®¡ç†å‘˜è´¦æˆ·
        learning_coin::register(admin);

        // é“¸é€ ä»£å¸
        let admin_addr = signer::address_of(admin);
        learning_coin::mint(admin, admin_addr, 100_00000000);

        // éªŒè¯ä½™é¢
        assert!(learning_coin::balance(admin_addr) == 100_00000000, 0);
    }

    #[test(admin = @my_coin, user = @0x123)]
    fun test_transfer(admin: &signer, user: &signer) {
        // åˆå§‹åŒ–
        learning_coin::init_module(admin);
        learning_coin::register(admin);
        learning_coin::register(user);

        // é“¸é€ ç»™ç®¡ç†å‘˜
        let admin_addr = signer::address_of(admin);
        learning_coin::mint(admin, admin_addr, 100_00000000);

        // è½¬è´¦ç»™ç”¨æˆ·
        let user_addr = signer::address_of(user);
        learning_coin::transfer(admin, user_addr, 10_00000000);

        // éªŒè¯ä½™é¢
        assert!(learning_coin::balance(user_addr) == 10_00000000, 0);
        assert!(learning_coin::balance(admin_addr) == 90_00000000, 1);
    }

    // TODO: æ·»åŠ æ›´å¤šæµ‹è¯•
}
```

### è¿è¡Œæµ‹è¯•
```bash
aptos move test
```

---

## ğŸš€ éƒ¨ç½²æŒ‡å—

### 1. ä¿®æ”¹ Move.toml
```toml
[addresses]
my_coin = "ä½ çš„åœ°å€"
```

### 2. åˆå§‹åŒ–è´¦æˆ·
```bash
aptos init --network testnet
```

### 3. ç¼–è¯‘
```bash
aptos move compile
```

### 4. å‘å¸ƒ
```bash
aptos move publish --named-addresses my_coin=default
```

### 5. è°ƒç”¨å‡½æ•°

**æ³¨å†Œ**
```bash
aptos move run \
  --function-id 'your_addr::learning_coin::register'
```

**é“¸é€ **
```bash
aptos move run \
  --function-id 'your_addr::learning_coin::mint' \
  --args address:0x123 u64:100000000
```

**æŸ¥è¯¢ä½™é¢**
```bash
aptos move view \
  --function-id 'your_addr::learning_coin::balance' \
  --args address:0x123
```

---

## ğŸ“Š è¯„åˆ†æ ‡å‡†

### ä»»åŠ¡ 1ï¼ˆ40 åˆ†ï¼‰
- åˆå§‹åŒ–ä»£å¸ï¼ˆ10 åˆ†ï¼‰
- æ³¨å†ŒåŠŸèƒ½ï¼ˆ5 åˆ†ï¼‰
- é“¸é€ åŠŸèƒ½ï¼ˆ10 åˆ†ï¼‰
- è½¬è´¦åŠŸèƒ½ï¼ˆ10 åˆ†ï¼‰
- æŸ¥è¯¢åŠŸèƒ½ï¼ˆ5 åˆ†ï¼‰

### ä»»åŠ¡ 2ï¼ˆ30 åˆ†ï¼‰
- é”€æ¯åŠŸèƒ½ï¼ˆ10 åˆ†ï¼‰
- æ‰¹é‡è½¬è´¦ï¼ˆ10 åˆ†ï¼‰
- äº‹ä»¶ç³»ç»Ÿï¼ˆ10 åˆ†ï¼‰

### ä»»åŠ¡ 3ï¼ˆ30 åˆ†ï¼‰
- æ°´é¾™å¤´åˆå§‹åŒ–ï¼ˆ5 åˆ†ï¼‰
- é¢†å–åŠŸèƒ½ï¼ˆ10 åˆ†ï¼‰
- å†·å´æ—¶é—´æ§åˆ¶ï¼ˆ5 åˆ†ï¼‰
- æ¬¡æ•°é™åˆ¶ï¼ˆ5 åˆ†ï¼‰
- é…ç½®ç®¡ç†ï¼ˆ5 åˆ†ï¼‰

**æ€»åˆ† 70 åˆ†ä»¥ä¸Šé€šè¿‡**

---

## ğŸ’¡ å¼€å‘æç¤º

### ç²¾åº¦è½¬æ¢
```move
// å‡è®¾ decimals = 8
const DECIMALS: u64 = 100000000;  // 10^8

// 1 ä¸ªä»£å¸
let one_token = 1 * DECIMALS;

// 0.5 ä¸ªä»£å¸
let half_token = DECIMALS / 2;

// 100 ä¸ªä»£å¸
let hundred_tokens = 100 * DECIMALS;
```

### æ£€æŸ¥æ˜¯å¦æ³¨å†Œ
```move
if (!coin::is_account_registered<LearningCoin>(addr)) {
    coin::register<LearningCoin>(account);
};
```

### å®‰å…¨åœ°è·å–å½“å‰æ—¶é—´
```move
use aptos_framework::timestamp;

let now = timestamp::now_seconds();
```

---

**é¢„è®¡å®Œæˆæ—¶é—´**ï¼š
- ä»»åŠ¡ 1ï¼š1.5 å°æ—¶
- ä»»åŠ¡ 2ï¼š1 å°æ—¶  
- ä»»åŠ¡ 3ï¼š1 å°æ—¶

**ç¥ä½ å¼€å‘é¡ºåˆ©ï¼** ğŸš€ğŸ’°
