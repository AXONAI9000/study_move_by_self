# Day 28 å®è·µä»»åŠ¡ï¼šIndexer ä¸ GraphQL æŸ¥è¯¢

## ğŸ“‹ ä»»åŠ¡æ¦‚è¿°

é€šè¿‡ä»Šå¤©çš„å®è·µï¼Œä½ å°†æ„å»ºä¸€ä¸ªå®Œæ•´çš„ Aptos Indexer æ•°æ®æŸ¥è¯¢å·¥å…·ï¼ŒåŒ…æ‹¬ GraphQL å®¢æˆ·ç«¯ã€äº‹ä»¶ç›‘å¬å™¨å’Œæ•°æ®åˆ†æåŠŸèƒ½ã€‚

**æ€»æ—¶é—´**: 3 å°æ—¶
**éš¾åº¦**: â­â­â­â˜†â˜† (ä¸­ç­‰)

---

## ğŸ¯ ä»»åŠ¡åˆ—è¡¨

### ä»»åŠ¡ä¸€ï¼šGraphQL å®¢æˆ·ç«¯å®ç°ï¼ˆ60åˆ†é’Ÿï¼‰â­â­â­

#### ç›®æ ‡
å®ç°ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ GraphQL å®¢æˆ·ç«¯åº“ï¼Œæ”¯æŒæŸ¥è¯¢ã€å˜é‡ã€é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶ã€‚

#### è¦æ±‚

**åŸºç¡€åŠŸèƒ½ï¼ˆå¿…åšï¼‰**ï¼š
1. åˆ›å»º `IndexerClient` ç±»
2. æ”¯æŒåŸºæœ¬çš„ GraphQL æŸ¥è¯¢
3. æ”¯æŒæŸ¥è¯¢å˜é‡
4. å®ç°é”™è¯¯å¤„ç†
5. å®ç°è‡ªåŠ¨é‡è¯•æœºåˆ¶

**é«˜çº§åŠŸèƒ½ï¼ˆé€‰åšï¼‰**ï¼š
6. æ”¯æŒæ‰¹é‡æŸ¥è¯¢
7. å®ç°æŸ¥è¯¢ç¼“å­˜
8. æ”¯æŒæŸ¥è¯¢ç‰‡æ®µ
9. æ·»åŠ è¯·æ±‚æ—¥å¿—

#### å®ç°æç¤º

```typescript
// indexer_client.ts

import axios, { AxiosInstance } from 'axios';

interface GraphQLResponse<T> {
  data?: T;
  errors?: Array<{
    message: string;
    locations?: Array<{ line: number; column: number }>;
    path?: Array<string | number>;
  }>;
}

interface QueryOptions {
  query: string;
  variables?: Record<string, any>;
  operationName?: string;
}

class IndexerClient {
  private client: AxiosInstance;
  private cache: Map<string, { data: any; timestamp: number }>;
  private cacheTTL: number = 60000; // 60ç§’

  constructor(
    private endpoint: string,
    private options: {
      timeout?: number;
      retries?: number;
      cacheEnabled?: boolean;
    } = {}
  ) {
    // TODO: åˆå§‹åŒ– axios å®¢æˆ·ç«¯
    // TODO: åˆå§‹åŒ–ç¼“å­˜
  }

  /**
   * æ‰§è¡Œ GraphQL æŸ¥è¯¢
   */
  async query<T>(options: QueryOptions): Promise<T> {
    // TODO: å®ç°æŸ¥è¯¢é€»è¾‘
    // 1. æ£€æŸ¥ç¼“å­˜
    // 2. å‘é€è¯·æ±‚
    // 3. å¤„ç†é”™è¯¯
    // 4. é‡è¯•æœºåˆ¶
    // 5. æ›´æ–°ç¼“å­˜
    throw new Error('Not implemented');
  }

  /**
   * æ‰¹é‡æŸ¥è¯¢
   */
  async batchQuery<T>(queries: QueryOptions[]): Promise<T[]> {
    // TODO: å®ç°æ‰¹é‡æŸ¥è¯¢
    throw new Error('Not implemented');
  }

  /**
   * æ¸…é™¤ç¼“å­˜
   */
  clearCache(): void {
    // TODO: å®ç°ç¼“å­˜æ¸…é™¤
  }

  /**
   * é‡è¯•é€»è¾‘
   */
  private async executeWithRetry<T>(
    fn: () => Promise<T>,
    retries: number = 3
  ): Promise<T> {
    // TODO: å®ç°é‡è¯•é€»è¾‘
    throw new Error('Not implemented');
  }
}

export default IndexerClient;
```

#### æµ‹è¯•è¦æ±‚

```typescript
// indexer_client.test.ts

describe('IndexerClient', () => {
  let client: IndexerClient;

  beforeEach(() => {
    client = new IndexerClient(
      'https://indexer.testnet.aptoslabs.com/v1/graphql'
    );
  });

  test('åº”è¯¥èƒ½å¤Ÿæ‰§è¡ŒåŸºæœ¬æŸ¥è¯¢', async () => {
    // TODO: æµ‹è¯•åŸºæœ¬æŸ¥è¯¢
  });

  test('åº”è¯¥èƒ½å¤Ÿä½¿ç”¨å˜é‡', async () => {
    // TODO: æµ‹è¯•å˜é‡ä½¿ç”¨
  });

  test('åº”è¯¥èƒ½å¤Ÿå¤„ç†é”™è¯¯', async () => {
    // TODO: æµ‹è¯•é”™è¯¯å¤„ç†
  });

  test('åº”è¯¥èƒ½å¤Ÿé‡è¯•å¤±è´¥çš„è¯·æ±‚', async () => {
    // TODO: æµ‹è¯•é‡è¯•æœºåˆ¶
  });

  test('åº”è¯¥èƒ½å¤Ÿç¼“å­˜æŸ¥è¯¢ç»“æœ', async () => {
    // TODO: æµ‹è¯•ç¼“å­˜åŠŸèƒ½
  });
});
```

#### éªŒæ”¶æ ‡å‡†

- âœ… èƒ½å¤ŸæˆåŠŸæ‰§è¡Œ GraphQL æŸ¥è¯¢
- âœ… æ”¯æŒæŸ¥è¯¢å˜é‡
- âœ… æ­£ç¡®å¤„ç† GraphQL é”™è¯¯å’Œç½‘ç»œé”™è¯¯
- âœ… å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•ï¼ˆæœ€å¤š 3 æ¬¡ï¼‰
- âœ… ç¼“å­˜æŸ¥è¯¢ç»“æœ
- âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡

---

### ä»»åŠ¡äºŒï¼šäº‹ä»¶ç›‘å¬å™¨ï¼ˆ60åˆ†é’Ÿï¼‰â­â­â­â­

#### ç›®æ ‡
å®ç°ä¸€ä¸ªå®æ—¶äº‹ä»¶ç›‘å¬å™¨ï¼Œèƒ½å¤Ÿè®¢é˜…é“¾ä¸Šäº‹ä»¶å¹¶è¿›è¡Œå¤„ç†ã€‚

#### è¦æ±‚

**åŸºç¡€åŠŸèƒ½ï¼ˆå¿…åšï¼‰**ï¼š
1. å®ç° WebSocket è¿æ¥
2. è®¢é˜…ç‰¹å®šç±»å‹çš„äº‹ä»¶
3. å¤„ç†äº‹ä»¶æ•°æ®
4. å®ç°æ–­çº¿é‡è¿
5. å­˜å‚¨äº‹ä»¶åˆ°æœ¬åœ°

**é«˜çº§åŠŸèƒ½ï¼ˆé€‰åšï¼‰**ï¼š
6. æ”¯æŒå¤šä¸ªè®¢é˜…
7. äº‹ä»¶è¿‡æ»¤å’Œè½¬æ¢
8. æ‰¹é‡å¤„ç†äº‹ä»¶
9. äº‹ä»¶é˜Ÿåˆ—ç®¡ç†

#### å®ç°æç¤º

```typescript
// event_listener.ts

import { WebSocketLink } from '@apollo/client/link/ws';
import { ApolloClient, InMemoryCache, gql } from '@apollo/client';
import { SubscriptionClient } from 'subscriptions-transport-ws';
import ws from 'ws';

interface Event {
  transaction_version: string;
  sequence_number: string;
  type: string;
  data: any;
  account_address: string;
}

interface EventHandler {
  (event: Event): void | Promise<void>;
}

class EventListener {
  private client: ApolloClient<any>;
  private subscriptionClient: SubscriptionClient;
  private subscriptions: Map<string, any>;
  private handlers: Map<string, EventHandler[]>;
  private reconnectAttempts: number = 0;
  private maxReconnectAttempts: number = 10;

  constructor(private wsEndpoint: string) {
    // TODO: åˆå§‹åŒ– WebSocket å®¢æˆ·ç«¯
    // TODO: è®¾ç½®é‡è¿é€»è¾‘
    this.subscriptions = new Map();
    this.handlers = new Map();
  }

  /**
   * è®¢é˜…ç‰¹å®šç±»å‹çš„äº‹ä»¶
   */
  subscribe(eventType: string, handler: EventHandler): () => void {
    // TODO: å®ç°è®¢é˜…é€»è¾‘
    // 1. åˆ›å»º GraphQL è®¢é˜…
    // 2. æ³¨å†Œäº‹ä»¶å¤„ç†å™¨
    // 3. è¿”å›å–æ¶ˆè®¢é˜…å‡½æ•°
    throw new Error('Not implemented');
  }

  /**
   * è®¢é˜…å¤šç§äº‹ä»¶ç±»å‹
   */
  subscribeMultiple(
    eventTypes: string[],
    handler: EventHandler
  ): () => void {
    // TODO: å®ç°å¤šç±»å‹è®¢é˜…
    throw new Error('Not implemented');
  }

  /**
   * å–æ¶ˆæ‰€æœ‰è®¢é˜…
   */
  unsubscribeAll(): void {
    // TODO: å–æ¶ˆæ‰€æœ‰è®¢é˜…
  }

  /**
   * å¤„ç†æ”¶åˆ°çš„äº‹ä»¶
   */
  private async handleEvent(event: Event): Promise<void> {
    // TODO: è°ƒç”¨æ³¨å†Œçš„å¤„ç†å™¨
    // TODO: é”™è¯¯å¤„ç†
    // TODO: äº‹ä»¶å­˜å‚¨
  }

  /**
   * é‡è¿é€»è¾‘
   */
  private reconnect(): void {
    // TODO: å®ç°æŒ‡æ•°é€€é¿é‡è¿
  }

  /**
   * å…³é—­è¿æ¥
   */
  close(): void {
    // TODO: æ¸…ç†èµ„æº
  }
}

export default EventListener;
```

#### ä½¿ç”¨ç¤ºä¾‹

```typescript
// example_usage.ts

const listener = new EventListener(
  'wss://indexer.testnet.aptoslabs.com/v1/graphql'
);

// ç›‘å¬è½¬è´¦äº‹ä»¶
const unsubscribe = listener.subscribe(
  '0x1::coin::WithdrawEvent',
  async (event) => {
    console.log('æ”¶åˆ°ææ¬¾äº‹ä»¶:', event);
    
    // å¤„ç†äº‹ä»¶ï¼ˆä¾‹å¦‚å‘é€é€šçŸ¥ï¼‰
    if (event.data.amount > 1000000) {
      console.log('å¤§é¢ææ¬¾è­¦å‘Š!');
    }
  }
);

// 5åˆ†é’Ÿåå–æ¶ˆè®¢é˜…
setTimeout(() => {
  unsubscribe();
  listener.close();
}, 5 * 60 * 1000);
```

#### éªŒæ”¶æ ‡å‡†

- âœ… èƒ½å¤Ÿå»ºç«‹ WebSocket è¿æ¥
- âœ… æˆåŠŸè®¢é˜…äº‹ä»¶
- âœ… æ­£ç¡®æ¥æ”¶å’Œè§£æäº‹ä»¶æ•°æ®
- âœ… æ–­çº¿åè‡ªåŠ¨é‡è¿
- âœ… èƒ½å¤Ÿå–æ¶ˆè®¢é˜…
- âœ… å¤„ç†è®¢é˜…é”™è¯¯

---

### ä»»åŠ¡ä¸‰ï¼šæ•°æ®åˆ†æå·¥å…·ï¼ˆ45åˆ†é’Ÿï¼‰â­â­â­

#### ç›®æ ‡
å¼€å‘ä¸€ä¸ªæ•°æ®åˆ†æå·¥å…·ï¼Œèƒ½å¤ŸæŸ¥è¯¢å’Œåˆ†æé“¾ä¸Šæ•°æ®ï¼Œç”Ÿæˆç»Ÿè®¡æŠ¥å‘Šã€‚

#### è¦æ±‚

**åŸºç¡€åŠŸèƒ½ï¼ˆå¿…åšï¼‰**ï¼š
1. æŸ¥è¯¢è´¦æˆ·çš„äº¤æ˜“å†å²
2. ç»Ÿè®¡äº¤æ˜“æˆåŠŸç‡
3. è®¡ç®—å¹³å‡ Gas ä½¿ç”¨
4. åˆ†ææœ€æ´»è·ƒçš„å‡½æ•°è°ƒç”¨
5. ç”Ÿæˆ JSON æ ¼å¼æŠ¥å‘Š

**é«˜çº§åŠŸèƒ½ï¼ˆé€‰åšï¼‰**ï¼š
6. æ—¶é—´èŒƒå›´è¿‡æ»¤
7. å¯¼å‡º CSV æ ¼å¼
8. å›¾è¡¨ç”Ÿæˆ
9. å¯¹æ¯”åˆ†æå¤šä¸ªè´¦æˆ·

#### å®ç°æç¤º

```typescript
// data_analyzer.ts

import IndexerClient from './indexer_client';
import { writeFileSync } from 'fs';

interface Transaction {
  version: string;
  hash: string;
  sender: string;
  success: boolean;
  gas_used: number;
  timestamp: string;
  entry_function_id_str?: string;
}

interface AnalysisReport {
  account: string;
  totalTransactions: number;
  successRate: number;
  averageGas: number;
  totalGasUsed: number;
  mostUsedFunctions: Array<{ function: string; count: number }>;
  timeRange: {
    from: string;
    to: string;
  };
}

class DataAnalyzer {
  constructor(private client: IndexerClient) {}

  /**
   * åˆ†æè´¦æˆ·æ´»åŠ¨
   */
  async analyzeAccount(
    address: string,
    options: {
      limit?: number;
      fromTimestamp?: string;
      toTimestamp?: string;
    } = {}
  ): Promise<AnalysisReport> {
    // TODO: 1. æŸ¥è¯¢è´¦æˆ·äº¤æ˜“
    const transactions = await this.getAccountTransactions(address, options);

    // TODO: 2. è®¡ç®—ç»Ÿè®¡æ•°æ®
    const stats = this.calculateStats(transactions);

    // TODO: 3. åˆ†æå‡½æ•°è°ƒç”¨
    const functions = this.analyzeFunctions(transactions);

    // TODO: 4. ç”ŸæˆæŠ¥å‘Š
    return {
      account: address,
      totalTransactions: transactions.length,
      successRate: stats.successRate,
      averageGas: stats.averageGas,
      totalGasUsed: stats.totalGas,
      mostUsedFunctions: functions,
      timeRange: {
        from: options.fromTimestamp || '',
        to: options.toTimestamp || ''
      }
    };
  }

  /**
   * æŸ¥è¯¢è´¦æˆ·äº¤æ˜“
   */
  private async getAccountTransactions(
    address: string,
    options: any
  ): Promise<Transaction[]> {
    // TODO: å®ç°äº¤æ˜“æŸ¥è¯¢
    // ä½¿ç”¨åˆ†é¡µè·å–æ‰€æœ‰äº¤æ˜“
    throw new Error('Not implemented');
  }

  /**
   * è®¡ç®—ç»Ÿè®¡æ•°æ®
   */
  private calculateStats(transactions: Transaction[]): {
    successRate: number;
    averageGas: number;
    totalGas: number;
  } {
    // TODO: è®¡ç®—æˆåŠŸç‡
    // TODO: è®¡ç®—å¹³å‡ Gas
    // TODO: è®¡ç®—æ€» Gas
    throw new Error('Not implemented');
  }

  /**
   * åˆ†æå‡½æ•°è°ƒç”¨é¢‘ç‡
   */
  private analyzeFunctions(
    transactions: Transaction[]
  ): Array<{ function: string; count: number }> {
    // TODO: ç»Ÿè®¡å‡½æ•°è°ƒç”¨æ¬¡æ•°
    // TODO: æ’åºè¿”å›å‰ 10 ä¸ª
    throw new Error('Not implemented');
  }

  /**
   * å¯¼å‡ºæŠ¥å‘Š
   */
  async exportReport(
    report: AnalysisReport,
    filename: string,
    format: 'json' | 'csv' = 'json'
  ): Promise<void> {
    // TODO: å®ç°æŠ¥å‘Šå¯¼å‡º
    if (format === 'json') {
      writeFileSync(filename, JSON.stringify(report, null, 2));
    } else {
      // TODO: å®ç° CSV å¯¼å‡º
    }
  }

  /**
   * å¯¹æ¯”åˆ†æå¤šä¸ªè´¦æˆ·
   */
  async compareAccounts(addresses: string[]): Promise<AnalysisReport[]> {
    // TODO: åˆ†æå¤šä¸ªè´¦æˆ·å¹¶è¿”å›å¯¹æ¯”ç»“æœ
    throw new Error('Not implemented');
  }
}

export default DataAnalyzer;
```

#### ä½¿ç”¨ç¤ºä¾‹

```typescript
// example_analysis.ts

const client = new IndexerClient(
  'https://indexer.mainnet.aptoslabs.com/v1/graphql'
);
const analyzer = new DataAnalyzer(client);

// åˆ†æè´¦æˆ·
const report = await analyzer.analyzeAccount(
  '0x1',
  {
    limit: 1000
  }
);

console.log('åˆ†ææŠ¥å‘Š:', report);

// å¯¼å‡ºæŠ¥å‘Š
await analyzer.exportReport(report, 'account_report.json');

// å¯¹æ¯”å¤šä¸ªè´¦æˆ·
const comparison = await analyzer.compareAccounts([
  '0x1',
  '0x2',
  '0x3'
]);
```

#### éªŒæ”¶æ ‡å‡†

- âœ… èƒ½å¤ŸæŸ¥è¯¢è´¦æˆ·çš„å®Œæ•´äº¤æ˜“å†å²
- âœ… æ­£ç¡®è®¡ç®—æˆåŠŸç‡å’Œ Gas ç»Ÿè®¡
- âœ… æ­£ç¡®è¯†åˆ«æœ€å¸¸ç”¨çš„å‡½æ•°
- âœ… ç”Ÿæˆæ ¼å¼æ­£ç¡®çš„ JSON æŠ¥å‘Š
- âœ… èƒ½å¤Ÿå¤„ç†å¤§é‡æ•°æ®ï¼ˆ1000+ äº¤æ˜“ï¼‰

---

### ä»»åŠ¡å››ï¼šæ€§èƒ½ä¼˜åŒ–ï¼ˆ15åˆ†é’Ÿï¼‰â­â­

#### ç›®æ ‡
ä¼˜åŒ–å‰é¢å®ç°çš„å·¥å…·ï¼Œæå‡æŸ¥è¯¢æ•ˆç‡å’Œç”¨æˆ·ä½“éªŒã€‚

#### è¦æ±‚

1. **æŸ¥è¯¢ä¼˜åŒ–**
   - åªæŸ¥è¯¢éœ€è¦çš„å­—æ®µ
   - ä½¿ç”¨ç´¢å¼•å­—æ®µè¿‡æ»¤
   - å®ç°åˆç†çš„åˆ†é¡µ

2. **ç¼“å­˜å®ç°**
   - ç¼“å­˜ä¸å¸¸å˜åŒ–çš„æ•°æ®
   - å®ç° TTL æœºåˆ¶
   - ç¼“å­˜å¤±æ•ˆç­–ç•¥

3. **å¹¶å‘æ§åˆ¶**
   - é™åˆ¶å¹¶å‘æŸ¥è¯¢æ•°
   - è¯·æ±‚é˜Ÿåˆ—ç®¡ç†

4. **é”™è¯¯å¤„ç†**
   - ä¼˜é›…é™çº§
   - è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
   - ç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯

#### å®ç°æç¤º

```typescript
// performance_optimizer.ts

class PerformanceOptimizer {
  private requestQueue: Array<() => Promise<any>> = [];
  private activeRequests: number = 0;
  private maxConcurrent: number = 5;

  /**
   * é™åˆ¶å¹¶å‘è¯·æ±‚
   */
  async throttle<T>(fn: () => Promise<T>): Promise<T> {
    // TODO: å®ç°å¹¶å‘æ§åˆ¶
    throw new Error('Not implemented');
  }

  /**
   * æ‰¹é‡æŸ¥è¯¢ä¼˜åŒ–
   */
  async optimizeBatchQuery(queries: any[]): any[] {
    // TODO: åˆå¹¶ç›¸ä¼¼çš„æŸ¥è¯¢
    // TODO: å»é‡
    throw new Error('Not implemented');
  }
}
```

#### éªŒæ”¶æ ‡å‡†

- âœ… æŸ¥è¯¢æ—¶é—´å‡å°‘ 30% ä»¥ä¸Š
- âœ… ç¼“å­˜å‘½ä¸­ç‡ > 50%
- âœ… å¹¶å‘è¯·æ±‚ä¸è¶…è¿‡é™åˆ¶
- âœ… æ‰€æœ‰é”™è¯¯éƒ½è¢«å¦¥å–„å¤„ç†

---

## ğŸ“Š å®Œæˆæ ‡å‡†

### å¿…é¡»å®Œæˆ
- âœ… ä»»åŠ¡ä¸€ï¼šGraphQL å®¢æˆ·ç«¯ï¼ˆåŸºç¡€åŠŸèƒ½ï¼‰
- âœ… ä»»åŠ¡äºŒï¼šäº‹ä»¶ç›‘å¬å™¨ï¼ˆåŸºç¡€åŠŸèƒ½ï¼‰
- âœ… ä»»åŠ¡ä¸‰ï¼šæ•°æ®åˆ†æå·¥å…·ï¼ˆåŸºç¡€åŠŸèƒ½ï¼‰
- âœ… æ‰€æœ‰ä»£ç é€šè¿‡æµ‹è¯•
- âœ… ä»£ç æœ‰é€‚å½“çš„æ³¨é‡Š

### åŠ åˆ†é¡¹
- â­ å®Œæˆæ‰€æœ‰é«˜çº§åŠŸèƒ½
- â­ ä»»åŠ¡å››ï¼šæ€§èƒ½ä¼˜åŒ–
- â­ ç¼–å†™å®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹
- â­ æä¾›ä½¿ç”¨æ–‡æ¡£
- â­ ä»£ç è´¨é‡é«˜ï¼Œç»“æ„æ¸…æ™°

---

## ğŸ§ª æµ‹è¯•æŒ‡å—

### å•å…ƒæµ‹è¯•

```bash
# å®‰è£…ä¾èµ–
npm install --save-dev jest @types/jest ts-jest

# è¿è¡Œæµ‹è¯•
npm test
```

### é›†æˆæµ‹è¯•

```typescript
// integration.test.ts

describe('Integration Tests', () => {
  test('å®Œæ•´å·¥ä½œæµï¼šæŸ¥è¯¢ -> åˆ†æ -> å¯¼å‡º', async () => {
    // 1. åˆ›å»ºå®¢æˆ·ç«¯
    const client = new IndexerClient('...');
    
    // 2. æŸ¥è¯¢æ•°æ®
    const data = await client.query({...});
    
    // 3. åˆ†ææ•°æ®
    const analyzer = new DataAnalyzer(client);
    const report = await analyzer.analyzeAccount('0x1');
    
    // 4. å¯¼å‡ºæŠ¥å‘Š
    await analyzer.exportReport(report, 'test_report.json');
    
    // 5. éªŒè¯ç»“æœ
    expect(report.totalTransactions).toBeGreaterThan(0);
  });
});
```

---

## ğŸ’¡ æç¤ºå’ŒæŠ€å·§

### GraphQL æŸ¥è¯¢ä¼˜åŒ–

```graphql
# âœ… å¥½çš„æŸ¥è¯¢
query GetTransactions($limit: Int!) {
  transactions(limit: $limit) {
    version    # åªæŸ¥è¯¢éœ€è¦çš„å­—æ®µ
    sender
    success
  }
}

# âŒ ä¸å¥½çš„æŸ¥è¯¢
query GetTransactions {
  transactions {
    version
    hash
    sender
    payload    # å¾ˆå¤§çš„å­—æ®µ
    events     # å¾ˆå¤šæ•°æ®
    changes    # ä¸éœ€è¦çš„æ•°æ®
  }
}
```

### é”™è¯¯å¤„ç†æ¨¡å¼

```typescript
try {
  const result = await client.query({...});
  return result;
} catch (error) {
  if (error.networkError) {
    // ç½‘ç»œé”™è¯¯ - é‡è¯•
    return await retry(() => client.query({...}));
  } else if (error.graphQLErrors) {
    // GraphQL é”™è¯¯ - è®°å½•å¹¶è¿”å›å‹å¥½æ¶ˆæ¯
    console.error('GraphQL errors:', error.graphQLErrors);
    throw new Error('æŸ¥è¯¢å¤±è´¥ï¼Œè¯·æ£€æŸ¥å‚æ•°');
  } else {
    // æœªçŸ¥é”™è¯¯
    throw error;
  }
}
```

### ç¼“å­˜ç­–ç•¥

```typescript
// ç¼“å­˜é”®ç”Ÿæˆ
function getCacheKey(query: string, variables: any): string {
  return `${query}:${JSON.stringify(variables)}`;
}

// ç¼“å­˜æ£€æŸ¥
const cacheKey = getCacheKey(query, variables);
const cached = cache.get(cacheKey);

if (cached && Date.now() - cached.timestamp < TTL) {
  return cached.data;  // è¿”å›ç¼“å­˜
}

// è·å–æ–°æ•°æ®å¹¶ç¼“å­˜
const data = await fetchData();
cache.set(cacheKey, { data, timestamp: Date.now() });
```

---

## ğŸ“š å‚è€ƒèµ„æº

### GraphQL å®¢æˆ·ç«¯åº“
- [Apollo Client](https://www.apollographql.com/docs/react/)
- [urql](https://formidable.com/open-source/urql/)
- [graphql-request](https://github.com/prisma-labs/graphql-request)

### TypeScript å·¥å…·
- [TypeScript GraphQL Code Generator](https://www.graphql-code-generator.com/)
- [ts-node](https://typestrong.org/ts-node/)

### æµ‹è¯•æ¡†æ¶
- [Jest](https://jestjs.io/)
- [Vitest](https://vitest.dev/)

---

## ğŸ¯ æäº¤æ¸…å•

å®Œæˆåï¼Œç¡®ä¿ä½ æœ‰ï¼š

- [ ] `indexer_client.ts` - GraphQL å®¢æˆ·ç«¯å®ç°
- [ ] `event_listener.ts` - äº‹ä»¶ç›‘å¬å™¨å®ç°
- [ ] `data_analyzer.ts` - æ•°æ®åˆ†æå·¥å…·å®ç°
- [ ] `*.test.ts` - æµ‹è¯•æ–‡ä»¶
- [ ] `README.md` - ä½¿ç”¨æ–‡æ¡£
- [ ] è‡³å°‘ä¸€ä¸ªç”Ÿæˆçš„åˆ†ææŠ¥å‘Šç¤ºä¾‹

---

## ğŸŒŸ æŒ‘æˆ˜ä»»åŠ¡ï¼ˆå¯é€‰ï¼‰

å¦‚æœä½ å®Œæˆäº†æ‰€æœ‰åŸºç¡€ä»»åŠ¡ï¼Œå¯ä»¥å°è¯•ï¼š

1. **å®ç°ä¸€ä¸ªç®€å•çš„ Web ç•Œé¢**
   - æ˜¾ç¤ºå®æ—¶äº‹ä»¶æµ
   - å±•ç¤ºè´¦æˆ·åˆ†æç»“æœ
   - æ”¯æŒäº¤äº’å¼æŸ¥è¯¢

2. **æ„å»º MEV æœºä¼šæ‰«æå™¨**
   - ç›‘å¬ DEX äº¤æ˜“
   - æ£€æµ‹å¥—åˆ©æœºä¼š
   - è®¡ç®—æ½œåœ¨æ”¶ç›Š

3. **å¼€å‘æ•°æ®å¯¼å‡ºå·¥å…·**
   - æ”¯æŒå¤šç§æ ¼å¼ï¼ˆJSON, CSV, Excelï¼‰
   - ç”Ÿæˆå›¾è¡¨å’Œå¯è§†åŒ–
   - å®šæ—¶æŠ¥å‘Šç”Ÿæˆ

---

**ç¥ä½ å®è·µé¡ºåˆ©ï¼è®°å¾—é‡åˆ°é—®é¢˜æ—¶æŸ¥é˜…ç†è®ºå­¦ä¹ ææ–™å’Œ API æ–‡æ¡£ã€‚ğŸš€**
