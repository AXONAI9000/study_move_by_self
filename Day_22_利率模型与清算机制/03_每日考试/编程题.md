# Day 22 æ¯æ—¥è€ƒè¯• - ç¼–ç¨‹é¢˜

## ğŸ“‹ è€ƒè¯•è¯´æ˜

- **é¢˜ç›®æ•°é‡**: 5 é“ç¼–ç¨‹é¢˜
- **æ¯é¢˜åˆ†å€¼**: 1 åˆ†
- **æ€»åˆ†**: 5 åˆ†
- **åŠæ ¼åˆ†æ•°**: 3.5 åˆ†ï¼ˆ70%ï¼‰
- **è€ƒè¯•æ—¶é—´**: 60 åˆ†é’Ÿ

---

## ğŸ’» ç¼–ç¨‹é¢˜

### ç¬¬ 1 é¢˜ï¼šåˆ©ç‡è®¡ç®—ï¼ˆ1åˆ†ï¼‰

#### é¢˜ç›®æè¿°

å®ç°ä¸€ä¸ªå‡½æ•°ï¼Œè®¡ç®—ç»™å®šä½¿ç”¨ç‡ä¸‹çš„å€Ÿæ¬¾åˆ©ç‡ï¼ˆä½¿ç”¨è·³è·ƒåˆ©ç‡æ¨¡å‹ï¼‰ã€‚

#### å‡½æ•°ç­¾å

```move
public fun calculate_borrow_rate(
    base_rate: u128,           // åŸºç¡€åˆ©ç‡ï¼Œç²¾åº¦ 1e18
    optimal_utilization: u128, // æœ€ä¼˜ä½¿ç”¨ç‡ï¼Œç²¾åº¦ 1e18
    slope_1: u128,             // æ–œç‡ 1ï¼Œç²¾åº¦ 1e18
    slope_2: u128,             // æ–œç‡ 2ï¼Œç²¾åº¦ 1e18
    utilization: u128          // å½“å‰ä½¿ç”¨ç‡ï¼Œç²¾åº¦ 1e18
): u128
```

#### è¦æ±‚

1. å½“ä½¿ç”¨ç‡ â‰¤ æœ€ä¼˜ä½¿ç”¨ç‡æ—¶ï¼Œä½¿ç”¨æ–œç‡ 1
2. å½“ä½¿ç”¨ç‡ > æœ€ä¼˜ä½¿ç”¨ç‡æ—¶ï¼Œä½¿ç”¨æ–œç‡ 2
3. ç²¾åº¦ä½¿ç”¨ 1e18

#### æµ‹è¯•ç”¨ä¾‹

```
è¾“å…¥:
  base_rate = 0
  optimal_utilization = 0.8 Ã— 10^18
  slope_1 = 0.04 Ã— 10^18
  slope_2 = 0.6 Ã— 10^18
  utilization = 0.9 Ã— 10^18

è¾“å‡º:
  0.34 Ã— 10^18 (34%)

è®¡ç®—è¿‡ç¨‹:
  è¶…å‡ºéƒ¨åˆ† = (0.9 - 0.8) / (1.0 - 0.8) = 0.5
  å€Ÿæ¬¾åˆ©ç‡ = 0 + 0.04 + 0.5 Ã— 0.6 = 0.34
```

#### ä½ çš„å®ç°

```move
// åœ¨è¿™é‡Œç¼–å†™ä½ çš„ä»£ç 




```

---

### ç¬¬ 2 é¢˜ï¼šåˆ©æ¯æŒ‡æ•°æ›´æ–°ï¼ˆ1åˆ†ï¼‰

#### é¢˜ç›®æè¿°

å®ç°ä¸€ä¸ªå‡½æ•°ï¼Œæ ¹æ®åˆ©ç‡å’Œæ—¶é—´é—´éš”æ›´æ–°åˆ©æ¯æŒ‡æ•°ã€‚

#### å‡½æ•°ç­¾å

```move
public fun update_interest_index(
    old_index: u128,      // æ—§æŒ‡æ•°ï¼Œç²¾åº¦ 1e18
    rate_per_second: u128, // æ¯ç§’åˆ©ç‡ï¼Œç²¾åº¦ 1e18
    time_delta: u64       // æ—¶é—´é—´éš”ï¼ˆç§’ï¼‰
): u128
```

#### å…¬å¼

```
new_index = old_index Ã— (1 + rate_per_second Ã— time_delta)
```

#### æµ‹è¯•ç”¨ä¾‹

```
è¾“å…¥:
  old_index = 1.0 Ã— 10^18
  rate_per_second = 0.0000000031709 Ã— 10^18 (çº¦ 10% APR)
  time_delta = 864000 (10 å¤©)

è¾“å‡º:
  â‰ˆ 1.00274 Ã— 10^18

è®¡ç®—:
  interest_factor = 1 + 0.0000000031709 Ã— 864000 = 1.00274
  new_index = 1.0 Ã— 1.00274 = 1.00274
```

#### ä½ çš„å®ç°

```move
// åœ¨è¿™é‡Œç¼–å†™ä½ çš„ä»£ç 




```

---

### ç¬¬ 3 é¢˜ï¼šå¥åº·å› å­è®¡ç®—ï¼ˆ1åˆ†ï¼‰

#### é¢˜ç›®æè¿°

å®ç°ä¸€ä¸ªå‡½æ•°ï¼Œè®¡ç®—ç”¨æˆ·çš„å¥åº·å› å­ã€‚

#### å‡½æ•°ç­¾å

```move
public fun calculate_health_factor(
    collateral_balance: u128, // æŠµæŠ¼å“ä½™é¢
    collateral_price: u128,   // æŠµæŠ¼å“ä»·æ ¼ï¼Œç²¾åº¦ 1e8
    collateral_factor: u128,  // æŠµæŠ¼ç‡ï¼Œç²¾åº¦ 1e18
    borrow_balance: u128,     // å€Ÿæ¬¾ä½™é¢
    borrow_price: u128        // å€Ÿæ¬¾ä»·æ ¼ï¼Œç²¾åº¦ 1e8
): u128
```

#### å…¬å¼

```
HF = (collateral_balance Ã— collateral_price Ã— collateral_factor) / (borrow_balance Ã— borrow_price)
```

#### ç‰¹æ®Šæƒ…å†µ

- å¦‚æœå€Ÿæ¬¾ä½™é¢ä¸º 0ï¼Œè¿”å› `1_000_000_000_000_000_000_000`ï¼ˆè¡¨ç¤ºæ— ç©·å¤§ï¼‰

#### æµ‹è¯•ç”¨ä¾‹

```
è¾“å…¥:
  collateral_balance = 100_000_000 (1 ETH, 8ä½å°æ•°)
  collateral_price = 200_000_000_000 ($2000, ç²¾åº¦ 1e8)
  collateral_factor = 750_000_000_000_000_000 (75%, ç²¾åº¦ 1e18)
  borrow_balance = 1200_000_000 (1200 USDC, 6ä½å°æ•°ï¼Œè½¬ä¸º8ä½)
  borrow_price = 100_000_000 ($1, ç²¾åº¦ 1e8)

è¾“å‡º:
  1.25 Ã— 10^18

è®¡ç®—:
  collateral_value = 100_000_000 Ã— 200_000_000_000 / 1e8 = 2000 (USD)
  collateral_power = 2000 Ã— 0.75 = 1500
  borrow_value = 120_000_000_000 Ã— 100_000_000 / 1e8 = 1200 (USD)
  HF = 1500 / 1200 = 1.25
```

#### ä½ çš„å®ç°

```move
// åœ¨è¿™é‡Œç¼–å†™ä½ çš„ä»£ç 




```

---

### ç¬¬ 4 é¢˜ï¼šæ¸…ç®—é‡‘é¢è®¡ç®—ï¼ˆ1åˆ†ï¼‰

#### é¢˜ç›®æè¿°

å®ç°ä¸€ä¸ªå‡½æ•°ï¼Œè®¡ç®—æ¸…ç®—æ—¶åº”è·å¾—çš„æŠµæŠ¼å“æ•°é‡ã€‚

#### å‡½æ•°ç­¾å

```move
public fun calculate_collateral_to_seize(
    repay_amount: u128,          // å¿è¿˜çš„å€ºåŠ¡é‡‘é¢
    repay_price: u128,           // å€ºåŠ¡èµ„äº§ä»·æ ¼ï¼Œç²¾åº¦ 1e8
    collateral_price: u128,      // æŠµæŠ¼å“ä»·æ ¼ï¼Œç²¾åº¦ 1e8
    liquidation_incentive: u128  // æ¸…ç®—å¥–åŠ±ç‡ï¼Œç²¾åº¦ 1e18
): u128
```

#### å…¬å¼

```
collateral = (repay_amount Ã— (1 + liquidation_incentive) Ã— repay_price) / collateral_price
```

#### æµ‹è¯•ç”¨ä¾‹

```
è¾“å…¥:
  repay_amount = 1000_000_000 (1000 USDC, 6ä½å°æ•°ï¼Œè½¬ä¸º8ä½)
  repay_price = 100_000_000 ($1, ç²¾åº¦ 1e8)
  collateral_price = 200_000_000_000 ($2000, ç²¾åº¦ 1e8)
  liquidation_incentive = 100_000_000_000_000_000 (10%, ç²¾åº¦ 1e18)

è¾“å‡º:
  55_000_000 (0.55 ETH)

è®¡ç®—:
  repay_value = 100_000_000_000 Ã— 100_000_000 / 1e8 = 1000 USD
  incentive_value = 1000 Ã— 0.10 = 100 USD
  total_value = 1000 + 100 = 1100 USD
  collateral = 1100 Ã— 1e8 / 200_000_000_000 = 55_000_000
```

#### ä½ çš„å®ç°

```move
// åœ¨è¿™é‡Œç¼–å†™ä½ çš„ä»£ç 




```

---

### ç¬¬ 5 é¢˜ï¼šæ¸…ç®—æ£€æŸ¥ï¼ˆ1åˆ†ï¼‰

#### é¢˜ç›®æè¿°

å®ç°ä¸€ä¸ªå®Œæ•´çš„æ¸…ç®—æ£€æŸ¥å‡½æ•°ï¼Œåˆ¤æ–­ç”¨æˆ·æ˜¯å¦å¯ä»¥è¢«æ¸…ç®—ï¼Œå¹¶è®¡ç®—æœ€å¤§æ¸…ç®—é‡‘é¢ã€‚

#### å‡½æ•°ç­¾å

```move
public fun check_liquidation(
    health_factor: u128,     // å¥åº·å› å­ï¼Œç²¾åº¦ 1e18
    total_borrow: u128,      // æ€»å€Ÿæ¬¾
    close_factor: u128       // æ¸…ç®—æ¯”ä¾‹ï¼Œç²¾åº¦ 1e18
): (bool, u128) // (æ˜¯å¦å¯æ¸…ç®—, æœ€å¤§æ¸…ç®—é‡‘é¢)
```

#### è§„åˆ™

1. å¥åº·å› å­ < 1.0 Ã— 10^18 æ—¶å¯æ¸…ç®—
2. æœ€å¤§æ¸…ç®—é‡‘é¢ = æ€»å€Ÿæ¬¾ Ã— close_factor

#### æµ‹è¯•ç”¨ä¾‹

```
æµ‹è¯• 1 - å¯æ¸…ç®—:
è¾“å…¥:
  health_factor = 0.95 Ã— 10^18
  total_borrow = 2000_000_000 (2000 USDC)
  close_factor = 0.5 Ã— 10^18 (50%)

è¾“å‡º:
  (true, 1000_000_000)

æµ‹è¯• 2 - ä¸å¯æ¸…ç®—:
è¾“å…¥:
  health_factor = 1.2 Ã— 10^18
  total_borrow = 2000_000_000
  close_factor = 0.5 Ã— 10^18

è¾“å‡º:
  (false, 0)
```

#### ä½ çš„å®ç°

```move
// åœ¨è¿™é‡Œç¼–å†™ä½ çš„ä»£ç 




```

---

## âœ… æäº¤è¯´æ˜

1. å°†ä½ çš„ç­”æ¡ˆå†™åœ¨æ¯é“é¢˜ä¸‹æ–¹çš„ä»£ç å—ä¸­
2. ç¡®ä¿ä»£ç å¯ä»¥ç¼–è¯‘é€šè¿‡
3. æµ‹è¯•ä½ çš„å®ç°æ˜¯å¦ç¬¦åˆæµ‹è¯•ç”¨ä¾‹

---

## ğŸ“Š è¯„åˆ†æ ‡å‡†

æ¯é“é¢˜æ ¹æ®ä»¥ä¸‹æ ‡å‡†è¯„åˆ†ï¼š

- **1.0 åˆ†**: å®Œå…¨æ­£ç¡®ï¼Œé€šè¿‡æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹
- **0.7 åˆ†**: é€»è¾‘åŸºæœ¬æ­£ç¡®ï¼Œæœ‰å°é”™è¯¯
- **0.5 åˆ†**: éƒ¨åˆ†æ­£ç¡®ï¼Œæœ‰æ˜æ˜¾é”™è¯¯
- **0.0 åˆ†**: å®Œå…¨é”™è¯¯æˆ–æœªå®Œæˆ

---

## ğŸ’¡ æç¤º

### ç²¾åº¦å¤„ç†

```move
const PRECISION: u128 = 1_000_000_000_000_000_000; // 1e18
const PRICE_PRECISION: u128 = 100_000_000; // 1e8

// ä¹˜æ³•åé™¤ä»¥ç²¾åº¦
let result = (a * b) / PRECISION;
```

### å¸¸è§é”™è¯¯

1. **ç²¾åº¦æ··æ·†**: æ³¨æ„ä»·æ ¼ç²¾åº¦æ˜¯ 1e8ï¼Œåˆ©ç‡ç²¾åº¦æ˜¯ 1e18
2. **è¿ç®—é¡ºåº**: å…ˆä¹˜åé™¤ï¼Œé¿å…ç²¾åº¦ä¸¢å¤±
3. **æº¢å‡ºæ£€æŸ¥**: æ³¨æ„ä¸­é—´ç»“æœå¯èƒ½æº¢å‡º
4. **è¾¹ç•Œæƒ…å†µ**: ä¸è¦å¿˜è®°å¤„ç†é™¤é›¶ã€æ— ç©·å¤§ç­‰æƒ…å†µ

---

**å®Œæˆåè¯·æŸ¥çœ‹ `ç­”æ¡ˆè§£æ.md` æ ¸å¯¹ç­”æ¡ˆï¼**
