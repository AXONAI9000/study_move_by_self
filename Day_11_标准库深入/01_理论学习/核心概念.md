# Move æ ‡å‡†åº“æ·±å…¥ï¼šæ ¸å¿ƒæ¦‚å¿µ

## ç¬¬ä¸€éƒ¨åˆ†ï¼šVector æ¨¡å—æ·±å…¥

### 1.1 Vector åŸºç¡€

**Vector** æ˜¯ Move ä¸­æœ€åŸºç¡€çš„åŠ¨æ€æ•°ç»„ç±»å‹ï¼Œç±»ä¼¼äºå…¶ä»–è¯­è¨€çš„ ArrayList æˆ– Vecã€‚

**åŸºæœ¬ç‰¹æ€§**ï¼š
- åŠ¨æ€å¤§å°ï¼Œå¯å¢é•¿å’Œæ”¶ç¼©
- å…ƒç´ ç±»å‹å¿…é¡»ç›¸åŒ
- æŒ‰ç´¢å¼•è®¿é—®ï¼ŒO(1) æ—¶é—´å¤æ‚åº¦
- åœ¨æœ«å°¾æ·»åŠ /åˆ é™¤å…ƒç´ æ•ˆç‡é«˜

**ç±»æ¯”**ï¼š
- å°±åƒä¸€æ’åº§ä½ï¼Œå¯ä»¥åœ¨æœ«å°¾æ·»åŠ æ–°åº§ä½
- è®¿é—®ä»»æ„åº§ä½å·å¾ˆå¿«
- ä½†åœ¨ä¸­é—´æ’åº§ä½å¾ˆæ…¢ï¼ˆè¦ç§»åŠ¨åé¢æ‰€æœ‰åº§ä½ï¼‰

### 1.2 Vector åŸºæœ¬æ“ä½œ

```move
use std::vector;

// åˆ›å»ºç©º vector
let v = vector::empty<u64>();

// åˆ›å»ºå¸¦åˆå§‹å€¼çš„ vector
let v = vector::singleton(42);  // [42]

// æ·»åŠ å…ƒç´ 
vector::push_back(&mut v, 100);  // [42, 100]

// è·å–é•¿åº¦
let len = vector::length(&v);  // 2

// è®¿é—®å…ƒç´ 
let first = vector::borrow(&v, 0);  // &42
let last = vector::borrow(&v, len - 1);  // &100

// ä¿®æ”¹å…ƒç´ 
let first_mut = vector::borrow_mut(&mut v, 0);
*first_mut = 99;  // v = [99, 100]

// ç§»é™¤æœ«å°¾å…ƒç´ 
let last_value = vector::pop_back(&mut v);  // 100, v = [99]

// æ£€æŸ¥æ˜¯å¦ä¸ºç©º
let is_empty = vector::is_empty(&v);  // false
```

### 1.3 Vector é«˜çº§æ“ä½œ

#### æ‰¹é‡æ“ä½œ

```move
// è¿½åŠ å¦ä¸€ä¸ª vector
let v1 = vector[1, 2, 3];
let v2 = vector[4, 5, 6];
vector::append(&mut v1, v2);  // v1 = [1,2,3,4,5,6]

// åè½¬
vector::reverse(&mut v);  // [6,5,4,3,2,1]

// äº¤æ¢ä¸¤ä¸ªå…ƒç´ 
vector::swap(&mut v, 0, 5);  // [1,5,4,3,2,6]

// ç§»é™¤æŒ‡å®šä½ç½®å…ƒç´ ï¼ˆæ…¢ï¼ï¼‰
let removed = vector::remove(&mut v, 2);  // ç§»é™¤ç´¢å¼•2çš„å…ƒç´ 
// âš ï¸ è¿™ä¸ªæ“ä½œéœ€è¦ç§»åŠ¨åé¢æ‰€æœ‰å…ƒç´ ï¼ŒO(n) å¤æ‚åº¦

// å¿«é€Ÿç§»é™¤ï¼ˆä¸ä¿æŒé¡ºåºï¼‰
let removed = vector::swap_remove(&mut v, 2);
// å°†æœ€åä¸€ä¸ªå…ƒç´ ç§»åˆ°è¢«åˆ é™¤ä½ç½®ï¼ŒO(1) å¤æ‚åº¦
```

#### æŸ¥æ‰¾æ“ä½œ

```move
// æŸ¥æ‰¾å…ƒç´ æ˜¯å¦å­˜åœ¨
let exists = vector::contains(&v, &42);

// æŸ¥æ‰¾å…ƒç´ ç´¢å¼•
let (found, index) = vector::index_of(&v, &42);
if (found) {
    // index æ˜¯å…ƒç´ çš„ä½ç½®
};
```

#### éå†æ“ä½œ

```move
// æ–¹æ³•1ï¼šä½¿ç”¨ for å¾ªç¯
let i = 0;
let len = vector::length(&v);
while (i < len) {
    let elem = vector::borrow(&v, i);
    // å¤„ç† elem
    i = i + 1;
};

// æ–¹æ³•2ï¼šä½¿ç”¨ for_eachï¼ˆéœ€è¦é«˜é˜¶å‡½æ•°ï¼‰
// æ³¨æ„ï¼šæ ‡å‡†åº“å¯èƒ½æ²¡æœ‰æä¾›ï¼Œéœ€è¦è‡ªå·±å®ç°
```

### 1.4 Vector æ€§èƒ½è€ƒè™‘

| æ“ä½œ | æ—¶é—´å¤æ‚åº¦ | Gas æˆæœ¬ | è¯´æ˜ |
|------|-----------|----------|------|
| `push_back` | O(1) | ä½ | æœ«å°¾æ·»åŠ  |
| `pop_back` | O(1) | ä½ | æœ«å°¾åˆ é™¤ |
| `borrow` | O(1) | æä½ | ç´¢å¼•è®¿é—® |
| `length` | O(1) | æä½ | è·å–é•¿åº¦ |
| `remove` | O(n) | é«˜ | åˆ é™¤å¹¶ä¿æŒé¡ºåº |
| `swap_remove` | O(1) | ä½ | åˆ é™¤ä¸ä¿æŒé¡ºåº |
| `insert` | O(n) | é«˜ | åœ¨ä¸­é—´æ’å…¥ |
| `contains` | O(n) | ä¸­-é«˜ | çº¿æ€§æŸ¥æ‰¾ |

**æœ€ä½³å®è·µ**ï¼š
- âœ… ä¼˜å…ˆåœ¨æœ«å°¾æ“ä½œï¼ˆpush_backã€pop_backï¼‰
- âœ… å¦‚æœä¸éœ€è¦ä¿æŒé¡ºåºï¼Œä½¿ç”¨ swap_remove
- âŒ é¿å…é¢‘ç¹åœ¨ä¸­é—´æ’å…¥/åˆ é™¤
- âŒ é¿å…å­˜å‚¨è¶…å¤§ vectorï¼ˆå»ºè®® < 1000 å…ƒç´ ï¼‰

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šTable æ¨¡å—

### 2.1 Table åŸºç¡€

**Table** æ˜¯ Aptos ç‰¹æœ‰çš„é”®å€¼å­˜å‚¨ç»“æ„ï¼Œç±»ä¼¼äº HashMapã€‚

**æ ¸å¿ƒç‰¹ç‚¹**ï¼š
- é”®å€¼å¯¹å­˜å‚¨
- O(1) éšæœºè®¿é—®
- ä¸å¯è¿­ä»£ï¼ˆæ— æ³•éå†æ‰€æœ‰é”®ï¼‰
- å¿…é¡»é…åˆ `store` èƒ½åŠ›ä½¿ç”¨

**ç±»æ¯”**ï¼š
- åƒä¸€ä¸ªå·¨å¤§çš„å‚¨ç‰©æŸœï¼Œæ¯ä¸ªæŸœå­æœ‰ç¼–å·ï¼ˆkeyï¼‰
- çŸ¥é“ç¼–å·å°±èƒ½ç«‹å³æ‰¾åˆ°ç‰©å“ï¼ˆvalueï¼‰
- ä½†æ— æ³•åˆ—å‡ºæ‰€æœ‰æŸœå­çš„ç¼–å·

### 2.2 Table åŸºæœ¬æ“ä½œ

```move
use aptos_std::table::{Self, Table};

// åˆ›å»º Table
let t = table::new<address, u64>();

// æ·»åŠ é”®å€¼å¯¹
table::add(&mut t, @0x1, 100);
table::add(&mut t, @0x2, 200);

// æ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨
let exists = table::contains(&t, @0x1);  // true

// å€Ÿç”¨å€¼ï¼ˆåªè¯»ï¼‰
if (table::contains(&t, @0x1)) {
    let value = table::borrow(&t, @0x1);  // &100
};

// å€Ÿç”¨å¯å˜å¼•ç”¨
let value_mut = table::borrow_mut(&mut t, @0x1);
*value_mut = 150;

// ç§»é™¤é”®å€¼å¯¹
let value = table::remove(&mut t, @0x1);  // 150

// è·å–é»˜è®¤å€¼ï¼ˆå¦‚æœé”®ä¸å­˜åœ¨ï¼‰
let value = table::borrow_with_default(&t, @0x3, &300);  // &300
```

### 2.3 Table é«˜çº§ç”¨æ³•

#### upsert æ“ä½œï¼ˆæ’å…¥æˆ–æ›´æ–°ï¼‰

```move
// æ–¹æ³•1ï¼šæ‰‹åŠ¨æ£€æŸ¥
if (table::contains(&mut t, key)) {
    let value = table::borrow_mut(&mut t, key);
    *value = new_value;
} else {
    table::add(&mut t, key, new_value);
};

// æ–¹æ³•2ï¼šä½¿ç”¨ upsertï¼ˆå¦‚æœå¯ç”¨ï¼‰
table::upsert(&mut t, key, new_value);
```

#### borrow_mut_with_default

```move
// è·å–æˆ–åˆ›å»ºé»˜è®¤å€¼
let value_mut = table::borrow_mut_with_default(&mut t, key, default_value);
*value_mut += delta;
// å¦‚æœ key ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨æ’å…¥ default_value
// ç„¶åè¿”å›å¯å˜å¼•ç”¨
```

### 2.4 Table çš„é™åˆ¶

**ä¸èƒ½åšçš„äº‹**ï¼š
```move
// âŒ æ— æ³•è·å–æ‰€æœ‰é”®
// let all_keys = table::keys(&t);  // ä¸å­˜åœ¨è¿™ä¸ªå‡½æ•°

// âŒ æ— æ³•éå†æ‰€æœ‰å€¼
// for (key, value) in table::iter(&t) { }  // ä¸å­˜åœ¨

// âŒ æ— æ³•è·å–å¤§å°
// let size = table::length(&t);  // ä¸å­˜åœ¨
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å¦‚æœéœ€è¦è¿­ä»£ï¼Œä½¿ç”¨ SmartTable
- å¦‚æœéœ€è¦è®°å½•å¤§å°ï¼Œè‡ªå·±ç»´æŠ¤è®¡æ•°å™¨
- å¦‚æœéœ€è¦æ‰€æœ‰é”®ï¼Œé¢å¤–ç”¨ vector å­˜å‚¨

### 2.5 Table ä½¿ç”¨åœºæ™¯

**é€‚åˆ**ï¼š
- âœ… åœ°å€ â†’ ä½™é¢æ˜ å°„
- âœ… NFT ID â†’ å…ƒæ•°æ®æ˜ å°„
- âœ… ç”¨æˆ· â†’ é…ç½®ä¿¡æ¯
- âœ… ä»»ä½•éœ€è¦å¿«é€Ÿéšæœºè®¿é—®çš„åœºæ™¯

**ä¸é€‚åˆ**ï¼š
- âŒ éœ€è¦éå†æ‰€æœ‰å…ƒç´ 
- âŒ éœ€è¦æ’åº
- âŒ æ•°æ®é‡å¾ˆå°ï¼ˆ< 10 é¡¹ï¼Œç”¨ vector æ›´ç®€å•ï¼‰

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šSmartTable æ¨¡å—

### 3.1 SmartTable ä»‹ç»

**SmartTable** æ˜¯ Table çš„å¢å¼ºç‰ˆï¼Œæ”¯æŒè¿­ä»£ã€‚

**æ ¸å¿ƒç‰¹ç‚¹**ï¼š
- é”®å€¼å¯¹å­˜å‚¨ï¼ˆåŒ Tableï¼‰
- O(1) éšæœºè®¿é—®
- **å¯è¿­ä»£**ï¼ˆå¯ä»¥éå†æ‰€æœ‰é”®å€¼å¯¹ï¼‰
- Gas æˆæœ¬ç•¥é«˜äº Table

**å®ç°åŸç†**ï¼š
- å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª vector å­˜å‚¨æ‰€æœ‰é”®
- åŒæ—¶ç»´æŠ¤ Table ç”¨äºå¿«é€Ÿè®¿é—®
- ç©ºé—´æ¢æ—¶é—´

### 3.2 SmartTable åŸºæœ¬æ“ä½œ

```move
use aptos_std::smart_table::{Self, SmartTable};

// åˆ›å»º SmartTable
let st = smart_table::new<address, u64>();

// æ·»åŠ é”®å€¼å¯¹
smart_table::add(&mut st, @0x1, 100);
smart_table::add(&mut st, @0x2, 200);
smart_table::add(&mut st, @0x3, 300);

// åŸºæœ¬æ“ä½œï¼ˆåŒ Tableï¼‰
let exists = smart_table::contains(&st, @0x1);
let value = smart_table::borrow(&st, @0x1);
let value_mut = smart_table::borrow_mut(&mut st, @0x1);
let removed = smart_table::remove(&mut st, @0x1);

// è·å–å¤§å°ï¼ˆSmartTable ç‹¬æœ‰ï¼‰
let size = smart_table::length(&st);  // 2
```

### 3.3 SmartTable è¿­ä»£

```move
// è·å–æ‰€æœ‰é”®ï¼ˆè¿”å› vectorï¼‰
let keys = smart_table::keys(&st);

// éå†æ‰€æœ‰é”®å€¼å¯¹
let i = 0;
let len = vector::length(&keys);
while (i < len) {
    let key = vector::borrow(&keys, i);
    let value = smart_table::borrow(&st, *key);
    // å¤„ç† key å’Œ value
    i = i + 1;
};
```

### 3.4 Table vs SmartTable å¯¹æ¯”

| ç‰¹æ€§ | Table | SmartTable |
|------|-------|------------|
| éšæœºè®¿é—® | O(1) | O(1) |
| æ·»åŠ å…ƒç´  | O(1) | O(1) |
| åˆ é™¤å…ƒç´  | O(1) | O(n) âš ï¸ |
| è·å–å¤§å° | âŒ | âœ… |
| è¿­ä»£æ‰€æœ‰é”® | âŒ | âœ… |
| Gas æˆæœ¬ | ä½ | ä¸­ |
| å†…å­˜å ç”¨ | ä½ | é«˜ |

**é€‰æ‹©å»ºè®®**ï¼š
- æ•°æ®é‡å°ï¼ˆ< 100ï¼‰ä¸”ä¸éœ€è¦è¿­ä»£ï¼šç”¨ **Table**
- æ•°æ®é‡å¤§ä¸”éœ€è¦è¿­ä»£ï¼šç”¨ **SmartTable**
- åªéœ€éšæœºè®¿é—®ï¼šç”¨ **Table**
- é¢‘ç¹åˆ é™¤ï¼šç”¨ **Table**ï¼ˆSmartTable åˆ é™¤æ…¢ï¼‰

---

## ç¬¬å››éƒ¨åˆ†ï¼šOption æ¨¡å—

### 4.1 Option åŸºç¡€

**Option** ç”¨äºè¡¨ç¤ºå¯èƒ½å­˜åœ¨æˆ–ä¸å­˜åœ¨çš„å€¼ï¼Œç±»ä¼¼ Rust çš„ Optionã€‚

**ä¸ºä»€ä¹ˆéœ€è¦ Option**ï¼š
- Move æ²¡æœ‰ null æ¦‚å¿µ
- æœ‰äº›å‡½æ•°å¯èƒ½æ²¡æœ‰è¿”å›å€¼
- æœ‰äº›æ•°æ®å¯èƒ½ä¸å­˜åœ¨

**å®šä¹‰**ï¼š
```move
struct Option<Element> has copy, drop, store {
    vec: vector<Element>
}
```

å†…éƒ¨ç”¨ vector å®ç°ï¼š
- ç©º vector = None
- åŒ…å«ä¸€ä¸ªå…ƒç´ çš„ vector = Some(value)

### 4.2 Option åŸºæœ¬æ“ä½œ

```move
use std::option::{Self, Option};

// åˆ›å»º None
let opt = option::none<u64>();

// åˆ›å»º Some
let opt = option::some(42);

// æ£€æŸ¥æ˜¯å¦æœ‰å€¼
let has_value = option::is_some(&opt);  // true
let is_empty = option::is_none(&opt);   // false

// è·å–å¼•ç”¨
if (option::is_some(&opt)) {
    let value_ref = option::borrow(&opt);  // &42
};

// è·å–å¯å˜å¼•ç”¨
if (option::is_some(&opt)) {
    let value_mut = option::borrow_mut(&mut opt);
    *value_mut = 100;
};

// æå–å€¼ï¼ˆæ¶ˆè€— Optionï¼‰
if (option::is_some(&opt)) {
    let value = option::extract(&mut opt);  // 42
    // ç°åœ¨ opt æ˜¯ none
};

// é”€æ¯ï¼ˆå¦‚æœæ˜¯ none åˆ™å®‰å…¨ï¼Œå¦‚æœæ˜¯ some åˆ™ panicï¼‰
option::destroy_none(opt);
```

### 4.3 Option å®‰å…¨æ¨¡å¼

```move
// âŒ å±é™©ï¼šç›´æ¥ extract å¯èƒ½ panic
let value = option::extract(&mut opt);

// âœ… å®‰å…¨ï¼šå…ˆæ£€æŸ¥
if (option::is_some(&opt)) {
    let value = option::extract(&mut opt);
    // ä½¿ç”¨ value
} else {
    // å¤„ç† none çš„æƒ…å†µ
};

// âœ… æ›´å¥½ï¼šä½¿ç”¨ borrow_with_default
let value = option::borrow_with_default(&opt, &default_value);

// âœ… æœ€ä½³ï¼šä½¿ç”¨ destroy_with_default
let value = option::destroy_with_default(opt, default_value);
```

### 4.4 Option å®æˆ˜åº”ç”¨

#### åœºæ™¯ 1ï¼šæŸ¥æ‰¾æ“ä½œ

```move
// è¿”å› Option çš„æŸ¥æ‰¾å‡½æ•°
public fun find_user(addr: address): Option<User> acquires UserRegistry {
    let registry = borrow_global<UserRegistry>(@module_addr);
    if (table::contains(&registry.users, addr)) {
        let user = *table::borrow(&registry.users, addr);
        option::some(user)
    } else {
        option::none()
    }
}

// è°ƒç”¨æ–¹
let user_opt = find_user(@0x1);
if (option::is_some(&user_opt)) {
    let user = option::extract(&mut user_opt);
    // å¤„ç†ç”¨æˆ·
} else {
    // ç”¨æˆ·ä¸å­˜åœ¨
};
```

#### åœºæ™¯ 2ï¼šå¯é€‰é…ç½®

```move
struct Config has key {
    name: vector<u8>,
    description: Option<vector<u8>>,  // å¯é€‰çš„æè¿°
    max_supply: Option<u64>,  // å¯é€‰çš„æœ€å¤§ä¾›åº”é‡
}

public fun create_config(
    name: vector<u8>,
    description: Option<vector<u8>>
) {
    move_to(account, Config {
        name,
        description,
        max_supply: option::none()
    });
}
```

---

## ç¬¬äº”éƒ¨åˆ†ï¼šString æ¨¡å—

### 5.1 String åŸºç¡€

Move æä¾›ä¸¤ç§å­—ç¬¦ä¸²ç±»å‹ï¼š
1. **`vector<u8>`**ï¼šåŸå§‹å­—èŠ‚æ•°ç»„ï¼ˆASCIIï¼‰
2. **`string::String`**ï¼šUTF-8 ç¼–ç çš„å­—ç¬¦ä¸²ï¼ˆæ¨èï¼‰

```move
use std::string::{Self, String};

// ä» UTF-8 å­—èŠ‚åˆ›å»º
let s = string::utf8(b"Hello, Move!");

// åˆ¤æ–­æ˜¯å¦ä¸ºç©º
let is_empty = string::is_empty(&s);

// è·å–é•¿åº¦ï¼ˆå­—èŠ‚æ•°ï¼‰
let len = string::length(&s);

// è½¬æ¢ä¸ºå­—èŠ‚
let bytes = string::bytes(&s);
```

### 5.2 String æ“ä½œ

```move
// è¿½åŠ å­—ç¬¦ä¸²
let s1 = string::utf8(b"Hello");
let s2 = string::utf8(b" World");
string::append(&mut s1, s2);  // s1 = "Hello World"

// å­å­—ç¬¦ä¸²
let sub = string::sub_string(&s, 0, 5);  // "Hello"

// æ¯”è¾ƒ
let s1 = string::utf8(b"abc");
let s2 = string::utf8(b"abc");
let equal = (s1 == s2);  // true
```

### 5.3 String vs vector<u8>

| ç‰¹æ€§ | String | vector<u8> |
|------|--------|------------|
| ç¼–ç  | UTF-8 | ä»»æ„å­—èŠ‚ |
| ç±»å‹å®‰å…¨ | å¼º | å¼± |
| éªŒè¯ | è‡ªåŠ¨ UTF-8 éªŒè¯ | æ— éªŒè¯ |
| ä½¿ç”¨åœºæ™¯ | æ–‡æœ¬æ•°æ® | åŸå§‹æ•°æ® |
| Gas æˆæœ¬ | ç•¥é«˜ | ä½ |

**é€‰æ‹©å»ºè®®**ï¼š
- ç”¨æˆ·å¯è§æ–‡æœ¬ï¼šç”¨ **String**
- å†…éƒ¨æ ‡è¯†ç¬¦ã€å“ˆå¸Œï¼šç”¨ **vector<u8>**
- éœ€è¦å­—èŠ‚æ“ä½œï¼šç”¨ **vector<u8>**

---

## ç¬¬å…­éƒ¨åˆ†ï¼šå…¶ä»–å¸¸ç”¨æ¨¡å—

### 6.1 Error æ¨¡å—

```move
use std::error;

// å®šä¹‰é”™è¯¯å¸¸é‡
const EINVALID_ARGUMENT: u64 = 1;
const ENOT_FOUND: u64 = 2;

// ä½¿ç”¨é”™è¯¯
assert!(condition, error::invalid_argument(EINVALID_ARGUMENT));
assert!(exists, error::not_found(ENOT_FOUND));
```

### 6.2 BCS æ¨¡å—ï¼ˆåºåˆ—åŒ–ï¼‰

```move
use std::bcs;

// åºåˆ—åŒ–
let value: u64 = 42;
let bytes = bcs::to_bytes(&value);

// æ³¨æ„ï¼šååºåˆ—åŒ–åœ¨ Move ä¸­å—é™ï¼Œä¸»è¦åœ¨é“¾ä¸‹ä½¿ç”¨
```

### 6.3 Hash æ¨¡å—

```move
use aptos_std::aptos_hash;

// SHA-256
let data = b"Hello, World!";
let hash = aptos_hash::sha2_256(data);

// SHA-3
let hash = aptos_hash::sha3_256(data);
```

---

## ç¬¬ä¸ƒéƒ¨åˆ†ï¼šæ€§èƒ½ä¼˜åŒ–ç»¼åˆæŒ‡å—

### 7.1 é€‰æ‹©åˆé€‚çš„æ•°æ®ç»“æ„

```move
// åœºæ™¯ï¼šå­˜å‚¨ç”¨æˆ·ä½™é¢

// âŒ ä¸å¥½ï¼šå°æ•°æ®ç”¨ SmartTable
struct Balances has key {
    data: SmartTable<address, u64>  // åªæœ‰ 10 ä¸ªç”¨æˆ·ï¼Œå¤ªé‡äº†
}

// âœ… å¥½ï¼šå°æ•°æ®ç”¨ vector
struct Balances has key {
    users: vector<address>,
    amounts: vector<u64>
}

// âœ… æ›´å¥½ï¼šå¤§æ•°æ®ç”¨ Table
struct Balances has key {
    data: Table<address, u64>  // 1000+ ç”¨æˆ·
}
```

### 7.2 Vector ä¼˜åŒ–æŠ€å·§

```move
// âŒ é¿å…ï¼šåœ¨å¾ªç¯ä¸­é¢‘ç¹ push_back
let v = vector::empty();
let i = 0;
while (i < 1000) {
    vector::push_back(&mut v, compute_value(i));
    i = i + 1;
};

// âœ… æ¨èï¼šé¢„åˆ†é…ç©ºé—´ï¼ˆå¦‚æœçŸ¥é“å¤§å°ï¼‰
// æ³¨æ„ï¼šMove æ ‡å‡†åº“å¯èƒ½æ²¡æœ‰ with_capacityï¼Œä½†æ¦‚å¿µå¾ˆé‡è¦

// âœ… æ‰¹é‡æ“ä½œ
let v1 = vector[1, 2, 3];
let v2 = vector[4, 5, 6];
vector::append(&mut v1, v2);  // æ¯”é€ä¸ª push_back å¿«
```

### 7.3 Table/SmartTable ä¼˜åŒ–

```move
// âŒ é¿å…ï¼šé‡å¤æ£€æŸ¥
if (table::contains(&t, key)) {
    let value = table::borrow(&t, key);
    // ä½¿ç”¨ value
};
if (table::contains(&t, key)) {  // é‡å¤æ£€æŸ¥
    let value = table::borrow_mut(&mut t, key);
    *value += 1;
};

// âœ… æ¨èï¼šä¸€æ¬¡æ£€æŸ¥ï¼Œå¤šæ¬¡ä½¿ç”¨
if (table::contains(&t, key)) {
    let value = table::borrow_mut(&mut t, key);
    // ä½¿ç”¨ value
    *value += 1;
};

// âœ… æ›´å¥½ï¼šä½¿ç”¨ borrow_mut_with_default
let value = table::borrow_mut_with_default(&mut t, key, default);
*value += 1;
```

### 7.4 Option ä¼˜åŒ–

```move
// âŒ é¿å…ï¼šé¢‘ç¹ extract å’Œ fill
let value = option::extract(&mut opt);
// å¤„ç† value
option::fill(&mut opt, new_value);

// âœ… æ¨èï¼šç›´æ¥ç”¨ borrow_mut
if (option::is_some(&opt)) {
    let value_ref = option::borrow_mut(&mut opt);
    *value_ref = new_value;
};
```

---

## ğŸ’¡ å…³é”®è¦ç‚¹æ€»ç»“

### Vector
- **é€‚åˆ**ï¼šå°å‹åˆ—è¡¨ï¼ˆ< 1000 å…ƒç´ ï¼‰ã€é¡ºåºè®¿é—®
- **ä¼˜åŒ–**ï¼šæœ«å°¾æ“ä½œã€swap_removeã€é¿å…ä¸­é—´æ’å…¥
- **å¤æ‚åº¦**ï¼šè®¿é—® O(1)ã€æœ«å°¾æ“ä½œ O(1)ã€ä¸­é—´æ“ä½œ O(n)

### Table
- **é€‚åˆ**ï¼šå¤§å‹é”®å€¼å­˜å‚¨ã€éšæœºè®¿é—®ã€ä¸éœ€è¦è¿­ä»£
- **é™åˆ¶**ï¼šä¸å¯è¿­ä»£ã€æ— æ³•è·å–å¤§å°
- **å¤æ‚åº¦**ï¼šæ‰€æœ‰æ“ä½œ O(1)

### SmartTable
- **é€‚åˆ**ï¼šéœ€è¦è¿­ä»£çš„é”®å€¼å­˜å‚¨
- **ä»£ä»·**ï¼šæ›´é«˜çš„ Gasã€åˆ é™¤æ…¢
- **å¤æ‚åº¦**ï¼šè®¿é—® O(1)ã€åˆ é™¤ O(n)

### Option
- **é€‚åˆ**ï¼šè¡¨ç¤ºå¯é€‰å€¼ã€é¿å… null
- **å®‰å…¨**ï¼šæ€»æ˜¯å…ˆæ£€æŸ¥ is_some
- **æ¨¡å¼**ï¼šä½¿ç”¨ borrow_with_default é¿å… panic

### String
- **é€‚åˆ**ï¼šç”¨æˆ·å¯è§æ–‡æœ¬
- **æ³¨æ„**ï¼šUTF-8 éªŒè¯æœ‰æˆæœ¬
- **é€‰æ‹©**ï¼šæ–‡æœ¬ç”¨ Stringï¼Œæ•°æ®ç”¨ vector<u8>

---

## ğŸ¯ æ€è€ƒé¢˜

1. ä»€ä¹ˆæ—¶å€™åº”è¯¥ç”¨ vectorï¼Œä»€ä¹ˆæ—¶å€™ç”¨ Tableï¼Ÿ
2. SmartTable çš„åˆ é™¤ä¸ºä»€ä¹ˆæ˜¯ O(n)ï¼Ÿ
3. å¦‚ä½•ç”¨ Table + vector å®ç°å¯è¿­ä»£çš„é”®å€¼å­˜å‚¨ï¼Ÿ
4. Option æ¯”ç›´æ¥ä½¿ç”¨ abort æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ

ç­”æ¡ˆåœ¨ä»Šæ—¥è€ƒè¯•ä¸­ï¼

---

**ä¸‹ä¸€æ­¥**ï¼šå­¦ä¹ ä»£ç ç¤ºä¾‹ï¼Œç„¶åå®Œæˆå®è·µä»»åŠ¡ï¼ğŸš€
