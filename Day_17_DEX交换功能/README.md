# Day 17: DEX - äº¤æ¢åŠŸèƒ½

## ğŸ“‹ å­¦ä¹ ç›®æ ‡

ä»Šå¤©æˆ‘ä»¬å°†åœ¨ Day 16 æµåŠ¨æ€§æ± çš„åŸºç¡€ä¸Šï¼Œå®ç° DEX æœ€æ ¸å¿ƒçš„åŠŸèƒ½â€”â€”ä»£å¸äº¤æ¢ï¼ˆSwapï¼‰ã€‚è¿™æ˜¯ç”¨æˆ·ä½¿ç”¨ DEX æœ€é¢‘ç¹çš„æ“ä½œã€‚

### æ ¸å¿ƒç›®æ ‡
1. ğŸ’± **å®ç° Swap æ ¸å¿ƒç®—æ³•** - åŸºäºæ’å®šä¹˜ç§¯å…¬å¼çš„ä»£å¸äº¤æ¢
2. ğŸ›¡ï¸ **æ»‘ç‚¹ä¿æŠ¤æœºåˆ¶** - é˜²æ­¢ä»·æ ¼å‰§çƒˆæ³¢åŠ¨é€ æˆæŸå¤±
3. ğŸ’° **æ‰‹ç»­è´¹ç³»ç»Ÿ** - å®ç°æ‰‹ç»­è´¹æ”¶å–å’Œåˆ†é…
4. ğŸ”€ **è·¯ç”±åŠŸèƒ½** - æ”¯æŒå¤šè·³äº¤æ¢è·¯å¾„
5. ğŸ“Š **ä»·æ ¼æŸ¥è¯¢æ¥å£** - æä¾›å®æ—¶ä»·æ ¼å’Œå½±å“è®¡ç®—

### å­¦ä¹ æˆæœ
- âœ… èƒ½å¤Ÿå®ç°å®Œæ•´çš„ Swap åŠŸèƒ½
- âœ… èƒ½å¤Ÿè®¾è®¡åˆç†çš„æ‰‹ç»­è´¹æœºåˆ¶
- âœ… èƒ½å¤Ÿå®ç°æ»‘ç‚¹ä¿æŠ¤
- âœ… èƒ½å¤Ÿä¼˜åŒ– Gas æ¶ˆè€—
- âœ… ç†è§£ MEV å’Œä¸‰æ˜æ²»æ”»å‡»

---

## ğŸ“š å­¦ä¹ è·¯çº¿å›¾

```
09:00 - 10:30  ğŸ“– ç†è®ºå­¦ä¹ 
               â”œâ”€ Swap ç®—æ³•æ·±å…¥ç†è§£
               â”œâ”€ æ‰‹ç»­è´¹æœºåˆ¶è®¾è®¡
               â”œâ”€ æ»‘ç‚¹ä¿æŠ¤åŸç†
               â””â”€ MEV å’Œå®‰å…¨æ€§

10:30 - 11:30  ğŸ’» ä»£ç å­¦ä¹ 
               â”œâ”€ åˆ†æå®Œæ•´ Swap å®ç°
               â”œâ”€ ç†è§£è·¯ç”±ç®—æ³•
               â”œâ”€ å­¦ä¹ æ‰‹ç»­è´¹è®¡ç®—
               â””â”€ ç ”ç©¶å®‰å…¨æœºåˆ¶

11:30 - 14:30  ğŸ”¨ å®è·µä»»åŠ¡
               â”œâ”€ å®ç°åŸºç¡€ Swap åŠŸèƒ½
               â”œâ”€ æ·»åŠ æ»‘ç‚¹ä¿æŠ¤
               â”œâ”€ å®ç°è·¯ç”±åŠŸèƒ½
               â””â”€ ç¼–å†™å®Œæ•´æµ‹è¯•

14:30 - 15:30  ğŸ“ æ¯æ—¥è€ƒè¯•
               â”œâ”€ é€‰æ‹©é¢˜ï¼ˆ20 é¢˜ï¼‰
               â”œâ”€ ç¼–ç¨‹é¢˜ï¼ˆ3 é¢˜ï¼‰
               â””â”€ è‡ªæˆ‘è¯„åˆ†
```

**é¢„è®¡å­¦ä¹ æ—¶é—´**ï¼š6-7 å°æ—¶

---

## ğŸ“ å‰ç½®çŸ¥è¯†

åœ¨å¼€å§‹ä»Šå¤©çš„å­¦ä¹ ä¹‹å‰ï¼Œè¯·ç¡®ä¿ä½ å·²ç»æŒæ¡ï¼š

- âœ… Day 15: AMM åŸç†ä¸æ’å®šä¹˜ç§¯å…¬å¼
- âœ… Day 16: ç®€å• DEX - æµåŠ¨æ€§æ± 
- âœ… æ‰‹ç»­è´¹è®¡ç®—çš„åŸºæœ¬æ•°å­¦
- âœ… äº‹ä»¶ç³»ç»Ÿå’ŒæŸ¥è¯¢æ¥å£

---

## ğŸ“– æ ¸å¿ƒæ¦‚å¿µé¢„è§ˆ

### ä»€ä¹ˆæ˜¯ Swapï¼Ÿ

**Swapï¼ˆäº¤æ¢ï¼‰** æ˜¯ DEX çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå…è®¸ç”¨æˆ·ä½¿ç”¨ä¸€ç§ä»£å¸äº¤æ¢å¦ä¸€ç§ä»£å¸ï¼Œä»·æ ¼ç”±æµåŠ¨æ€§æ± çš„å‚¨å¤‡æ¯”ä¾‹å’Œ AMM ç®—æ³•è‡ªåŠ¨ç¡®å®šã€‚

### Swap çš„å·¥ä½œæµç¨‹

```
1. ç”¨æˆ·æŒ‡å®šè¾“å…¥ä»£å¸å’Œæ•°é‡
2. è®¡ç®—æ‰£é™¤æ‰‹ç»­è´¹åçš„è¾“å…¥
3. ä½¿ç”¨ AMM å…¬å¼è®¡ç®—è¾“å‡ºæ•°é‡
4. æ£€æŸ¥æ»‘ç‚¹æ˜¯å¦åœ¨å…è®¸èŒƒå›´å†…
5. æ›´æ–°æ± å­å‚¨å¤‡
6. è½¬ç§»ä»£å¸ç»™ç”¨æˆ·
7. å‘å‡º Swap äº‹ä»¶
```

### æ ¸å¿ƒå…¬å¼

**å¸¦æ‰‹ç»­è´¹çš„ Swap å…¬å¼ï¼š**

```
amount_in_with_fee = amount_in * (10000 - fee_rate) / 10000
amount_out = (reserve_out * amount_in_with_fee) / (reserve_in + amount_in_with_fee)

å…¶ä¸­ï¼š
- fee_rate: æ‰‹ç»­è´¹ç‡ï¼ˆä¾‹å¦‚ 30 = 0.3%ï¼‰
- reserve_in: è¾“å…¥ä»£å¸çš„å‚¨å¤‡é‡
- reserve_out: è¾“å‡ºä»£å¸çš„å‚¨å¤‡é‡
```

### å…³é”®ç»„ä»¶

1. **Swap æ ¸å¿ƒ**
   - `swap_exact_input`: æŒ‡å®šè¾“å…¥æ•°é‡
   - `swap_exact_output`: æŒ‡å®šè¾“å‡ºæ•°é‡
   - K å€¼ä¿æŠ¤ï¼ˆå®é™…ä¼šç•¥å¾®å¢åŠ ï¼‰

2. **æ‰‹ç»­è´¹ç³»ç»Ÿ**
   - æ‰‹ç»­è´¹ç‡ï¼šé€šå¸¸ 0.3%
   - åè®®è´¹ç”¨ï¼šå¯é€‰çš„é¢å¤–è´¹ç”¨
   - æ‰‹ç»­è´¹ç´¯ç§¯åˆ°å‚¨å¤‡ä¸­

3. **æ»‘ç‚¹ä¿æŠ¤**
   - `min_amount_out`: æœ€å°è¾“å‡ºæ•°é‡
   - `max_amount_in`: æœ€å¤§è¾“å…¥æ•°é‡
   - é˜²æ­¢ä»·æ ¼çªå˜å¯¼è‡´æŸå¤±

4. **è·¯ç”±ç³»ç»Ÿ**
   - å•è·³äº¤æ¢ï¼šA -> B
   - å¤šè·³äº¤æ¢ï¼šA -> C -> B
   - è‡ªåŠ¨å¯»æ‰¾æœ€ä¼˜è·¯å¾„

---

## ğŸ“ ä»Šæ—¥æ–‡ä»¶ç»“æ„

```
Day_17_DEXäº¤æ¢åŠŸèƒ½/
â”œâ”€â”€ README.md                          # ğŸ“˜ æœ¬æ–‡ä»¶ - å­¦ä¹ æŒ‡å—
â”œâ”€â”€ Move.toml                          # âš™ï¸ é¡¹ç›®é…ç½®
â”œâ”€â”€ 01_ç†è®ºå­¦ä¹ /
â”‚   â”œâ”€â”€ æ ¸å¿ƒæ¦‚å¿µ.md                    # ğŸ“š è¯¦ç»†ç†è®ºè®²è§£
â”‚   â””â”€â”€ ä»£ç ç¤ºä¾‹.move                  # ğŸ’¡ å®Œæ•´ä»£ç ç¤ºä¾‹
â”œâ”€â”€ 02_å®è·µä»»åŠ¡/
â”‚   â””â”€â”€ ä»»åŠ¡è¯´æ˜.md                    # ğŸ¯ å®è·µä»»åŠ¡è¦æ±‚
â”œâ”€â”€ 03_æ¯æ—¥è€ƒè¯•/
â”‚   â”œâ”€â”€ é€‰æ‹©é¢˜.md                      # âœï¸ 20é“é€‰æ‹©é¢˜
â”‚   â”œâ”€â”€ ç¼–ç¨‹é¢˜.md                      # ğŸ’» 3é“ç¼–ç¨‹é¢˜
â”‚   â””â”€â”€ ç­”æ¡ˆè§£æ.md                    # âœ… å®Œæ•´ç­”æ¡ˆå’Œè§£æ
â”œâ”€â”€ sources/
â”‚   â”œâ”€â”€ swap.move                     # ğŸ”§ Swap æ ¸å¿ƒå®ç°
â”‚   â”œâ”€â”€ router.move                   # ğŸ”€ è·¯ç”±æ¨¡å—
â”‚   â””â”€â”€ fee_manager.move              # ğŸ’° æ‰‹ç»­è´¹ç®¡ç†
â””â”€â”€ scripts/
    â”œâ”€â”€ swap_exact_input.move         # ç²¾ç¡®è¾“å…¥äº¤æ¢è„šæœ¬
    â”œâ”€â”€ swap_exact_output.move        # ç²¾ç¡®è¾“å‡ºäº¤æ¢è„šæœ¬
    â””â”€â”€ multi_hop_swap.move           # å¤šè·³äº¤æ¢è„šæœ¬
```

---

## ğŸš€ å¼€å§‹å­¦ä¹ 

### Step 1: ç†è®ºå­¦ä¹ ï¼ˆ90åˆ†é’Ÿï¼‰

é˜…è¯» `01_ç†è®ºå­¦ä¹ /æ ¸å¿ƒæ¦‚å¿µ.md`ï¼Œé‡ç‚¹ç†è§£ï¼š
- Swap ç®—æ³•çš„æ•°å­¦åŸç†
- æ‰‹ç»­è´¹å¦‚ä½•å½±å“ä»·æ ¼
- æ»‘ç‚¹äº§ç”Ÿçš„åŸå› å’Œä¿æŠ¤æ–¹æ³•
- MEV å’Œä¸‰æ˜æ²»æ”»å‡»åŸç†
- æœ€ä¼˜è·¯å¾„é€‰æ‹©ç®—æ³•

**å­¦ä¹ å»ºè®®**ï¼š
- ğŸ“ æ‰‹å·¥è®¡ç®—å‡ ä¸ª Swap ä¾‹å­
- ğŸ” ç†è§£ä¸ºä»€ä¹ˆ K å€¼ä¼šå¢åŠ 
- ğŸ¤” æ€è€ƒå¦‚ä½•é˜²èŒƒ MEV æ”»å‡»

### Step 2: ä»£ç å­¦ä¹ ï¼ˆ60åˆ†é’Ÿï¼‰

ç ”ç©¶ `01_ç†è®ºå­¦ä¹ /ä»£ç ç¤ºä¾‹.move`ï¼Œç†è§£ï¼š
- Swap å‡½æ•°çš„å®Œæ•´å®ç°
- æ‰‹ç»­è´¹è®¡ç®—çš„ç»†èŠ‚
- æ»‘ç‚¹æ£€æŸ¥çš„æ—¶æœº
- äº‹ä»¶å‘å°„å’ŒçŠ¶æ€æ›´æ–°
- è·¯ç”±ç®—æ³•çš„å®ç°

**å­¦ä¹ å»ºè®®**ï¼š
- ğŸ” å¯¹æ¯”æœ‰æ— æ‰‹ç»­è´¹çš„å…¬å¼
- ğŸ’­ ç†è§£ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ªæ–¹å‘çš„ Swap
- ğŸ“Š è¿½è¸ªæ¯ä¸€æ­¥çš„å‚¨å¤‡å˜åŒ–

### Step 3: å®è·µä»»åŠ¡ï¼ˆ3å°æ—¶ï¼‰

å®Œæˆ `02_å®è·µä»»åŠ¡/ä»»åŠ¡è¯´æ˜.md` ä¸­çš„è¦æ±‚ï¼š
- å®ç° `swap_exact_input` å‡½æ•°
- å®ç° `swap_exact_output` å‡½æ•°
- æ·»åŠ æ‰‹ç»­è´¹è®¡ç®—æ¨¡å—
- å®ç°è·¯ç”±åŠŸèƒ½
- ç¼–å†™å…¨é¢çš„æµ‹è¯•ç”¨ä¾‹

**å®è·µå»ºè®®**ï¼š
- âš¡ å…ˆå®ç°åŸºç¡€ Swapï¼Œå†æ·»åŠ é«˜çº§åŠŸèƒ½
- ğŸ§ª æ¯ä¸ªå‡½æ•°éƒ½è¦å……åˆ†æµ‹è¯•
- ğŸ›¡ï¸ æµ‹è¯•å„ç§è¾¹ç•Œæƒ…å†µ

### Step 4: æ¯æ—¥è€ƒè¯•ï¼ˆ60åˆ†é’Ÿï¼‰

å®Œæˆ `03_æ¯æ—¥è€ƒè¯•/` ä¸­çš„æ‰€æœ‰é¢˜ç›®ï¼š
- 20 é“é€‰æ‹©é¢˜ï¼ˆæ¯é¢˜ 2 åˆ†ï¼‰
- 3 é“ç¼–ç¨‹é¢˜ï¼ˆæ¯é¢˜ 20 åˆ†ï¼‰

**è€ƒè¯•è¦æ±‚**ï¼š
- âœ… ç‹¬ç«‹å®Œæˆï¼Œä¸æŸ¥çœ‹ç­”æ¡ˆ
- â±ï¸ é™æ—¶ 60 åˆ†é’Ÿ
- ğŸ¯ ç›®æ ‡åˆ†æ•° â‰¥ 70 åˆ†

---

## ğŸ’¡ é‡ç‚¹æç¤º

### âš ï¸ å¸¸è§é™·é˜±

1. **æ‰‹ç»­è´¹è®¡ç®—é¡ºåº**
   ```move
   // âŒ é”™è¯¯ï¼šå…ˆè®¡ç®—è¾“å‡ºå†æ‰£æ‰‹ç»­è´¹
   let amount_out = calculate_output(amount_in, ...);
   let fee = amount_out * 3 / 1000;
   
   // âœ… æ­£ç¡®ï¼šå…ˆæ‰£æ‰‹ç»­è´¹å†è®¡ç®—è¾“å‡º
   let amount_in_with_fee = amount_in * 997 / 1000;
   let amount_out = calculate_output(amount_in_with_fee, ...);
   ```

2. **æ»‘ç‚¹æ£€æŸ¥æ—¶æœº**
   ```move
   // âŒ é”™è¯¯ï¼šåœ¨è½¬è´¦åæ£€æŸ¥
   transfer_coins(user, amount_out);
   assert!(amount_out >= min_amount_out, ERROR_SLIPPAGE);
   
   // âœ… æ­£ç¡®ï¼šåœ¨è½¬è´¦å‰æ£€æŸ¥
   assert!(amount_out >= min_amount_out, ERROR_SLIPPAGE);
   transfer_coins(user, amount_out);
   ```

3. **K å€¼ä¿æŠ¤**
   ```move
   // ç¡®ä¿ K å€¼ä¸å‡å°‘ï¼ˆè€ƒè™‘æ‰‹ç»­è´¹ä¼šå¢åŠ ï¼‰
   let k_before = (reserve_x as u128) * (reserve_y as u128);
   // ... æ‰§è¡Œ swap
   let k_after = (new_reserve_x as u128) * (new_reserve_y as u128);
   assert!(k_after >= k_before, ERROR_K_INVARIANT);
   ```

4. **æ•´æ•°é™¤æ³•ç²¾åº¦**
   ```move
   // âŒ å¯èƒ½æŸå¤±ç²¾åº¦
   let amount_out = reserve_out * amount_in / (reserve_in + amount_in);
   
   // âœ… æ›´å¥½çš„ç²¾åº¦å¤„ç†
   let numerator = (reserve_out as u128) * (amount_in as u128);
   let denominator = (reserve_in as u128) + (amount_in as u128);
   let amount_out = (numerator / denominator as u64);
   ```

### ğŸ”‘ å…³é”®è¦ç‚¹

1. **æ‰‹ç»­è´¹è®¾è®¡åŸåˆ™**
   - å¯¹æµåŠ¨æ€§æä¾›è€…å…¬å¹³ï¼ˆæ‰‹ç»­è´¹å½’å…¥å‚¨å¤‡ï¼‰
   - é˜²æ­¢ Gas æ”»å‡»ï¼ˆæ‰‹ç»­è´¹ä¸èƒ½å¤ªä½ï¼‰
   - ä¿æŒç«äº‰åŠ›ï¼ˆæ‰‹ç»­è´¹ä¸èƒ½å¤ªé«˜ï¼‰
   - å¯é…ç½®æ€§ï¼ˆä¸åŒæ± å­å¯ä»¥æœ‰ä¸åŒè´¹ç‡ï¼‰

2. **æ»‘ç‚¹ä¿æŠ¤çš„é‡è¦æ€§**
   - ä¿æŠ¤ç”¨æˆ·å…å—ä»·æ ¼çªå˜å½±å“
   - é˜²æ­¢ä¸‰æ˜æ²»æ”»å‡»
   - æä¾›äº¤æ˜“ç¡®å®šæ€§
   - å…è®¸ç”¨æˆ·æ§åˆ¶é£é™©

3. **åŸå­æ€§ä¿è¯**
   - Swap å¿…é¡»æ˜¯åŸå­æ“ä½œ
   - è¦ä¹ˆå®Œå…¨æˆåŠŸï¼Œè¦ä¹ˆå®Œå…¨å¤±è´¥
   - ä¸èƒ½å‡ºç°éƒ¨åˆ†çŠ¶æ€æ›´æ–°
   - é˜²æ­¢é‡å…¥æ”»å‡»

4. **äº‹ä»¶çš„é‡è¦æ€§**
   - è®°å½•æ¯æ¬¡ Swap çš„è¯¦ç»†ä¿¡æ¯
   - ä¾¿äºé“¾ä¸‹ç´¢å¼•å’Œåˆ†æ
   - ç”¨äºå‰ç«¯å®æ—¶æ›´æ–°
   - å®¡è®¡å’Œè°ƒè¯•å·¥å…·

---

## ğŸ¯ å­¦ä¹ æ£€æŸ¥æ¸…å•

å®Œæˆä»Šå¤©çš„å­¦ä¹ åï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š

- [ ] å®ç°ç²¾ç¡®è¾“å…¥çš„ Swap åŠŸèƒ½
- [ ] å®ç°ç²¾ç¡®è¾“å‡ºçš„ Swap åŠŸèƒ½
- [ ] æ­£ç¡®è®¡ç®—å’Œæ”¶å–æ‰‹ç»­è´¹
- [ ] å®ç°æœ‰æ•ˆçš„æ»‘ç‚¹ä¿æŠ¤
- [ ] è®¾è®¡å’Œå®ç°è·¯ç”±åŠŸèƒ½
- [ ] è®¡ç®—äº¤æ˜“çš„ä»·æ ¼å½±å“
- [ ] å¤„ç†å„ç§é”™è¯¯æƒ…å†µ
- [ ] é˜²èŒƒ MEV æ”»å‡»
- [ ] ç¼–å†™å®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹
- [ ] ä¼˜åŒ– Gas æ¶ˆè€—

---

## ğŸ“š æ‰©å±•é˜…è¯»

### å¿…è¯»
- [Uniswap V2 Core - Swap å®ç°](https://github.com/Uniswap/v2-core/blob/master/contracts/UniswapV2Pair.sol)
- [Understanding Slippage](https://academy.binance.com/en/articles/impermanent-loss-explained)
- [MEV å’Œä¸‰æ˜æ²»æ”»å‡»](https://www.paradigm.xyz/2020/08/ethereum-is-a-dark-forest)

### é€‰è¯»
- [Optimal Routing in AMMs](https://arxiv.org/abs/2106.07371)
- [Flash Boys 2.0](https://arxiv.org/abs/1904.05234)
- [æ‰‹ç»­è´¹å¯¹æµåŠ¨æ€§çš„å½±å“](https://uniswap.org/blog/uniswap-v3)

### ä»£ç å‚è€ƒ
- [Liquidswap Swap å®ç°](https://github.com/pontem-network/liquidswap/blob/main/sources/router.move)
- [SushiSwap Router](https://github.com/sushiswap/sushiswap/blob/master/protocols/route-processor/contracts/RouteProcessor4.sol)
- [PancakeSwap V2 Router](https://github.com/pancakeswap/pancake-smart-contracts/blob/master/projects/exchange-protocol/contracts/PancakeRouter.sol)

---

## ğŸ”— ç›¸å…³èµ„æº

### å·¥å…·
- [Aptos Explorer](https://explorer.aptoslabs.com/) - æŸ¥çœ‹äº¤æ˜“è¯¦æƒ…
- [DEX Screener](https://dexscreener.com/) - åˆ†æä»·æ ¼å’Œäº¤æ˜“é‡
- [Swap æ¨¡æ‹Ÿå™¨](https://www.desmos.com/calculator/swap-simulator) - å¯è§†åŒ– Swap è¿‡ç¨‹

### å‚è€ƒé¡¹ç›®
- [Liquidswap](https://liquidswap.com/) - Aptos ä¸»æµ DEX
- [PancakeSwap Aptos](https://aptos.pancakeswap.finance/)
- [Thala Swap](https://www.thala.fi/)

---

## ğŸ“ æ¯æ—¥æ€»ç»“æ¨¡æ¿

å­¦ä¹ å®Œæˆåï¼Œè¯·ç”¨ä»¥ä¸‹æ¨¡æ¿æ€»ç»“ä»Šå¤©çš„å­¦ä¹ ï¼š

```markdown
## Day 17 å­¦ä¹ æ€»ç»“

### å­¦åˆ°çš„å…³é”®æ¦‚å¿µ
1. 
2. 
3. 

### å®Œæˆçš„ä»»åŠ¡
- [ ] ç†è®ºå­¦ä¹ 
- [ ] ä»£ç ç¤ºä¾‹ç ”ç©¶
- [ ] å®è·µä»»åŠ¡
- [ ] æ¯æ—¥è€ƒè¯•

### è€ƒè¯•æˆç»©
- é€‰æ‹©é¢˜ï¼š___/40 åˆ†
- ç¼–ç¨‹é¢˜ï¼š___/60 åˆ†
- æ€»åˆ†ï¼š___/100 åˆ†

### é‡åˆ°çš„å›°éš¾
1. 
2. 

### è§£å†³æ–¹æ¡ˆ
1. 
2. 

### Swap åŠŸèƒ½å®ç°è¦ç‚¹
- æ‰‹ç»­è´¹è®¡ç®—ï¼š
- æ»‘ç‚¹ä¿æŠ¤ï¼š
- æ€§èƒ½ä¼˜åŒ–ï¼š

### æ˜å¤©çš„è®¡åˆ’
- å­¦ä¹  Day 18: ä»·æ ¼é¢„è¨€æœºé›†æˆ
```

---

## ğŸ“ ä¸‹ä¸€æ­¥

å®Œæˆä»Šå¤©çš„å­¦ä¹ åï¼š

1. **å¦‚æœå¾—åˆ† â‰¥ 70 åˆ†**
   - âœ… ç»§ç»­å­¦ä¹  Day 18: ä»·æ ¼é¢„è¨€æœºé›†æˆ
   - ğŸ’¡ æ€è€ƒå¦‚ä½•ä¼˜åŒ– Swap Gas æ¶ˆè€—
   - ğŸ” ç ”ç©¶å…¶ä»– DEX çš„åˆ›æ–°è®¾è®¡

2. **å¦‚æœå¾—åˆ† < 70 åˆ†**
   - ğŸ”„ é‡æ–°å­¦ä¹ ä»Šå¤©çš„ç†è®º
   - ğŸ’» é‡åšå®è·µä»»åŠ¡
   - ğŸ“– é˜…è¯»æ‰©å±•èµ„æ–™
   - ğŸ§ª ç¼–å†™æ›´å¤šæµ‹è¯•ç”¨ä¾‹

---

## âš¡ å¿«é€Ÿå‚è€ƒ

### æ ¸å¿ƒæ¥å£é€ŸæŸ¥

```move
// ç²¾ç¡®è¾“å…¥äº¤æ¢
public entry fun swap_exact_input<X, Y>(
    user: &signer,
    amount_in: u64,
    min_amount_out: u64,
)

// ç²¾ç¡®è¾“å‡ºäº¤æ¢
public entry fun swap_exact_output<X, Y>(
    user: &signer,
    amount_out: u64,
    max_amount_in: u64,
)

// å¤šè·³äº¤æ¢
public entry fun swap_exact_input_multi_hop<X, Y, Z>(
    user: &signer,
    amount_in: u64,
    min_amount_out: u64,
)

// æŸ¥è¯¢äº¤æ¢è¾“å‡º
#[view]
public fun get_amount_out<X, Y>(amount_in: u64): u64

// æŸ¥è¯¢äº¤æ¢è¾“å…¥
#[view]
public fun get_amount_in<X, Y>(amount_out: u64): u64

// æŸ¥è¯¢ä»·æ ¼å½±å“
#[view]
public fun get_price_impact<X, Y>(amount_in: u64): u64
```

### é”™è¯¯ç é€ŸæŸ¥

```
ERROR_ZERO_AMOUNT = 200
ERROR_INSUFFICIENT_OUTPUT = 201
ERROR_EXCESSIVE_INPUT = 202
ERROR_SLIPPAGE_EXCEEDED = 203
ERROR_POOL_NOT_EXISTS = 204
ERROR_INSUFFICIENT_LIQUIDITY = 205
ERROR_K_INVARIANT = 206
ERROR_INVALID_PATH = 207
ERROR_EXPIRED = 208
```

### æ‰‹ç»­è´¹è®¡ç®—é€ŸæŸ¥

```
æ ‡å‡†æ‰‹ç»­è´¹ç‡ï¼š0.3% (30 basis points)
è®¡ç®—å…¬å¼ï¼š
- amount_in_with_fee = amount_in * 997 / 1000
- æˆ– amount_in_with_fee = amount_in * (10000 - 30) / 10000

åè®®è´¹ç”¨ï¼ˆå¯é€‰ï¼‰ï¼š0.05%
- protocol_fee = swap_fee * 1 / 6
- lp_fee = swap_fee * 5 / 6
```

---

## ğŸ—ï¸ Swap æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç”¨æˆ·å‘èµ· Swap                      â”‚
â”‚         swap_exact_input<X, Y>(amount_in, min_out)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              1. å‚æ•°éªŒè¯                             â”‚
â”‚  - æ£€æŸ¥ amount_in > 0                               â”‚
â”‚  - æ£€æŸ¥æ± å­æ˜¯å¦å­˜åœ¨                                  â”‚
â”‚  - æ£€æŸ¥å‚¨å¤‡æ˜¯å¦å……è¶³                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              2. è®¡ç®—æ‰‹ç»­è´¹                           â”‚
â”‚  amount_in_with_fee = amount_in * 997 / 1000        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              3. è®¡ç®—è¾“å‡ºæ•°é‡                         â”‚
â”‚  amount_out = (reserve_y * amount_in_with_fee)      â”‚
â”‚               / (reserve_x + amount_in_with_fee)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              4. æ»‘ç‚¹æ£€æŸ¥                             â”‚
â”‚  assert!(amount_out >= min_amount_out)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              5. è½¬ç§»ä»£å¸                             â”‚
â”‚  - ä»ç”¨æˆ·æ”¶å– amount_in çš„ X                        â”‚
â”‚  - ç»™ç”¨æˆ·å‘é€ amount_out çš„ Y                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              6. æ›´æ–°å‚¨å¤‡                             â”‚
â”‚  reserve_x = reserve_x + amount_in                  â”‚
â”‚  reserve_y = reserve_y - amount_out                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              7. K å€¼éªŒè¯                             â”‚
â”‚  assert!(new_k >= old_k)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              8. å‘å‡ºäº‹ä»¶                             â”‚
â”‚  emit SwapEvent { ... }                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¼ å®æˆ˜ä»·å€¼

ä»Šå¤©å­¦ä¹ çš„ Swap åŠŸèƒ½æ˜¯ DeFi çš„æ ¸å¿ƒï¼š

### çŸ­æœŸä»·å€¼ï¼ˆå­¦ä¹ é˜¶æ®µï¼‰
- ç†è§£ DEX çš„æ ¸å¿ƒæœºåˆ¶
- æŒæ¡ä»·æ ¼æ»‘ç‚¹çš„è®¡ç®—
- å­¦ä¼šé˜²èŒƒ MEV æ”»å‡»

### ä¸­æœŸä»·å€¼ï¼ˆ30å¤©åï¼‰
- å¯ä»¥å¼€å‘å®Œæ•´çš„ DEX
- ç†è§£å¥—åˆ©æœºä¼šçš„æ¥æº
- ä¸ºå¼€å‘äº¤æ˜“æœºå™¨äººæ‰“åŸºç¡€

### é•¿æœŸä»·å€¼ï¼ˆ60å¤©åï¼‰
- è®¾è®¡åˆ›æ–°çš„äº¤æ¢æœºåˆ¶
- ä¼˜åŒ–è·¯ç”±ç®—æ³•
- å®¡è®¡å…¶ä»– DEX é¡¹ç›®
- å¼€å‘èšåˆäº¤æ˜“å·¥å…·

---

## ğŸ” å®‰å…¨æ£€æŸ¥æ¸…å•

åœ¨å®ç° Swap åŠŸèƒ½æ—¶ï¼ŒåŠ¡å¿…æ£€æŸ¥ï¼š

- [ ] è¾“å…¥éªŒè¯ï¼šé‡‘é¢ > 0ï¼Œæ± å­å­˜åœ¨
- [ ] æ»‘ç‚¹ä¿æŠ¤ï¼šmin_amount_out æˆ– max_amount_in
- [ ] K å€¼ä¸å˜æ€§ï¼šnew_k >= old_k
- [ ] æ•´æ•°æº¢å‡ºï¼šä½¿ç”¨ u128 è¿›è¡Œä¸­é—´è®¡ç®—
- [ ] é‡å…¥ä¿æŠ¤ï¼šMove å¤©ç„¶é˜²æŠ¤ï¼Œä½†è¦æ³¨æ„è·¨åˆçº¦è°ƒç”¨
- [ ] äº‹ä»¶å‘å°„ï¼šè®°å½•æ‰€æœ‰å…³é”®å‚æ•°
- [ ] ç²¾åº¦æŸå¤±ï¼šå…ˆä¹˜åé™¤
- [ ] è¾¹ç•Œæƒ…å†µï¼šå‚¨å¤‡ä¸º 0ï¼Œé‡‘é¢è¿‡å¤§ç­‰

---

**å‡†å¤‡å¥½äº†å—ï¼Ÿè®©æˆ‘ä»¬å¼€å§‹å®ç° DEX çš„æ ¸å¿ƒåŠŸèƒ½ï¼ğŸš€**

**ç‰ˆæƒå£°æ˜**: æœ¬è¯¾ç¨‹ææ–™ä»…ä¾›å­¦ä¹ ä½¿ç”¨ã€‚

**æ›´æ–°æ—¥æœŸ**: 2025-01-09
