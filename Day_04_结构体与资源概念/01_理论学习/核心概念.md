# Day 04: ç»“æ„ä½“ä¸èµ„æºæ¦‚å¿µ - æ ¸å¿ƒæ¦‚å¿µ

## ğŸ“š å­¦ä¹ ç›®æ ‡

- ç†è§£ Move ä¸­ç»“æ„ä½“ï¼ˆStructï¼‰çš„å®šä¹‰å’Œä½¿ç”¨
- æŒæ¡èµ„æºï¼ˆResourceï¼‰çš„æ ¸å¿ƒæ¦‚å¿µå’Œç‰¹æ€§
- ç†è§£èƒ½åŠ›ï¼ˆAbilitiesï¼‰ç³»ç»Ÿçš„åŸºç¡€
- å­¦ä¼šä½¿ç”¨ç»“æ„ä½“ç»„ç»‡å¤æ‚æ•°æ®
- æŒæ¡èµ„æºçš„ç”Ÿå‘½å‘¨æœŸç®¡ç†

## 1. ç»“æ„ä½“ï¼ˆStructï¼‰åŸºç¡€

### 1.1 ä»€ä¹ˆæ˜¯ç»“æ„ä½“ï¼Ÿ

ç»“æ„ä½“æ˜¯ Move ä¸­ç”¨äºç»„ç»‡ç›¸å…³æ•°æ®çš„è‡ªå®šä¹‰ç±»å‹ã€‚å®ƒå…è®¸æˆ‘ä»¬å°†å¤šä¸ªå­—æ®µç»„åˆæˆä¸€ä¸ªé€»è¾‘å•å…ƒã€‚

```move
module my_addr::basic_struct {
    struct User {
        name: vector<u8>,
        age: u8,
        is_active: bool,
    }
}
```

### 1.2 ç»“æ„ä½“çš„ç‰¹ç‚¹

- **å‘½åå­—æ®µ**ï¼šæ¯ä¸ªå­—æ®µéƒ½æœ‰åç§°å’Œç±»å‹
- **ç±»å‹å®‰å…¨**ï¼šç¼–è¯‘æ—¶æ£€æŸ¥ç±»å‹åŒ¹é…
- **å°è£…æ€§**ï¼šå­—æ®µé»˜è®¤å¯¹æ¨¡å—å¤–éƒ¨ä¸å¯è§
- **é›¶æ‹·è´**ï¼šç»“æ„ä½“æŒ‰å€¼ä¼ é€’æ—¶æ˜¯ç§»åŠ¨è¯­ä¹‰

### 1.3 ç»“æ„ä½“çš„å®šä¹‰è§„åˆ™

```move
// âœ… æ­£ç¡®ï¼šæ ‡å‡†ç»“æ„ä½“å®šä¹‰
struct Point {
    x: u64,
    y: u64,
}

// âœ… æ­£ç¡®ï¼šåŒ…å«å¤æ‚ç±»å‹
struct UserProfile {
    id: address,
    username: vector<u8>,
    scores: vector<u64>,
    metadata: Metadata,
}

// âœ… æ­£ç¡®ï¼šç©ºç»“æ„ä½“ï¼ˆæ ‡è®°ç±»å‹ï¼‰
struct Witness {}
```

## 2. èƒ½åŠ›ï¼ˆAbilitiesï¼‰ç³»ç»Ÿ

### 2.1 å››ç§åŸºæœ¬èƒ½åŠ›

Move çš„èƒ½åŠ›ç³»ç»Ÿå®šä¹‰äº†ç±»å‹å¯ä»¥è¿›è¡Œçš„æ“ä½œï¼š

| èƒ½åŠ› | å…³é”®å­— | å«ä¹‰ | åº”ç”¨åœºæ™¯ |
|------|--------|------|----------|
| **Copy** | `copy` | å¯ä»¥è¢«å¤åˆ¶ | ç®€å•æ•°å€¼ç±»å‹ |
| **Drop** | `drop` | å¯ä»¥è¢«ä¸¢å¼ƒ | ä¸´æ—¶æ•°æ®ç»“æ„ |
| **Store** | `store` | å¯ä»¥å­˜å‚¨åœ¨å…¨å±€å­˜å‚¨ä¸­ | æŒä¹…åŒ–æ•°æ® |
| **Key** | `key` | å¯ä»¥ä½œä¸ºå…¨å±€å­˜å‚¨çš„é”® | é¡¶å±‚èµ„æº |

### 2.2 èƒ½åŠ›çš„å£°æ˜

```move
// å…·æœ‰ copy å’Œ drop èƒ½åŠ›
struct Point has copy, drop {
    x: u64,
    y: u64,
}

// å…·æœ‰ store èƒ½åŠ›ï¼ˆå¯å­˜å‚¨ä½†ä¸å¯å¤åˆ¶ï¼‰
struct Token has store {
    value: u64,
}

// å…·æœ‰ key å’Œ store èƒ½åŠ›ï¼ˆèµ„æºç±»å‹ï¼‰
struct Account has key, store {
    balance: u64,
}

// æ— ä»»ä½•èƒ½åŠ›ï¼ˆæœ€ä¸¥æ ¼çš„èµ„æºï¼‰
struct HotPotato {
    secret: u64,
}
```

### 2.3 èƒ½åŠ›çš„ç»§æ‰¿è§„åˆ™

```move
// å¦‚æœç»“æ„ä½“çš„å­—æ®µæœ‰æŸç§èƒ½åŠ›é™åˆ¶ï¼Œ
// ç»“æ„ä½“æœ¬èº«ä¹Ÿå¿…é¡»éµå®ˆè¿™äº›é™åˆ¶

// âŒ é”™è¯¯ï¼šCoin æ²¡æœ‰ copyï¼Œä½† Wallet å£°æ˜äº† copy
struct Coin has store {
    value: u64,
}

struct Wallet has copy {  // ç¼–è¯‘é”™è¯¯ï¼
    coin: Coin,  // Coin ä¸èƒ½è¢«å¤åˆ¶
}

// âœ… æ­£ç¡®ï¼šWallet ä¹Ÿä¸å£°æ˜ copy
struct Wallet has store {
    coin: Coin,
}
```

## 3. èµ„æºï¼ˆResourceï¼‰æ¦‚å¿µ

### 3.1 ä»€ä¹ˆæ˜¯èµ„æºï¼Ÿ

èµ„æºæ˜¯ Move çš„æ ¸å¿ƒç‰¹æ€§ï¼Œç”¨äºè¡¨ç¤ºå…·æœ‰å†…åœ¨ä»·å€¼çš„æ•°å­—èµ„äº§ã€‚èµ„æºå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

1. **ä¸èƒ½è¢«å¤åˆ¶**ï¼šä¿è¯å”¯ä¸€æ€§
2. **ä¸èƒ½è¢«ä¸¢å¼ƒ**ï¼šå¿…é¡»æ˜¾å¼å¤„ç†
3. **å¿…é¡»è¢«ç§»åŠ¨æˆ–é”€æ¯**ï¼šä¿è¯èµ„äº§å®‰å…¨

```move
// å…¸å‹çš„èµ„æºå®šä¹‰
struct Coin has key, store {
    value: u64,
}

// è¿™æ˜¯ä¸€ä¸ªèµ„æºï¼Œå› ä¸ºå®ƒï¼š
// - å…·æœ‰ key èƒ½åŠ›ï¼ˆå¯ä½œä¸ºé¡¶å±‚èµ„æºï¼‰
// - å…·æœ‰ store èƒ½åŠ›ï¼ˆå¯å­˜å‚¨ï¼‰
// - æ²¡æœ‰ copy èƒ½åŠ›ï¼ˆä¸å¯å¤åˆ¶ï¼‰
// - æ²¡æœ‰ drop èƒ½åŠ›ï¼ˆä¸å¯ä¸¢å¼ƒï¼‰
```

### 3.2 èµ„æº vs æ™®é€šç»“æ„ä½“

```move
// æ™®é€šç»“æ„ä½“ï¼ˆå€¼ç±»å‹ï¼‰
struct Point has copy, drop {
    x: u64,
    y: u64,
}

// èµ„æºç±»å‹ï¼ˆä¸å¯å¤åˆ¶ã€ä¸å¯ä¸¢å¼ƒï¼‰
struct Token has store {
    amount: u64,
}

fun example() {
    // æ™®é€šç»“æ„ä½“å¯ä»¥å¤åˆ¶å’Œä¸¢å¼ƒ
    let p1 = Point { x: 1, y: 2 };
    let p2 = p1;  // å¤åˆ¶
    // p1 å’Œ p2 éƒ½å¯ä»¥ä½¿ç”¨
    // å‡½æ•°ç»“æŸæ—¶è‡ªåŠ¨ä¸¢å¼ƒ
    
    // èµ„æºå¿…é¡»æ˜¾å¼å¤„ç†
    let token = Token { amount: 100 };
    // let token2 = token;  // è¿™æ˜¯ç§»åŠ¨ï¼Œä¸æ˜¯å¤åˆ¶
    // å¿…é¡»ä½¿ç”¨æˆ–é”€æ¯ tokenï¼Œå¦åˆ™ç¼–è¯‘é”™è¯¯
}
```

### 3.3 èµ„æºçš„ç”Ÿå‘½å‘¨æœŸ

```move
module my_addr::resource_lifecycle {
    use std::signer;
    
    struct Coin has key {
        value: u64,
    }
    
    // 1. åˆ›å»ºèµ„æº
    public fun mint(account: &signer, value: u64) {
        let coin = Coin { value };
        move_to(account, coin);  // ç§»åŠ¨åˆ°å…¨å±€å­˜å‚¨
    }
    
    // 2. å€Ÿç”¨èµ„æºï¼ˆåªè¯»ï¼‰
    public fun get_value(addr: address): u64 acquires Coin {
        let coin = borrow_global<Coin>(addr);
        coin.value
    }
    
    // 3. å€Ÿç”¨èµ„æºï¼ˆå¯å˜ï¼‰
    public fun increase_value(addr: address, amount: u64) acquires Coin {
        let coin = borrow_global_mut<Coin>(addr);
        coin.value = coin.value + amount;
    }
    
    // 4. ç§»å‡ºå¹¶é”€æ¯èµ„æº
    public fun burn(account: &signer) acquires Coin {
        let Coin { value: _ } = move_from<Coin>(signer::address_of(account));
        // é€šè¿‡è§£æ„é”€æ¯èµ„æº
    }
}
```

## 4. ç»“æ„ä½“æ“ä½œ

### 4.1 åˆ›å»ºç»“æ„ä½“å®ä¾‹

```move
struct User {
    name: vector<u8>,
    age: u8,
}

// åˆ›å»ºå®ä¾‹
let user = User {
    name: b"Alice",
    age: 25,
};

// æ‰€æœ‰å­—æ®µå¿…é¡»åˆå§‹åŒ–
// let user = User { name: b"Bob" };  // âŒ é”™è¯¯ï¼šç¼ºå°‘ age å­—æ®µ
```

### 4.2 è®¿é—®ç»“æ„ä½“å­—æ®µ

```move
// é€šè¿‡ç‚¹å·è®¿é—®
let name = user.name;
let age = user.age;

// å¯å˜å€Ÿç”¨åä¿®æ”¹
let user_ref = &mut user;
user_ref.age = 26;
```

### 4.3 è§£æ„ï¼ˆDestructuringï¼‰

```move
// å®Œå…¨è§£æ„
let User { name, age } = user;
// ç°åœ¨å¯ä»¥ä½¿ç”¨ name å’Œ age å˜é‡

// éƒ¨åˆ†è§£æ„ï¼ˆå¿½ç•¥æŸäº›å­—æ®µï¼‰
let User { name, age: _ } = user;
// åªä½¿ç”¨ nameï¼Œage è¢«å¿½ç•¥

// è§£æ„æ˜¯é”€æ¯èµ„æºçš„å”¯ä¸€æ–¹å¼
struct Coin has store {
    value: u64,
}

let coin = Coin { value: 100 };
let Coin { value } = coin;  // è§£æ„é”€æ¯
// coin ä¸å†å­˜åœ¨ï¼Œä½† value å¯ä»¥ä½¿ç”¨
```

### 4.4 æ¨¡å¼åŒ¹é…

```move
fun process_user(user: User): u8 {
    // åœ¨å‡½æ•°å‚æ•°ä¸­è§£æ„
    let User { name: _, age } = user;
    age
}

// åœ¨ let ç»‘å®šä¸­è§£æ„
fun example() {
    let point = Point { x: 10, y: 20 };
    let Point { x, y } = point;
    // ä½¿ç”¨ x å’Œ y
}
```

## 5. åµŒå¥—ç»“æ„ä½“

### 5.1 ç»„åˆç»“æ„ä½“

```move
struct Address {
    street: vector<u8>,
    city: vector<u8>,
    zip: u32,
}

struct Company {
    name: vector<u8>,
    address: Address,
    employee_count: u64,
}

// åˆ›å»ºåµŒå¥—å®ä¾‹
let company = Company {
    name: b"Tech Corp",
    address: Address {
        street: b"123 Main St",
        city: b"San Francisco",
        zip: 94102,
    },
    employee_count: 100,
};

// è®¿é—®åµŒå¥—å­—æ®µ
let city = company.address.city;
```

### 5.2 èƒ½åŠ›ä¼ æ’­

```move
// å¦‚æœå†…éƒ¨ç»“æ„ä½“æ²¡æœ‰æŸç§èƒ½åŠ›ï¼Œå¤–éƒ¨ç»“æ„ä½“ä¹Ÿä¸èƒ½æœ‰

struct Inner {
    value: u64,
    // æ²¡æœ‰ä»»ä½•èƒ½åŠ›
}

// âŒ é”™è¯¯ï¼šOuter ä¸èƒ½æœ‰ copyï¼Œå› ä¸º Inner æ²¡æœ‰
struct Outer has copy {
    inner: Inner,
}

// âœ… æ­£ç¡®ï¼šä¸¤è€…èƒ½åŠ›ä¸€è‡´
struct Inner has copy, drop {
    value: u64,
}

struct Outer has copy, drop {
    inner: Inner,
}
```

## 6. å®è·µå»ºè®®

### 6.1 è®¾è®¡åŸåˆ™

1. **æœ€å°èƒ½åŠ›åŸåˆ™**ï¼šåªç»™ç»“æ„ä½“å¿…éœ€çš„èƒ½åŠ›
2. **æ˜ç¡®æ‰€æœ‰æƒ**ï¼šæ¸…æ¥šèµ„æºçš„æ‹¥æœ‰è€…å’Œç”Ÿå‘½å‘¨æœŸ
3. **ç±»å‹å®‰å…¨**ï¼šåˆ©ç”¨ç±»å‹ç³»ç»Ÿé˜²æ­¢é”™è¯¯
4. **ç»„åˆä¼˜äºç»§æ‰¿**ï¼šé€šè¿‡åµŒå¥—ç»“æ„ä½“å¤ç”¨ä»£ç 

### 6.2 å¸¸è§æ¨¡å¼

```move
// 1. é…ç½®ç»“æ„ä½“ï¼ˆå¯å¤åˆ¶ï¼‰
struct Config has copy, drop, store {
    max_users: u64,
    fee_rate: u64,
}

// 2. èµ„äº§ç»“æ„ä½“ï¼ˆä¸å¯å¤åˆ¶ï¼‰
struct Asset has key, store {
    id: u64,
    owner: address,
    value: u64,
}

// 3. èƒ½åŠ›è§è¯ï¼ˆWitnessï¼‰æ¨¡å¼
struct Witness has drop {}

// 4. çƒ­åœŸè±†ï¼ˆHot Potatoï¼‰æ¨¡å¼
struct Request {
    id: u64,
    // æ²¡æœ‰ä»»ä½•èƒ½åŠ›ï¼Œå¼ºåˆ¶å¿…é¡»å¤„ç†
}
```

### 6.3 é”™è¯¯å¤„ç†

```move
// ä½¿ç”¨æ–­è¨€éªŒè¯ç»“æ„ä½“çŠ¶æ€
public fun transfer(coin: &mut Coin, amount: u64) {
    assert!(coin.value >= amount, 1);  // ä½™é¢ä¸è¶³
    coin.value = coin.value - amount;
}

// ä½¿ç”¨ Option å¤„ç†å¯é€‰å­—æ®µ
struct UserProfile has store {
    name: vector<u8>,
    email: Option<vector<u8>>,  // å¯é€‰çš„ç”µå­é‚®ä»¶
}
```

## 7. å®‰å…¨æ€§è€ƒè™‘

### 7.1 èµ„æºå®‰å…¨

```move
// âœ… æ­£ç¡®ï¼šèµ„æºè¢«æ­£ç¡®å¤„ç†
fun safe_transfer(coin: Coin): Coin {
    coin  // è¿”å›èµ„æº
}

// âŒ é”™è¯¯ï¼šèµ„æºè¢«å¿½ç•¥
fun unsafe_transfer(coin: Coin) {
    // ç¼–è¯‘é”™è¯¯ï¼šcoin æœªè¢«ä½¿ç”¨æˆ–é”€æ¯
}

// âœ… æ­£ç¡®ï¼šæ˜¾å¼é”€æ¯
fun destroy_coin(coin: Coin) {
    let Coin { value: _ } = coin;  // è§£æ„é”€æ¯
}
```

### 7.2 è®¿é—®æ§åˆ¶

```move
module my_addr::secure_vault {
    use std::signer;
    
    struct Vault has key {
        owner: address,
        balance: u64,
    }
    
    // åªæœ‰æ‰€æœ‰è€…å¯ä»¥æå–
    public fun withdraw(account: &signer, amount: u64) acquires Vault {
        let addr = signer::address_of(account);
        let vault = borrow_global_mut<Vault>(addr);
        
        assert!(vault.owner == addr, 1);  // éªŒè¯æ‰€æœ‰æƒ
        assert!(vault.balance >= amount, 2);  // éªŒè¯ä½™é¢
        
        vault.balance = vault.balance - amount;
    }
}
```

## 8. æ€»ç»“

### å…³é”®è¦ç‚¹

1. **ç»“æ„ä½“**æ˜¯ç»„ç»‡æ•°æ®çš„åŸºæœ¬æ–¹å¼
2. **èƒ½åŠ›ç³»ç»Ÿ**æ§åˆ¶ç±»å‹å¯ä»¥è¿›è¡Œçš„æ“ä½œ
3. **èµ„æº**æ˜¯ Move çš„æ ¸å¿ƒç‰¹æ€§ï¼Œç”¨äºè¡¨ç¤ºæœ‰ä»·å€¼çš„èµ„äº§
4. **æ‰€æœ‰æƒå’Œç”Ÿå‘½å‘¨æœŸ**å¿…é¡»åœ¨ç¼–è¯‘æ—¶æ˜ç¡®
5. **ç±»å‹å®‰å…¨**æ˜¯ Move å®‰å…¨æ€§çš„åŸºç¡€

### ä¸‹ä¸€æ­¥

- æ˜å¤©å°†å­¦ä¹ **æ¨¡å—ç³»ç»Ÿä¸å¯è§æ€§**
- è¿›ä¸€æ­¥ç†è§£å¦‚ä½•ç»„ç»‡å’Œå°è£…ä»£ç 
- å­¦ä¹ è®¿é—®æ§åˆ¶å’Œæƒé™ç®¡ç†

## ğŸ“– å‚è€ƒèµ„æ–™

- [Move Book - Structs and Resources](https://move-language.github.io/move/)
- [Aptos Move Documentation](https://aptos.dev/move/move-on-aptos/)
- Move è¯­è¨€è§„èŒƒ
