# Day 05: æ¨¡å—ç³»ç»Ÿä¸å¯è§æ€§ - ç¼–ç¨‹é¢˜

**è€ƒè¯•æ—¶é—´**: 60 åˆ†é’Ÿ  
**æ€»åˆ†**: 100 åˆ†

---

## ğŸ“ ç­”é¢˜è¯´æ˜

1. å°†ä»£ç ä¿å­˜åœ¨ `Day_05_æ¨¡å—ç³»ç»Ÿä¸å¯è§æ€§/sources/` ç›®å½•ä¸‹
2. ç¡®ä¿æ‰€æœ‰ä»£ç èƒ½å¤Ÿç¼–è¯‘é€šè¿‡
3. æ³¨æ„ä»£ç è§„èŒƒå’Œæ³¨é‡Š
4. æµ‹è¯•æ‰€æœ‰åŠŸèƒ½æ˜¯å¦æ­£ç¡®

---

## ç¬¬ 1 é¢˜ï¼šç”¨æˆ·æ³¨å†Œç³»ç»Ÿï¼ˆ30 åˆ†ï¼‰

### é¢˜ç›®æè¿°

å®ç°ä¸€ä¸ªç”¨æˆ·æ³¨å†Œç³»ç»Ÿï¼ŒåŒ…å«ä¸¤ä¸ªæ¨¡å—ï¼š
- `user_registry`: ç”¨æˆ·æ³¨å†Œæ ¸å¿ƒåŠŸèƒ½
- `user_service`: ç”¨æˆ·æœåŠ¡æ¥å£

### åŠŸèƒ½éœ€æ±‚

#### user_registry æ¨¡å—ï¼ˆ15 åˆ†ï¼‰

åˆ›å»ºæ–‡ä»¶ `sources/user_registry.move`

**è¦æ±‚**ï¼š
1. å®šä¹‰ `UserInfo` ç»“æ„ä½“ï¼ˆå…¬å…±ï¼‰
   - `username: vector<u8>`
   - `registration_time: u64`
   - `is_active: bool`

2. å®šä¹‰ `UserRegistry` èµ„æºï¼ˆå…¬å…±ï¼‰
   - `users: vector<UserInfo>`
   - `total_users: u64`

3. å®ç°ä»¥ä¸‹å‡½æ•°ï¼š
   - `create_user_info(name: vector<u8>, time: u64): UserInfo` (public)
   - `get_total_users(registry: &UserRegistry): u64` (public)

#### user_service æ¨¡å—ï¼ˆ15 åˆ†ï¼‰

åˆ›å»ºæ–‡ä»¶ `sources/user_service.move`

**è¦æ±‚**ï¼š
1. ä¾èµ– `user_registry` æ¨¡å—
2. å®ç° `initialize(account: &signer)` (entry)
   - åˆ›å»ºå¹¶å­˜å‚¨ `UserRegistry` èµ„æº
3. å®ç° `register_user(account: &signer, username: vector<u8>, time: u64)` (public entry)
   - åˆ›å»ºæ–°ç”¨æˆ·
   - æ·»åŠ åˆ°æ³¨å†Œè¡¨
   - æ›´æ–°æ€»ç”¨æˆ·æ•°
4. å®ç° `deactivate_user(account: &signer, user_index: u64)` (public entry)
   - å°†æŒ‡å®šç”¨æˆ·çš„ `is_active` è®¾ç½®ä¸º false

### è¯„åˆ†æ ‡å‡†

- ç»“æ„ä½“å®šä¹‰æ­£ç¡®ï¼ˆ8 åˆ†ï¼‰
- å‡½æ•°å¯è§æ€§è®¾ç½®æ­£ç¡®ï¼ˆ8 åˆ†ï¼‰
- æ¨¡å—å¯¼å…¥æ­£ç¡®ï¼ˆ4 åˆ†ï¼‰
- ä¸šåŠ¡é€»è¾‘å®ç°æ­£ç¡®ï¼ˆ8 åˆ†ï¼‰
- ä»£ç é£æ ¼å’Œæ³¨é‡Šï¼ˆ2 åˆ†ï¼‰

### ä»£ç æ¨¡æ¿

```move
module 0x1::user_registry {
    // TODO: å®ç°ä»£ç 
}

module 0x1::user_service {
    use 0x1::user_registry;
    // TODO: å®ç°ä»£ç 
}
```

---

## ç¬¬ 2 é¢˜ï¼šè®¿é—®æ§åˆ¶ç³»ç»Ÿï¼ˆ40 åˆ†ï¼‰

### é¢˜ç›®æè¿°

å®ç°ä¸€ä¸ªåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ç³»ç»Ÿï¼Œä½¿ç”¨å‹å…ƒæœºåˆ¶ä¿æŠ¤æ•æ„Ÿæ“ä½œã€‚

### åŠŸèƒ½éœ€æ±‚

#### access_control æ¨¡å—ï¼ˆ20 åˆ†ï¼‰

åˆ›å»ºæ–‡ä»¶ `sources/access_control.move`

**è¦æ±‚**ï¼š
1. å£°æ˜ `admin_operations` ä¸ºå‹å…ƒæ¨¡å—

2. å®šä¹‰å¸¸é‡ï¼š
   ```move
   const ROLE_ADMIN: u8 = 1;
   const ROLE_MODERATOR: u8 = 2;
   const ROLE_USER: u8 = 3;
   
   const ERROR_NOT_AUTHORIZED: u64 = 1;
   const ERROR_INVALID_ROLE: u64 = 2;
   ```

3. å®šä¹‰ `Account` èµ„æºï¼š
   - `role: u8`
   - `created_at: u64`

4. å®ç°ä»¥ä¸‹å‡½æ•°ï¼š
   - `register(account: &signer)` (public entry)
     - åˆ›å»ºè´¦æˆ·ï¼Œé»˜è®¤è§’è‰²ä¸º `ROLE_USER`
   - `get_role(addr: address): u8` (public)
   - `set_role(addr: address, new_role: u8)` (public(friend))
     - ä¿®æ”¹ç”¨æˆ·è§’è‰²
     - éªŒè¯è§’è‰²æœ‰æ•ˆæ€§
   - `is_admin(addr: address): bool` (public)
     - æ£€æŸ¥æ˜¯å¦ä¸ºç®¡ç†å‘˜

#### admin_operations æ¨¡å—ï¼ˆ20 åˆ†ï¼‰

åˆ›å»ºæ–‡ä»¶ `sources/admin_operations.move`

**è¦æ±‚**ï¼š
1. å®šä¹‰ `AdminCapability` èµ„æºï¼ˆè¯æ˜ç®¡ç†å‘˜èº«ä»½ï¼‰

2. å®ç°ä»¥ä¸‹å‡½æ•°ï¼š
   - `initialize_admin(account: &signer)` (entry)
     - æˆäºˆç®¡ç†å‘˜èƒ½åŠ›
     - åœ¨ `access_control` ä¸­æ³¨å†Œä¸ºç®¡ç†å‘˜
   - `promote_to_moderator(admin: &signer, target: address)` (entry)
     - éªŒè¯è°ƒç”¨è€…æ˜¯ç®¡ç†å‘˜
     - è°ƒç”¨å‹å…ƒå‡½æ•°æå‡ç›®æ ‡ç”¨æˆ·ä¸ºç‰ˆä¸»
   - `demote_to_user(admin: &signer, target: address)` (entry)
     - éªŒè¯è°ƒç”¨è€…æ˜¯ç®¡ç†å‘˜
     - é™çº§ç›®æ ‡ç”¨æˆ·ä¸ºæ™®é€šç”¨æˆ·

### è¯„åˆ†æ ‡å‡†

- å‹å…ƒå£°æ˜å’Œä½¿ç”¨ï¼ˆ10 åˆ†ï¼‰
- å¸¸é‡å®šä¹‰ï¼ˆ4 åˆ†ï¼‰
- æƒé™éªŒè¯é€»è¾‘ï¼ˆ10 åˆ†ï¼‰
- è§’è‰²ç®¡ç†åŠŸèƒ½ï¼ˆ10 åˆ†ï¼‰
- é”™è¯¯å¤„ç†ï¼ˆ4 åˆ†ï¼‰
- ä»£ç è´¨é‡ï¼ˆ2 åˆ†ï¼‰

### ä»£ç æ¨¡æ¿

```move
module 0x1::access_control {
    friend 0x1::admin_operations;
    
    const ROLE_ADMIN: u8 = 1;
    // TODO: æ·»åŠ å…¶ä»–å¸¸é‡
    
    public struct Account has key {
        // TODO: æ·»åŠ å­—æ®µ
    }
    
    // TODO: å®ç°å‡½æ•°
}

module 0x1::admin_operations {
    use 0x1::access_control;
    
    struct AdminCapability has key {}
    
    // TODO: å®ç°å‡½æ•°
}
```

---

## ç¬¬ 3 é¢˜ï¼šä»£å¸è½¬è´¦ç³»ç»Ÿï¼ˆ30 åˆ†ï¼‰

### é¢˜ç›®æè¿°

å®ç°ä¸€ä¸ªç®€å•çš„ä»£å¸ç³»ç»Ÿï¼Œå±•ç¤ºåˆ†å±‚æ¶æ„è®¾è®¡ã€‚

### æ¨¡å—ç»“æ„

```
token_system/
â”œâ”€â”€ token_core.move      # æ ¸å¿ƒæ•°æ®ç»“æ„
â”œâ”€â”€ token_logic.move     # ä¸šåŠ¡é€»è¾‘
â””â”€â”€ token_api.move       # å…¬å…±æ¥å£
```

### åŠŸèƒ½éœ€æ±‚

#### token_core æ¨¡å—ï¼ˆ10 åˆ†ï¼‰

**è¦æ±‚**ï¼š
1. å®šä¹‰ `Token` ç»“æ„ä½“ï¼ˆstore, dropï¼‰ï¼š
   - `value: u64`

2. å®ç°å‡½æ•°ï¼š
   - `create_token(value: u64): Token` (public)
   - `get_value(token: &Token): u64` (public)
   - `destroy_token(token: Token): u64` (public)
   - `merge_tokens(token1: Token, token2: Token): Token` (public)

#### token_logic æ¨¡å—ï¼ˆ10 åˆ†ï¼‰

**è¦æ±‚**ï¼š
1. å£°æ˜ `token_api` ä¸ºå‹å…ƒ

2. å®šä¹‰ `Balance` èµ„æºï¼š
   - `amount: u64`

3. å®ç°å‡½æ•°ï¼š
   - `create_balance(): Balance` (public(friend))
   - `deposit(balance: &mut Balance, token: Token)` (public(friend))
   - `withdraw(balance: &mut Balance, amount: u64): Token` (public(friend))
     - æ£€æŸ¥ä½™é¢æ˜¯å¦å……è¶³
   - `get_balance(balance: &Balance): u64` (public)

#### token_api æ¨¡å—ï¼ˆ10 åˆ†ï¼‰

**è¦æ±‚**ï¼š
1. å®ç°ä»¥ä¸‹ entry å‡½æ•°ï¼š
   - `initialize_account(account: &signer)`
     - åˆ›å»º Balance èµ„æº
   - `mint_tokens(account: &signer, amount: u64)`
     - åˆ›å»ºä»£å¸å¹¶å­˜å…¥ä½™é¢
   - `transfer(from: &signer, to: address, amount: u64)`
     - ä»å‘é€è€…æå–ä»£å¸
     - å­˜å…¥æ¥æ”¶è€…è´¦æˆ·
   - `get_balance(addr: address): u64`
     - æŸ¥è¯¢è´¦æˆ·ä½™é¢

### è¯„åˆ†æ ‡å‡†

- æ¨¡å—åˆ†å±‚æ¸…æ™°ï¼ˆ8 åˆ†ï¼‰
- å‹å…ƒæœºåˆ¶ä½¿ç”¨æ­£ç¡®ï¼ˆ6 åˆ†ï¼‰
- ä»£å¸åˆ›å»ºå’Œé”€æ¯ï¼ˆ6 åˆ†ï¼‰
- è½¬è´¦é€»è¾‘æ­£ç¡®ï¼ˆ6 åˆ†ï¼‰
- é”™è¯¯å¤„ç†ï¼ˆ2 åˆ†ï¼‰
- ä»£ç è´¨é‡ï¼ˆ2 åˆ†ï¼‰

### ä»£ç æ¨¡æ¿

```move
module 0x1::token_core {
    public struct Token has store, drop {
        value: u64
    }
    
    // TODO: å®ç°å‡½æ•°
}

module 0x1::token_logic {
    use 0x1::token_core::{Self, Token};
    friend 0x1::token_api;
    
    public struct Balance has key {
        // TODO: æ·»åŠ å­—æ®µ
    }
    
    // TODO: å®ç°å‡½æ•°
}

module 0x1::token_api {
    use 0x1::token_core;
    use 0x1::token_logic;
    use std::signer;
    
    // TODO: å®ç°å‡½æ•°
}
```

---

## ğŸ§ª æµ‹è¯•è¦æ±‚

ä¸ºæ¯é“é¢˜ç¼–å†™è‡³å°‘ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼ˆé¢å¤–åŠ åˆ†ï¼‰ï¼š

```move
#[test_only]
module 0x1::tests {
    use 0x1::user_service;
    use std::signer;
    
    #[test(account = @0x1)]
    public fun test_user_registration(account: &signer) {
        user_service::initialize(account);
        user_service::register_user(account, b"Alice", 1000);
        // æ·»åŠ æ–­è¨€éªŒè¯
    }
}
```

---

## ğŸ“¤ æäº¤æ¸…å•

å®Œæˆåè¯·ç¡®ä¿ï¼š

- [ ] æ‰€æœ‰æ¨¡å—æ–‡ä»¶éƒ½å·²åˆ›å»º
- [ ] ä»£ç èƒ½å¤Ÿç¼–è¯‘é€šè¿‡ï¼ˆ`aptos move compile`ï¼‰
- [ ] æ‰€æœ‰å‡½æ•°éƒ½æœ‰å®ç°
- [ ] å¯è§æ€§ä¿®é¥°ç¬¦ä½¿ç”¨æ­£ç¡®
- [ ] å‹å…ƒå£°æ˜æ­£ç¡®
- [ ] æœ‰é€‚å½“çš„é”™è¯¯å¤„ç†
- [ ] ä»£ç æœ‰æ³¨é‡Š
- [ ] ï¼ˆå¯é€‰ï¼‰åŒ…å«æµ‹è¯•ç”¨ä¾‹

---

## è¯„åˆ†æ€»ç»“

| é¢˜ç›® | åˆ†å€¼ | å¾—åˆ† |
|------|------|------|
| ç¬¬ 1 é¢˜ï¼šç”¨æˆ·æ³¨å†Œç³»ç»Ÿ | 30 åˆ† | |
| ç¬¬ 2 é¢˜ï¼šè®¿é—®æ§åˆ¶ç³»ç»Ÿ | 40 åˆ† | |
| ç¬¬ 3 é¢˜ï¼šä»£å¸è½¬è´¦ç³»ç»Ÿ | 30 åˆ† | |
| æµ‹è¯•ç”¨ä¾‹ï¼ˆåŠ åˆ†é¡¹ï¼‰ | +10 åˆ† | |
| **æ€»åˆ†** | **100 åˆ†** | |

---

## ğŸ’¡ æç¤º

### é€šç”¨æç¤º
1. å…ˆè®¾è®¡æ¨¡å—ç»“æ„ï¼Œå†å®ç°å…·ä½“åŠŸèƒ½
2. æ³¨æ„èµ„æºçš„ `move_to` å’Œ `borrow_global`
3. ä½¿ç”¨ `assert!` è¿›è¡Œé”™è¯¯æ£€æŸ¥
4. å‹å…ƒå‡½æ•°åªèƒ½åœ¨å‹å…ƒæ¨¡å—ä¸­è°ƒç”¨

### è°ƒè¯•æŠ€å·§
```bash
# ç¼–è¯‘æ£€æŸ¥
aptos move compile

# æŸ¥çœ‹ç¼–è¯‘é”™è¯¯
aptos move compile --verbose

# è¿è¡Œæµ‹è¯•
aptos move test
```

**ç¥ä½ è€ƒè¯•é¡ºåˆ©ï¼** ğŸ¯
