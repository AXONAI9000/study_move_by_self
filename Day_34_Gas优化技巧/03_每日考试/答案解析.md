# Day 34 è€ƒè¯•ç­”æ¡ˆè§£æ

## ğŸ“ ç¬¬ä¸€éƒ¨åˆ†ï¼šé€‰æ‹©é¢˜ç­”æ¡ˆï¼ˆ40åˆ†ï¼‰

### ç­”æ¡ˆé€ŸæŸ¥

1. C  2. C  3. A  4. B  5. B  
6. C  7. B  8. C  9. B  10. C  
11. C  12. B  13. B  14. C  15. B  
16. C  17. B  18. C  19. B  20. B

---

### è¯¦ç»†è§£æ

**1. Aptos Gas è®¡è´¹æ¨¡å‹åŒ…æ‹¬å“ªäº›éƒ¨åˆ†ï¼Ÿ**
- **ç­”æ¡ˆï¼šC. æ‰§è¡Œ Gas + å­˜å‚¨ Gas + IO Gas**
- è§£æï¼šAptos é‡‡ç”¨ä¸‰ç»´ Gas æ¨¡å‹ï¼ŒåŒ…æ‹¬ï¼š
  - æ‰§è¡Œ Gasï¼šæŒ‡ä»¤æ‰§è¡Œæˆæœ¬
  - å­˜å‚¨ Gasï¼šè¯»å†™æ•°æ®æˆæœ¬
  - IO Gasï¼šäº¤æ˜“å¤§å°å’Œç­¾åéªŒè¯æˆæœ¬

**2. åœ¨ Aptos ä¸­ï¼Œå†™å…¥å­˜å‚¨çš„æˆæœ¬å¤§çº¦æ˜¯è¯»å–çš„å¤šå°‘å€ï¼Ÿ**
- **ç­”æ¡ˆï¼šC. 10-20 å€**
- è§£æï¼š
  - è¯»å–ï¼š~300 Gas/byte
  - å†™å…¥ï¼š~5000 Gas/byte + Slot è´¹ç”¨
  - æ¯”ä¾‹çº¦ä¸º 16-20 å€

**3. ä»¥ä¸‹å“ªç§æ•°æ®ç±»å‹å ç”¨ç©ºé—´æœ€å°ï¼Ÿ**
- **ç­”æ¡ˆï¼šA. bool**
- è§£æï¼š
  - bool: 1 bitï¼ˆå®é™… 1 byteï¼‰
  - u8: 1 byte
  - u64: 8 bytes
  - u256: 32 bytes

**4. æ•°æ®æ‰“åŒ…ï¼ˆBit Packingï¼‰çš„ä¸»è¦ä¼˜åŠ¿æ˜¯ä»€ä¹ˆï¼Ÿ**
- **ç­”æ¡ˆï¼šB. å‡å°‘å­˜å‚¨ç©ºé—´å ç”¨**
- è§£æï¼šé€šè¿‡å°†å¤šä¸ªå°å­—æ®µæ‰“åŒ…åˆ°ä¸€ä¸ªå¤§å­—æ®µï¼Œå¯ä»¥æ˜¾è‘—å‡å°‘å­˜å‚¨ç©ºé—´ï¼Œä»è€Œé™ä½ Gas æˆæœ¬ã€‚

**5. ä»¥ä¸‹å“ªä¸ªå¾ªç¯ä¼˜åŒ–æŠ€å·§æœ€æœ‰æ•ˆï¼Ÿ**
- **ç­”æ¡ˆï¼šB. ç¼“å­˜ vector::length() çš„ç»“æœ**
- è§£æï¼š
```move
// âŒ æ¯æ¬¡è¿­ä»£éƒ½è°ƒç”¨ length()
while (i < vector::length(v)) { ... }

// âœ… åªè°ƒç”¨ä¸€æ¬¡
let len = vector::length(v);
while (i < len) { ... }
```
å¯¹äº n æ¬¡è¿­ä»£ï¼ŒèŠ‚çœ (n-1) æ¬¡å‡½æ•°è°ƒç”¨ã€‚

**6. åœ¨ä»€ä¹ˆæƒ…å†µä¸‹åº”è¯¥ä½¿ç”¨ Table è€Œä¸æ˜¯ vectorï¼Ÿ**
- **ç­”æ¡ˆï¼šC. æ•°æ®é‡è¶…è¿‡ 10000 ä¸ª**
- è§£æï¼š
  - vector: é€‚åˆ < 100 é¡¹
  - SimpleMap: é€‚åˆ 100-10000 é¡¹
  - Table: é€‚åˆ > 10000 é¡¹

**7. æ‰¹é‡æ“ä½œç›¸æ¯”å•ä¸ªæ“ä½œçš„ä¸»è¦ä¼˜åŠ¿æ˜¯ä»€ä¹ˆï¼Ÿ**
- **ç­”æ¡ˆï¼šB. åˆ†æ‘Šå›ºå®šæˆæœ¬**
- è§£æï¼š
```
å•ä¸ªæ“ä½œæˆæœ¬ = å›ºå®šæˆæœ¬ + å˜åŠ¨æˆæœ¬
æ‰¹é‡æ“ä½œæˆæœ¬ = å›ºå®šæˆæœ¬ + n Ã— å˜åŠ¨æˆæœ¬
èŠ‚çœ = (n - 1) Ã— å›ºå®šæˆæœ¬
```

**8. ä»¥ä¸‹å“ªç§ä¼˜åŒ–æ–¹å¼çš„ Gas èŠ‚çœæ•ˆæœæœ€æ˜¾è‘—ï¼Ÿ**
- **ç­”æ¡ˆï¼šC. ä¼˜åŒ–å­˜å‚¨ç»“æ„**
- è§£æï¼šå­˜å‚¨æˆæœ¬é€šå¸¸å æ€» Gas çš„ 60-80%ï¼Œå› æ­¤å­˜å‚¨ä¼˜åŒ–æ•ˆæœæœ€æ˜æ˜¾ã€‚

**9. ä»€ä¹ˆæ˜¯å»¶è¿ŸåŠ è½½ï¼ˆLazy Loadingï¼‰ï¼Ÿ**
- **ç­”æ¡ˆï¼šB. åªåœ¨éœ€è¦æ—¶æ‰è¯»å–æ•°æ®**
- è§£æï¼šå°†æ•°æ®åˆ†ç¦»å­˜å‚¨ï¼Œé¿å…ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ•°æ®ï¼ŒæŒ‰éœ€è¯»å–å¯ä»¥æ˜¾è‘—é™ä½ Gasã€‚

**10. ä½¿ç”¨ä½è¿ç®— x >> 3 ç­‰ä»·äºï¼š**
- **ç­”æ¡ˆï¼šC. x / 8**
- è§£æï¼š
  - >> 1 = é™¤ä»¥ 2
  - >> 2 = é™¤ä»¥ 4
  - >> 3 = é™¤ä»¥ 8
  - >> n = é™¤ä»¥ 2^n

**11. SimpleMap é€‚ç”¨äºå¤šå°‘æ•°é‡çº§çš„æ•°æ®ï¼Ÿ**
- **ç­”æ¡ˆï¼šC. 100-10000**
- è§£æï¼šSimpleMap å¹³è¡¡äº†æŸ¥æ‰¾æ•ˆç‡å’Œå­˜å‚¨æˆæœ¬ï¼Œé€‚åˆä¸­ç­‰æ•°æ®é‡ã€‚

**12. åœ¨æ¡ä»¶åˆ†æ”¯ä¼˜åŒ–ä¸­ï¼Œåº”è¯¥å¦‚ä½•æ’åºæ¡ä»¶ï¼Ÿ**
- **ç­”æ¡ˆï¼šB. æŒ‰æ¦‚ç‡é™åº**
- è§£æï¼šå°†æœ€å¸¸è§çš„æƒ…å†µæ”¾åœ¨å‰é¢ï¼Œå¯ä»¥å‡å°‘å¹³å‡åˆ¤æ–­æ¬¡æ•°ã€‚

**13. æ‰¹é‡æ“ä½œçš„æ‰¹æ¬¡å¤§å°ä¸Šé™åº”è¯¥è€ƒè™‘ä»€ä¹ˆï¼Ÿ**
- **ç­”æ¡ˆï¼šB. Gas é™åˆ¶å’Œäº¤æ˜“å¤§å°**
- è§£æï¼šéœ€è¦ç¡®ä¿æ‰¹é‡æ“ä½œä¸ä¼šè¶…è¿‡ï¼š
  - äº¤æ˜“ Gas ä¸Šé™
  - äº¤æ˜“å¤§å°é™åˆ¶
  - åŒºå— Gas é™åˆ¶

**14. ä»¥ä¸‹å“ªç§æƒ…å†µä¸é€‚åˆä½¿ç”¨æ•°æ®æ‰“åŒ…ï¼Ÿ**
- **ç­”æ¡ˆï¼šC. å­—æ®µç‹¬ç«‹è®¿é—®é¢‘ç¹**
- è§£æï¼šå¦‚æœå­—æ®µç»å¸¸ç‹¬ç«‹è®¿é—®ï¼Œæ‰“åŒ…ä¼šå¢åŠ ä½è¿ç®—å¼€é”€ï¼Œåè€Œé™ä½æ•ˆç‡ã€‚

**15. èµ„æºå…±äº«æ¨¡å¼çš„ä¸»è¦æ€æƒ³æ˜¯ä»€ä¹ˆï¼Ÿ**
- **ç­”æ¡ˆï¼šB. ä½¿ç”¨å…¨å±€é»˜è®¤é…ç½®ï¼Œä»…å­˜å‚¨è‡ªå®šä¹‰å€¼**
- è§£æï¼šå¤§å¤šæ•°ç”¨æˆ·ä½¿ç”¨é»˜è®¤å€¼æ—¶ï¼Œåªéœ€å­˜å‚¨å°‘æ•°è‡ªå®šä¹‰é…ç½®ï¼Œå¤§å¹…èŠ‚çœå­˜å‚¨ã€‚

**16. ä»¥ä¸‹å“ªä¸ªä¸æ˜¯ Gas ä¼˜åŒ–çš„ç»´åº¦ï¼Ÿ**
- **ç­”æ¡ˆï¼šC. UI ä¼˜åŒ–**
- è§£æï¼šGas ä¼˜åŒ–çš„ä¸‰å¤§ç»´åº¦ï¼š
  1. å­˜å‚¨ä¼˜åŒ–
  2. è®¡ç®—ä¼˜åŒ–
  3. æ‰¹é‡æ“ä½œ

**17. åœ¨ Move ä¸­ï¼Œå¦‚ä½•æµ‹é‡å‡½æ•°çš„ Gas æ¶ˆè€—ï¼Ÿ**
- **ç­”æ¡ˆï¼šB. ä½¿ç”¨ gas_profiler**
- è§£æï¼š
```bash
aptos move test --gas-profiler
```

**18. åˆå¹¶å¤šä¸ªé™¤æ³•è¿ç®— (a / b / c) åº”è¯¥æ”¹å†™ä¸ºï¼š**
- **ç­”æ¡ˆï¼šC. a / (b * c)**
- è§£æï¼š
```move
// âŒ ä¸¤æ¬¡é™¤æ³•
(a / b) / c

// âœ… ä¸€æ¬¡é™¤æ³•
a / (b * c)
```

**19. è¿‡åº¦ä¼˜åŒ–çš„ä¸»è¦é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ**
- **ç­”æ¡ˆï¼šB. ä»£ç å¯è¯»æ€§å’Œç»´æŠ¤æ€§ä¸‹é™**
- è§£æï¼šè¿‡åº¦ä¼˜åŒ–ä¼šå¯¼è‡´ä»£ç å¤æ‚ã€éš¾ä»¥ç†è§£å’Œç»´æŠ¤ï¼Œå¢åŠ å‡ºé”™é£é™©ã€‚

**20. Gas ä¼˜åŒ–çš„é¦–è¦åŸåˆ™æ˜¯ä»€ä¹ˆï¼Ÿ**
- **ç­”æ¡ˆï¼šB. å…ˆæµ‹é‡ï¼Œè¯†åˆ«çƒ­ç‚¹ï¼Œå†ä¼˜åŒ–**
- è§£æï¼š"è¿‡æ—©ä¼˜åŒ–æ˜¯ä¸‡æ¶ä¹‹æº"ï¼Œåº”è¯¥ï¼š
  1. å…ˆæµ‹é‡æ€§èƒ½
  2. è¯†åˆ« Gas çƒ­ç‚¹
  3. é’ˆå¯¹æ€§ä¼˜åŒ–
  4. éªŒè¯æ•ˆæœ

---

## ğŸ’» ç¬¬äºŒéƒ¨åˆ†ï¼šç¼–ç¨‹é¢˜ç­”æ¡ˆï¼ˆ60åˆ†ï¼‰

### ç¼–ç¨‹é¢˜ 1ï¼šæ•°æ®æ‰“åŒ…å®ç°ï¼ˆ20åˆ†ï¼‰

```move
module exam::packed_order {
    struct PackedOrder has store, drop, copy {
        data: u128,
    }
    
    public fun create_order(
        order_id: u32,
        status: u8,
        priority: u8,
        is_paid: bool,
        is_gift: bool,
        quantity: u16,
        discount_rate: u8,
        warehouse_id: u8
    ): PackedOrder {
        let data: u128 = 0;
        
        // Pack order_id (32 bits at position 0)
        data = data | ((order_id as u128) & 0xFFFFFFFF);
        
        // Pack status (8 bits at position 32)
        data = data | (((status as u128) & 0xFF) << 32);
        
        // Pack priority (8 bits at position 40)
        data = data | (((priority as u128) & 0xFF) << 40);
        
        // Pack is_paid (1 bit at position 48)
        if (is_paid) data = data | (1 << 48);
        
        // Pack is_gift (1 bit at position 49)
        if (is_gift) data = data | (1 << 49);
        
        // Pack quantity (16 bits at position 50)
        data = data | (((quantity as u128) & 0xFFFF) << 50);
        
        // Pack discount_rate (8 bits at position 66)
        data = data | (((discount_rate as u128) & 0xFF) << 66);
        
        // Pack warehouse_id (8 bits at position 74)
        data = data | (((warehouse_id as u128) & 0xFF) << 74);
        
        PackedOrder { data }
    }
    
    public fun get_order_id(order: &PackedOrder): u32 {
        (order.data & 0xFFFFFFFF) as u32
    }
    
    public fun get_status(order: &PackedOrder): u8 {
        ((order.data >> 32) & 0xFF) as u8
    }
    
    public fun set_status(order: &mut PackedOrder, status: u8) {
        // Clear existing status bits
        order.data = order.data & 0xFFFFFFFFFFFFFFFFFFFFFFFFFFFF00FFFFFFFF;
        // Set new status
        order.data = order.data | (((status as u128) & 0xFF) << 32);
    }
    
    public fun is_paid(order: &PackedOrder): bool {
        ((order.data >> 48) & 1) != 0
    }
    
    #[test]
    public fun test_packed_order() {
        let order = create_order(
            12345,  // order_id
            1,      // status (confirmed)
            2,      // priority
            true,   // is_paid
            false,  // is_gift
            5,      // quantity
            10,     // discount_rate
            3       // warehouse_id
        );
        
        assert!(get_order_id(&order) == 12345, 0);
        assert!(get_status(&order) == 1, 1);
        assert!(is_paid(&order) == true, 2);
        
        set_status(&mut order, 2);
        assert!(get_status(&order) == 2, 3);
    }
}
```

**è¯„åˆ†è¦ç‚¹**ï¼š
- æ­£ç¡®çš„ä½å¸ƒå±€è®¾è®¡ï¼ˆ4åˆ†ï¼‰
- æ‰“åŒ…é€»è¾‘æ­£ç¡®ï¼ˆ4åˆ†ï¼‰
- æ‰€æœ‰è®¿é—®å‡½æ•°æ­£ç¡®ï¼ˆ8åˆ†ï¼‰
- è¾¹ç•Œæƒ…å†µå¤„ç†ï¼ˆ2åˆ†ï¼‰
- æµ‹è¯•ç”¨ä¾‹ï¼ˆ2åˆ†ï¼‰

---

### ç¼–ç¨‹é¢˜ 2ï¼šå¾ªç¯å’Œæ‰¹é‡ä¼˜åŒ–ï¼ˆ20åˆ†ï¼‰

```move
module exam::token_distribution {
    use std::signer;
    use std::vector;
    
    const E_INVALID_LENGTH: u64 = 1;
    const E_BATCH_TOO_LARGE: u64 = 2;
    const MAX_BATCH_SIZE: u64 = 100;
    
    struct TokenStore has key {
        balance: u64,
    }
    
    // ä¼˜åŒ–ç‰ˆæœ¬
    public entry fun distribute_tokens_v2(
        admin: &signer,
        recipients: vector<address>,
        amounts: vector<u64>
    ) acquires TokenStore {
        // 1. å‚æ•°éªŒè¯
        let len = vector::length(&recipients);
        assert!(len == vector::length(&amounts), E_INVALID_LENGTH);
        assert!(len <= MAX_BATCH_SIZE, E_BATCH_TOO_LARGE);
        
        // 2. ç¼“å­˜é•¿åº¦ï¼ˆä¼˜åŒ–ç‚¹1ï¼‰
        let admin_addr = signer::address_of(admin);
        
        // 3. è®¡ç®—æ€»é¢ï¼ˆä¼˜åŒ–ç‚¹2ï¼‰
        let total = 0;
        let i = 0;
        while (i < len) {  // ä½¿ç”¨ç¼“å­˜çš„ len
            total = total + *vector::borrow(&amounts, i);
            i = i + 1;
        };
        
        // 4. æ£€æŸ¥ä½™é¢ï¼ˆæ‰¹é‡ä¼˜åŒ–ï¼‰
        let admin_store = borrow_global_mut<TokenStore>(admin_addr);
        assert!(admin_store.balance >= total, 3);
        admin_store.balance = admin_store.balance - total;
        
        // 5. æ‰¹é‡è½¬è´¦
        i = 0;
        while (i < len) {
            let recipient = *vector::borrow(&recipients, i);
            let amount = *vector::borrow(&amounts, i);
            
            if (!exists<TokenStore>(recipient)) {
                move_to(&create_signer(recipient), TokenStore { balance: 0 });
            };
            
            let recipient_store = borrow_global_mut<TokenStore>(recipient);
            recipient_store.balance = recipient_store.balance + amount;
            
            i = i + 1;
        };
    }
    
    native fun create_signer(addr: address): signer;
}
```

**ä¼˜åŒ–ç‚¹è¯´æ˜**ï¼š
1. ç¼“å­˜ vector::length() ç»“æœ
2. å…ˆè®¡ç®—æ€»é¢ï¼Œä¸€æ¬¡æ€§æ£€æŸ¥ä½™é¢
3. æ‰¹é‡å¤„ç†ï¼Œåˆ†æ‘Šå›ºå®šæˆæœ¬
4. å®Œå–„çš„å‚æ•°éªŒè¯å’Œé”™è¯¯å¤„ç†

---

### ç¼–ç¨‹é¢˜ 3ï¼šGas Profiler å®ç°ï¼ˆ20åˆ†ï¼‰

```move
module gas_optimization::profiler {
    use std::string::{Self, String};
    use std::vector;
    
    struct BenchmarkResult has drop {
        name: String,
        iterations: u64,
        total_gas: u64,
        avg_gas: u64,
    }
    
    struct ComparisonReport has drop {
        baseline_name: String,
        baseline_gas: u64,
        optimized_name: String,
        optimized_gas: u64,
        gas_saved: u64,
        improvement_percent: u64,
    }
    
    public fun benchmark(
        name: String,
        iterations: u64,
        func: ||
    ): BenchmarkResult {
        // æ³¨æ„ï¼šå®é™… Gas æµ‹é‡éœ€è¦ä½¿ç”¨ Aptos Gas Profiler
        // è¿™é‡Œæ˜¯ç¤ºæ„æ€§å®ç°
        
        let start_gas = get_remaining_gas();
        
        let i = 0;
        while (i < iterations) {
            func();
            i = i + 1;
        };
        
        let end_gas = get_remaining_gas();
        let total_gas = start_gas - end_gas;
        let avg_gas = total_gas / iterations;
        
        BenchmarkResult {
            name,
            iterations,
            total_gas,
            avg_gas,
        }
    }
    
    public fun compare(
        baseline_name: String,
        baseline_func: ||,
        optimized_name: String,
        optimized_func: ||,
        iterations: u64
    ): ComparisonReport {
        let baseline_result = benchmark(baseline_name, iterations, baseline_func);
        let optimized_result = benchmark(optimized_name, iterations, optimized_func);
        
        let gas_saved = baseline_result.total_gas - optimized_result.total_gas;
        let improvement_percent = (gas_saved * 100) / baseline_result.total_gas;
        
        ComparisonReport {
            baseline_name: baseline_result.name,
            baseline_gas: baseline_result.total_gas,
            optimized_name: optimized_result.name,
            optimized_gas: optimized_result.total_gas,
            gas_saved,
            improvement_percent,
        }
    }
    
    public fun generate_report(
        results: vector<BenchmarkResult>
    ): String {
        let report = string::utf8(b"Gas Benchmark Report\n");
        report = string::append(report, string::utf8(b"=====================\n\n"));
        
        let len = vector::length(&results);
        let i = 0;
        while (i < len) {
            let result = vector::borrow(&results, i);
            // æ ¼å¼åŒ–è¾“å‡ºæ¯ä¸ªç»“æœ
            // å®é™…å®ç°éœ€è¦å­—ç¬¦ä¸²æ‹¼æ¥å’Œæ ¼å¼åŒ–
            i = i + 1;
        };
        
        report
    }
    
    // è¾…åŠ©å‡½æ•°ï¼ˆå®é™…éœ€è¦ä»VMè·å–ï¼‰
    native fun get_remaining_gas(): u64;
}
```

**è¯„åˆ†è¦ç‚¹**ï¼š
- benchmark å‡½æ•°å®ç°ï¼ˆ6åˆ†ï¼‰
- compare å‡½æ•°å®ç°ï¼ˆ6åˆ†ï¼‰
- generate_report å‡½æ•°ï¼ˆ4åˆ†ï¼‰
- æµ‹è¯•ç”¨ä¾‹ï¼ˆ4åˆ†ï¼‰

---

## ğŸ“Š è¯„åˆ†æ€»ç»“

### ä¼˜ç§€ç­”æ¡ˆç‰¹å¾
- âœ… æ‰€æœ‰åŠŸèƒ½æ­£ç¡®å®ç°
- âœ… ä»£ç æ¸…æ™°æ˜“è¯»
- âœ… å……åˆ†çš„é”™è¯¯å¤„ç†
- âœ… å®Œå–„çš„æµ‹è¯•ç”¨ä¾‹
- âœ… æ¸…æ¥šçš„æ³¨é‡Šè¯´æ˜

### å¸¸è§é”™è¯¯
- âŒ ä½è¿ç®—æ©ç é”™è¯¯
- âŒ æœªç¼“å­˜ vector::length()
- âŒ ç¼ºå°‘å‚æ•°éªŒè¯
- âŒ æœªè€ƒè™‘è¾¹ç•Œæƒ…å†µ
- âŒ æµ‹è¯•ä¸å……åˆ†

---

**æ€»ç»“**ï¼šGas ä¼˜åŒ–éœ€è¦ç†è®ºå’Œå®è·µç›¸ç»“åˆï¼Œæ—¢è¦ç†è§£åº•å±‚æœºåˆ¶ï¼Œä¹Ÿè¦æŒæ¡å®ç”¨æŠ€å·§ã€‚æŒç»­æµ‹é‡å’Œä¼˜åŒ–æ˜¯å…³é”®ï¼
