# Day 08 ç¼–ç¨‹é¢˜

## ğŸ“ è€ƒè¯•è¯´æ˜

- **é¢˜ç›®æ•°é‡**ï¼š3 é¢˜
- **æ€»åˆ†**ï¼š60 åˆ†
- **å»ºè®®æ—¶é—´**ï¼š60 åˆ†é’Ÿ
- **åŠæ ¼åˆ†æ•°**ï¼š42 åˆ†ï¼ˆ70%ï¼‰

---

## ç¬¬ä¸€é¢˜ï¼šæ´»åŠ¨ç­¾åˆ°ç³»ç»Ÿï¼ˆ15 åˆ†ï¼‰â­â­â˜†â˜†â˜†

### é¢˜ç›®æè¿°

å®ç°ä¸€ä¸ªæ´»åŠ¨ç­¾åˆ°ç³»ç»Ÿï¼Œç”¨æˆ·å¯ä»¥ç­¾åˆ°å‚åŠ æ´»åŠ¨ï¼Œç³»ç»Ÿè®°å½•æ‰€æœ‰ç­¾åˆ°äº‹ä»¶ã€‚

### åŠŸèƒ½è¦æ±‚

1. **åˆå§‹åŒ–æ´»åŠ¨**ï¼ˆ3 åˆ†ï¼‰
   - åˆ›å»ºæ´»åŠ¨èµ„æº
   - è®¾ç½®æ´»åŠ¨åç§°ã€å¼€å§‹æ—¶é—´ã€ç»“æŸæ—¶é—´
   - åˆå§‹åŒ–äº‹ä»¶å¥æŸ„

2. **ç”¨æˆ·ç­¾åˆ°**ï¼ˆ7 åˆ†ï¼‰
   - æ£€æŸ¥æ´»åŠ¨æ˜¯å¦åœ¨è¿›è¡Œä¸­
   - æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç­¾åˆ°
   - è®°å½•ç­¾åˆ°ä¿¡æ¯
   - å‘å°„ `CheckInEvent`

3. **æŸ¥è¯¢ç»Ÿè®¡**ï¼ˆ5 åˆ†ï¼‰
   - æŸ¥è¯¢æ´»åŠ¨æ€»ç­¾åˆ°äººæ•°
   - æŸ¥è¯¢ç”¨æˆ·æ˜¯å¦å·²ç­¾åˆ°

### äº‹ä»¶ç»“æ„

```move
struct CheckInEvent has drop, store {
    activity_id: u64,
    user: address,
    check_in_time: u64,
    total_participants: u64
}
```

### æ•°æ®ç»“æ„

```move
struct Activity has key {
    id: u64,
    name: vector<u8>,
    start_time: u64,
    end_time: u64,
    participants: vector<address>,
    check_in_events: event::EventHandle<CheckInEvent>
}
```

### ä»£ç æ¨¡æ¿

```move
module day08_exam::activity {
    use std::signer;
    use std::vector;
    use aptos_framework::event;
    use aptos_framework::timestamp;

    /// é”™è¯¯ç 
    const E_ACTIVITY_NOT_STARTED: u64 = 1;
    const E_ACTIVITY_ENDED: u64 = 2;
    const E_ALREADY_CHECKED_IN: u64 = 3;

    struct CheckInEvent has drop, store {
        activity_id: u64,
        user: address,
        check_in_time: u64,
        total_participants: u64
    }

    struct Activity has key {
        id: u64,
        name: vector<u8>,
        start_time: u64,
        end_time: u64,
        participants: vector<address>,
        check_in_events: event::EventHandle<CheckInEvent>
    }

    /// TODO: å®ç°åˆå§‹åŒ–æ´»åŠ¨
    public entry fun initialize_activity(
        organizer: &signer,
        id: u64,
        name: vector<u8>,
        start_time: u64,
        end_time: u64
    ) {
        // ä½ çš„ä»£ç 
    }

    /// TODO: å®ç°ç”¨æˆ·ç­¾åˆ°
    public entry fun check_in(user: &signer, activity_addr: address) acquires Activity {
        // ä½ çš„ä»£ç 
    }

    /// TODO: å®ç°æŸ¥è¯¢åŠŸèƒ½
    #[view]
    public fun get_participant_count(activity_addr: address): u64 acquires Activity {
        // ä½ çš„ä»£ç 
    }

    #[view]
    public fun has_checked_in(activity_addr: address, user: address): bool acquires Activity {
        // ä½ çš„ä»£ç 
    }
}
```

### è¯„åˆ†æ ‡å‡†

- åˆå§‹åŒ–åŠŸèƒ½æ­£ç¡®ï¼š3 åˆ†
- ç­¾åˆ°é€»è¾‘æ­£ç¡®ï¼ˆåŒ…å«æ‰€æœ‰æ£€æŸ¥ï¼‰ï¼š4 åˆ†
- äº‹ä»¶å‘å°„æ­£ç¡®ï¼š3 åˆ†
- æŸ¥è¯¢åŠŸèƒ½æ­£ç¡®ï¼š3 åˆ†
- ä»£ç è´¨é‡å’Œé”™è¯¯å¤„ç†ï¼š2 åˆ†

---

## ç¬¬äºŒé¢˜ï¼šæŠ•ç¥¨ç³»ç»Ÿï¼ˆ20 åˆ†ï¼‰â­â­â­â˜†â˜†

### é¢˜ç›®æè¿°

å®ç°ä¸€ä¸ªæŠ•ç¥¨ç³»ç»Ÿï¼Œæ”¯æŒåˆ›å»ºæŠ•ç¥¨ã€æŠ•ç¥¨ã€ç»“æŸæŠ•ç¥¨ï¼Œå¹¶é€šè¿‡äº‹ä»¶è¿½è¸ªæ‰€æœ‰æŠ•ç¥¨æ´»åŠ¨ã€‚

### åŠŸèƒ½è¦æ±‚

1. **åˆ›å»ºæŠ•ç¥¨**ï¼ˆ5 åˆ†ï¼‰
   - è®¾ç½®æŠ•ç¥¨æ ‡é¢˜ã€é€‰é¡¹ã€ç»“æŸæ—¶é—´
   - å‘å°„ `PollCreatedEvent`

2. **æŠ•ç¥¨**ï¼ˆ8 åˆ†ï¼‰
   - æ£€æŸ¥æŠ•ç¥¨æ˜¯å¦æœ‰æ•ˆ
   - æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²æŠ•ç¥¨
   - è®°å½•æŠ•ç¥¨é€‰æ‹©
   - å‘å°„ `VoteCastEvent`

3. **ç»“æŸæŠ•ç¥¨**ï¼ˆ4 åˆ†ï¼‰
   - æ£€æŸ¥æ—¶é—´æ˜¯å¦åˆ°æœŸ
   - ç»Ÿè®¡ç»“æœ
   - å‘å°„ `PollEndedEvent`

4. **æŸ¥è¯¢ç»“æœ**ï¼ˆ3 åˆ†ï¼‰
   - æŸ¥è¯¢å„é€‰é¡¹ç¥¨æ•°
   - æŸ¥è¯¢æŠ•ç¥¨çŠ¶æ€

### äº‹ä»¶ç»“æ„

```move
struct PollCreatedEvent has drop, store {
    poll_id: u64,
    creator: address,
    title: vector<u8>,
    options_count: u64,
    end_time: u64,
    timestamp: u64
}

struct VoteCastEvent has drop, store {
    poll_id: u64,
    voter: address,
    choice: u64,
    total_votes: u64,
    timestamp: u64
}

struct PollEndedEvent has drop, store {
    poll_id: u64,
    total_votes: u64,
    winning_option: u64,
    winning_votes: u64,
    timestamp: u64
}
```

### æ•°æ®ç»“æ„

```move
struct Poll has key {
    id: u64,
    creator: address,
    title: vector<u8>,
    options: vector<vector<u8>>,  // é€‰é¡¹æè¿°
    votes: vector<u64>,            // æ¯ä¸ªé€‰é¡¹çš„ç¥¨æ•°
    voters: vector<address>,       // å·²æŠ•ç¥¨çš„ç”¨æˆ·
    end_time: u64,
    is_ended: bool,
    // äº‹ä»¶å¥æŸ„
    creation_events: event::EventHandle<PollCreatedEvent>,
    vote_events: event::EventHandle<VoteCastEvent>,
    end_events: event::EventHandle<PollEndedEvent>
}
```

### ä»£ç æ¨¡æ¿

```move
module day08_exam::voting {
    use std::signer;
    use std::vector;
    use aptos_framework::event;
    use aptos_framework::timestamp;

    /// é”™è¯¯ç 
    const E_POLL_ENDED: u64 = 1;
    const E_ALREADY_VOTED: u64 = 2;
    const E_INVALID_CHOICE: u64 = 3;
    const E_POLL_NOT_ENDED: u64 = 4;

    struct PollCreatedEvent has drop, store {
        poll_id: u64,
        creator: address,
        title: vector<u8>,
        options_count: u64,
        end_time: u64,
        timestamp: u64
    }

    struct VoteCastEvent has drop, store {
        poll_id: u64,
        voter: address,
        choice: u64,
        total_votes: u64,
        timestamp: u64
    }

    struct PollEndedEvent has drop, store {
        poll_id: u64,
        total_votes: u64,
        winning_option: u64,
        winning_votes: u64,
        timestamp: u64
    }

    struct Poll has key {
        id: u64,
        creator: address,
        title: vector<u8>,
        options: vector<vector<u8>>,
        votes: vector<u64>,
        voters: vector<address>,
        end_time: u64,
        is_ended: bool,
        creation_events: event::EventHandle<PollCreatedEvent>,
        vote_events: event::EventHandle<VoteCastEvent>,
        end_events: event::EventHandle<PollEndedEvent>
    }

    /// TODO: å®ç°åˆ›å»ºæŠ•ç¥¨
    public entry fun create_poll(
        creator: &signer,
        id: u64,
        title: vector<u8>,
        options: vector<vector<u8>>,
        end_time: u64
    ) {
        // ä½ çš„ä»£ç 
    }

    /// TODO: å®ç°æŠ•ç¥¨
    public entry fun cast_vote(
        voter: &signer,
        poll_addr: address,
        choice: u64
    ) acquires Poll {
        // ä½ çš„ä»£ç 
    }

    /// TODO: å®ç°ç»“æŸæŠ•ç¥¨
    public entry fun end_poll(poll_addr: address) acquires Poll {
        // ä½ çš„ä»£ç 
    }

    /// TODO: å®ç°æŸ¥è¯¢åŠŸèƒ½
    #[view]
    public fun get_results(poll_addr: address): vector<u64> acquires Poll {
        // ä½ çš„ä»£ç 
    }

    #[view]
    public fun is_poll_ended(poll_addr: address): bool acquires Poll {
        // ä½ çš„ä»£ç 
    }
}
```

### è¯„åˆ†æ ‡å‡†

- åˆ›å»ºæŠ•ç¥¨åŠŸèƒ½æ­£ç¡®ï¼š5 åˆ†
- æŠ•ç¥¨é€»è¾‘æ­£ç¡®ï¼ˆåŒ…å«æ‰€æœ‰éªŒè¯ï¼‰ï¼š5 åˆ†
- ç»“æŸæŠ•ç¥¨å’Œç»Ÿè®¡é€»è¾‘æ­£ç¡®ï¼š4 åˆ†
- äº‹ä»¶å‘å°„å®Œæ•´å‡†ç¡®ï¼š4 åˆ†
- æŸ¥è¯¢åŠŸèƒ½æ­£ç¡®ï¼š2 åˆ†

---

## ç¬¬ä¸‰é¢˜ï¼šä»£å¸è´¨æŠ¼ç³»ç»Ÿï¼ˆ25 åˆ†ï¼‰â­â­â­â­â˜†

### é¢˜ç›®æè¿°

å®ç°ä¸€ä¸ªä»£å¸è´¨æŠ¼ç³»ç»Ÿï¼Œç”¨æˆ·å¯ä»¥è´¨æŠ¼ä»£å¸è·å¾—å¥–åŠ±ã€‚ç³»ç»Ÿéœ€è¦è¿½è¸ªæ‰€æœ‰è´¨æŠ¼ã€è§£æŠ¼ã€é¢†å¥–æ´»åŠ¨ã€‚

### åŠŸèƒ½è¦æ±‚

1. **è´¨æŠ¼ä»£å¸**ï¼ˆ7 åˆ†ï¼‰
   - ç”¨æˆ·è´¨æŠ¼æŒ‡å®šæ•°é‡çš„ä»£å¸
   - è®°å½•è´¨æŠ¼æ—¶é—´å’Œæ•°é‡
   - å‘å°„ `StakeEvent`

2. **è§£æŠ¼ä»£å¸**ï¼ˆ7 åˆ†ï¼‰
   - æ£€æŸ¥è´¨æŠ¼æ˜¯å¦æ»¡è¶³æœ€å°æ—¶é—´
   - è®¡ç®—å¥–åŠ±
   - è¿”è¿˜æœ¬é‡‘å’Œå¥–åŠ±
   - å‘å°„ `UnstakeEvent`

3. **é¢†å–å¥–åŠ±**ï¼ˆ6 åˆ†ï¼‰
   - è®¡ç®—å½“å‰å¯é¢†å–çš„å¥–åŠ±
   - æ›´æ–°æœ€åé¢†å–æ—¶é—´
   - å‘å°„ `ClaimRewardEvent`

4. **æŸ¥è¯¢ä¿¡æ¯**ï¼ˆ5 åˆ†ï¼‰
   - æŸ¥è¯¢ç”¨æˆ·è´¨æŠ¼ä¿¡æ¯
   - è®¡ç®—å¾…é¢†å–å¥–åŠ±
   - æŸ¥è¯¢æ± å­æ€»è´¨æŠ¼é‡

### äº‹ä»¶ç»“æ„

```move
struct StakeEvent has drop, store {
    user: address,
    amount: u64,
    total_staked: u64,      // ç”¨æˆ·æ€»è´¨æŠ¼
    pool_total: u64,         // æ± å­æ€»é‡
    timestamp: u64
}

struct UnstakeEvent has drop, store {
    user: address,
    principal: u64,          // æœ¬é‡‘
    reward: u64,             // å¥–åŠ±
    total_staked: u64,       // ç”¨æˆ·å‰©ä½™è´¨æŠ¼
    pool_total: u64,         // æ± å­å‰©ä½™
    timestamp: u64
}

struct ClaimRewardEvent has drop, store {
    user: address,
    reward: u64,
    total_claimed: u64,      // ç´¯è®¡å·²é¢†å–
    timestamp: u64
}
```

### æ•°æ®ç»“æ„

```move
struct StakingPool has key {
    total_staked: u64,
    reward_rate: u64,        // æ¯ç§’æ¯ä»£å¸çš„å¥–åŠ±ç‡ï¼ˆåŸºæ•° 1000000ï¼‰
    min_stake_duration: u64, // æœ€å°è´¨æŠ¼æ—¶é—´ï¼ˆç§’ï¼‰
    // äº‹ä»¶å¥æŸ„
    stake_events: event::EventHandle<StakeEvent>,
    unstake_events: event::EventHandle<UnstakeEvent>,
    claim_events: event::EventHandle<ClaimRewardEvent>
}

struct UserStake has key {
    amount: u64,
    staked_at: u64,
    last_claim_at: u64,
    total_claimed: u64
}
```

### ä»£ç æ¨¡æ¿

```move
module day08_exam::staking {
    use std::signer;
    use aptos_framework::event;
    use aptos_framework::timestamp;

    /// é”™è¯¯ç 
    const E_INSUFFICIENT_STAKE: u64 = 1;
    const E_MIN_DURATION_NOT_MET: u64 = 2;
    const E_NO_STAKE: u64 = 3;
    const E_NO_REWARD: u64 = 4;

    struct StakeEvent has drop, store {
        user: address,
        amount: u64,
        total_staked: u64,
        pool_total: u64,
        timestamp: u64
    }

    struct UnstakeEvent has drop, store {
        user: address,
        principal: u64,
        reward: u64,
        total_staked: u64,
        pool_total: u64,
        timestamp: u64
    }

    struct ClaimRewardEvent has drop, store {
        user: address,
        reward: u64,
        total_claimed: u64,
        timestamp: u64
    }

    struct StakingPool has key {
        total_staked: u64,
        reward_rate: u64,
        min_stake_duration: u64,
        stake_events: event::EventHandle<StakeEvent>,
        unstake_events: event::EventHandle<UnstakeEvent>,
        claim_events: event::EventHandle<ClaimRewardEvent>
    }

    struct UserStake has key {
        amount: u64,
        staked_at: u64,
        last_claim_at: u64,
        total_claimed: u64
    }

    /// TODO: åˆå§‹åŒ–è´¨æŠ¼æ± 
    public entry fun initialize_pool(
        admin: &signer,
        reward_rate: u64,
        min_stake_duration: u64
    ) {
        // ä½ çš„ä»£ç 
    }

    /// TODO: è´¨æŠ¼ä»£å¸
    public entry fun stake(user: &signer, amount: u64) acquires StakingPool, UserStake {
        // ä½ çš„ä»£ç 
    }

    /// TODO: è§£æŠ¼ä»£å¸
    public entry fun unstake(user: &signer, amount: u64) acquires StakingPool, UserStake {
        // ä½ çš„ä»£ç 
    }

    /// TODO: é¢†å–å¥–åŠ±
    public entry fun claim_reward(user: &signer) acquires StakingPool, UserStake {
        // ä½ çš„ä»£ç 
    }

    /// TODO: è®¡ç®—å¾…é¢†å–å¥–åŠ±
    fun calculate_pending_reward(
        amount: u64,
        staked_at: u64,
        last_claim_at: u64,
        reward_rate: u64
    ): u64 {
        // ä½ çš„ä»£ç 
    }

    /// TODO: æŸ¥è¯¢åŠŸèƒ½
    #[view]
    public fun get_user_stake(user: address): (u64, u64, u64) acquires UserStake {
        // è¿”å› (è´¨æŠ¼é‡, è´¨æŠ¼æ—¶é—´, å·²é¢†å–å¥–åŠ±)
        // ä½ çš„ä»£ç 
    }

    #[view]
    public fun get_pending_reward(user: address): u64 acquires StakingPool, UserStake {
        // ä½ çš„ä»£ç 
    }

    #[view]
    public fun get_pool_total(): u64 acquires StakingPool {
        // ä½ çš„ä»£ç 
    }
}
```

### è¯„åˆ†æ ‡å‡†

- è´¨æŠ¼åŠŸèƒ½æ­£ç¡®ï¼š6 åˆ†
- è§£æŠ¼åŠŸèƒ½æ­£ç¡®ï¼ˆåŒ…å«æ—¶é—´æ£€æŸ¥ï¼‰ï¼š6 åˆ†
- å¥–åŠ±è®¡ç®—æ­£ç¡®ï¼š5 åˆ†
- äº‹ä»¶å‘å°„å®Œæ•´å‡†ç¡®ï¼š5 åˆ†
- æŸ¥è¯¢åŠŸèƒ½æ­£ç¡®ï¼š3 åˆ†

---

## ğŸ“Š æäº¤è¦æ±‚

### æ–‡ä»¶ç»“æ„

```
Day_08_äº‹ä»¶ç³»ç»Ÿä¸é“¾ä¸‹ç´¢å¼•/
â””â”€â”€ 03_æ¯æ—¥è€ƒè¯•/
    â””â”€â”€ exam_submissions/
        â”œâ”€â”€ activity.move        # ç¬¬ä¸€é¢˜
        â”œâ”€â”€ voting.move          # ç¬¬äºŒé¢˜
        â””â”€â”€ staking.move         # ç¬¬ä¸‰é¢˜
```

### æµ‹è¯•å‘½ä»¤

```bash
# ç¼–è¯‘æ£€æŸ¥
aptos move compile

# è¿è¡Œæµ‹è¯•
aptos move test
```

---

## ğŸ¯ è¯„åˆ†æ€»è¡¨

| é¢˜å· | é¢˜ç›® | æ»¡åˆ† | å¾—åˆ† |
|------|------|------|------|
| 1 | æ´»åŠ¨ç­¾åˆ°ç³»ç»Ÿ | 15 | |
| 2 | æŠ•ç¥¨ç³»ç»Ÿ | 20 | |
| 3 | ä»£å¸è´¨æŠ¼ç³»ç»Ÿ | 25 | |
| **æ€»è®¡** | | **60** | |

**åŠæ ¼åˆ†ï¼š42 åˆ†ï¼ˆ70%ï¼‰**

---

## ğŸ’¡ è§£é¢˜æç¤º

### é€šç”¨æç¤º

1. å…ˆå®ç°åŸºæœ¬åŠŸèƒ½ï¼Œå†æ·»åŠ äº‹ä»¶
2. æ³¨æ„è¾¹ç•Œæ¡ä»¶æ£€æŸ¥
3. ä½¿ç”¨ `timestamp::now_seconds()` è·å–å½“å‰æ—¶é—´
4. EventHandle å¿…é¡»åœ¨èµ„æºåˆå§‹åŒ–æ—¶åˆ›å»º
5. äº‹ä»¶å‘å°„è¦åŒ…å«å®Œæ•´çš„ä¸Šä¸‹æ–‡ä¿¡æ¯

### ç¬¬ä¸€é¢˜æç¤º

- ä½¿ç”¨ `vector::contains()` æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç­¾åˆ°
- æ´»åŠ¨æ—¶é—´éªŒè¯å¾ˆé‡è¦

### ç¬¬äºŒé¢˜æç¤º

- åˆå§‹åŒ–æ—¶ä¸ºæ¯ä¸ªé€‰é¡¹åˆ›å»ºå¯¹åº”çš„è®¡æ•°å™¨
- ä½¿ç”¨ `vector::length()` éªŒè¯é€‰é¡¹æœ‰æ•ˆæ€§
- æ‰¾å‡ºè·èƒœé€‰é¡¹éœ€è¦éå†æ‰€æœ‰ç¥¨æ•°

### ç¬¬ä¸‰é¢˜æç¤º

- å¥–åŠ±è®¡ç®—å…¬å¼ï¼š`amount * (now - last_claim) * rate / 1000000`
- è´¨æŠ¼æ—¶é—´éªŒè¯ï¼š`now - staked_at >= min_duration`
- å°å¿ƒå¤„ç†é¦–æ¬¡è´¨æŠ¼å’Œè¿½åŠ è´¨æŠ¼çš„æƒ…å†µ

---

**ç¥ä½ è€ƒè¯•é¡ºåˆ©ï¼è®°å¾—å‘å°„æ‰€æœ‰å¿…è¦çš„äº‹ä»¶ï¼** ğŸš€
