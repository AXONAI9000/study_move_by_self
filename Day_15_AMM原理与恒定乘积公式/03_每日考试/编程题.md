# Day 15 æ¯æ—¥è€ƒè¯• - ç¼–ç¨‹é¢˜

**è€ƒè¯•æ—¶é—´**ï¼š30 åˆ†é’Ÿ  
**æ€»åˆ†**ï¼š60 åˆ†ï¼ˆæ¯é¢˜ 20 åˆ†ï¼Œå…± 3 é¢˜ï¼‰  
**åŠæ ¼åˆ†æ•°**ï¼š42 åˆ†ï¼ˆ70%ï¼‰

---

## ğŸ“ ç­”é¢˜è¯´æ˜

1. åœ¨ `sources/exam_solutions.move` ä¸­å®ç°æ‰€æœ‰å‡½æ•°
2. ç¡®ä¿ä»£ç å¯ä»¥ç¼–è¯‘é€šè¿‡
3. è¿è¡Œæµ‹è¯•éªŒè¯æ­£ç¡®æ€§
4. å®Œæˆåå¯¹ç…§ç­”æ¡ˆè§£æè¯„åˆ†

---

## ç¼–ç¨‹é¢˜ 1ï¼šå®ç°æ’å®šä¹˜ç§¯äº¤æ¢è®¡ç®—ï¼ˆ20åˆ†ï¼‰

### é¢˜ç›®æè¿°

å®ç°ä¸€ä¸ªå‡½æ•°ï¼Œæ ¹æ®æ’å®šä¹˜ç§¯å…¬å¼ `x * y = k` è®¡ç®—äº¤æ¢è¾“å‡ºé‡ã€‚

### å‡½æ•°ç­¾å

```move
/// è®¡ç®—äº¤æ¢è¾“å‡ºé‡ï¼ˆä¸å«æ‰‹ç»­è´¹ï¼‰
/// 
/// å‚æ•°ï¼š
///   - amount_in: è¾“å…¥æ•°é‡
///   - reserve_in: è¾“å…¥ä»£å¸å‚¨å¤‡
///   - reserve_out: è¾“å‡ºä»£å¸å‚¨å¤‡
/// 
/// è¿”å›ï¼šè¾“å‡ºæ•°é‡
/// 
/// å…¬å¼ï¼šamount_out = (amount_in * reserve_out) / (reserve_in + amount_in)
public fun calculate_swap_output(
    amount_in: u64,
    reserve_in: u64,
    reserve_out: u64,
): u64 {
    // TODO: åœ¨è¿™é‡Œå®ç°ä½ çš„ä»£ç 
}
```

### è¦æ±‚

1. âœ… æ­£ç¡®å®ç°æ’å®šä¹˜ç§¯å…¬å¼ï¼ˆ10åˆ†ï¼‰
2. âœ… å¤„ç†è¾¹ç•Œæƒ…å†µï¼ˆé›¶å€¼æ£€æŸ¥ï¼‰ï¼ˆ5åˆ†ï¼‰
3. âœ… é¿å…æ•´æ•°æº¢å‡ºï¼ˆä½¿ç”¨ u128ï¼‰ï¼ˆ5åˆ†ï¼‰

### æµ‹è¯•ç”¨ä¾‹

```move
#[test]
fun test_calculate_swap_output() {
    // æµ‹è¯• 1ï¼šåŸºç¡€è®¡ç®—
    let output = calculate_swap_output(1000, 10000, 20000);
    assert!(output == 1818, 1);  // (1000 * 20000) / 11000 â‰ˆ 1818
    
    // æµ‹è¯• 2ï¼šå°é¢äº¤æ¢
    let output = calculate_swap_output(100, 10000, 20000);
    assert!(output == 198, 2);  // (100 * 20000) / 10100 â‰ˆ 198
    
    // æµ‹è¯• 3ï¼šå¤§é¢äº¤æ¢
    let output = calculate_swap_output(5000, 10000, 20000);
    assert!(output == 6666, 3);  // (5000 * 20000) / 15000 â‰ˆ 6666
}

#[test]
#[expected_failure]
fun test_calculate_swap_output_zero_reserve() {
    // åº”è¯¥å¤±è´¥ï¼šå‚¨å¤‡ä¸ºé›¶
    calculate_swap_output(1000, 0, 20000);
}
```

### è¯„åˆ†æ ‡å‡†

| é¡¹ç›® | åˆ†æ•° | è¯´æ˜ |
|------|------|------|
| å…¬å¼æ­£ç¡® | 10 | è®¡ç®—ç»“æœå‡†ç¡® |
| é”™è¯¯å¤„ç† | 5 | æ£€æŸ¥é›¶å€¼ç­‰è¾¹ç•Œæƒ…å†µ |
| æº¢å‡ºå¤„ç† | 5 | ä½¿ç”¨ u128 é¿å…æº¢å‡º |

---

## ç¼–ç¨‹é¢˜ 2ï¼šå®ç° LP Token è®¡ç®—ï¼ˆ20åˆ†ï¼‰

### é¢˜ç›®æè¿°

å®ç°ä¸¤ä¸ªå‡½æ•°ï¼Œåˆ†åˆ«è®¡ç®—é¦–æ¬¡æ·»åŠ å’Œåç»­æ·»åŠ æµåŠ¨æ€§æ—¶çš„ LP Token æ•°é‡ã€‚

### å‡½æ•°ç­¾å

```move
/// è®¡ç®—åˆå§‹ LP Token æ•°é‡
/// 
/// å‚æ•°ï¼š
///   - amount_x: ä»£å¸ X æ•°é‡
///   - amount_y: ä»£å¸ Y æ•°é‡
/// 
/// è¿”å›ï¼šLP Token æ•°é‡
/// 
/// å…¬å¼ï¼šLP = sqrt(amount_x * amount_y) - MINIMUM_LIQUIDITY
const MINIMUM_LIQUIDITY: u64 = 1000;

public fun calculate_initial_lp(
    amount_x: u64,
    amount_y: u64,
): u64 {
    // TODO: å®ç°åˆå§‹ LP è®¡ç®—
    // æç¤ºï¼šéœ€è¦å®ç°å¹³æ–¹æ ¹å‡½æ•°
}

/// è®¡ç®—åç»­ LP Token æ•°é‡
/// 
/// å‚æ•°ï¼š
///   - amount_x: æ·»åŠ çš„ä»£å¸ X æ•°é‡
///   - reserve_x: å½“å‰ä»£å¸ X å‚¨å¤‡
///   - total_lp: å½“å‰ LP æ€»ä¾›åº”é‡
/// 
/// è¿”å›ï¼šæ–°é“¸é€ çš„ LP Token æ•°é‡
/// 
/// å…¬å¼ï¼šnew_lp = (amount_x / reserve_x) * total_lp
public fun calculate_additional_lp(
    amount_x: u64,
    reserve_x: u64,
    total_lp: u64,
): u64 {
    // TODO: å®ç°åç»­ LP è®¡ç®—
}
```

### è¾…åŠ©å‡½æ•°

ä½ å¯èƒ½éœ€è¦å®ç°å¹³æ–¹æ ¹å‡½æ•°ï¼š

```move
/// è®¡ç®—å¹³æ–¹æ ¹ï¼ˆç‰›é¡¿è¿­ä»£æ³•ï¼‰
fun sqrt(x: u128): u64 {
    if (x == 0) return 0;
    
    let z = (x + 1) / 2;
    let y = x;
    
    while (z < y) {
        y = z;
        z = (x / z + z) / 2;
    };
    
    (y as u64)
}
```

### æµ‹è¯•ç”¨ä¾‹

```move
#[test]
fun test_calculate_initial_lp() {
    // sqrt(10000 * 20000) - 1000 = 14142 - 1000 = 13142
    let lp = calculate_initial_lp(10000, 20000);
    assert!(lp >= 13140 && lp <= 13144, 1);  // å…è®¸èˆå…¥è¯¯å·®
}

#[test]
fun test_calculate_additional_lp() {
    // (1000 / 10000) * 14142 = 1414
    let lp = calculate_additional_lp(1000, 10000, 14142);
    assert!(lp == 1414, 2);
}

#[test]
#[expected_failure]
fun test_calculate_additional_lp_zero_reserve() {
    calculate_additional_lp(1000, 0, 14142);
}
```

### è¯„åˆ†æ ‡å‡†

| é¡¹ç›® | åˆ†æ•° | è¯´æ˜ |
|------|------|------|
| åˆå§‹ LP è®¡ç®— | 8 | æ­£ç¡®ä½¿ç”¨å¹³æ–¹æ ¹å…¬å¼ |
| åç»­ LP è®¡ç®— | 8 | æ­£ç¡®æŒ‰æ¯”ä¾‹è®¡ç®— |
| é”™è¯¯å¤„ç† | 4 | è¾¹ç•Œæƒ…å†µæ£€æŸ¥ |

---

## ç¼–ç¨‹é¢˜ 3ï¼šå®ç°å«æ‰‹ç»­è´¹çš„äº¤æ¢ï¼ˆ20åˆ†ï¼‰

### é¢˜ç›®æè¿°

æ‰©å±•ç¬¬ä¸€é¢˜ï¼Œå®ç°å«æ‰‹ç»­è´¹çš„äº¤æ¢è®¡ç®—ã€‚å‡è®¾æ‰‹ç»­è´¹ä¸º 0.3%ã€‚

### å‡½æ•°ç­¾å

```move
/// è®¡ç®—äº¤æ¢è¾“å‡ºé‡ï¼ˆå« 0.3% æ‰‹ç»­è´¹ï¼‰
/// 
/// å‚æ•°ï¼š
///   - amount_in: è¾“å…¥æ•°é‡
///   - reserve_in: è¾“å…¥ä»£å¸å‚¨å¤‡
///   - reserve_out: è¾“å‡ºä»£å¸å‚¨å¤‡
/// 
/// è¿”å›ï¼š(è¾“å‡ºæ•°é‡, æ‰‹ç»­è´¹)
/// 
/// å…¬å¼ï¼š
///   fee = amount_in * 0.003
///   amount_in_after_fee = amount_in - fee = amount_in * 0.997
///   amount_out = (amount_in_after_fee * reserve_out) / (reserve_in + amount_in_after_fee)
public fun calculate_swap_with_fee(
    amount_in: u64,
    reserve_in: u64,
    reserve_out: u64,
): (u64, u64) {
    // TODO: å®ç°å«æ‰‹ç»­è´¹çš„äº¤æ¢è®¡ç®—
}

/// éªŒè¯äº¤æ¢å k å€¼å¢åŠ ï¼ˆæ‰‹ç»­è´¹æ•ˆæœï¼‰
/// 
/// å‚æ•°ï¼š
///   - old_reserve_x: äº¤æ¢å‰ X å‚¨å¤‡
///   - old_reserve_y: äº¤æ¢å‰ Y å‚¨å¤‡
///   - new_reserve_x: äº¤æ¢å X å‚¨å¤‡
///   - new_reserve_y: äº¤æ¢å Y å‚¨å¤‡
/// 
/// è¿”å›ï¼šæ–° k æ˜¯å¦ > æ—§ k
public fun verify_k_increase(
    old_reserve_x: u64,
    old_reserve_y: u64,
    new_reserve_x: u64,
    new_reserve_y: u64,
): bool {
    // TODO: éªŒè¯ k å€¼å¢åŠ 
}
```

### å¸¸é‡å®šä¹‰

```move
const FEE_NUMERATOR: u64 = 30;      // 0.3% = 30/10000
const FEE_DENOMINATOR: u64 = 10000;
```

### æµ‹è¯•ç”¨ä¾‹

```move
#[test]
fun test_calculate_swap_with_fee() {
    // è¾“å…¥ï¼š1000
    // æ‰‹ç»­è´¹ï¼š1000 * 0.003 = 3
    // å®é™…äº¤æ¢ï¼š997
    // è¾“å‡ºï¼š(997 * 20000) / (10000 + 997) â‰ˆ 1812
    let (output, fee) = calculate_swap_with_fee(1000, 10000, 20000);
    
    assert!(fee == 3, 1);
    assert!(output >= 1810 && output <= 1815, 2);
}

#[test]
fun test_verify_k_increase() {
    // äº¤æ¢å‰ï¼šk = 10000 * 20000 = 200,000,000
    // äº¤æ¢ï¼š1000 è¾“å…¥ï¼Œ1812 è¾“å‡ºï¼ˆå«æ‰‹ç»­è´¹ï¼‰
    // äº¤æ¢åï¼šk = 11000 * 18188 = 200,068,000 > 200,000,000 âœ…
    let result = verify_k_increase(10000, 20000, 11000, 18188);
    assert!(result == true, 3);
}

#[test]
fun test_fee_calculation() {
    // éªŒè¯ä¸åŒè¾“å…¥çš„æ‰‹ç»­è´¹
    let (_, fee1) = calculate_swap_with_fee(1000, 10000, 20000);
    assert!(fee1 == 3, 1);
    
    let (_, fee2) = calculate_swap_with_fee(10000, 10000, 20000);
    assert!(fee2 == 30, 2);
    
    let (_, fee3) = calculate_swap_with_fee(100, 10000, 20000);
    assert!(fee3 == 0, 3);  // å‘ä¸‹å–æ•´
}
```

### è¯„åˆ†æ ‡å‡†

| é¡¹ç›® | åˆ†æ•° | è¯´æ˜ |
|------|------|------|
| æ‰‹ç»­è´¹è®¡ç®— | 8 | æ­£ç¡®è®¡ç®— 0.3% æ‰‹ç»­è´¹ |
| è¾“å‡ºè®¡ç®— | 8 | æ‰£é™¤æ‰‹ç»­è´¹åæ­£ç¡®è®¡ç®—è¾“å‡º |
| k å€¼éªŒè¯ | 4 | æ­£ç¡®éªŒè¯ k å¢åŠ  |

---

## ğŸ§ª å®Œæ•´æµ‹è¯•ä»£ç æ¨¡æ¿

åœ¨ `tests/exam_tests.move` ä¸­ï¼š

```move
#[test_only]
module day15_exam::exam_tests {
    use day15_exam::exam_solutions::{
        calculate_swap_output,
        calculate_initial_lp,
        calculate_additional_lp,
        calculate_swap_with_fee,
        verify_k_increase
    };

    // ========== ç¼–ç¨‹é¢˜ 1 æµ‹è¯• ==========
    
    #[test]
    fun test_q1_basic_swap() {
        let output = calculate_swap_output(1000, 10000, 20000);
        assert!(output == 1818, 0);
    }
    
    #[test]
    fun test_q1_small_swap() {
        let output = calculate_swap_output(100, 10000, 20000);
        assert!(output == 198, 1);
    }
    
    #[test]
    #[expected_failure]
    fun test_q1_zero_reserve() {
        calculate_swap_output(1000, 0, 20000);
    }
    
    // ========== ç¼–ç¨‹é¢˜ 2 æµ‹è¯• ==========
    
    #[test]
    fun test_q2_initial_lp() {
        let lp = calculate_initial_lp(10000, 20000);
        // sqrt(200000000) - 1000 â‰ˆ 13142
        assert!(lp >= 13140 && lp <= 13145, 2);
    }
    
    #[test]
    fun test_q2_additional_lp() {
        let lp = calculate_additional_lp(1000, 10000, 14142);
        assert!(lp == 1414, 3);
    }
    
    // ========== ç¼–ç¨‹é¢˜ 3 æµ‹è¯• ==========
    
    #[test]
    fun test_q3_swap_with_fee() {
        let (output, fee) = calculate_swap_with_fee(1000, 10000, 20000);
        assert!(fee == 3, 4);
        assert!(output >= 1810 && output <= 1815, 5);
    }
    
    #[test]
    fun test_q3_k_increase() {
        let result = verify_k_increase(10000, 20000, 11000, 18188);
        assert!(result == true, 6);
    }
}
```

---

## ğŸ“¤ æäº¤è¦æ±‚

### æ–‡ä»¶ç»“æ„

```
sources/
â””â”€â”€ exam_solutions.move    # ä½ çš„å®ç°

tests/
â””â”€â”€ exam_tests.move        # æµ‹è¯•ä»£ç 
```

### exam_solutions.move æ¨¡æ¿

```move
module day15_exam::exam_solutions {
    
    // ========== ç¼–ç¨‹é¢˜ 1 ==========
    
    public fun calculate_swap_output(
        amount_in: u64,
        reserve_in: u64,
        reserve_out: u64,
    ): u64 {
        // TODO: å®ç°ä½ çš„ä»£ç 
        0
    }
    
    // ========== ç¼–ç¨‹é¢˜ 2 ==========
    
    const MINIMUM_LIQUIDITY: u64 = 1000;
    
    public fun calculate_initial_lp(
        amount_x: u64,
        amount_y: u64,
    ): u64 {
        // TODO: å®ç°ä½ çš„ä»£ç 
        0
    }
    
    public fun calculate_additional_lp(
        amount_x: u64,
        reserve_x: u64,
        total_lp: u64,
    ): u64 {
        // TODO: å®ç°ä½ çš„ä»£ç 
        0
    }
    
    // ========== ç¼–ç¨‹é¢˜ 3 ==========
    
    const FEE_NUMERATOR: u64 = 30;
    const FEE_DENOMINATOR: u64 = 10000;
    
    public fun calculate_swap_with_fee(
        amount_in: u64,
        reserve_in: u64,
        reserve_out: u64,
    ): (u64, u64) {
        // TODO: å®ç°ä½ çš„ä»£ç 
        (0, 0)
    }
    
    public fun verify_k_increase(
        old_reserve_x: u64,
        old_reserve_y: u64,
        new_reserve_x: u64,
        new_reserve_y: u64,
    ): bool {
        // TODO: å®ç°ä½ çš„ä»£ç 
        false
    }
    
    // ========== è¾…åŠ©å‡½æ•° ==========
    
    fun sqrt(x: u128): u64 {
        if (x == 0) return 0;
        
        let z = (x + 1) / 2;
        let y = x;
        
        while (z < y) {
            y = z;
            z = (x / z + z) / 2;
        };
        
        (y as u64)
    }
}
```

---

## âœ… éªŒè¯æ­¥éª¤

### 1. ç¼–è¯‘æ£€æŸ¥

```bash
aptos move compile
```

é¢„æœŸè¾“å‡ºï¼š
```
{
  "Result": "Success"
}
```

### 2. è¿è¡Œæµ‹è¯•

```bash
aptos move test
```

é¢„æœŸè¾“å‡ºï¼š
```
Running Move unit tests
[ PASS    ] 0x...::exam_tests::test_q1_basic_swap
[ PASS    ] 0x...::exam_tests::test_q1_small_swap
[ PASS    ] 0x...::exam_tests::test_q2_initial_lp
[ PASS    ] 0x...::exam_tests::test_q2_additional_lp
[ PASS    ] 0x...::exam_tests::test_q3_swap_with_fee
[ PASS    ] 0x...::exam_tests::test_q3_k_increase
Test result: OK. Total tests: 6; passed: 6; failed: 0
```

### 3. è‡ªæˆ‘è¯„åˆ†

æ ¹æ®é€šè¿‡çš„æµ‹è¯•æ•°é‡è¯„åˆ†ï¼š

| é€šè¿‡æµ‹è¯• | å¾—åˆ† |
|---------|------|
| 6/6 | 60/60 âœ… æ»¡åˆ† |
| 5/6 | 50/60 âœ… è‰¯å¥½ |
| 4/6 | 42/60 âœ… åŠæ ¼ |
| 3/6 | 30/60 âŒ ä¸åŠæ ¼ |

---

## ğŸ’¡ è§£é¢˜æç¤º

### æç¤º 1ï¼šé¿å…æ•´æ•°é™¤æ³•ç²¾åº¦æŸå¤±

```move
// âŒ é”™è¯¯ï¼šå…ˆé™¤åä¹˜ä¼šæŸå¤±ç²¾åº¦
let ratio = amount_in / reserve_in;
let output = ratio * reserve_out;

// âœ… æ­£ç¡®ï¼šå…ˆä¹˜åé™¤
let output = (amount_in * reserve_out) / (reserve_in + amount_in);
```

### æç¤º 2ï¼šå¤„ç†æº¢å‡º

```move
// âŒ å¯èƒ½æº¢å‡º
let product = reserve_x * reserve_y;

// âœ… ä½¿ç”¨ u128
let product = (reserve_x as u128) * (reserve_y as u128);
```

### æç¤º 3ï¼šæ‰‹ç»­è´¹è®¡ç®—

```move
// 0.3% = 30 / 10000
let fee = amount_in * FEE_NUMERATOR / FEE_DENOMINATOR;
let amount_after_fee = amount_in - fee;

// æˆ–è€…ç›´æ¥è®¡ç®— 0.997
let amount_after_fee = amount_in * (FEE_DENOMINATOR - FEE_NUMERATOR) / FEE_DENOMINATOR;
```

### æç¤º 4ï¼šéªŒè¯ k å¢åŠ 

```move
let old_k = (old_reserve_x as u128) * (old_reserve_y as u128);
let new_k = (new_reserve_x as u128) * (new_reserve_y as u128);
new_k > old_k
```

---

## ğŸ“Š è¯„åˆ†æ±‡æ€»

| é¢˜ç›® | æ»¡åˆ† | æˆ‘çš„å¾—åˆ† |
|------|------|---------|
| ç¼–ç¨‹é¢˜ 1 | 20 | _____ |
| ç¼–ç¨‹é¢˜ 2 | 20 | _____ |
| ç¼–ç¨‹é¢˜ 3 | 20 | _____ |
| **æ€»åˆ†** | **60** | **_____** |

---

## ğŸ¯ å®Œæˆæ ‡å‡†

- **ä¼˜ç§€**ï¼š54-60 åˆ†ï¼ˆ90%+ï¼‰
- **è‰¯å¥½**ï¼š48-53 åˆ†ï¼ˆ80%-89%ï¼‰
- **åŠæ ¼**ï¼š42-47 åˆ†ï¼ˆ70%-79%ï¼‰
- **ä¸åŠæ ¼**ï¼š< 42 åˆ†ï¼ˆ< 70%ï¼‰

---

## ğŸ“ è€ƒååæ€

å®Œæˆç¼–ç¨‹é¢˜åï¼Œè¯·å›ç­”ï¼š

1. **æœ€éš¾çš„éƒ¨åˆ†**ï¼š__________
2. **å­¦åˆ°çš„æ–°çŸ¥è¯†**ï¼š__________
3. **éœ€è¦æ”¹è¿›çš„åœ°æ–¹**ï¼š__________
4. **ç”¨æ—¶**ï¼š_____ åˆ†é’Ÿ

---

**å®Œæˆåè¯·æŸ¥çœ‹ `ç­”æ¡ˆè§£æ.md` å¯¹ç…§æ ‡å‡†ç­”æ¡ˆï¼**

ç¥ä½ è€ƒè¯•é¡ºåˆ©ï¼ğŸ’ª
