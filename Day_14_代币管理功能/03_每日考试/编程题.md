# Day 14 æ¯æ—¥è€ƒè¯•ï¼šä»£å¸ç®¡ç†åŠŸèƒ½ - ç¼–ç¨‹é¢˜

**è€ƒè¯•æ—¶é—´**ï¼š90 åˆ†é’Ÿ  
**æ€»åˆ†**ï¼š100 åˆ†

---

## ç¬¬ä¸€é¢˜ï¼šé™é¢é“¸é€ ç³»ç»Ÿï¼ˆ30 åˆ†ï¼‰

### é¢˜ç›®æè¿°
å®ç°ä¸€ä¸ªå¸¦æœ‰æ—¥é“¸é€ é™é¢å’Œæœˆé“¸é€ é™é¢çš„åŒé‡é™åˆ¶ç³»ç»Ÿã€‚è¦æ±‚ï¼š

1. **æ—¥é™é¢**ï¼šæ¯å¤©æœ€å¤šé“¸é€  100,000 ä¸ªä»£å¸
2. **æœˆé™é¢**ï¼šæ¯æœˆæœ€å¤šé“¸é€  2,000,000 ä¸ªä»£å¸
3. **é‡ç½®æœºåˆ¶**ï¼š
   - æ¯å¤©åˆå¤œè‡ªåŠ¨é‡ç½®æ—¥é™é¢
   - æ¯æœˆ 1 æ—¥è‡ªåŠ¨é‡ç½®æœˆé™é¢
4. **æŸ¥è¯¢åŠŸèƒ½**ï¼š
   - æŸ¥è¯¢ä»Šæ—¥å·²é“¸é€ æ•°é‡
   - æŸ¥è¯¢æœ¬æœˆå·²é“¸é€ æ•°é‡
   - æŸ¥è¯¢ä»Šæ—¥å‰©ä½™é¢åº¦
   - æŸ¥è¯¢æœ¬æœˆå‰©ä½™é¢åº¦

### ä»£ç æ¡†æ¶
```move
module token_exam::limited_mint {
    use std::signer;
    use aptos_framework::coin::{Self, MintCapability};
    use aptos_framework::timestamp;

    struct LimitedCoin {}

    struct MintLimits has key {
        mint_cap: MintCapability<LimitedCoin>,
        
        // æ—¥é™é¢
        daily_limit: u64,
        minted_today: u64,
        last_daily_reset: u64,
        
        // æœˆé™é¢
        monthly_limit: u64,
        minted_this_month: u64,
        last_monthly_reset: u64,
    }

    /// TODO 1: å®ç°åˆå§‹åŒ–å‡½æ•°ï¼ˆ5 åˆ†ï¼‰
    fun init_module(account: &signer) {
        // åˆå§‹åŒ–ä»£å¸
        // è®¾ç½®æ—¥é™é¢ 100,000 * 10^8
        // è®¾ç½®æœˆé™é¢ 2,000,000 * 10^8
    }

    /// TODO 2: å®ç°é™é¢æ£€æŸ¥å’Œé‡ç½®å‡½æ•°ï¼ˆ10 åˆ†ï¼‰
    fun check_and_reset_limits(limits: &mut MintLimits) {
        let now = timestamp::now_seconds();
        
        // æ£€æŸ¥æ˜¯å¦éœ€è¦é‡ç½®æ—¥é™é¢
        // æç¤ºï¼šè®¡ç®—å½“å‰å¤©æ•° = now / 86400
        
        // æ£€æŸ¥æ˜¯å¦éœ€è¦é‡ç½®æœˆé™é¢  
        // æç¤ºï¼šè®¡ç®—å½“å‰æœˆæ•° = now / (86400 * 30)
    }

    /// TODO 3: å®ç°é™é¢é“¸é€ å‡½æ•°ï¼ˆ10 åˆ†ï¼‰
    public entry fun mint_with_limits(
        admin: &signer,
        recipient: address,
        amount: u64
    ) acquires MintLimits {
        // 1. éªŒè¯æƒé™
        // 2. æ£€æŸ¥å¹¶é‡ç½®é™é¢
        // 3. æ£€æŸ¥æ—¥é™é¢
        // 4. æ£€æŸ¥æœˆé™é¢
        // 5. æ‰§è¡Œé“¸é€ 
        // 6. æ›´æ–°ç»Ÿè®¡
    }

    /// TODO 4: å®ç°æŸ¥è¯¢å‡½æ•°ï¼ˆ5 åˆ†ï¼‰
    #[view]
    public fun get_remaining_daily_quota(): u64 acquires MintLimits {
        // è¿”å›ä»Šæ—¥å‰©ä½™é¢åº¦
    }

    #[view]
    public fun get_remaining_monthly_quota(): u64 acquires MintLimits {
        // è¿”å›æœ¬æœˆå‰©ä½™é¢åº¦
    }
}
```

### è¯„åˆ†æ ‡å‡†
- åˆå§‹åŒ–æ­£ç¡®ï¼ˆ5 åˆ†ï¼‰
- é™é¢é‡ç½®é€»è¾‘æ­£ç¡®ï¼ˆ10 åˆ†ï¼‰
- é“¸é€ å‡½æ•°é€»è¾‘å®Œæ•´ï¼ˆ10 åˆ†ï¼‰
- æŸ¥è¯¢å‡½æ•°å®ç°æ­£ç¡®ï¼ˆ5 åˆ†ï¼‰

---

## ç¬¬äºŒé¢˜ï¼šé˜¶æ¢¯é”€æ¯ç‡è½¬è´¦ç³»ç»Ÿï¼ˆ35 åˆ†ï¼‰

### é¢˜ç›®æè¿°
å®ç°ä¸€ä¸ªæ ¹æ®è½¬è´¦é‡‘é¢é‡‡ç”¨ä¸åŒé”€æ¯ç‡çš„è½¬è´¦ç³»ç»Ÿã€‚é”€æ¯ç‡è§„åˆ™ï¼š

| è½¬è´¦é‡‘é¢èŒƒå›´ | é”€æ¯ç‡ |
|------------|-------|
| 0 - 1,000 | 0.5% |
| 1,001 - 10,000 | 1% |
| 10,001 - 100,000 | 1.5% |
| > 100,000 | 2% |

**é¢å¤–è¦æ±‚**ï¼š
1. ç»Ÿè®¡ä¸åŒåŒºé—´çš„æ€»é”€æ¯é‡
2. è®°å½•æ¯æ¬¡è½¬è´¦çš„é”€æ¯äº‹ä»¶
3. æä¾›æŸ¥è¯¢å„åŒºé—´ç´¯è®¡é”€æ¯é‡çš„åŠŸèƒ½
4. VIP ç”¨æˆ·ï¼ˆç™½åå•ï¼‰äº«å— 50% é”€æ¯ç‡æŠ˜æ‰£

### ä»£ç æ¡†æ¶
```move
module token_exam::tiered_burn {
    use std::signer;
    use std::string::{Self, String};
    use aptos_std::table::{Self, Table};
    use aptos_framework::coin::{Self, Coin, BurnCapability};
    use aptos_framework::event::{Self, EventHandle};
    use aptos_framework::account;
    use aptos_framework::timestamp;

    struct TieredCoin {}

    const TIER1_THRESHOLD: u64 = 1000 * 100000000;      // 1,000
    const TIER2_THRESHOLD: u64 = 10000 * 100000000;     // 10,000
    const TIER3_THRESHOLD: u64 = 100000 * 100000000;    // 100,000

    const TIER1_RATE: u64 = 50;    // 0.5% = 50 åŸºç‚¹
    const TIER2_RATE: u64 = 100;   // 1%
    const TIER3_RATE: u64 = 150;   // 1.5%
    const TIER4_RATE: u64 = 200;   // 2%

    const BASIS_POINTS: u64 = 10000;

    struct BurnConfig has key {
        burn_cap: BurnCapability<TieredCoin>,
        
        // å„åŒºé—´ç´¯è®¡é”€æ¯é‡
        tier1_burned: u64,
        tier2_burned: u64,
        tier3_burned: u64,
        tier4_burned: u64,
        
        // VIP ç™½åå•
        vip_users: Table<address, bool>,
        
        // äº‹ä»¶
        burn_events: EventHandle<BurnEvent>,
    }

    struct BurnEvent has drop, store {
        from: address,
        to: address,
        total_amount: u64,
        burned_amount: u64,
        burn_rate: u64,
        tier: u8,
        timestamp: u64,
    }

    /// TODO 1: å®ç°è®¡ç®—é”€æ¯ç‡å‡½æ•°ï¼ˆ10 åˆ†ï¼‰
    fun calculate_burn_rate(
        amount: u64,
        is_vip: bool
    ): (u64, u8) {
        // æ ¹æ®é‡‘é¢ç¡®å®šåŒºé—´å’ŒåŸºç¡€è´¹ç‡
        // å¦‚æœæ˜¯ VIPï¼Œè´¹ç‡å‡åŠ
        // è¿”å› (burn_rate, tier)
    }

    /// TODO 2: å®ç°å¸¦é”€æ¯çš„è½¬è´¦å‡½æ•°ï¼ˆ15 åˆ†ï¼‰
    public entry fun transfer_with_tiered_burn(
        from: &signer,
        to: address,
        amount: u64
    ) acquires BurnConfig {
        // 1. è·å–å‘é€è€…åœ°å€
        // 2. æ£€æŸ¥æ˜¯å¦æ˜¯ VIP
        // 3. è®¡ç®—é”€æ¯ç‡å’ŒåŒºé—´
        // 4. è®¡ç®—é”€æ¯æ•°é‡å’Œè½¬è´¦æ•°é‡
        // 5. æå–ä»£å¸
        // 6. åˆ†ç¦»é”€æ¯éƒ¨åˆ†
        // 7. æ‰§è¡Œé”€æ¯
        // 8. æ›´æ–°å¯¹åº”åŒºé—´çš„ç»Ÿè®¡
        // 9. è½¬è´¦å‰©ä½™éƒ¨åˆ†
        // 10. å‘å°„äº‹ä»¶
    }

    /// TODO 3: å®ç° VIP ç®¡ç†å‡½æ•°ï¼ˆ5 åˆ†ï¼‰
    public entry fun add_vip(
        admin: &signer,
        user: address
    ) acquires BurnConfig {
        // æ·»åŠ  VIP ç”¨æˆ·
    }

    public entry fun remove_vip(
        admin: &signer,
        user: address
    ) acquires BurnConfig {
        // ç§»é™¤ VIP ç”¨æˆ·
    }

    /// TODO 4: å®ç°ç»Ÿè®¡æŸ¥è¯¢å‡½æ•°ï¼ˆ5 åˆ†ï¼‰
    #[view]
    public fun get_tier_stats(): (u64, u64, u64, u64) acquires BurnConfig {
        // è¿”å›å››ä¸ªåŒºé—´çš„ç´¯è®¡é”€æ¯é‡
    }

    #[view]
    public fun is_vip(user: address): bool acquires BurnConfig {
        // æ£€æŸ¥æ˜¯å¦æ˜¯ VIP
    }

    #[view]
    public fun calculate_burn_preview(
        user: address,
        amount: u64
    ): (u64, u64, u8) acquires BurnConfig {
        // é¢„è§ˆè½¬è´¦ï¼šè¿”å› (burn_amount, transfer_amount, tier)
    }
}
```

### è¯„åˆ†æ ‡å‡†
- é”€æ¯ç‡è®¡ç®—æ­£ç¡®ï¼ˆ10 åˆ†ï¼‰
- è½¬è´¦é€»è¾‘å®Œæ•´ä¸”æ­£ç¡®ï¼ˆ15 åˆ†ï¼‰
- VIP ç®¡ç†åŠŸèƒ½æ­£ç¡®ï¼ˆ5 åˆ†ï¼‰
- ç»Ÿè®¡å’ŒæŸ¥è¯¢åŠŸèƒ½æ­£ç¡®ï¼ˆ5 åˆ†ï¼‰

---

## ç¬¬ä¸‰é¢˜ï¼šé«˜çº§å¤šç­¾åæƒé™ç®¡ç†ç³»ç»Ÿï¼ˆ35 åˆ†ï¼‰

### é¢˜ç›®æè¿°
å®ç°ä¸€ä¸ªæ”¯æŒå¤šç§æ“ä½œç±»å‹çš„å¤šç­¾åç³»ç»Ÿã€‚è¦æ±‚ï¼š

**æ”¯æŒçš„æ“ä½œç±»å‹**ï¼š
1. **é“¸é€ æ“ä½œ**ï¼šéœ€è¦ 3/5 ç­¾å
2. **å†»ç»“æ“ä½œ**ï¼šéœ€è¦ 2/5 ç­¾å
3. **ä¿®æ”¹é…ç½®**ï¼šéœ€è¦ 4/5 ç­¾å

**åŠŸèƒ½è¦æ±‚**ï¼š
1. ä¸åŒæ“ä½œç±»å‹æœ‰ä¸åŒçš„ç­¾åè¦æ±‚
2. ææ¡ˆæœ‰è¿‡æœŸæ—¶é—´ï¼ˆ7 å¤©ï¼‰
3. å·²æ‰§è¡Œæˆ–å·²è¿‡æœŸçš„ææ¡ˆä¸èƒ½å†æ“ä½œ
4. ç­¾åè€…å¯ä»¥æ’¤é”€è‡ªå·±çš„ç­¾åï¼ˆæ‰§è¡Œå‰ï¼‰
5. è®°å½•æ‰€æœ‰æ“ä½œå†å²

### ä»£ç æ¡†æ¶
```move
module token_exam::advanced_multisig {
    use std::signer;
    use std::string::{Self, String};
    use std::vector;
    use aptos_std::table::{Self, Table};
    use aptos_framework::coin::{Self, MintCapability, FreezeCapability};
    use aptos_framework::timestamp;

    struct MultiSigCoin {}

    const OPERATION_MINT: u8 = 1;
    const OPERATION_FREEZE: u8 = 2;
    const OPERATION_CONFIG: u8 = 3;

    const PROPOSAL_EXPIRY: u64 = 604800;  // 7 å¤©

    struct MultiSigManager has key {
        signers: vector<address>,
        
        // ä¸åŒæ“ä½œçš„ç­¾åè¦æ±‚
        mint_required_sigs: u64,     // 3
        freeze_required_sigs: u64,   // 2
        config_required_sigs: u64,   // 4
        
        // ææ¡ˆ
        proposals: Table<u64, Proposal>,
        next_proposal_id: u64,
        
        // æƒé™
        mint_cap: MintCapability<MultiSigCoin>,
        freeze_cap: FreezeCapability<MultiSigCoin>,
    }

    struct Proposal has store {
        operation_type: u8,
        proposer: address,
        created_at: u64,
        executed: bool,
        
        signatures: vector<address>,
        
        // æ“ä½œå‚æ•°ï¼ˆæ ¹æ® operation_type è§£é‡Šï¼‰
        target_address: address,
        amount: u64,
        description: String,
    }

    /// TODO 1: å®ç°åˆ›å»ºææ¡ˆå‡½æ•°ï¼ˆ10 åˆ†ï¼‰
    public entry fun create_proposal(
        proposer: &signer,
        operation_type: u8,
        target_address: address,
        amount: u64,
        description: vector<u8>
    ) acquires MultiSigManager {
        // 1. éªŒè¯ææ¡ˆè€…æ˜¯ç­¾åè€…
        // 2. åˆ›å»ºææ¡ˆ
        // 3. ææ¡ˆè€…è‡ªåŠ¨ç­¾å
        // 4. å­˜å‚¨ææ¡ˆ
    }

    /// TODO 2: å®ç°ç­¾å/æ’¤é”€ç­¾åå‡½æ•°ï¼ˆ10 åˆ†ï¼‰
    public entry fun sign_proposal(
        signer_account: &signer,
        proposal_id: u64
    ) acquires MultiSigManager {
        // 1. éªŒè¯ç­¾åè€…èº«ä»½
        // 2. æ£€æŸ¥ææ¡ˆçŠ¶æ€ï¼ˆæœªæ‰§è¡Œã€æœªè¿‡æœŸï¼‰
        // 3. æ£€æŸ¥æ˜¯å¦å·²ç­¾å
        // 4. æ·»åŠ ç­¾å
    }

    public entry fun revoke_signature(
        signer_account: &signer,
        proposal_id: u64
    ) acquires MultiSigManager {
        // 1. éªŒè¯ç­¾åè€…èº«ä»½
        // 2. æ£€æŸ¥ææ¡ˆçŠ¶æ€ï¼ˆæœªæ‰§è¡Œï¼‰
        // 3. ç§»é™¤ç­¾å
    }

    /// TODO 3: å®ç°æ‰§è¡Œææ¡ˆå‡½æ•°ï¼ˆ10 åˆ†ï¼‰
    public entry fun execute_proposal(
        executor: &signer,
        proposal_id: u64
    ) acquires MultiSigManager {
        // 1. è·å–ææ¡ˆ
        // 2. æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
        // 3. æ ¹æ®æ“ä½œç±»å‹æ£€æŸ¥ç­¾åæ•°é‡
        // 4. æ‰§è¡Œå¯¹åº”æ“ä½œï¼ˆé“¸é€ /å†»ç»“/é…ç½®ï¼‰
        // 5. æ ‡è®°ä¸ºå·²æ‰§è¡Œ
    }

    /// TODO 4: è¾…åŠ©å‡½æ•°ï¼ˆ5 åˆ†ï¼‰
    
    /// æ£€æŸ¥ææ¡ˆæ˜¯å¦è¿‡æœŸ
    fun is_proposal_expired(proposal: &Proposal): bool {
        // å®ç°è¿‡æœŸæ£€æŸ¥
    }

    /// è·å–æ“ä½œæ‰€éœ€ç­¾åæ•°
    fun get_required_signatures(
        manager: &MultiSigManager,
        operation_type: u8
    ): u64 {
        // æ ¹æ®æ“ä½œç±»å‹è¿”å›æ‰€éœ€ç­¾åæ•°
    }

    /// æ‰§è¡Œå…·ä½“æ“ä½œ
    fun execute_operation(
        manager: &mut MultiSigManager,
        proposal: &Proposal
    ) {
        // æ ¹æ® operation_type æ‰§è¡Œæ“ä½œ
        // MINT: é“¸é€ ä»£å¸
        // FREEZE: å†»ç»“è´¦æˆ·
        // CONFIG: ä¿®æ”¹é…ç½®ï¼ˆå¦‚ä¿®æ”¹ç­¾åè¦æ±‚ï¼‰
    }

    #[view]
    public fun get_proposal_status(
        proposal_id: u64
    ): (u8, u64, bool, bool) acquires MultiSigManager {
        // è¿”å› (operation_type, signature_count, executed, expired)
    }
}
```

### è¯„åˆ†æ ‡å‡†
- åˆ›å»ºææ¡ˆé€»è¾‘æ­£ç¡®ï¼ˆ10 åˆ†ï¼‰
- ç­¾å/æ’¤é”€ç­¾ååŠŸèƒ½æ­£ç¡®ï¼ˆ10 åˆ†ï¼‰
- æ‰§è¡Œææ¡ˆé€»è¾‘å®Œæ•´ï¼ˆ10 åˆ†ï¼‰
- è¾…åŠ©å‡½æ•°å’ŒæŸ¥è¯¢åŠŸèƒ½æ­£ç¡®ï¼ˆ5 åˆ†ï¼‰

---

## é™„åŠ é¢˜ï¼šæƒé™ç´§æ€¥å†»ç»“æœºåˆ¶ï¼ˆ+20 åˆ†ï¼‰

### é¢˜ç›®æè¿°
åœ¨ä¸Šè¿°ä»»ä¸€é¢˜ç›®åŸºç¡€ä¸Šï¼Œæ·»åŠ ç´§æ€¥å†»ç»“æœºåˆ¶ï¼š

1. **ç´§æ€¥å†»ç»“è§¦å‘æ¡ä»¶**ï¼š
   - å•æ—¥é“¸é€ é‡è¶…è¿‡é™é¢ 200%
   - å•æ—¥é”€æ¯é‡è¶…è¿‡æ€»ä¾›åº”é‡ 10%
   - æ£€æµ‹åˆ°å¼‚å¸¸å¤§é¢è½¬è´¦ï¼ˆ> æ€»ä¾›åº”é‡ 5%ï¼‰

2. **ç´§æ€¥å“åº”**ï¼š
   - è‡ªåŠ¨æš‚åœæ‰€æœ‰é“¸é€ æ“ä½œ
   - è‡ªåŠ¨æš‚åœå¤§é¢è½¬è´¦ï¼ˆ> 100,000ï¼‰
   - å‘é€ç´§æ€¥äº‹ä»¶é€šçŸ¥
   - åªæœ‰å¤šç­¾åï¼ˆ4/5ï¼‰å¯ä»¥è§£é™¤

3. **å®ç°è¦æ±‚**ï¼š
```move
struct EmergencyControl has key {
    is_frozen: bool,
    freeze_reason: String,
    frozen_at: u64,
    frozen_by: address,
    
    // é˜ˆå€¼é…ç½®
    daily_mint_threshold_multiplier: u64,  // 200 = 200%
    burn_ratio_threshold: u64,             // 10 = 10%
    large_transfer_threshold: u64,
}

public entry fun trigger_emergency_freeze(
    detector: &signer,
    reason: vector<u8>
) acquires EmergencyControl {
    // å®ç°ç´§æ€¥å†»ç»“
}

public entry fun lift_emergency_freeze(
    // å¤šç­¾åå‚æ•°
) acquires EmergencyControl, MultiSigManager {
    // éœ€è¦ 4/5 å¤šç­¾åæ‰èƒ½è§£é™¤
}
```

### è¯„åˆ†æ ‡å‡†
- ç´§æ€¥è§¦å‘é€»è¾‘æ­£ç¡®ï¼ˆ8 åˆ†ï¼‰
- å†»ç»“æœºåˆ¶å®Œæ•´ï¼ˆ7 åˆ†ï¼‰
- è§£é™¤æœºåˆ¶å®‰å…¨ï¼ˆ5 åˆ†ï¼‰

---

## æäº¤è¯´æ˜

1. **ä»£ç è§„èŒƒ**ï¼š
   - å¿…é¡»åŒ…å«å®Œæ•´çš„é”™è¯¯ç å®šä¹‰
   - æ‰€æœ‰ public å‡½æ•°å¿…é¡»æœ‰æ³¨é‡Š
   - ä½¿ç”¨ `assert!` è¿›è¡Œå‚æ•°éªŒè¯

2. **æµ‹è¯•è¦æ±‚**ï¼š
   - æ¯é¢˜è‡³å°‘æä¾› 3 ä¸ªæµ‹è¯•ç”¨ä¾‹
   - æµ‹è¯•æ­£å¸¸æµç¨‹å’Œè¾¹ç•Œæƒ…å†µ

3. **è¯„åˆ†æƒé‡**ï¼š
   - ä»£ç æ­£ç¡®æ€§ï¼š70%
   - ä»£ç è§„èŒƒï¼š15%
   - æµ‹è¯•è¦†ç›–ï¼š15%

**ç¥ä½ è€ƒè¯•é¡ºåˆ©ï¼** ğŸš€
