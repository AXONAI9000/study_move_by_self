# æ³›å‹ç¼–ç¨‹ä¸èƒ½åŠ›ç³»ç»Ÿæ ¸å¿ƒæ¦‚å¿µ

## ç¬¬ä¸€éƒ¨åˆ†ï¼šæ³›å‹ç¼–ç¨‹ï¼ˆGenericsï¼‰

### 1.1 ä»€ä¹ˆæ˜¯æ³›å‹ï¼Ÿ

æ³›å‹å…è®¸ä½ ç¼–å†™å¯ä»¥å¤„ç†å¤šç§ç±»å‹çš„ä»£ç ï¼Œè€Œä¸éœ€è¦ä¸ºæ¯ç§ç±»å‹é‡å¤ç¼–å†™ç›¸åŒçš„é€»è¾‘ã€‚

**ç±»æ¯”ï¼šæƒ³è±¡ä¸€ä¸ªé€šç”¨çš„å®¹å™¨**
- éæ³›å‹ï¼šä½ éœ€è¦ä¸€ä¸ªè£…è‹¹æœçš„ç›’å­ã€ä¸€ä¸ªè£…æ©™å­çš„ç›’å­ã€ä¸€ä¸ªè£…é¦™è•‰çš„ç›’å­...
- æ³›å‹ï¼šä½ æœ‰ä¸€ä¸ªå¯ä»¥è£…ä»»ä½•æ°´æœçš„é€šç”¨ç›’å­

### 1.2 æ³›å‹è¯­æ³•

#### æ³›å‹ç»“æ„ä½“
```move
struct Box<T> {
    value: T
}

// ä½¿ç”¨
let int_box = Box<u64> { value: 100 };
let bool_box = Box<bool> { value: true };
```

#### æ³›å‹å‡½æ•°
```move
public fun swap<T>(a: T, b: T): (T, T) {
    (b, a)
}

// ä½¿ç”¨
let (x, y) = swap<u64>(1, 2);  // (2, 1)
```

#### å¤šä¸ªæ³›å‹å‚æ•°
```move
struct Pair<T1, T2> {
    first: T1,
    second: T2
}

let pair = Pair<u64, bool> { 
    first: 42, 
    second: true 
};
```

### 1.3 æ³›å‹çº¦æŸ

ä½ å¯ä»¥è¦æ±‚æ³›å‹ç±»å‹å¿…é¡»å…·æœ‰æŸäº›èƒ½åŠ›ï¼š

```move
// T å¿…é¡»å…·æœ‰ copy èƒ½åŠ›
public fun duplicate<T: copy>(value: T): (T, T) {
    (value, value)
}

// T å¿…é¡»å…·æœ‰ drop èƒ½åŠ›
public fun discard<T: drop>(value: T) {
    // value ä¼šè¢«è‡ªåŠ¨ä¸¢å¼ƒ
}

// T å¿…é¡»åŒæ—¶å…·æœ‰ copy å’Œ drop
public fun process<T: copy + drop>(value: T) {
    // ...
}
```

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šèƒ½åŠ›ç³»ç»Ÿï¼ˆAbilitiesï¼‰

### 2.1 èƒ½åŠ›ç³»ç»Ÿæ¦‚è¿°

Move çš„èƒ½åŠ›ç³»ç»Ÿæ˜¯å…¶æœ€é‡è¦çš„å®‰å…¨ç‰¹æ€§ã€‚å››ç§èƒ½åŠ›æ§åˆ¶äº†ç±»å‹å¯ä»¥è¿›è¡Œçš„æ“ä½œï¼š

| èƒ½åŠ› | å«ä¹‰ | å…è®¸çš„æ“ä½œ |
|------|------|-----------|
| **copy** | å¯å¤åˆ¶ | å¯ä»¥è¢«å¤åˆ¶ï¼ˆæŒ‰å€¼ä¼ é€’ï¼‰ |
| **drop** | å¯ä¸¢å¼ƒ | å¯ä»¥åœ¨ä½œç”¨åŸŸç»“æŸæ—¶è¢«ä¸¢å¼ƒ |
| **store** | å¯å­˜å‚¨ | å¯ä»¥å­˜å‚¨åœ¨å…¨å±€å­˜å‚¨æˆ–å…¶ä»–ç»“æ„ä½“ä¸­ |
| **key** | å¯ä½œä¸ºé”® | å¯ä»¥ä½œä¸ºå…¨å±€å­˜å‚¨çš„é¡¶å±‚å¯¹è±¡ |

### 2.2 èƒ½åŠ›è¯¦è§£

#### 2.2.1 Copy èƒ½åŠ›

**å«ä¹‰**ï¼šç±»å‹çš„å€¼å¯ä»¥è¢«å¤åˆ¶

```move
// å…·æœ‰ copy èƒ½åŠ›
struct Point has copy {
    x: u64,
    y: u64
}

fun use_point() {
    let p1 = Point { x: 1, y: 2 };
    let p2 = p1;  // p1 è¢«å¤åˆ¶ï¼Œp1 å’Œ p2 éƒ½å¯ç”¨
    let p3 = p1;  // å¯ä»¥å†æ¬¡ä½¿ç”¨ p1
}

// æ²¡æœ‰ copy èƒ½åŠ›ï¼ˆèµ„æºç±»å‹ï¼‰
struct Coin {
    value: u64
}

fun use_coin() {
    let c1 = Coin { value: 100 };
    let c2 = c1;  // c1 è¢«ç§»åŠ¨ï¼Œc1 ä¸å†å¯ç”¨
    // let c3 = c1;  // é”™è¯¯ï¼c1 å·²ç»è¢«ç§»åŠ¨
}
```

**ä½¿ç”¨åœºæ™¯**ï¼š
- âœ… åŸºæœ¬ç±»å‹ï¼ˆu8, u64, bool, address ç­‰ï¼‰
- âœ… é…ç½®æ•°æ®ã€åæ ‡ã€ç»Ÿè®¡ä¿¡æ¯
- âŒ èµ„äº§ç±»å‹ï¼ˆä»£å¸ã€NFTï¼‰ï¼šå¿…é¡»ä¿è¯å”¯ä¸€æ€§

#### 2.2.2 Drop èƒ½åŠ›

**å«ä¹‰**ï¼šç±»å‹çš„å€¼å¯ä»¥åœ¨ä½œç”¨åŸŸç»“æŸæ—¶è¢«è‡ªåŠ¨ä¸¢å¼ƒ

```move
// å…·æœ‰ drop èƒ½åŠ›
struct Config has drop {
    max_value: u64
}

fun use_config() {
    let config = Config { max_value: 1000 };
    // config åœ¨å‡½æ•°ç»“æŸæ—¶è‡ªåŠ¨ä¸¢å¼ƒ
}

// æ²¡æœ‰ drop èƒ½åŠ›
struct Coin {
    value: u64
}

fun use_coin() {
    let coin = Coin { value: 100 };
    // é”™è¯¯ï¼coin å¿…é¡»è¢«æ˜¾å¼å¤„ç†ï¼ˆè½¬ç§»æˆ–é”€æ¯ï¼‰
}
```

**ä½¿ç”¨åœºæ™¯**ï¼š
- âœ… ä¸´æ—¶æ•°æ®ã€é…ç½®
- âŒ å¿…é¡»è¢«æ˜¾å¼å¤„ç†çš„èµ„æºï¼ˆä»£å¸ã€æƒé™å‡­è¯ï¼‰

#### 2.2.3 Store èƒ½åŠ›

**å«ä¹‰**ï¼šç±»å‹çš„å€¼å¯ä»¥å­˜å‚¨åœ¨å…¨å±€å­˜å‚¨ä¸­æˆ–å…¶ä»–ç»“æ„ä½“ä¸­

```move
// å…·æœ‰ store èƒ½åŠ›
struct Token has store {
    amount: u64
}

// å¯ä»¥å­˜å‚¨åœ¨å…¶ä»–ç»“æ„ä½“ä¸­
struct Wallet has key {
    tokens: vector<Token>  // âœ… Token æœ‰ store èƒ½åŠ›
}

// æ²¡æœ‰ store èƒ½åŠ›
struct HotPotato {
    value: u64
}

struct Container has key {
    // item: HotPotato  // âŒ é”™è¯¯ï¼HotPotato æ²¡æœ‰ store
}
```

**ä½¿ç”¨åœºæ™¯**ï¼š
- âœ… éœ€è¦æŒä¹…åŒ–çš„æ•°æ®
- âœ… éœ€è¦åµŒå¥—åœ¨å…¶ä»–ç»“æ„ä½“ä¸­çš„ç±»å‹
- âŒ å¿…é¡»ç«‹å³æ¶ˆè´¹çš„ç±»å‹ï¼ˆHot Potato æ¨¡å¼ï¼‰

#### 2.2.4 Key èƒ½åŠ›

**å«ä¹‰**ï¼šç±»å‹å¯ä»¥ä½œä¸ºå…¨å±€å­˜å‚¨çš„é¡¶å±‚å¯¹è±¡

```move
// å…·æœ‰ key èƒ½åŠ›
struct Account has key {
    balance: u64
}

// å¯ä»¥å­˜å‚¨åˆ°å…¨å±€å­˜å‚¨
public fun create_account(account: &signer) {
    move_to(account, Account { balance: 0 });
}

// å¯ä»¥ä»å…¨å±€å­˜å‚¨è¯»å–
public fun get_balance(addr: address): u64 acquires Account {
    borrow_global<Account>(addr).balance
}
```

**ä½¿ç”¨åœºæ™¯**ï¼š
- âœ… ç”¨æˆ·è´¦æˆ·ã€èµ„æº
- âœ… å…¨å±€é…ç½®
- âš ï¸ é€šå¸¸ä¸ store ä¸€èµ·ä½¿ç”¨ï¼š`has key, store`

### 2.3 èƒ½åŠ›ç»„åˆ

å¸¸è§çš„èƒ½åŠ›ç»„åˆæ¨¡å¼ï¼š

```move
// 1. æ™®é€šæ•°æ®ï¼šå¯å¤åˆ¶ã€å¯ä¸¢å¼ƒã€å¯å­˜å‚¨
struct Config has copy, drop, store {
    value: u64
}

// 2. èµ„æºï¼ˆä»£å¸ã€NFTï¼‰ï¼šåªèƒ½å­˜å‚¨ï¼Œä¸èƒ½å¤åˆ¶å’Œä¸¢å¼ƒ
struct Coin has store {
    value: u64
}

// 3. å…¨å±€èµ„æºï¼šå¯ä»¥ä½œä¸ºé”®ï¼Œå¯ä»¥å­˜å‚¨
struct UserProfile has key, store {
    name: vector<u8>,
    age: u8
}

// 4. Hot Potatoï¼šæ²¡æœ‰ä»»ä½•èƒ½åŠ›ï¼Œå¿…é¡»è¢«æ¶ˆè´¹
struct Witness {
    // æ²¡æœ‰èƒ½åŠ›ï¼
}
```

### 2.4 èƒ½åŠ›çš„ç»§æ‰¿è§„åˆ™

**é‡è¦è§„åˆ™**ï¼šå­ç±»å‹çš„èƒ½åŠ›ä¸èƒ½è¶…è¿‡å…¶å­—æ®µç±»å‹çš„èƒ½åŠ›

```move
struct Inner {
    value: u64
}

// âŒ é”™è¯¯ï¼Inner æ²¡æœ‰ copyï¼ŒContainer ä¸èƒ½æœ‰ copy
struct Container has copy {
    inner: Inner
}

// âœ… æ­£ç¡®
struct Container {
    inner: Inner
}
```

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šå®æˆ˜åº”ç”¨

### 3.1 æ³›å‹ä»£å¸å®¹å™¨

```move
module my_addr::generic_wallet {
    use std::signer;
    
    // å¯ä»¥å­˜å‚¨ä»»ä½•å…·æœ‰ store èƒ½åŠ›çš„ä»£å¸
    struct Wallet<CoinType: store> has key {
        coins: vector<CoinType>
    }
    
    public fun create<CoinType: store>(account: &signer) {
        move_to(account, Wallet<CoinType> {
            coins: vector::empty()
        });
    }
    
    public fun deposit<CoinType: store>(
        account: &signer, 
        coin: CoinType
    ) acquires Wallet {
        let addr = signer::address_of(account);
        let wallet = borrow_global_mut<Wallet<CoinType>>(addr);
        vector::push_back(&mut wallet.coins, coin);
    }
}
```

### 3.2 Hot Potato æ¨¡å¼

ç”¨äºå¼ºåˆ¶æ‰§è¡Œç‰¹å®šçš„è°ƒç”¨é¡ºåºï¼š

```move
module my_addr::flash_loan {
    // Receipt æ²¡æœ‰ä»»ä½•èƒ½åŠ›ï¼Œå¿…é¡»è¢« repay æ¶ˆè´¹
    struct Receipt {
        amount: u64,
        borrower: address
    }
    
    public fun borrow(amount: u64, borrower: address): Receipt {
        // ç»™å‡ºä»£å¸...
        Receipt { amount, borrower }
    }
    
    public fun repay(receipt: Receipt) {
        let Receipt { amount, borrower: _ } = receipt;
        // æ”¶å›ä»£å¸...
        // Receipt è¢«è§£æ„ï¼Œä¸å†å­˜åœ¨
    }
    
    // ç”¨æˆ·å¿…é¡»ï¼šborrow -> ä½¿ç”¨ -> repay
    // ä¸èƒ½å¿˜è®° repayï¼Œå› ä¸º Receipt æ²¡æœ‰ drop èƒ½åŠ›
}
```

### 3.3 èƒ½åŠ›çº¦æŸçš„å®‰å…¨æ€§

```move
// å®‰å…¨çš„ swap å‡½æ•°
public fun swap<T: copy + drop>(a: T, b: T): (T, T) {
    (b, a)
}

// å¯ä»¥ç”¨äºæ™®é€šæ•°æ®
let (x, y) = swap(1, 2);

// âŒ ä¸èƒ½ç”¨äºèµ„æºç±»å‹ï¼ˆCoin æ²¡æœ‰ copyï¼‰
// let (c1, c2) = swap(coin1, coin2);  // ç¼–è¯‘é”™è¯¯ï¼
```

---

## ç¬¬å››éƒ¨åˆ†ï¼šå¸¸è§é”™è¯¯ä¸è°ƒè¯•

### 4.1 ç¼ºå°‘èƒ½åŠ›

```move
struct Coin {
    value: u64
}

fun test() {
    let c = Coin { value: 100 };
    // é”™è¯¯ï¼šCoin does not have the 'drop' ability
}

// è§£å†³æ–¹æ¡ˆï¼šæ˜¾å¼å¤„ç†
fun test_fixed() {
    let c = Coin { value: 100 };
    destroy_coin(c);  // å¿…é¡»æ˜¾å¼é”€æ¯
}

fun destroy_coin(coin: Coin) {
    let Coin { value: _ } = coin;  // è§£æ„é”€æ¯
}
```

### 4.2 æ³›å‹çº¦æŸä¸åŒ¹é…

```move
public fun process<T: copy>(value: T) {
    // ...
}

struct Resource {
    value: u64
}

fun test() {
    let r = Resource { value: 100 };
    // é”™è¯¯ï¼šResource does not have the 'copy' ability
    process(r);
}
```

---

## ğŸ“Š å¯¹æ¯”è¡¨æ ¼

### Move vs Solidity vs Rust

| ç‰¹æ€§ | Move | Solidity | Rust |
|------|------|----------|------|
| æ³›å‹ | âœ… æœ‰æ³›å‹ | âŒ æ— æ³›å‹ | âœ… æœ‰æ³›å‹ |
| èµ„æºå®‰å…¨ | âœ… èƒ½åŠ›ç³»ç»Ÿ | âŒ é å¼€å‘è€… | âœ… æ‰€æœ‰æƒç³»ç»Ÿ |
| åŒèŠ±é˜²æŠ¤ | âœ… ç¼–è¯‘æœŸæ£€æŸ¥ | âš ï¸ è¿è¡Œæ—¶æ£€æŸ¥ | âœ… ç¼–è¯‘æœŸæ£€æŸ¥ |
| å­¦ä¹ æ›²çº¿ | ä¸­ç­‰ | ç®€å• | é™¡å³­ |

---

## ğŸ’¡ å…³é”®è¦ç‚¹

1. **æ³›å‹ = ä»£ç å¤ç”¨**ï¼šä¸€æ¬¡ç¼–å†™ï¼Œå¤šç§ç±»å‹ä½¿ç”¨
2. **èƒ½åŠ› = å®‰å…¨çº¦æŸ**ï¼šç¼–è¯‘å™¨å¼ºåˆ¶æ‰§è¡Œèµ„æºå®‰å…¨
3. **æ²¡æœ‰ drop = å¿…é¡»å¤„ç†**ï¼šé˜²æ­¢èµ„æºæ³„æ¼
4. **æ²¡æœ‰ copy = çº¿æ€§ç±»å‹**ï¼šé˜²æ­¢åŒèŠ±
5. **key + store = å…¨å±€èµ„æº**ï¼šç”¨æˆ·è´¦æˆ·æ¨¡å¼

---

## ğŸ¯ æ€è€ƒé¢˜

1. ä¸ºä»€ä¹ˆä»£å¸ç±»å‹ä¸åº”è¯¥æœ‰ `copy` èƒ½åŠ›ï¼Ÿ
2. Hot Potato æ¨¡å¼å¦‚ä½•ä¿è¯ä»£ç å®‰å…¨æ€§ï¼Ÿ
3. å¦‚æœä¸€ä¸ªç»“æ„ä½“åŒ…å«æ²¡æœ‰ `drop` çš„å­—æ®µï¼Œè¿™ä¸ªç»“æ„ä½“èƒ½æœ‰ `drop` å—ï¼Ÿ

ç­”æ¡ˆåœ¨ä»Šæ—¥è€ƒè¯•ä¸­ï¼

---

**ä¸‹ä¸€æ­¥**ï¼šé˜…è¯» `ä»£ç ç¤ºä¾‹.move`ï¼Œçœ‹å®é™…ä»£ç ä¸­å¦‚ä½•ä½¿ç”¨è¿™äº›æ¦‚å¿µã€‚
