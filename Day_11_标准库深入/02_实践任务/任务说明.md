# Day 11 å®è·µä»»åŠ¡ï¼šæ ‡å‡†åº“æ·±å…¥åº”ç”¨

## ğŸ“‹ ä»»åŠ¡æ¦‚è§ˆ

ä»Šå¤©ä½ éœ€è¦å®Œæˆä¸‰ä¸ªé€’è¿›å¼çš„å®è·µä»»åŠ¡ï¼Œä»ç”¨æˆ·ç®¡ç†åˆ°è®¢å•ç°¿å®ç°ï¼Œå…¨é¢æŒæ¡ Move æ ‡å‡†åº“çš„ä½¿ç”¨ã€‚

**æ€»æ—¶é—´**ï¼šçº¦ 3.5 å°æ—¶

---

## ä»»åŠ¡ 1ï¼šç”¨æˆ·ç®¡ç†ç³»ç»Ÿï¼ˆåŸºç¡€ï¼‰â­â­â˜†â˜†â˜†

### ğŸ¯ ç›®æ ‡
ä½¿ç”¨ Table å’Œ vector å®ç°ä¸€ä¸ªé«˜æ•ˆçš„ç”¨æˆ·ç®¡ç†ç³»ç»Ÿã€‚

### ğŸ“ éœ€æ±‚

1. **æ³¨å†Œç”¨æˆ·**
   - ç”¨æˆ·å¯ä»¥æ³¨å†Œï¼Œæä¾›ç”¨æˆ·åå’Œé‚®ç®±
   - éªŒè¯ç”¨æˆ·ä¸å­˜åœ¨

2. **æ›´æ–°ç”¨æˆ·ä¿¡æ¯**
   - æ›´æ–°ç”¨æˆ·åæˆ–é‚®ç®±

3. **æŸ¥æ‰¾ç”¨æˆ·**
   - é€šè¿‡åœ°å€æŸ¥æ‰¾ç”¨æˆ·ä¿¡æ¯

4. **ç”¨æˆ·åˆ—è¡¨**
   - è·å–æ‰€æœ‰å·²æ³¨å†Œç”¨æˆ·çš„åœ°å€åˆ—è¡¨

5. **ç»Ÿè®¡ä¿¡æ¯**
   - è·å–æ³¨å†Œç”¨æˆ·æ€»æ•°

### ğŸ’» èµ·å§‹ä»£ç 

```move
module task1::user_manager {
    use std::signer;
    use std::string::{Self, String};
    use std::vector;
    use std::option::{Self, Option};
    use aptos_std::table::{Self, Table};

    const ERROR_USER_EXISTS: u64 = 1;
    const ERROR_USER_NOT_FOUND: u64 = 2;
    const ERROR_INVALID_USERNAME: u64 = 3;

    struct User has store, drop, copy {
        username: String,
        email: Option<String>,
        registration_time: u64  // ç®€åŒ–ï¼Œå®é™…åº”ç”¨ä½¿ç”¨ timestamp
    }

    struct UserRegistry has key {
        users: Table<address, User>,
        user_list: vector<address>
    }

    /// TODO: åˆå§‹åŒ–ç”¨æˆ·æ³¨å†Œè¡¨
    public fun initialize(admin: &signer) {
        // ä½ çš„ä»£ç 
    }

    /// TODO: æ³¨å†Œç”¨æˆ·
    public fun register_user(
        account: &signer,
        username: vector<u8>,
        email: Option<vector<u8>>
    ) acquires UserRegistry {
        // ä½ çš„ä»£ç 
    }

    /// TODO: æ›´æ–°ç”¨æˆ·ä¿¡æ¯
    public fun update_user(
        account: &signer,
        new_username: Option<vector<u8>>,
        new_email: Option<vector<u8>>
    ) acquires UserRegistry {
        // ä½ çš„ä»£ç 
    }

    /// TODO: è·å–ç”¨æˆ·ä¿¡æ¯
    public fun get_user(addr: address): Option<User> acquires UserRegistry {
        // ä½ çš„ä»£ç 
    }

    /// TODO: è·å–æ‰€æœ‰ç”¨æˆ·åœ°å€
    public fun get_all_users(): vector<address> acquires UserRegistry {
        // ä½ çš„ä»£ç 
    }

    /// TODO: è·å–ç”¨æˆ·æ€»æ•°
    public fun get_user_count(): u64 acquires UserRegistry {
        // ä½ çš„ä»£ç 
    }

    /// TODO: æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å”¯ä¸€ï¼ˆå¯é€‰æŒ‘æˆ˜ï¼‰
    public fun is_username_available(username: vector<u8>): bool acquires UserRegistry {
        // éå†æ‰€æœ‰ç”¨æˆ·æ£€æŸ¥ç”¨æˆ·å
        // ä½ çš„ä»£ç 
    }
}
```

### âœ… éªŒè¯æ ‡å‡†
- æ­£ç¡®ä½¿ç”¨ Table å­˜å‚¨ç”¨æˆ·æ•°æ®
- æ­£ç¡®ä½¿ç”¨ vector ç»´æŠ¤ç”¨æˆ·åˆ—è¡¨
- æ­£ç¡®ä½¿ç”¨ Option å¤„ç†å¯é€‰å­—æ®µ
- æ­£ç¡®ä½¿ç”¨ String æ¨¡å—

---

## ä»»åŠ¡ 2ï¼šå•†å“åº“å­˜ç³»ç»Ÿï¼ˆä¸­çº§ï¼‰â­â­â­â˜†â˜†

### ğŸ¯ ç›®æ ‡
ä½¿ç”¨ SmartTable å®ç°ä¸€ä¸ªå¯è¿­ä»£çš„å•†å“åº“å­˜ç³»ç»Ÿã€‚

### ğŸ“ éœ€æ±‚

1. **æ·»åŠ å•†å“**
   - æ·»åŠ æ–°å•†å“åŠå…¶ä¿¡æ¯

2. **æ›´æ–°åº“å­˜**
   - å¢åŠ æˆ–å‡å°‘åº“å­˜æ•°é‡

3. **æŸ¥è¯¢å•†å“**
   - æ ¹æ®å•†å“ ID æŸ¥è¯¢è¯¦ç»†ä¿¡æ¯

4. **åº“å­˜æŠ¥å‘Š**
   - è®¡ç®—åº“å­˜æ€»ä»·å€¼
   - æŸ¥æ‰¾ä½åº“å­˜å•†å“ï¼ˆåº“å­˜ < é˜ˆå€¼ï¼‰
   - åˆ—å‡ºæ‰€æœ‰å•†å“

5. **æ‰¹é‡æ“ä½œ**
   - æ‰¹é‡æ›´æ–°ä»·æ ¼ï¼ˆæ‰€æœ‰å•†å“æ‰“æŠ˜ï¼‰

### ğŸ’» èµ·å§‹ä»£ç 

```move
module task2::inventory_system {
    use std::signer;
    use std::string::{Self, String};
    use std::vector;
    use aptos_std::smart_table::{Self, SmartTable};

    const ERROR_PRODUCT_EXISTS: u64 = 1;
    const ERROR_PRODUCT_NOT_FOUND: u64 = 2;
    const ERROR_INSUFFICIENT_STOCK: u64 = 3;
    const ERROR_INVALID_PRICE: u64 = 4;

    struct Product has store, drop, copy {
        name: String,
        price: u64,  // ä»·æ ¼ï¼ˆæœ€å°å•ä½ï¼‰
        stock: u64,
        category: String
    }

    struct Inventory has key {
        products: SmartTable<u64, Product>,
        next_product_id: u64
    }

    /// TODO: åˆå§‹åŒ–åº“å­˜ç³»ç»Ÿ
    public fun initialize(admin: &signer) {
        // ä½ çš„ä»£ç 
    }

    /// TODO: æ·»åŠ å•†å“
    public fun add_product(
        admin: &signer,
        name: vector<u8>,
        price: u64,
        initial_stock: u64,
        category: vector<u8>
    ): u64 acquires Inventory {
        // è¿”å›å•†å“ ID
        // ä½ çš„ä»£ç 
    }

    /// TODO: æ›´æ–°åº“å­˜
    public fun update_stock(
        admin: &signer,
        product_id: u64,
        delta: u64,
        is_increase: bool
    ) acquires Inventory {
        // ä½ çš„ä»£ç 
    }

    /// TODO: æ›´æ–°ä»·æ ¼
    public fun update_price(
        admin: &signer,
        product_id: u64,
        new_price: u64
    ) acquires Inventory {
        // ä½ çš„ä»£ç 
    }

    /// TODO: è·å–å•†å“ä¿¡æ¯
    public fun get_product(product_id: u64): Product acquires Inventory {
        // ä½ çš„ä»£ç 
    }

    /// TODO: è®¡ç®—åº“å­˜æ€»ä»·å€¼
    public fun calculate_total_value(): u64 acquires Inventory {
        // éå†æ‰€æœ‰å•†å“ï¼Œç´¯åŠ  price * stock
        // ä½ çš„ä»£ç 
    }

    /// TODO: æŸ¥æ‰¾ä½åº“å­˜å•†å“
    public fun find_low_stock_products(threshold: u64): vector<u64> acquires Inventory {
        // è¿”å›åº“å­˜ä½äºé˜ˆå€¼çš„å•†å“ ID åˆ—è¡¨
        // ä½ çš„ä»£ç 
    }

    /// TODO: æ‰¹é‡è°ƒæ•´ä»·æ ¼ï¼ˆæ‰“æŠ˜ï¼‰
    public fun apply_discount(
        admin: &signer,
        discount_percent: u64  // ä¾‹å¦‚ 10 è¡¨ç¤º 10% æŠ˜æ‰£
    ) acquires Inventory {
        // ä½ çš„ä»£ç 
    }

    /// TODO: è·å–æ‰€æœ‰å•†å“ ID
    public fun get_all_product_ids(): vector<u64> acquires Inventory {
        // ä½ çš„ä»£ç 
    }

    /// TODO: è·å–å•†å“æ€»æ•°
    public fun get_product_count(): u64 acquires Inventory {
        // ä½ çš„ä»£ç 
    }
}
```

### âœ… éªŒè¯æ ‡å‡†
- æ­£ç¡®ä½¿ç”¨ SmartTable å®ç°å¯è¿­ä»£å­˜å‚¨
- é«˜æ•ˆçš„æ‰¹é‡æ“ä½œå®ç°
- æ­£ç¡®çš„æ•°å€¼è®¡ç®—ï¼ˆé¿å…æº¢å‡ºï¼‰

---

## ä»»åŠ¡ 3ï¼šè®¢å•ç°¿ç³»ç»Ÿï¼ˆé«˜çº§ï¼‰â­â­â­â­â˜†

### ğŸ¯ ç›®æ ‡
å®ç°ä¸€ä¸ªç®€åŒ–çš„è®¢å•ç°¿ï¼ˆOrder Bookï¼‰ï¼Œæ”¯æŒä¹°å–è®¢å•çš„æ·»åŠ ã€åŒ¹é…å’Œæ’¤é”€ã€‚

### ğŸ“ éœ€æ±‚

1. **ä¸‹å•**
   - æ”¯æŒä¹°å•ï¼ˆBuy Orderï¼‰å’Œå–å•ï¼ˆSell Orderï¼‰
   - åŒ…å«ä»·æ ¼ã€æ•°é‡ã€ä¸‹å•è€…åœ°å€

2. **è®¢å•åŒ¹é…**
   - å½“ä¹°å•ä»·æ ¼ >= å–å•ä»·æ ¼æ—¶è‡ªåŠ¨åŒ¹é…
   - éƒ¨åˆ†æˆäº¤æ”¯æŒ

3. **æ’¤é”€è®¢å•**
   - ç”¨æˆ·å¯ä»¥æ’¤é”€è‡ªå·±çš„æœªæˆäº¤è®¢å•

4. **æŸ¥è¯¢è®¢å•**
   - æŸ¥è¯¢ç”¨æˆ·çš„æ´»è·ƒè®¢å•
   - æŸ¥è¯¢æ‰€æœ‰ä¹°å•/å–å•

5. **è®¢å•ç°¿çŠ¶æ€**
   - è·å–æœ€ä¼˜ä¹°ä»·å’Œå–ä»·
   - è®¡ç®—ä»·å·®ï¼ˆSpreadï¼‰

### ğŸ’» èµ·å§‹ä»£ç 

```move
module task3::order_book {
    use std::signer;
    use std::vector;
    use std::option::{Self, Option};
    use aptos_std::table::{Self, Table};
    use aptos_std::smart_table::{Self, SmartTable};

    const ERROR_INVALID_PRICE: u64 = 1;
    const ERROR_INVALID_AMOUNT: u64 = 2;
    const ERROR_ORDER_NOT_FOUND: u64 = 3;
    const ERROR_NOT_ORDER_OWNER: u64 = 4;

    const ORDER_TYPE_BUY: u8 = 0;
    const ORDER_TYPE_SELL: u8 = 1;

    struct Order has store, drop, copy {
        id: u64,
        order_type: u8,  // 0 = Buy, 1 = Sell
        price: u64,
        amount: u64,
        filled_amount: u64,
        owner: address
    }

    struct OrderBook has key {
        orders: SmartTable<u64, Order>,
        buy_orders: vector<u64>,   // æŒ‰ä»·æ ¼ä»é«˜åˆ°ä½æ’åº
        sell_orders: vector<u64>,  // æŒ‰ä»·æ ¼ä»ä½åˆ°é«˜æ’åº
        user_orders: Table<address, vector<u64>>,
        next_order_id: u64
    }

    /// TODO: åˆå§‹åŒ–è®¢å•ç°¿
    public fun initialize(admin: &signer) {
        // ä½ çš„ä»£ç 
    }

    /// TODO: ä¸‹ä¹°å•
    public fun place_buy_order(
        account: &signer,
        price: u64,
        amount: u64
    ): u64 acquires OrderBook {
        // è¿”å›è®¢å• ID
        // å°è¯•åŒ¹é…å–å•
        // ä½ çš„ä»£ç 
    }

    /// TODO: ä¸‹å–å•
    public fun place_sell_order(
        account: &signer,
        price: u64,
        amount: u64
    ): u64 acquires OrderBook {
        // è¿”å›è®¢å• ID
        // å°è¯•åŒ¹é…ä¹°å•
        // ä½ çš„ä»£ç 
    }

    /// TODO: æ’¤é”€è®¢å•
    public fun cancel_order(
        account: &signer,
        order_id: u64
    ) acquires OrderBook {
        // ä½ çš„ä»£ç 
    }

    /// TODO: è·å–æœ€ä¼˜ä¹°ä»·
    public fun get_best_bid(): Option<u64> acquires OrderBook {
        // ä¹°å•ä¸­çš„æœ€é«˜ä»·
        // ä½ çš„ä»£ç 
    }

    /// TODO: è·å–æœ€ä¼˜å–ä»·
    public fun get_best_ask(): Option<u64> acquires OrderBook {
        // å–å•ä¸­çš„æœ€ä½ä»·
        // ä½ çš„ä»£ç 
    }

    /// TODO: è·å–ä»·å·®
    public fun get_spread(): Option<u64> acquires OrderBook {
        // best_ask - best_bid
        // ä½ çš„ä»£ç 
    }

    /// TODO: è·å–ç”¨æˆ·è®¢å•
    public fun get_user_orders(user: address): vector<u64> acquires OrderBook {
        // ä½ çš„ä»£ç 
    }

    /// TODO: è·å–è®¢å•è¯¦æƒ…
    public fun get_order(order_id: u64): Order acquires OrderBook {
        // ä½ çš„ä»£ç 
    }

    /// TODO: è¾…åŠ©å‡½æ•°ï¼šåŒ¹é…è®¢å•
    fun try_match_orders(order_book: &mut OrderBook, new_order_id: u64) {
        // å®ç°è®¢å•åŒ¹é…é€»è¾‘
        // ä½ çš„ä»£ç 
    }

    /// TODO: è¾…åŠ©å‡½æ•°ï¼šæ’å…¥æœ‰åºè®¢å•
    fun insert_sorted_order(orders: &mut vector<u64>, order_id: u64, price: u64, is_buy: bool) {
        // ç»´æŠ¤ä»·æ ¼æ’åº
        // ä½ çš„ä»£ç 
    }
}
```

### âœ… éªŒè¯æ ‡å‡†
- æ­£ç¡®å®ç°è®¢å•åŒ¹é…é€»è¾‘
- ç»´æŠ¤ä¹°å–è®¢å•çš„ä»·æ ¼æ’åº
- é«˜æ•ˆçš„è®¢å•æŸ¥è¯¢å’Œæ’¤é”€
- æ­£ç¡®å¤„ç†éƒ¨åˆ†æˆäº¤

### ğŸ’¡ æç¤º
1. ä¹°å•æŒ‰ä»·æ ¼é™åºæ’åˆ—ï¼ˆæœ€é«˜ä»·åœ¨å‰ï¼‰
2. å–å•æŒ‰ä»·æ ¼å‡åºæ’åˆ—ï¼ˆæœ€ä½ä»·åœ¨å‰ï¼‰
3. åŒ¹é…æ—¶ä»æœ€ä¼˜ä»·æ ¼å¼€å§‹
4. æ³¨æ„éƒ¨åˆ†æˆäº¤çš„å¤„ç†

---

## ğŸ“Š æäº¤è¦æ±‚

### æ–‡ä»¶ç»“æ„
```
02_å®è·µä»»åŠ¡/
â”œâ”€â”€ ä»»åŠ¡è¯´æ˜.md (æœ¬æ–‡ä»¶)
â”œâ”€â”€ task1_user_manager.move
â”œâ”€â”€ task2_inventory_system.move
â””â”€â”€ task3_order_book.move
```

### æµ‹è¯•è¦æ±‚
æ¯ä¸ªä»»åŠ¡éƒ½è¦åŒ…å«æµ‹è¯•ï¼š
```bash
aptos move test
```

---

## â° æ—¶é—´åˆ†é…å»ºè®®

- **ä»»åŠ¡ 1ï¼ˆ1 å°æ—¶ï¼‰**ï¼šåŸºç¡€çš„ CRUD æ“ä½œ
- **ä»»åŠ¡ 2ï¼ˆ1 å°æ—¶ï¼‰**ï¼šSmartTable è¿­ä»£å’Œæ‰¹é‡æ“ä½œ
- **ä»»åŠ¡ 3ï¼ˆ1.5 å°æ—¶ï¼‰**ï¼šå¤æ‚çš„è®¢å•åŒ¹é…é€»è¾‘

---

**ç¥ä½ æŒ‘æˆ˜æˆåŠŸï¼æ ‡å‡†åº“æ˜¯æ„å»ºå¤æ‚åº”ç”¨çš„åŸºçŸ³ï¼** ğŸš€ğŸ’ª
