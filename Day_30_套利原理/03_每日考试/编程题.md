# Day 30 每日考试 - 编程题

**考试时间**: 30分钟  
**总分**: 60分（每题20分）  
**及格分数**: 42分（70%）

---

## 📝 答题说明

- 可以使用 TypeScript 或 Move 语言
- 注重代码逻辑正确性
- 添加必要的注释
- 考虑边界情况
- 完成后对照答案解析检查

---

## 编程题 1: 简单套利计算器（20分）

### 题目描述

实现一个函数，计算给定条件下的简单套利净利润。

### 函数签名

```typescript
function calculateSimpleArbitrage(
  buyPrice: number,      // 买入价格
  sellPrice: number,     // 卖出价格
  amount: number,        // 交易数量（USDC）
  buyReserve0: number,   // 买入池储备0
  buyReserve1: number,   // 买入池储备1
  sellReserve0: number,  // 卖出池储备0
  sellReserve1: number,  // 卖出池储备1
  feeRate: number,       // 手续费率（如 0.003 表示 0.3%）
  gasCost: number        // Gas 成本（USDC）
): number | null         // 返回净利润，无利润返回 null
```

### 要求

1. 使用恒定乘积公式计算实际输出（考虑滑点）
2. 扣除买入和卖出的手续费
3. 扣除 Gas 成本
4. 如果净利润 <= 0，返回 null
5. 添加输入验证

### 测试用例

```typescript
// 测试用例 1: 有利可图的套利
const profit1 = calculateSimpleArbitrage(
  10.0,    // 买入价
  10.5,    // 卖出价
  1000,    // 交易量
  100000,  // 买入池储备
  10000,   // 买入池储备
  80000,   // 卖出池储备
  8000,    // 卖出池储备
  0.003,   // 0.3% 手续费
  2        // $2 Gas
);
// 预期: profit1 > 0

// 测试用例 2: 价差不足
const profit2 = calculateSimpleArbitrage(
  10.0,
  10.05,
  1000,
  100000,
  10000,
  100000,
  10000,
  0.003,
  2
);
// 预期: profit2 === null
```

### 评分标准

- 正确实现恒定乘积公式（8分）
- 正确计算手续费和滑点（6分）
- 正确判断是否有利可图（4分）
- 代码质量和注释（2分）

---

## 编程题 2: 三角套利路径搜索（20分）

### 题目描述

实现一个函数，在给定的代币和价格信息中，查找所有可能的三角套利机会。

### 数据结构

```typescript
interface TokenPair {
  token0: string;
  token1: string;
  rate: number;  // token1 / token0 的汇率
}

interface TriangularPath {
  path: [string, string, string, string];  // [A, B, C, A]
  rates: [number, number, number];          // 各段汇率
  product: number;                          // 汇率乘积
  profitRate: number;                       // 利润率（扣除手续费）
}
```

### 函数签名

```typescript
function findTriangularArbitrage(
  pairs: TokenPair[],
  feeRate: number,
  minProfitRate: number
): TriangularPath[]
```

### 要求

1. 遍历所有可能的三代币组合
2. 检查是否存在完整的循环路径
3. 计算汇率乘积和利润率
4. 考虑三次交易的手续费
5. 只返回利润率 >= minProfitRate 的路径
6. 按利润率从高到低排序

### 测试用例

```typescript
const pairs: TokenPair[] = [
  { token0: 'APT', token1: 'USDC', rate: 10.0 },
  { token0: 'USDC', token1: 'BTC', rate: 0.00003 },
  { token0: 'BTC', token1: 'APT', rate: 3500 },
  { token0: 'APT', token1: 'ETH', rate: 0.005 },
  { token0: 'ETH', token1: 'USDC', rate: 2000 },
];

const paths = findTriangularArbitrage(pairs, 0.003, 0.01);

// 应该找到: APT → USDC → BTC → APT
// 汇率乘积: 10.0 * 0.00003 * 3500 = 1.05
// 扣除手续费后应该仍有利润
```

### 评分标准

- 正确实现路径搜索（8分）
- 正确计算汇率乘积和利润率（6分）
- 正确处理手续费（4分）
- 代码质量和效率（2分）

---

## 编程题 3: 套利风险评估（20分）

### 题目描述

实现一个风险评估系统，评估套利机会的综合风险。

### 数据结构

```typescript
interface ArbitrageOpportunity {
  buyPrice: number;
  sellPrice: number;
  amount: number;
  buyLiquidity: number;
  sellLiquidity: number;
  estimatedProfit: number;
}

interface RiskAssessment {
  marketRisk: number;      // 0-100
  liquidityRisk: number;   // 0-100
  executionRisk: number;   // 0-100
  overallRisk: number;     // 0-100
  riskLevel: 'low' | 'medium' | 'high' | 'extreme';
  recommendation: string;   // 建议
}
```

### 函数签名

```typescript
function assessArbitrageRisk(
  opportunity: ArbitrageOpportunity,
  priceVolatility: number,      // 价格波动率 (0-1)
  currentGasPrice: number,      // 当前 Gas 价格
  normalGasPrice: number,       // 正常 Gas 价格
  networkCongestion: number     // 网络拥堵程度 (0-100)
): RiskAssessment
```

### 要求

1. **市场风险**：基于价格波动率
   - 高波动性 = 高风险
   - 公式建议: `marketRisk = min(priceVolatility * 100, 100)`

2. **流动性风险**：基于交易量占流动性比例
   - 交易量 / 流动性 > 5% = 高风险
   - 公式建议: `liquidityRisk = min((amount / minLiquidity) * 100, 100)`

3. **执行风险**：基于 Gas 价格和网络状况
   - Gas 价格异常 + 网络拥堵 = 高风险
   - 公式建议: 综合 Gas 溢价和网络拥堵

4. **综合风险**：加权平均
   - 市场风险 40%, 流动性风险 35%, 执行风险 25%

5. **风险等级**：
   - 0-30: low
   - 31-60: medium
   - 61-80: high
   - 81-100: extreme

6. **给出建议**

### 测试用例

```typescript
const opp: ArbitrageOpportunity = {
  buyPrice: 10.0,
  sellPrice: 10.5,
  amount: 5000,
  buyLiquidity: 100000,
  sellLiquidity: 80000,
  estimatedProfit: 200
};

const risk = assessArbitrageRisk(
  opp,
  0.05,    // 5% 波动率
  100,     // 当前 Gas: $1
  50,      // 正常 Gas: $0.5
  30       // 网络拥堵 30%
);

console.log(risk);
// 预期输出示例:
// {
//   marketRisk: 5,
//   liquidityRisk: 6.25,
//   executionRisk: 65,
//   overallRisk: 22.125,
//   riskLevel: 'low',
//   recommendation: '风险可控，可以执行'
// }
```

### 评分标准

- 正确计算各类风险（9分）
- 正确计算综合风险和等级（5分）
- 给出合理建议（4分）
- 代码质量和注释（2分）

---

## 📊 评分标准总览

| 题目 | 分值 | 评分要点 |
|-----|------|---------|
| 题1 | 20分 | 滑点计算、手续费处理、逻辑正确性 |
| 题2 | 20分 | 路径搜索、收益计算、代码效率 |
| 题3 | 20分 | 风险评估、综合计算、建议合理性 |
| 总计 | 60分 | |

---

## 提交要求

1. 将代码保存为单独的 `.ts` 文件
2. 确保代码可以运行（可以使用 ts-node）
3. 添加必要的测试用例
4. 添加注释说明关键逻辑

---

**时间到！请停止答题并检查代码。**

**完成后请查看"答案解析.md"对照参考答案。**
