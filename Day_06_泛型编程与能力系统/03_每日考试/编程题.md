# Day 06 æ¯æ—¥è€ƒè¯• - ç¼–ç¨‹é¢˜

**æ€»åˆ†ï¼š50 åˆ†**  
**æ—¶é—´ï¼š30 åˆ†é’Ÿ**

---

## ç¼–ç¨‹é¢˜ 1ï¼šæ³›å‹äº¤æ¢å‡½æ•°ï¼ˆ15 åˆ†ï¼‰

### é¢˜ç›®æè¿°

å®ç°ä¸€ä¸ªæ³›å‹å‡½æ•° `swap_if_greater`ï¼Œå®ƒæ¥å—ä¸¤ä¸ªå¯æ¯”è¾ƒçš„å€¼ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå€¼å¤§äºç¬¬äºŒä¸ªå€¼ï¼Œåˆ™äº¤æ¢å®ƒä»¬ï¼Œå¦åˆ™ä¿æŒä¸å˜ã€‚

### å‡½æ•°ç­¾å

```move
public fun swap_if_greater<T: copy + drop>(a: T, b: T): (T, T)
```

### è¦æ±‚

1. ä½¿ç”¨æ³›å‹å®ç°
2. éœ€è¦æ¯”è¾ƒä¸¤ä¸ªå€¼çš„å¤§å°ï¼ˆå‡è®¾ T æ˜¯ u64 ç±»å‹ï¼‰
3. è¿”å›äº¤æ¢åçš„ç»“æœ

### æµ‹è¯•ç”¨ä¾‹

```move
#[test]
fun test_swap_if_greater() {
    let (a, b) = swap_if_greater(5, 3);
    assert!(a == 3 && b == 5, 0);
    
    let (a, b) = swap_if_greater(2, 8);
    assert!(a == 2 && b == 8, 1);
}
```

### è¯„åˆ†æ ‡å‡†

- æ­£ç¡®å®ç°æ³›å‹ï¼š5 åˆ†
- é€»è¾‘æ­£ç¡®ï¼š5 åˆ†
- æµ‹è¯•é€šè¿‡ï¼š5 åˆ†

---

## ç¼–ç¨‹é¢˜ 2ï¼šèƒ½åŠ›ç³»ç»Ÿåº”ç”¨ï¼ˆ20 åˆ†ï¼‰

### é¢˜ç›®æè¿°

å®ç°ä¸€ä¸ªç®€å•çš„æƒé™å‡­è¯ç³»ç»Ÿï¼ŒåŒ…å«ä»¥ä¸‹ç»„ä»¶ï¼š

1. `AdminCap`ï¼šç®¡ç†å‘˜æƒé™å‡­è¯ï¼ˆä¸èƒ½å¤åˆ¶ã€ä¸èƒ½å­˜å‚¨ï¼‰
2. `Resource`ï¼šå—ä¿æŠ¤çš„èµ„æºï¼ˆåªæœ‰ store èƒ½åŠ›ï¼‰
3. `Storage`ï¼šèµ„æºå­˜å‚¨å®¹å™¨ï¼ˆkey èƒ½åŠ›ï¼‰

### è¦æ±‚å®ç°çš„å‡½æ•°

```move
// åˆ›å»ºç®¡ç†å‘˜æƒé™ï¼ˆåªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼‰
public fun create_admin_cap(): AdminCap

// åˆ›å»ºå­˜å‚¨å®¹å™¨
public fun create_storage(account: &signer)

// å­˜å…¥èµ„æºï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰
public fun store_resource(
    _cap: &AdminCap,
    account: &signer,
    resource: Resource
)

// å–å‡ºèµ„æºï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰
public fun retrieve_resource(
    _cap: &AdminCap,
    account: &signer
): Resource

// é”€æ¯ç®¡ç†å‘˜æƒé™
public fun destroy_admin_cap(cap: AdminCap)
```

### ç»“æ„ä½“å®šä¹‰

```move
struct AdminCap has drop {
    // ä¸èƒ½æœ‰ copy å’Œ store
}

struct Resource has store {
    value: u64
}

struct Storage has key {
    resource: option::Option<Resource>
}
```

### æµ‹è¯•ç”¨ä¾‹

```move
#[test(admin = @0x1)]
fun test_permission_system(admin: &signer) {
    let cap = create_admin_cap();
    create_storage(admin);
    
    let resource = Resource { value: 100 };
    store_resource(&cap, admin, resource);
    
    let retrieved = retrieve_resource(&cap, admin);
    assert!(retrieved.value == 100, 0);
    
    destroy_admin_cap(cap);
}

#[test(user = @0x2)]
#[expected_failure]  // åº”è¯¥å¤±è´¥ï¼šæ²¡æœ‰æƒé™
fun test_no_permission(user: &signer) {
    create_storage(user);
    let resource = Resource { value: 100 };
    // é”™è¯¯ï¼šæ²¡æœ‰ AdminCapï¼Œæ— æ³•è°ƒç”¨
    // store_resource(&cap, user, resource);
}
```

### è¯„åˆ†æ ‡å‡†

- èƒ½åŠ›å£°æ˜æ­£ç¡®ï¼š8 åˆ†
- å‡½æ•°å®ç°æ­£ç¡®ï¼š8 åˆ†
- æµ‹è¯•é€šè¿‡ï¼š4 åˆ†

---

## ç¼–ç¨‹é¢˜ 3ï¼šHot Potato å®æˆ˜ï¼ˆ15 åˆ†ï¼‰

### é¢˜ç›®æè¿°

å®ç°ä¸€ä¸ªä½¿ç”¨ Hot Potato æ¨¡å¼çš„ä¸´æ—¶æˆæƒç³»ç»Ÿã€‚ç”¨æˆ·å¿…é¡»å…ˆè·å–æˆæƒï¼Œä½¿ç”¨åå½’è¿˜ã€‚

### è¦æ±‚å®ç°

```move
// Ticket æ²¡æœ‰ä»»ä½•èƒ½åŠ›
struct Ticket {
    user: address,
    expires_at: u64
}

// è·å–ä¸´æ—¶ç¥¨æ®
public fun get_ticket(user: address, duration: u64): Ticket {
    // å®ç°
}

// ä½¿ç”¨ç¥¨æ®æ‰§è¡Œæ“ä½œ
public fun use_ticket(ticket: &Ticket, current_time: u64): bool {
    // æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
    // è¿”å›æ˜¯å¦æœ‰æ•ˆ
}

// å½’è¿˜ç¥¨æ®ï¼ˆæ¶ˆè´¹ Ticketï¼‰
public fun return_ticket(ticket: Ticket) {
    // è§£æ„é”€æ¯
}
```

### ä½¿ç”¨ç¤ºä¾‹

```move
public fun example() {
    let ticket = get_ticket(@0x1, 100);
    let valid = use_ticket(&ticket, 50);
    assert!(valid, 0);
    return_ticket(ticket);  // å¿…é¡»è°ƒç”¨ï¼Œå¦åˆ™ç¼–è¯‘é”™è¯¯
}
```

### æµ‹è¯•ç”¨ä¾‹

```move
#[test]
fun test_ticket_system() {
    let ticket = get_ticket(@0x1, 100);
    
    // æœªè¿‡æœŸ
    assert!(use_ticket(&ticket, 50), 0);
    
    // å·²è¿‡æœŸ
    assert!(!use_ticket(&ticket, 150), 1);
    
    return_ticket(ticket);
}

#[test]
#[expected_failure]
fun test_must_return_ticket() {
    let ticket = get_ticket(@0x1, 100);
    // é”™è¯¯ï¼šå¿˜è®°è°ƒç”¨ return_ticket
    // ç¼–è¯‘å™¨ä¼šæŠ¥é”™
}
```

### è¯„åˆ†æ ‡å‡†

- Hot Potato æ¨¡å¼æ­£ç¡®ï¼š5 åˆ†
- é€»è¾‘å®ç°æ­£ç¡®ï¼š5 åˆ†
- æµ‹è¯•é€šè¿‡ï¼š5 åˆ†

---

## æäº¤è¯´æ˜

### æ–‡ä»¶ç»“æ„

```
03_æ¯æ—¥è€ƒè¯•/
â””â”€â”€ ä½ çš„ç­”æ¡ˆ/
    â”œâ”€â”€ problem1.move
    â”œâ”€â”€ problem2.move
    â””â”€â”€ problem3.move
```

### æµ‹è¯•æ–¹æ³•

```bash
aptos move test --filter problem1
aptos move test --filter problem2
aptos move test --filter problem3
```

---

## è¯„åˆ†æ±‡æ€»

| é¢˜ç›® | åˆ†æ•° | ä½ çš„å¾—åˆ† |
|------|------|----------|
| ç¼–ç¨‹é¢˜ 1 | 15 |  |
| ç¼–ç¨‹é¢˜ 2 | 20 |  |
| ç¼–ç¨‹é¢˜ 3 | 15 |  |
| **æ€»åˆ†** | **50** |  |

**åŠæ ¼çº¿**ï¼š35 åˆ†ï¼ˆ70%ï¼‰  
**ä¼˜ç§€çº¿**ï¼š45 åˆ†ï¼ˆ90%ï¼‰

---

## ğŸ’¡ è§£é¢˜æç¤º

### ç¼–ç¨‹é¢˜ 1
- å…³é”®æ˜¯ç†è§£æ³›å‹çº¦æŸ
- å¯¹äº u64 ç±»å‹ï¼Œå¯ä»¥ç›´æ¥æ¯”è¾ƒå¤§å°
- æ³¨æ„å‡½æ•°ç­¾åä¸­çš„çº¦æŸ

### ç¼–ç¨‹é¢˜ 2
- ä»”ç»†è®¾è®¡æ¯ä¸ªç»“æ„ä½“çš„èƒ½åŠ›
- AdminCap åº”è¯¥æœ‰ drop ä½†ä¸èƒ½æœ‰ copy å’Œ store
- ä½¿ç”¨ option::Option æ¥å­˜å‚¨å¯èƒ½ä¸ºç©ºçš„èµ„æº

### ç¼–ç¨‹é¢˜ 3
- Ticket ä¸åº”è¯¥æœ‰ä»»ä½•èƒ½åŠ›
- use_ticket æ¥å—å¼•ç”¨ï¼Œä¸æ¶ˆè´¹ Ticket
- return_ticket æ¶ˆè´¹ Ticketï¼Œé€šè¿‡è§£æ„é”€æ¯

---

## å¸¸è§é”™è¯¯

âŒ **é”™è¯¯ 1**ï¼šç»™ Hot Potato ç»“æ„ä½“æ·»åŠ èƒ½åŠ›
```move
struct Ticket has drop { ... }  // é”™è¯¯ï¼
```

âŒ **é”™è¯¯ 2**ï¼šæƒé™å‡­è¯å¯ä»¥è¢«å­˜å‚¨
```move
struct AdminCap has store { ... }  // ä¸å®‰å…¨ï¼
```

âŒ **é”™è¯¯ 3**ï¼šå¿˜è®°è§£æ„é”€æ¯èµ„æº
```move
public fun return_ticket(ticket: Ticket) {
    // ä»€ä¹ˆéƒ½ä¸åš - é”™è¯¯ï¼
}
```

âœ… **æ­£ç¡®åšæ³•**ï¼š
```move
public fun return_ticket(ticket: Ticket) {
    let Ticket { user: _, expires_at: _ } = ticket;
}
```

---

**é¢„è®¡å®Œæˆæ—¶é—´**ï¼š30 åˆ†é’Ÿ  
**å®é™…ç”¨æ—¶**ï¼š________

ç­”æ¡ˆå’Œè¯¦ç»†è§£æè¯·å‚è€ƒ `ç­”æ¡ˆè§£æ.md`

åŠ æ²¹ï¼ğŸ’ª
