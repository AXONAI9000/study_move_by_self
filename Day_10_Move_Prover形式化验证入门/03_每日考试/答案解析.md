# Day 10 æ¯æ—¥è€ƒè¯• - ç­”æ¡ˆè§£æ

## é€‰æ‹©é¢˜ç­”æ¡ˆä¸è§£æï¼ˆ50 åˆ†ï¼‰

### ç¬¬ 1 é¢˜
**ç­”æ¡ˆï¼šC**

**è§£æï¼š**  
Move Prover çš„ä¸»è¦ä½œç”¨æ˜¯ä½¿ç”¨æ•°å­¦æ–¹æ³•ï¼ˆå½¢å¼åŒ–éªŒè¯ï¼‰è¯æ˜ä»£ç æ»¡è¶³å…¶è§„çº¦ã€‚å®ƒä¸æ˜¯ç¼–è¯‘å™¨ï¼ˆAï¼‰ï¼Œä¸æ˜¯æµ‹è¯•è¿è¡Œå™¨ï¼ˆBï¼‰ï¼Œä¹Ÿä¸æ˜¯ä»£ç æ ¼å¼åŒ–å·¥å…·ï¼ˆDï¼‰ã€‚å½¢å¼åŒ–éªŒè¯æä¾›æ¯”æµ‹è¯•æ›´å¼ºçš„ä¿è¯ï¼Œå¯ä»¥è¯æ˜ä»£ç å¯¹æ‰€æœ‰å¯èƒ½çš„è¾“å…¥éƒ½æ˜¯æ­£ç¡®çš„ã€‚

---

### ç¬¬ 2 é¢˜
**ç­”æ¡ˆï¼šB**

**è§£æï¼š**  
- `requires`ï¼šå®šä¹‰å‡½æ•°çš„å‰ç½®æ¡ä»¶ï¼ˆpreconditionï¼‰
- `ensures`ï¼šå®šä¹‰å‡½æ•°çš„åç½®æ¡ä»¶ï¼ˆpostconditionï¼‰
- `aborts_if`ï¼šå®šä¹‰å‡½æ•°ä¸­æ­¢çš„æ¡ä»¶
- `invariant`ï¼šå®šä¹‰æ•°æ®ä¸å˜é‡

å‰ç½®æ¡ä»¶æ˜¯å‡½æ•°æ‰§è¡Œå‰å¿…é¡»æ»¡è¶³çš„æ¡ä»¶ï¼Œç”±è°ƒç”¨è€…ä¿è¯ã€‚

---

### ç¬¬ 3 é¢˜
**ç­”æ¡ˆï¼šA**

**è§£æï¼š**  
`old(x)` è¡¨è¾¾å¼å¼•ç”¨å˜é‡ `x` åœ¨å‡½æ•°æ‰§è¡Œ**ä¹‹å‰**çš„å€¼ã€‚è¿™åœ¨åç½®æ¡ä»¶ä¸­éå¸¸æœ‰ç”¨ï¼Œç”¨äºæ¯”è¾ƒå‡½æ•°æ‰§è¡Œå‰åçš„çŠ¶æ€å˜åŒ–ã€‚

ç¤ºä¾‹ï¼š
```move
spec increment {
    ensures counter.value == old(counter.value) + 1;
}
```

---

### ç¬¬ 4 é¢˜
**ç­”æ¡ˆï¼šB**

**è§£æï¼š**  
è¦é˜²æ­¢åŠ æ³•æº¢å‡ºï¼Œéœ€è¦åœ¨**å‡½æ•°æ‰§è¡Œå‰**æ£€æŸ¥æ¡ä»¶ï¼Œæ‰€ä»¥è¦ç”¨ `requires` å‰ç½®æ¡ä»¶ã€‚

- A é”™è¯¯ï¼š`ensures` æ˜¯åç½®æ¡ä»¶ï¼Œä¸”æ¡ä»¶ä¸æ­£ç¡®
- B æ­£ç¡®ï¼šå‰ç½®æ¡ä»¶ç¡®ä¿ a + b ä¸è¶…è¿‡ u64 æœ€å¤§å€¼
- C é”™è¯¯ï¼š`aborts_if` çš„æ¡ä»¶é”™è¯¯ï¼ˆa + b > 0 æ€»æ˜¯çœŸï¼‰
- D é”™è¯¯ï¼š`invariant` ç”¨äºæ•°æ®ç»“æ„ï¼Œä¸”æ¡ä»¶æ— å…³

å®Œæ•´è§„çº¦ï¼š
```move
spec add {
    requires a + b <= 18446744073709551615;
    ensures result == a + b;
}
```

---

### ç¬¬ 5 é¢˜
**ç­”æ¡ˆï¼šC**

**è§£æï¼š**  
`aborts_if` ç”¨äºæŒ‡å®šå‡½æ•°åœ¨ä»€ä¹ˆæ¡ä»¶ä¸‹ä¼š abortï¼ˆä¸­æ­¢æ‰§è¡Œï¼‰ã€‚è¿™å¸®åŠ©è°ƒç”¨è€…ç†è§£å‡½æ•°å¯èƒ½å¤±è´¥çš„æƒ…å†µã€‚

ç¤ºä¾‹ï¼š
```move
spec divide {
    aborts_if b == 0 with ERROR_DIVISION_BY_ZERO;
    ensures result == a / b;
}
```

---

### ç¬¬ 6 é¢˜
**ç­”æ¡ˆï¼šB**

**è§£æï¼š**  
åœ¨è§„çº¦ä¸­è®¿é—®å…¨å±€å­˜å‚¨ä½¿ç”¨ `global<T>(address)` è¯­æ³•ã€‚

ç¤ºä¾‹ï¼š
```move
spec transfer {
    ensures global<Account>(addr).balance == old(global<Account>(addr).balance) + amount;
}
```

è¿™ä¸ä»£ç ä¸­çš„ `borrow_global<T>(address)` å¯¹åº”ï¼Œä½†è§„çº¦ä½¿ç”¨ `global`ã€‚

---

### ç¬¬ 7 é¢˜
**ç­”æ¡ˆï¼šB**

**è§£æï¼š**  
ä¸å˜é‡ï¼ˆinvariantï¼‰å®šä¹‰æ•°æ®ç»“æ„åœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­å¿…é¡»ä¿æŒçš„æ€§è´¨ã€‚

ç¤ºä¾‹ï¼š
```move
struct Account has key {
    balance: u64
}

spec Account {
    invariant balance >= 0;  // u64 æœ¬èº«ä¿è¯ï¼Œè¿™åªæ˜¯ç¤ºä¾‹
}
```

æ¨¡å—çº§ä¸å˜é‡å¯ä»¥è¡¨è¾¾æ›´å¤æ‚çš„æ€§è´¨ï¼Œå¦‚"æ‰€æœ‰è´¦æˆ·ä½™é¢ä¹‹å’Œç­‰äºæ€»ä¾›åº”é‡"ã€‚

---

### ç¬¬ 8 é¢˜
**ç­”æ¡ˆï¼šC**

**è§£æï¼š**  
æ€»é‡å®ˆæ’æ„å‘³ç€è½¬è´¦å‰åçš„æ€»ä½™é¢ä¸å˜ï¼Œå³ï¼š
```
from.balance + to.balance == old(from.balance + to.balance)
```

- A åªè¯´æ˜ from å‡å°‘äº†ï¼Œä¸å®Œæ•´
- B åªè¯´æ˜ to å¢åŠ äº†ï¼Œä¸å®Œæ•´
- C æ­£ç¡®ï¼šè¯æ˜äº†æ€»é‡å®ˆæ’
- D åªæ˜¯å‚æ•°éªŒè¯ï¼Œä¸å®ˆæ’æ— å…³

---

### ç¬¬ 9 é¢˜
**ç­”æ¡ˆï¼šC**

**è§£æï¼š**  
å½¢å¼åŒ–éªŒè¯**ä¸èƒ½**å®Œå…¨æ›¿ä»£æµ‹è¯•ã€‚åŸå› ï¼š

1. **éªŒè¯æˆæœ¬é«˜**ï¼šå¤æ‚ç³»ç»Ÿçš„éªŒè¯å¯èƒ½éå¸¸è€—æ—¶
2. **è§„çº¦å¯èƒ½é”™è¯¯**ï¼šè§„çº¦æœ¬èº«å¯èƒ½æœ‰ bug
3. **å·¥å…·é™åˆ¶**ï¼šéªŒè¯å·¥å…·æœ‰å·²çŸ¥çš„é™åˆ¶
4. **å®é™…è¿è¡Œç¯å¢ƒ**ï¼šæµ‹è¯•å¯ä»¥å‘ç°é›†æˆé—®é¢˜ã€æ€§èƒ½é—®é¢˜ç­‰

æœ€ä½³å®è·µæ˜¯**ç»“åˆä½¿ç”¨**ï¼šå…³é”®é€»è¾‘ç”¨å½¢å¼åŒ–éªŒè¯ï¼Œå…¶ä»–éƒ¨åˆ†ç”¨æµ‹è¯•ã€‚

---

### ç¬¬ 10 é¢˜
**ç­”æ¡ˆï¼šC**

**è§£æï¼š**  
æ­£ç¡®çš„é‡è¯è¡¨è¾¾å¼åº”è¯¥ï¼š
1. ä½¿ç”¨ `forall` éå†æ‰€æœ‰åœ°å€
2. ä½¿ç”¨ `where` å­å¥é™åˆ¶èŒƒå›´ï¼ˆåªæ£€æŸ¥å­˜åœ¨è´¦æˆ·çš„åœ°å€ï¼‰
3. è®¿é—®å…¨å±€å­˜å‚¨æ—¶ä½¿ç”¨ `global<T>(addr)`

```move
invariant forall addr: address where exists<Account>(addr):
    global<Account>(addr).balance >= 0
```

- A é”™è¯¯ï¼šæ²¡æœ‰é‡è¯ï¼Œåªæ£€æŸ¥ä¸€ä¸ª addr
- B é”™è¯¯ï¼šæ²¡æœ‰ where å­å¥ï¼Œä¼šæ£€æŸ¥ä¸å­˜åœ¨è´¦æˆ·çš„åœ°å€
- C æ­£ç¡®
- D é”™è¯¯ï¼šä½¿ç”¨ exists é‡è¯ï¼Œè¡¨ç¤º"å­˜åœ¨æŸä¸ªåœ°å€"ï¼Œæ„ä¹‰ä¸åŒ

---

## ç¼–ç¨‹é¢˜ç­”æ¡ˆä¸è§£æï¼ˆ50 åˆ†ï¼‰

### ç¼–ç¨‹é¢˜ 1ï¼šéªŒè¯å®‰å…¨çš„æ•°å­¦åº“ï¼ˆ25 åˆ†ï¼‰

#### å‚è€ƒç­”æ¡ˆ

```move
module exam::safe_math {
    /// é”™è¯¯ç 
    const ERROR_OVERFLOW: u64 = 1;
    const ERROR_UNDERFLOW: u64 = 2;
    const ERROR_INVALID_PERCENT: u64 = 3;

    const MAX_U64: u64 = 18446744073709551615;

    /// å®‰å…¨åŠ æ³•
    public fun safe_add(a: u64, b: u64): u64 {
        assert!(MAX_U64 - a >= b, ERROR_OVERFLOW);
        a + b
    }

    spec safe_add {
        // å‰ç½®æ¡ä»¶ï¼šä¸ä¼šæº¢å‡º
        requires a + b <= MAX_U64;
        
        // åç½®æ¡ä»¶ï¼šè¿”å›æ­£ç¡®çš„å’Œ
        ensures result == a + b;
        
        // åç½®æ¡ä»¶ï¼šç»“æœå¤§äºç­‰äºä»»ä¸€è¾“å…¥
        ensures result >= a;
        ensures result >= b;
        
        // äº¤æ¢å¾‹
        ensures result == b + a;
        
        // ä¸­æ­¢æ¡ä»¶
        aborts_if a + b > MAX_U64 with ERROR_OVERFLOW;
    }

    /// å®‰å…¨å‡æ³•
    public fun safe_sub(a: u64, b: u64): u64 {
        assert!(a >= b, ERROR_UNDERFLOW);
        a - b
    }

    spec safe_sub {
        requires a >= b;
        ensures result == a - b;
        ensures result <= a;
        aborts_if a < b with ERROR_UNDERFLOW;
    }

    /// å®‰å…¨ä¹˜æ³•
    public fun safe_mul(a: u64, b: u64): u64 {
        if (a == 0 || b == 0) {
            return 0
        };
        
        let result = a * b;
        assert!(result / a == b, ERROR_OVERFLOW);
        result
    }

    spec safe_mul {
        // ç‰¹æ®Šæƒ…å†µï¼šæœ‰ä¸€ä¸ªä¸º 0
        ensures (a == 0 || b == 0) ==> result == 0;
        
        // ä¸€èˆ¬æƒ…å†µï¼šä¸æº¢å‡ºæ—¶è¿”å›æ­£ç¡®çš„ç§¯
        ensures (a != 0 && b != 0 && a * b <= MAX_U64) ==> result == a * b;
        
        // ä¸­æ­¢æ¡ä»¶ï¼šéé›¶ä¸”ä¼šæº¢å‡º
        aborts_if a != 0 && b != 0 && a * b > MAX_U64 with ERROR_OVERFLOW;
    }

    /// ç™¾åˆ†æ¯”è®¡ç®—
    public fun percentage(value: u64, percent: u64): u64 {
        assert!(percent <= 100, ERROR_INVALID_PERCENT);
        
        // å…ˆæ£€æŸ¥ä¹˜æ³•ä¸ä¼šæº¢å‡º
        if (percent > 0) {
            assert!(MAX_U64 / percent >= value, ERROR_OVERFLOW);
        };
        
        (value * percent) / 100
    }

    spec percentage {
        requires percent <= 100;
        requires percent == 0 || value <= MAX_U64 / percent;
        
        ensures result == (value * percent) / 100;
        ensures result <= value;  // ç™¾åˆ†æ¯”ä¸è¶…è¿‡ 100%ï¼Œç»“æœä¸è¶…è¿‡åŸå€¼
        
        aborts_if percent > 100 with ERROR_INVALID_PERCENT;
        aborts_if percent != 0 && value > MAX_U64 / percent with ERROR_OVERFLOW;
    }
}
```

#### è¯„åˆ†è¦ç‚¹

1. **ä»£ç å®ç°ï¼ˆ10 åˆ†ï¼‰**
   - æº¢å‡ºæ£€æŸ¥æ­£ç¡®ï¼š3 åˆ†
   - ä¸‹æº¢æ£€æŸ¥æ­£ç¡®ï¼š2 åˆ†
   - ä¹˜æ³•éªŒè¯æ­£ç¡®ï¼š3 åˆ†
   - ç™¾åˆ†æ¯”è®¡ç®—æ­£ç¡®ï¼š2 åˆ†

2. **è§„çº¦ç¼–å†™ï¼ˆ12 åˆ†ï¼‰**
   - å‰ç½®æ¡ä»¶å®Œæ•´ï¼š4 åˆ†
   - åç½®æ¡ä»¶å‡†ç¡®ï¼š4 åˆ†
   - ä¸­æ­¢æ¡ä»¶æ¸…æ™°ï¼š4 åˆ†

3. **éªŒè¯é€šè¿‡ï¼ˆ3 åˆ†ï¼‰**

#### å¸¸è§é”™è¯¯

1. **å¿˜è®°æ£€æŸ¥æº¢å‡º**ï¼šç›´æ¥è¿›è¡Œè¿ç®—
2. **è§„çº¦ä¸å®Œæ•´**ï¼šç¼ºå°‘æŸäº›æ¡ä»¶
3. **ä¸­æ­¢æ¡ä»¶é”™è¯¯**ï¼šä½¿ç”¨ `>=` è€Œä¸æ˜¯ `>`

---

### ç¼–ç¨‹é¢˜ 2ï¼šéªŒè¯è´¦æˆ·ç³»ç»Ÿçš„ä¸å˜é‡ï¼ˆ25 åˆ†ï¼‰

#### å‚è€ƒç­”æ¡ˆ

```move
module exam::account_system {
    use std::signer;

    const ERROR_ACCOUNT_EXISTS: u64 = 1;
    const ERROR_ACCOUNT_NOT_FOUND: u64 = 2;
    const ERROR_INSUFFICIENT_BALANCE: u64 = 3;
    const ERROR_INVALID_AMOUNT: u64 = 4;
    const ERROR_OVERFLOW: u64 = 5;
    const ERROR_NOT_INITIALIZED: u64 = 6;

    const MAX_U64: u64 = 18446744073709551615;

    struct Account has key {
        balance: u64
    }

    struct GlobalState has key {
        total_balance: u64
    }

    /// æ¨¡å—çº§ä¸å˜é‡ï¼šæ€»ä½™é¢çš„ä¸€è‡´æ€§
    spec module {
        // ç®€åŒ–ç‰ˆï¼šGlobalState å­˜åœ¨æ—¶ï¼Œtotal_balance åº”è¯¥åˆç†
        invariant forall addr: address where exists<GlobalState>(addr):
            global<GlobalState>(addr).total_balance >= 0;
    }

    /// åˆå§‹åŒ–å…¨å±€çŠ¶æ€
    public fun initialize(admin: &signer) {
        let admin_addr = signer::address_of(admin);
        assert!(!exists<GlobalState>(admin_addr), ERROR_ACCOUNT_EXISTS);
        move_to(admin, GlobalState { total_balance: 0 });
    }

    spec initialize {
        let admin_addr = signer::address_of(admin);
        requires !exists<GlobalState>(admin_addr);
        ensures exists<GlobalState>(admin_addr);
        ensures global<GlobalState>(admin_addr).total_balance == 0;
        aborts_if exists<GlobalState>(admin_addr);
    }

    /// åˆ›å»ºè´¦æˆ·
    public fun create_account(owner: &signer, initial_balance: u64) acquires GlobalState {
        let addr = signer::address_of(owner);
        assert!(!exists<Account>(addr), ERROR_ACCOUNT_EXISTS);
        assert!(exists<GlobalState>(@exam), ERROR_NOT_INITIALIZED);
        
        let state = borrow_global_mut<GlobalState>(@exam);
        assert!(MAX_U64 - state.total_balance >= initial_balance, ERROR_OVERFLOW);
        
        state.total_balance = state.total_balance + initial_balance;
        move_to(owner, Account { balance: initial_balance });
    }

    spec create_account {
        let addr = signer::address_of(owner);
        
        requires !exists<Account>(addr);
        requires exists<GlobalState>(@exam);
        requires global<GlobalState>(@exam).total_balance + initial_balance <= MAX_U64;
        
        ensures exists<Account>(addr);
        ensures global<Account>(addr).balance == initial_balance;
        ensures global<GlobalState>(@exam).total_balance == 
                old(global<GlobalState>(@exam).total_balance) + initial_balance;
        
        aborts_if exists<Account>(addr);
        aborts_if !exists<GlobalState>(@exam);
        aborts_if global<GlobalState>(@exam).total_balance + initial_balance > MAX_U64;
    }

    /// å­˜æ¬¾
    public fun deposit(addr: address, amount: u64) acquires Account, GlobalState {
        assert!(exists<Account>(addr), ERROR_ACCOUNT_NOT_FOUND);
        assert!(exists<GlobalState>(@exam), ERROR_NOT_INITIALIZED);
        assert!(amount > 0, ERROR_INVALID_AMOUNT);
        
        let account = borrow_global_mut<Account>(addr);
        assert!(MAX_U64 - account.balance >= amount, ERROR_OVERFLOW);
        account.balance = account.balance + amount;
        
        let state = borrow_global_mut<GlobalState>(@exam);
        assert!(MAX_U64 - state.total_balance >= amount, ERROR_OVERFLOW);
        state.total_balance = state.total_balance + amount;
    }

    spec deposit {
        requires exists<Account>(addr);
        requires exists<GlobalState>(@exam);
        requires amount > 0;
        requires global<Account>(addr).balance + amount <= MAX_U64;
        requires global<GlobalState>(@exam).total_balance + amount <= MAX_U64;
        
        ensures global<Account>(addr).balance == old(global<Account>(addr).balance) + amount;
        ensures global<GlobalState>(@exam).total_balance == 
                old(global<GlobalState>(@exam).total_balance) + amount;
        
        aborts_if !exists<Account>(addr);
        aborts_if !exists<GlobalState>(@exam);
        aborts_if amount == 0;
        aborts_if global<Account>(addr).balance + amount > MAX_U64;
        aborts_if global<GlobalState>(@exam).total_balance + amount > MAX_U64;
    }

    /// å–æ¬¾
    public fun withdraw(owner: &signer, amount: u64) acquires Account, GlobalState {
        let addr = signer::address_of(owner);
        assert!(exists<Account>(addr), ERROR_ACCOUNT_NOT_FOUND);
        assert!(exists<GlobalState>(@exam), ERROR_NOT_INITIALIZED);
        assert!(amount > 0, ERROR_INVALID_AMOUNT);
        
        let account = borrow_global_mut<Account>(addr);
        assert!(account.balance >= amount, ERROR_INSUFFICIENT_BALANCE);
        account.balance = account.balance - amount;
        
        let state = borrow_global_mut<GlobalState>(@exam);
        assert!(state.total_balance >= amount, ERROR_INSUFFICIENT_BALANCE);
        state.total_balance = state.total_balance - amount;
    }

    spec withdraw {
        let addr = signer::address_of(owner);
        
        requires exists<Account>(addr);
        requires exists<GlobalState>(@exam);
        requires amount > 0;
        requires global<Account>(addr).balance >= amount;
        requires global<GlobalState>(@exam).total_balance >= amount;
        
        ensures global<Account>(addr).balance == old(global<Account>(addr).balance) - amount;
        ensures global<GlobalState>(@exam).total_balance == 
                old(global<GlobalState>(@exam).total_balance) - amount;
        
        aborts_if !exists<Account>(addr);
        aborts_if !exists<GlobalState>(@exam);
        aborts_if amount == 0;
        aborts_if global<Account>(addr).balance < amount;
        aborts_if global<GlobalState>(@exam).total_balance < amount;
    }

    /// è½¬è´¦
    public fun transfer(from: &signer, to: address, amount: u64) acquires Account, GlobalState {
        let from_addr = signer::address_of(from);
        
        assert!(from_addr != to, ERROR_INVALID_AMOUNT);
        assert!(amount > 0, ERROR_INVALID_AMOUNT);
        assert!(exists<Account>(from_addr), ERROR_ACCOUNT_NOT_FOUND);
        assert!(exists<Account>(to), ERROR_ACCOUNT_NOT_FOUND);
        assert!(exists<GlobalState>(@exam), ERROR_NOT_INITIALIZED);
        
        // ä»å‘é€æ–¹æ‰£æ¬¾
        {
            let from_account = borrow_global_mut<Account>(from_addr);
            assert!(from_account.balance >= amount, ERROR_INSUFFICIENT_BALANCE);
            from_account.balance = from_account.balance - amount;
        };
        
        // ç»™æ¥æ”¶æ–¹åŠ æ¬¾
        {
            let to_account = borrow_global_mut<Account>(to);
            assert!(MAX_U64 - to_account.balance >= amount, ERROR_OVERFLOW);
            to_account.balance = to_account.balance + amount;
        };
        
        // æ³¨æ„ï¼šGlobalState.total_balance ä¸å˜ï¼
    }

    spec transfer {
        let from_addr = signer::address_of(from);
        
        requires from_addr != to;
        requires amount > 0;
        requires exists<Account>(from_addr);
        requires exists<Account>(to);
        requires exists<GlobalState>(@exam);
        requires global<Account>(from_addr).balance >= amount;
        requires global<Account>(to).balance + amount <= MAX_U64;
        
        // å‘é€æ–¹ä½™é¢å‡å°‘
        ensures global<Account>(from_addr).balance == 
                old(global<Account>(from_addr).balance) - amount;
        
        // æ¥æ”¶æ–¹ä½™é¢å¢åŠ 
        ensures global<Account>(to).balance == 
                old(global<Account>(to).balance) + amount;
        
        // å…³é”®ï¼šæ€»ä½™é¢ä¸å˜ï¼
        ensures global<GlobalState>(@exam).total_balance == 
                old(global<GlobalState>(@exam).total_balance);
        
        aborts_if from_addr == to;
        aborts_if amount == 0;
        aborts_if !exists<Account>(from_addr);
        aborts_if !exists<Account>(to);
        aborts_if !exists<GlobalState>(@exam);
        aborts_if global<Account>(from_addr).balance < amount;
        aborts_if global<Account>(to).balance + amount > MAX_U64;
    }

    /// æŸ¥è¯¢ä½™é¢
    public fun balance_of(addr: address): u64 acquires Account {
        if (!exists<Account>(addr)) {
            0
        } else {
            borrow_global<Account>(addr).balance
        }
    }

    spec balance_of {
        ensures result == if (exists<Account>(addr)) {
            global<Account>(addr).balance
        } else {
            0
        };
        aborts_if false;
    }

    /// æŸ¥è¯¢æ€»ä½™é¢
    public fun total_balance(): u64 acquires GlobalState {
        assert!(exists<GlobalState>(@exam), ERROR_NOT_INITIALIZED);
        borrow_global<GlobalState>(@exam).total_balance
    }

    spec total_balance {
        requires exists<GlobalState>(@exam);
        ensures result == global<GlobalState>(@exam).total_balance;
        aborts_if !exists<GlobalState>(@exam);
    }
}
```

#### è¯„åˆ†è¦ç‚¹

1. **ä»£ç å®ç°ï¼ˆ10 åˆ†ï¼‰**
   - æ­£ç¡®ç»´æŠ¤ GlobalStateï¼š4 åˆ†
   - è½¬è´¦é€»è¾‘æ­£ç¡®ï¼š3 åˆ†
   - å­˜æ¬¾/å–æ¬¾é€»è¾‘æ­£ç¡®ï¼š3 åˆ†

2. **è§„çº¦ç¼–å†™ï¼ˆ10 åˆ†ï¼‰**
   - æ¯ä¸ªå‡½æ•°è§„çº¦å®Œæ•´ï¼š5 åˆ†
   - è½¬è´¦å‡½æ•°è¯æ˜æ€»ä½™é¢ä¸å˜ï¼š3 åˆ†
   - æ¨¡å—çº§ä¸å˜é‡ï¼š2 åˆ†

3. **éªŒè¯é€šè¿‡ï¼ˆ5 åˆ†ï¼‰**

#### å…³é”®çŸ¥è¯†ç‚¹

1. **è½¬è´¦çš„æ€»ä½™é¢ä¸å˜æ€§**
   ```move
   ensures global<GlobalState>(@exam).total_balance == 
           old(global<GlobalState>(@exam).total_balance);
   ```

2. **ä½¿ç”¨ä½œç”¨åŸŸåˆ†ç¦» borrow_global_mut**
   ```move
   {
       let from_account = borrow_global_mut<Account>(from_addr);
       from_account.balance = from_account.balance - amount;
   }; // è¿™é‡Œé‡Šæ”¾ from_account
   
   {
       let to_account = borrow_global_mut<Account>(to);
       to_account.balance = to_account.balance + amount;
   };
   ```

3. **æ¨¡å—çº§ä¸å˜é‡çš„ç®€åŒ–**
   - å®Œæ•´çš„ä¸å˜é‡éœ€è¦éå†æ‰€æœ‰è´¦æˆ·æ±‚å’Œï¼Œè¿™åœ¨å®é™…ä¸­å¾ˆéš¾éªŒè¯
   - ç®€åŒ–ç‰ˆåªéªŒè¯ GlobalState æœ¬èº«çš„æ€§è´¨
   - åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œé€šè¿‡æ¯ä¸ªå‡½æ•°çš„è§„çº¦æ¥é—´æ¥ä¿è¯æ€»ä½“ä¸å˜é‡

---

## ğŸ’¡ å­¦ä¹ æ€»ç»“

### å½¢å¼åŒ–éªŒè¯çš„å…³é”®è¦ç‚¹

1. **å‰ç½®æ¡ä»¶ï¼ˆrequiresï¼‰**
   - è°ƒç”¨è€…çš„è´£ä»»
   - é˜²æ­¢éæ³•è¾“å…¥
   - é˜²æ­¢æº¢å‡º/ä¸‹æº¢

2. **åç½®æ¡ä»¶ï¼ˆensuresï¼‰**
   - å‡½æ•°çš„æ‰¿è¯º
   - æè¿°å‡½æ•°è¡Œä¸º
   - ä½¿ç”¨ `old()` æ¯”è¾ƒçŠ¶æ€

3. **ä¸­æ­¢æ¡ä»¶ï¼ˆaborts_ifï¼‰**
   - æ˜ç¡®å¤±è´¥æƒ…å†µ
   - å¯¹åº” assert! è¯­å¥
   - å¸®åŠ©è°ƒç”¨è€…å¤„ç†é”™è¯¯

4. **ä¸å˜é‡ï¼ˆinvariantï¼‰**
   - æ•°æ®ç»“æ„çš„æ€§è´¨
   - æ¨¡å—çº§çš„å…¨å±€æ€§è´¨
   - å¿…é¡»åœ¨æ‰€æœ‰æ“ä½œä¸­ä¿æŒ

### å¸¸è§æ¨¡å¼

1. **é˜²æº¢å‡ºæ¨¡å¼**
   ```move
   requires a + b <= MAX_U64;
   aborts_if a + b > MAX_U64;
   ```

2. **çŠ¶æ€å˜åŒ–æ¨¡å¼**
   ```move
   ensures balance == old(balance) + amount;
   ```

3. **å®ˆæ’å®šå¾‹æ¨¡å¼**
   ```move
   ensures total == old(total);  // æ€»é‡ä¸å˜
   ```

4. **æƒé™æ£€æŸ¥æ¨¡å¼**
   ```move
   requires signer::address_of(account) == owner;
   ```

---

## ğŸ“Š è¯„åˆ†æ ‡å‡†

### æ€»åˆ† 100 åˆ†

- **é€‰æ‹©é¢˜**ï¼š50 åˆ†ï¼ˆæ¯é¢˜ 5 åˆ†ï¼‰
- **ç¼–ç¨‹é¢˜ 1**ï¼š25 åˆ†
- **ç¼–ç¨‹é¢˜ 2**ï¼š25 åˆ†

### ç­‰çº§åˆ’åˆ†

- **90-100 åˆ†**ï¼šä¼˜ç§€ - å®Œå…¨æŒæ¡å½¢å¼åŒ–éªŒè¯
- **80-89 åˆ†**ï¼šè‰¯å¥½ - åŸºæœ¬æŒæ¡ï¼Œéœ€è¦æ›´å¤šç»ƒä¹ 
- **70-79 åˆ†**ï¼šåŠæ ¼ - ç†è§£æ¦‚å¿µï¼Œä½†å®è·µä¸è¶³
- **60-69 åˆ†**ï¼šä¸åŠæ ¼ - éœ€è¦é‡å­¦ç›¸å…³å†…å®¹
- **< 60 åˆ†**ï¼šéœ€è¦ä»åŸºç¡€é‡æ–°å­¦ä¹ 

---

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®

### å¦‚æœå¾—åˆ† >= 80
- ç»§ç»­å­¦ä¹  Day 11ï¼šæ ‡å‡†åº“æ·±å…¥
- å¼€å§‹ç ”ç©¶ Aptos Framework çš„è§„çº¦
- å°è¯•ä¸ºè‡ªå·±çš„é¡¹ç›®æ·»åŠ éªŒè¯

### å¦‚æœå¾—åˆ† 70-79
- é‡ç‚¹ç»ƒä¹ ç¼–ç¨‹é¢˜
- é˜…è¯»æ›´å¤šè§„çº¦ç¤ºä¾‹
- ç†è§£ old() å’Œ global<> çš„ä½¿ç”¨

### å¦‚æœå¾—åˆ† < 70
- é‡æ–°å­¦ä¹ æ ¸å¿ƒæ¦‚å¿µ
- ä»ç®€å•ç¤ºä¾‹å¼€å§‹ç»ƒä¹ 
- ç†è§£å‰ç½®/åç½®æ¡ä»¶çš„åŒºåˆ«

---

**æ­å–œå®Œæˆ Day 10 çš„å­¦ä¹ ï¼å½¢å¼åŒ–éªŒè¯æ˜¯é«˜çº§æŠ€èƒ½ï¼Œéœ€è¦æŒç»­ç»ƒä¹ æ‰èƒ½ç²¾é€šã€‚** ğŸ“âœ¨
