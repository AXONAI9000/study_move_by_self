# Aptos Coin Framework æ ¸å¿ƒæ¦‚å¿µ

## ç¬¬ä¸€éƒ¨åˆ†ï¼šCoin Framework æ¦‚è¿°

### 1.1 ä»€ä¹ˆæ˜¯ Coin Framework

**Coin Framework** æ˜¯ Aptos åŒºå—é“¾çš„å®˜æ–¹åŒè´¨åŒ–ä»£å¸ï¼ˆFungible Tokenï¼‰æ ‡å‡†ï¼Œç±»ä¼¼äºä»¥å¤ªåŠçš„ ERC-20ã€‚

**æ ¸å¿ƒç‰¹ç‚¹**ï¼š
- **ç±»å‹å®‰å…¨**ï¼šä½¿ç”¨æ³›å‹ç¡®ä¿ä¸åŒä»£å¸ä¸ä¼šæ··æ·†
- **èµ„æºå®‰å…¨**ï¼šåŸºäº Move çš„èµ„æºæ¨¡å‹ï¼Œä»£å¸ä¸èƒ½è¢«å¤åˆ¶æˆ–ä¸¢å¤±
- **æ ‡å‡†åŒ–**ï¼šç»Ÿä¸€çš„æ¥å£ä¿è¯äº’æ“ä½œæ€§
- **é«˜æ•ˆ**ï¼šåŸç”Ÿæ”¯æŒï¼ŒGas æˆæœ¬ä½

**ä¸ ERC-20 å¯¹æ¯”**ï¼š

| ç‰¹æ€§ | Aptos Coin | ERC-20 |
|------|-----------|--------|
| æ ‡å‡† | å†…ç½®æ¡†æ¶ | æ™ºèƒ½åˆçº¦æ ‡å‡† |
| ç±»å‹å®‰å…¨ | ç¼–è¯‘æ—¶æ£€æŸ¥ | è¿è¡Œæ—¶æ£€æŸ¥ |
| ä½™é¢å­˜å‚¨ | ç”¨æˆ·è´¦æˆ·ä¸‹ | åˆçº¦ä¸­çš„æ˜ å°„ |
| è½¬è´¦å®‰å…¨ | èµ„æºä¸å¯å¤åˆ¶ | éœ€è¦æ£€æŸ¥ |
| Gas æˆæœ¬ | ä½ | ä¸­ç­‰ |

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šæ ¸å¿ƒæ•°æ®ç»“æ„

### 2.1 CoinInfo - ä»£å¸å…ƒæ•°æ®

```move
struct CoinInfo<phantom CoinType> has key {
    name: string::String,           // ä»£å¸åç§°ï¼Œå¦‚ "My Coin"
    symbol: string::String,         // ä»£å¸ç¬¦å·ï¼Œå¦‚ "MYC"
    decimals: u8,                   // å°æ•°ä½æ•°ï¼Œå¦‚ 8
    supply: Option<OptionalAggregator>, // æ€»ä¾›åº”é‡ï¼ˆå¯é€‰ï¼‰
}
```

**å­—æ®µè¯´æ˜**ï¼š
- **name**: å®Œæ•´åç§°ï¼Œç”¨äºæ˜¾ç¤º
- **symbol**: ç®€çŸ­ç¬¦å·ï¼Œé€šå¸¸ 3-5 ä¸ªå­—ç¬¦
- **decimals**: å°æ•°ç²¾åº¦ï¼ˆ0-18ï¼‰ï¼Œå¸¸ç”¨ 6 æˆ– 8
- **supply**: å¯é€‰çš„æ€»ä¾›åº”é‡è·Ÿè¸ª

**ç¤ºä¾‹**ï¼š
```move
// USDC çš„ CoinInfo
name: "USD Coin"
symbol: "USDC"
decimals: 6
supply: Some(1000000000000)  // 100ä¸‡ USDCï¼ˆè€ƒè™‘ç²¾åº¦ï¼‰
```

### 2.2 CoinStore - ç”¨æˆ·ä½™é¢

```move
struct CoinStore<phantom CoinType> has key {
    coin: Coin<CoinType>,                    // ç”¨æˆ·æŒæœ‰çš„ä»£å¸
    frozen: bool,                            // è´¦æˆ·æ˜¯å¦è¢«å†»ç»“
    deposit_events: EventHandle<DepositEvent>,
    withdraw_events: EventHandle<WithdrawEvent>,
}
```

**å­˜å‚¨ä½ç½®**ï¼šæ¯ä¸ªç”¨æˆ·åœ°å€ä¸‹  
**è®¿é—®æ–¹å¼**ï¼š`borrow_global<CoinStore<MyCoin>>(user_addr)`

### 2.3 Coin - ä»£å¸å€¼

```move
struct Coin<phantom CoinType> has store {
    value: u64,  // ä»£å¸æ•°é‡ï¼ˆæœ€å°å•ä½ï¼‰
}
```

**å…³é”®ç‚¹**ï¼š
- `value` æ˜¯æœ€å°å•ä½ï¼Œä¸æ˜¯äººç±»å¯è¯»çš„å€¼
- å¦‚æœ decimals = 8ï¼Œ1 ä¸ªä»£å¸ = 100000000 ä¸ªå•ä½

### 2.4 æƒé™èƒ½åŠ›

```move
struct MintCapability<phantom CoinType> has key, store {}
struct BurnCapability<phantom CoinType> has key, store {}  
struct FreezeCapability<phantom CoinType> has key, store {}
```

**ç”¨é€”**ï¼š
- **MintCapability**: å…è®¸é“¸é€ æ–°ä»£å¸
- **BurnCapability**: å…è®¸é”€æ¯ä»£å¸
- **FreezeCapability**: å…è®¸å†»ç»“/è§£å†»è´¦æˆ·

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ ¸å¿ƒå‡½æ•° API

### 3.1 åˆå§‹åŒ–ä»£å¸

```move
public fun initialize<CoinType>(
    account: &signer,
    name: string::String,
    symbol: string::String,
    decimals: u8,
    monitor_supply: bool,
): (BurnCapability<CoinType>, FreezeCapability<CoinType>, MintCapability<CoinType>)
```

**åŠŸèƒ½**ï¼šåˆ›å»ºæ–°ä»£å¸å¹¶è¿”å›æƒé™  
**è°ƒç”¨ä¸€æ¬¡**ï¼šæ¯ä¸ªä»£å¸ç±»å‹åªèƒ½åˆå§‹åŒ–ä¸€æ¬¡  
**è¿”å›**ï¼šä¸‰ä¸ªæƒé™èƒ½åŠ›

**ç¤ºä¾‹**ï¼š
```move
struct MyCoin {}

fun init_module(account: &signer) {
    let (burn_cap, freeze_cap, mint_cap) = coin::initialize<MyCoin>(
        account,
        string::utf8(b"My Coin"),
        string::utf8(b"MYC"),
        8,
        true,  // ç›‘æ§æ€»ä¾›åº”é‡
    );
    
    // ä¿å­˜æƒé™
    move_to(account, Capabilities {
        burn_cap,
        freeze_cap,
        mint_cap,
    });
}
```

### 3.2 æ³¨å†Œè´¦æˆ·

```move
public fun register<CoinType>(account: &signer)
```

**åŠŸèƒ½**ï¼šä¸ºç”¨æˆ·åˆ›å»º CoinStore  
**å¿…é¡»**ï¼šæ¥æ”¶ä»£å¸å‰å¿…é¡»å…ˆæ³¨å†Œ  
**åªéœ€ä¸€æ¬¡**ï¼šæ¯ä¸ªç”¨æˆ·æ¯ç§ä»£å¸æ³¨å†Œä¸€æ¬¡

**ç¤ºä¾‹**ï¼š
```move
public entry fun register_for_my_coin(user: &signer) {
    coin::register<MyCoin>(user);
}
```

### 3.3 è½¬è´¦

```move
public entry fun transfer<CoinType>(
    from: &signer,
    to: address,
    amount: u64,
)
```

**åŠŸèƒ½**ï¼šä» from è½¬è´¦ç»™ to  
**è¦æ±‚**ï¼što å¿…é¡»å·²æ³¨å†Œ  
**åŸå­æ€§**ï¼šå¤±è´¥è‡ªåŠ¨å›æ»š

**ç¤ºä¾‹**ï¼š
```move
// è½¬è´¦ 10 ä¸ª MyCoinï¼ˆå‡è®¾ decimals = 8ï¼‰
coin::transfer<MyCoin>(
    sender,
    @0x123,
    1000000000,  // 10 * 10^8
);
```

### 3.4 æŸ¥è¯¢ä½™é¢

```move
#[view]
public fun balance<CoinType>(owner: address): u64
```

**åŠŸèƒ½**ï¼šæŸ¥è¯¢è´¦æˆ·ä½™é¢  
**å…è´¹**ï¼šview å‡½æ•°ä¸æ¶ˆè€— Gas  
**è¿”å›**ï¼šæœ€å°å•ä½çš„ä½™é¢

**ç¤ºä¾‹**ï¼š
```move
let balance = coin::balance<MyCoin>(@0x123);
// å¦‚æœ balance = 1000000000, decimals = 8
// å®é™…ä½™é¢ = 10 ä¸ªä»£å¸
```

### 3.5 é“¸é€ ä»£å¸

```move
public fun mint<CoinType>(
    amount: u64,
    mint_cap: &MintCapability<CoinType>,
): Coin<CoinType>
```

**åŠŸèƒ½**ï¼šåˆ›å»ºæ–°ä»£å¸  
**éœ€è¦**ï¼šMintCapability  
**è¿”å›**ï¼šCoin å¯¹è±¡

**ç¤ºä¾‹**ï¼š
```move
public fun mint_to_user(
    amount: u64,
    recipient: address,
    mint_cap: &MintCapability<MyCoin>
) acquires CoinStore {
    let coins = coin::mint(amount, mint_cap);
    coin::deposit(recipient, coins);
}
```

### 3.6 é”€æ¯ä»£å¸

```move
public fun burn<CoinType>(
    coin: Coin<CoinType>,
    burn_cap: &BurnCapability<CoinType>,
)
```

**åŠŸèƒ½**ï¼šæ°¸ä¹…é”€æ¯ä»£å¸  
**éœ€è¦**ï¼šBurnCapability  
**ä¸å¯é€†**ï¼šä»£å¸è¢«æ°¸ä¹…ç§»é™¤

---

## ç¬¬å››éƒ¨åˆ†ï¼šå®Œæ•´ç¤ºä¾‹

### 4.1 åˆ›å»ºä»£å¸æ¨¡å—

```move
module my_addr::my_coin {
    use std::signer;
    use std::string;
    use aptos_framework::coin::{Self, MintCapability, BurnCapability};
    
    // ä»£å¸ç±»å‹ï¼ˆæ— èƒ½åŠ›ï¼‰
    struct MyCoin {}
    
    // å­˜å‚¨æƒé™
    struct Capabilities has key {
        mint_cap: MintCapability<MyCoin>,
        burn_cap: BurnCapability<MyCoin>,
    }
    
    // åˆå§‹åŒ–ï¼ˆéƒ¨ç½²æ—¶è‡ªåŠ¨è°ƒç”¨ï¼‰
    fun init_module(account: &signer) {
        let (burn_cap, freeze_cap, mint_cap) = coin::initialize<MyCoin>(
            account,
            string::utf8(b"My Coin"),
            string::utf8(b"MYC"),
            8,  // 8 ä½å°æ•°
            true,
        );
        
        // å­˜å‚¨é“¸é€ å’Œé”€æ¯æƒé™
        move_to(account, Capabilities {
            mint_cap,
            burn_cap,
        });
        
        // å†»ç»“æƒé™å¯ä»¥é”€æ¯æˆ–å­˜å‚¨
        coin::destroy_freeze_cap(freeze_cap);
    }
    
    // ç”¨æˆ·æ³¨å†Œ
    public entry fun register(account: &signer) {
        coin::register<MyCoin>(account);
    }
    
    // é“¸é€ ä»£å¸
    public entry fun mint(
        admin: &signer,
        recipient: address,
        amount: u64
    ) acquires Capabilities {
        let admin_addr = signer::address_of(admin);
        let caps = borrow_global<Capabilities>(admin_addr);
        
        let coins = coin::mint(amount, &caps.mint_cap);
        coin::deposit(recipient, coins);
    }
    
    // è½¬è´¦
    public entry fun transfer(
        from: &signer,
        to: address,
        amount: u64
    ) {
        coin::transfer<MyCoin>(from, to, amount);
    }
    
    // æŸ¥è¯¢ä½™é¢
    #[view]
    public fun balance(addr: address): u64 {
        coin::balance<MyCoin>(addr)
    }
}
```

### 4.2 ä½¿ç”¨æµç¨‹

```move
// 1. éƒ¨ç½²æ¨¡å—ï¼ˆè‡ªåŠ¨è°ƒç”¨ init_moduleï¼‰
aptos move publish

// 2. ç”¨æˆ·æ³¨å†Œ
my_coin::register(user)

// 3. ç®¡ç†å‘˜é“¸é€ 
my_coin::mint(admin, user_addr, 100_00000000)  // 100 ä¸ªå¸

// 4. ç”¨æˆ·è½¬è´¦
my_coin::transfer(user1, user2_addr, 10_00000000)  // 10 ä¸ªå¸

// 5. æŸ¥è¯¢ä½™é¢
my_coin::balance(user_addr)
```

---

## ç¬¬äº”éƒ¨åˆ†ï¼šé«˜çº§ä¸»é¢˜

### 5.1 Phantom ç±»å‹å‚æ•°

```move
struct MintCapability<phantom CoinType> has key, store {}
```

**phantom** å…³é”®å­—è¡¨ç¤º CoinType åªç”¨äºç±»å‹æ ‡è¯†ï¼Œä¸å­˜å‚¨å®é™…æ•°æ®ã€‚

**å¥½å¤„**ï¼š
- ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥
- ä¸å¢åŠ å­˜å‚¨æˆæœ¬
- é˜²æ­¢ç±»å‹æ··æ·†

### 5.2 ç®¡ç†ä»£å¸ï¼ˆManaged Coinï¼‰

Aptos æä¾›äº† `managed_coin` æ¨¡å—ç®€åŒ–ä»£å¸åˆ›å»ºï¼š

```move
use aptos_framework::managed_coin;

public entry fun initialize(account: &signer) {
    managed_coin::initialize<MyCoin>(
        account,
        b"My Coin",
        b"MYC",
        8,
        true,
    );
}

public entry fun register(account: &signer) {
    managed_coin::register<MyCoin>(account);
}

public entry fun mint(
    account: &signer,
    dst_addr: address,
    amount: u64,
) {
    managed_coin::mint<MyCoin>(account, dst_addr, amount);
}
```

**ä¼˜ç‚¹**ï¼šä»£ç æ›´ç®€æ´  
**ç¼ºç‚¹**ï¼šçµæ´»æ€§è¾ƒä½

### 5.3 Fungible Asset vs Coin

Aptos ç°åœ¨æ¨èä½¿ç”¨æ–°çš„ **Fungible Asset** æ ‡å‡†ï¼š

| ç‰¹æ€§ | Coin | Fungible Asset |
|------|------|----------------|
| å‘å¸ƒæ—¶é—´ | æ—©æœŸ | æ–°ç‰ˆæœ¬ |
| çµæ´»æ€§ | ä¸­ç­‰ | é«˜ |
| å…ƒæ•°æ® | æœ‰é™ | ä¸°å¯Œ |
| æœªæ¥æ”¯æŒ | ç»´æŠ¤ | æ¨è |

**å»ºè®®**ï¼š
- æ–°é¡¹ç›®ï¼šä½¿ç”¨ Fungible Asset
- å·²æœ‰é¡¹ç›®ï¼šç»§ç»­ä½¿ç”¨ Coin
- å­¦ä¹ ï¼šä¸¤è€…éƒ½äº†è§£

---

## ç¬¬å…­éƒ¨åˆ†ï¼šæœ€ä½³å®è·µ

### 6.1 ä»£å¸è®¾è®¡æ¸…å•

**åŸºæœ¬ä¿¡æ¯**
- [ ] é€‰æ‹©åˆé€‚çš„åç§°å’Œç¬¦å·
- [ ] ç¡®å®šå°æ•°ä½æ•°ï¼ˆ6-8 ä½å¸¸è§ï¼‰
- [ ] å†³å®šæ˜¯å¦è¿½è¸ªæ€»ä¾›åº”é‡

**æƒé™ç®¡ç†**
- [ ] å†³å®šè°æŒæœ‰é“¸é€ æƒé™
- [ ] æ˜¯å¦éœ€è¦é”€æ¯åŠŸèƒ½
- [ ] æ˜¯å¦éœ€è¦å†»ç»“åŠŸèƒ½
- [ ] å¦‚ä½•è½¬ç§»æˆ–é”€æ¯æƒé™

**å®‰å…¨è€ƒè™‘**
- [ ] å®ç°è®¿é—®æ§åˆ¶
- [ ] é˜²æ­¢æ•´æ•°æº¢å‡º
- [ ] è€ƒè™‘å‡çº§æœºåˆ¶
- [ ] å®¡è®¡ä»£ç 

### 6.2 ç²¾åº¦è®¡ç®—

```move
// äººç±»å¯è¯» â†’ æœ€å°å•ä½
fun to_units(amount: u64, decimals: u8): u64 {
    amount * pow(10, decimals)
}

// æœ€å°å•ä½ â†’ äººç±»å¯è¯»
fun from_units(units: u64, decimals: u8): u64 {
    units / pow(10, decimals)
}

// ç¤ºä¾‹ï¼š8 ä½å°æ•°
let one_token = 100000000;  // 1.0
let half_token = 50000000;  // 0.5
let tenth = 10000000;       // 0.1
```

### 6.3 å®‰å…¨è½¬è´¦æ¨¡å¼

```move
// âŒ ä¸å®‰å…¨ï¼šæœªæ£€æŸ¥æ¥æ”¶æ–¹æ˜¯å¦æ³¨å†Œ
public fun unsafe_transfer(from: &signer, to: address, amount: u64) {
    coin::transfer<MyCoin>(from, to, amount);  // å¯èƒ½å¤±è´¥
}

// âœ“ å®‰å…¨ï¼šè‡ªåŠ¨æ³¨å†Œ
public fun safe_transfer(from: &signer, to: address, amount: u64) {
    if (!coin::is_account_registered<MyCoin>(to)) {
        coin::register<MyCoin>(&create_signer(to));  // éœ€è¦ç‰¹æ®Šæƒé™
    };
    coin::transfer<MyCoin>(from, to, amount);
}

// âœ“ æ›´å¥½ï¼šæå–åå­˜å…¥
public fun deposit_transfer(from: &signer, to: address, amount: u64) {
    let coin = coin::withdraw<MyCoin>(from, amount);
    coin::deposit(to, coin);  // deposit ä¼šè‡ªåŠ¨æ£€æŸ¥
}
```

---

## ç¬¬ä¸ƒéƒ¨åˆ†ï¼šå¸¸è§é—®é¢˜

### Q1: å¦‚ä½•ç¡®å®šå°æ•°ä½æ•°ï¼Ÿ
**A**: æ ¹æ®ç”¨é€”é€‰æ‹©ï¼š
- ç¨³å®šå¸ï¼š6-8 ä½ï¼ˆUSDC ç”¨ 6 ä½ï¼‰
- æ²»ç†ä»£å¸ï¼š8 ä½
- æ¸¸æˆè´§å¸ï¼š0-2 ä½

### Q2: æ€»ä¾›åº”é‡å¯ä»¥ä¿®æ”¹å—ï¼Ÿ
**A**: å–å†³äºè®¾è®¡ï¼š
- å›ºå®šä¾›åº”ï¼šåˆå§‹åŒ–æ—¶é“¸é€ å…¨éƒ¨ï¼Œç„¶åé”€æ¯ MintCapability
- é€šèƒ€ï¼šä¿ç•™ MintCapabilityï¼Œå®šæœŸé“¸é€ 
- é€šç¼©ï¼šä½¿ç”¨ BurnCapability é”€æ¯

### Q3: å¦‚ä½•å®ç°ä»£å¸å‡çº§ï¼Ÿ
**A**: Move æ¨¡å—ä¸å¯å˜ï¼Œä½†å¯ä»¥ï¼š
- è¿ç§»åˆ°æ–°ä»£å¸ï¼ˆæä¾›å…‘æ¢åˆçº¦ï¼‰
- ä½¿ç”¨ä»£ç†æ¨¡å¼ï¼ˆå¤æ‚ï¼‰
- æå‰è®¾è®¡å¯é…ç½®å‚æ•°

### Q4: ä¸ Solidity æœ€å¤§çš„åŒºåˆ«ï¼Ÿ
**A**: 
- Moveï¼šä½™é¢å­˜å‚¨åœ¨ç”¨æˆ·è´¦æˆ·
- Solidityï¼šä½™é¢å­˜å‚¨åœ¨åˆçº¦æ˜ å°„

### Q5: å¦‚ä½•é˜²æ­¢åŒèŠ±ï¼Ÿ
**A**: Move çš„èµ„æºæ¨¡å‹ä»è¯­è¨€å±‚é¢é˜²æ­¢ï¼Œä»£å¸ä¸èƒ½è¢«å¤åˆ¶ã€‚

---

## ğŸ’¡ å…³é”®è¦ç‚¹æ€»ç»“

1. **ç±»å‹ç³»ç»Ÿ**ï¼šæ³›å‹ç¡®ä¿ç±»å‹å®‰å…¨
2. **èµ„æºæ¨¡å‹**ï¼šä»£å¸ä¸å¯å¤åˆ¶ï¼Œè‡ªåŠ¨é˜²åŒèŠ±
3. **æƒé™åˆ†ç¦»**ï¼šé“¸é€ ã€é”€æ¯ã€å†»ç»“æƒé™ç‹¬ç«‹
4. **æ³¨å†Œæœºåˆ¶**ï¼šç”¨æˆ·éœ€å…ˆæ³¨å†Œæ‰èƒ½æ¥æ”¶ä»£å¸
5. **ç²¾åº¦å¤„ç†**ï¼šå­˜å‚¨æœ€å°å•ä½ï¼Œæ˜¾ç¤ºæ—¶è½¬æ¢

---

**ä¸‹ä¸€æ­¥**ï¼šå­¦ä¹ ä»£ç ç¤ºä¾‹ï¼Œç„¶åå®Œæˆå®è·µä»»åŠ¡ï¼ğŸš€
