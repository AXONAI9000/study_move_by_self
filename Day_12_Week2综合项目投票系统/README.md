# Day 12: Week 2 综合项目 - 投票系统

## 📚 学习目标

今天你将完成 Week 2 的综合项目，整合本周所学的所有知识：
- 综合运用泛型、能力系统、全局存储
- 实现事件系统和错误处理
- 使用标准库的高级数据结构
- 构建完整的链上投票 DApp
- 体验从设计到部署的完整流程

## 🎯 为什么重要

投票系统是 DAO 治理的核心，也是 Web3 项目的重要组成部分：
- **实战价值**：掌握投票机制是开发 DeFi 协议的基础
- **知识综合**：融合了本周学习的所有高级特性
- **真实应用**：Aptos 生态的许多项目都需要治理模块
- **技能证明**：完成这个项目意味着你已掌握 Move 中级技能

**真实案例**：
- Aptos DAO 使用链上投票管理协议参数
- Liquidswap 通过投票决定新交易对的添加
- Thala 使用投票系统进行协议升级

## 📖 今日课程安排

这是一个综合项目日，时间分配与平常不同：

1. **系统设计**（1.5 小时）
   - 阅读 `01_理论学习/核心概念.md`
   - 理解投票系统架构
   - 设计数据结构和流程
   
2. **核心开发**（4 小时）
   - 完成 `02_实践任务/任务说明.md` 中的投票系统
   - 实现提案创建、投票、执行功能
   - 添加事件和错误处理
   
3. **测试与部署**（1.5 小时）
   - 编写单元测试
   - 本地测试验证
   - 部署到测试网
   
4. **项目总结**（1 小时）
   - 完成每日考试
   - 总结 Week 2 学习成果
   - 规划 Week 3 学习

## 🎓 Week 2 知识回顾

本周你学习了以下内容，今天将全部用到：

### Day 06: 泛型与能力系统
- ✅ 泛型结构体和函数
- ✅ copy, drop, store, key 能力
- ✅ Hot Potato 模式

### Day 07: 全局存储与资源管理
- ✅ move_to, borrow_global, move_from
- ✅ acquires 关键字
- ✅ 资源生命周期管理

### Day 08: 事件系统
- ✅ Event 声明和发射
- ✅ EventHandle 使用
- ✅ 链下索引

### Day 09: 错误处理
- ✅ assert! 和 abort
- ✅ 错误码设计
- ✅ 自定义错误类型

### Day 10: Move Prover
- ✅ 规约编写
- ✅ 不变量验证
- ✅ 前后置条件

### Day 11: 标准库
- ✅ vector, Table, SmartTable
- ✅ option, string 模块
- ✅ 性能优化

## 📋 项目需求概述

你将实现一个功能完整的链上投票系统，包括：

### 核心功能
1. **提案管理**
   - 创建提案（标题、描述、投票期限）
   - 查询提案状态
   - 提案生命周期管理

2. **投票机制**
   - 支持赞成/反对/弃权
   - 一人一票机制
   - 投票权重（可选）

3. **执行机制**
   - 投票结束后统计结果
   - 自动执行通过的提案
   - 时间锁机制

4. **治理代币（可选）**
   - 基于代币数量的投票权
   - 投票锁定机制

### 技术要求
- ✅ 使用泛型支持不同类型的提案
- ✅ 使用能力系统保证资源安全
- ✅ 发射事件记录所有关键操作
- ✅ 完善的错误处理和断言
- ✅ 使用 Table/SmartTable 存储数据
- ✅ 使用 option 处理可选值

## 🏗️ 系统架构

```
投票系统
├── 提案模块 (Proposal)
│   ├── 创建提案
│   ├── 查询提案
│   └── 提案状态管理
├── 投票模块 (Voting)
│   ├── 投票
│   ├── 查询投票结果
│   └── 统计票数
├── 执行模块 (Execution)
│   ├── 提案执行
│   ├── 时间锁
│   └── 权限验证
└── 治理模块 (Governance)
    ├── 参数配置
    ├── 权限管理
    └── 升级机制
```

## 🎯 完成标准

### 基础版（必须完成）
- [ ] 实现提案的创建、查询功能
- [ ] 实现投票功能（赞成/反对/弃权）
- [ ] 实现一人一票机制
- [ ] 发射事件记录操作
- [ ] 完善的错误处理
- [ ] 通过所有单元测试
- [ ] 成功部署到测试网

### 进阶版（可选挑战）
- [ ] 基于代币的投票权重
- [ ] 委托投票功能
- [ ] 时间锁执行机制
- [ ] 提案取消功能
- [ ] 投票历史查询
- [ ] 提案类型系统（使用泛型）

### 专家版（挑战）
- [ ] 多重签名提案
- [ ] 动态投票期限
- [ ] 链下投票验证
- [ ] 完整的前端界面

## 💡 开发建议

### 1. 分步实现
不要一次性实现所有功能，建议顺序：
1. 先实现简单的提案数据结构
2. 再实现基本的投票功能
3. 然后添加事件和错误处理
4. 最后优化和添加高级功能

### 2. 测试驱动
每实现一个功能就立即测试：
```bash
aptos move test
```

### 3. 参考真实项目
学习开源项目的实现：
- [Aptos DAO](https://github.com/aptos-labs/aptos-core/tree/main/aptos-move/move-examples/dao)
- [Thala Governance](https://github.com/ThalaLabs)

### 4. 使用 Move Prover（可选）
为关键函数添加规约：
```move
spec vote {
    ensures proposal.yes_votes == old(proposal.yes_votes) + 1;
}
```

## 📊 评分标准

### 代码质量（40分）
- 代码结构清晰：10分
- 命名规范：5分
- 注释完整：10分
- 错误处理：15分

### 功能完整性（30分）
- 提案管理：10分
- 投票功能：10分
- 事件系统：10分

### 测试（20分）
- 单元测试覆盖：15分
- 测试用例质量：5分

### 创新性（10分）
- 额外功能：5分
- 优化设计：5分

**总分 70 分以上为通过**

## 🔧 开发环境

### 初始化项目
```bash
cd Day_12_Week2综合项目投票系统
aptos move compile
```

### 运行测试
```bash
aptos move test
```

### 部署到测试网
```bash
aptos init
aptos move publish
```

## 📚 参考资源

### 官方文档
- [Aptos Move Book](https://aptos.dev/move/book/)
- [Governance Best Practices](https://aptos.dev/guides/move-guides/)

### 示例项目
- [Aptos DAO Example](https://github.com/aptos-labs/aptos-core/tree/main/aptos-move/move-examples/dao)
- [Simple Voting](https://github.com/aptos-labs/aptos-core/tree/main/aptos-move/move-examples)

### 社区资源
- [Aptos Discord](https://discord.gg/aptoslabs)
- [Move Developers Forum](https://forum.aptoslabs.com/)

## ⚠️ 常见陷阱

1. **时间戳处理**
   - 使用 `aptos_framework::timestamp::now_seconds()`
   - 注意时间戳单位是秒

2. **投票权限**
   - 确保一个地址只能投票一次
   - 使用 Table 记录已投票地址

3. **提案状态**
   - 正确管理提案的生命周期
   - Pending → Active → Succeeded/Defeated → Executed

4. **整数溢出**
   - 投票数量累加时注意溢出
   - 使用适当的数据类型

5. **资源管理**
   - 确保提案资源正确存储
   - 避免资源泄漏

## 🎯 Week 2 总结

### 本周成就
完成 Week 2 后，你已经：
- ✅ 掌握了 Move 的高级特性
- ✅ 理解了泛型和能力系统
- ✅ 学会了使用标准库
- ✅ 能够设计和实现复杂的 DApp
- ✅ 具备了开发 DeFi 协议的基础

### 技能检查清单
- [ ] 能够使用泛型设计可复用的代码
- [ ] 理解四种能力的作用和限制
- [ ] 能够正确管理全局存储资源
- [ ] 会使用事件系统记录链上活动
- [ ] 能够设计清晰的错误处理机制
- [ ] 熟练使用 vector、Table、SmartTable
- [ ] 能够独立完成中等复杂度的项目

### Week 3 预告

下周你将进入 **DeFi 核心协议** 的学习：
- **Day 13**: Fungible Token 标准（Coin Framework）
- **Day 14**: 代币管理功能
- **Day 15**: AMM 原理与恒定乘积公式
- **Day 16**: 简单 DEX - 流动性池
- **Day 17**: DEX - 交换功能
- **Day 18**: 价格预言机集成
- **Day 19**: Week 3 综合项目 - 完整 DEX

开始构建真实的金融产品！💰

## 💰 变现提示

完成这个投票系统后，你可以：
1. **开源项目**：发布到 GitHub，建立个人品牌
2. **NFT 项目**：为 NFT 社区提供治理功能
3. **DAO 服务**：帮助项目搭建治理系统（$1000-$5000/项目）
4. **教学内容**：制作教程视频赚取收益

## 📝 提交检查清单

提交前确认：
- [ ] 所有代码都有注释
- [ ] 通过 `aptos move test`
- [ ] 通过 `aptos move compile`
- [ ] 完成每日考试
- [ ] 编写了 README 说明使用方法
- [ ] （可选）部署到测试网并记录地址

---

**预计学习时间**：8 小时  
**难度等级**：⭐⭐⭐⭐☆  
**重要程度**：⭐⭐⭐⭐⭐

这是 Week 2 的巅峰挑战！完成它，你就正式迈入 Move 高级开发者行列！🚀💪

**Let's build something amazing!** 🎉
