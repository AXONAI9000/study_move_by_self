# Day 31 æ¯æ—¥è€ƒè¯• - ç­”æ¡ˆè§£æ

## ğŸ“ é€‰æ‹©é¢˜ç­”æ¡ˆ

### ç¬¬ 1 é¢˜
**æ­£ç¡®ç­”æ¡ˆ**ï¼šB

**è§£æ**ï¼š
é—ªç”µè´·çš„æ ¸å¿ƒç‰¹å¾æ˜¯**åŸå­æ€§**ï¼Œå³å€Ÿæ¬¾å’Œè¿˜æ¬¾å¿…é¡»åœ¨åŒä¸€ä¸ªäº¤æ˜“ä¸­å®Œæˆã€‚è¿™æ˜¯é€šè¿‡ Hot Potato æ¨¡å¼åœ¨ç¼–è¯‘æ—¶å¼ºåˆ¶æ‰§è¡Œçš„ã€‚

- Aé”™è¯¯ï¼šé—ªç”µè´·æ— éœ€ä»»ä½•æŠµæŠ¼
- Cé”™è¯¯ï¼šå¿…é¡»åœ¨åŒä¸€äº¤æ˜“ä¸­å½’è¿˜
- Dé”™è¯¯ï¼šéœ€è¦æ”¯ä»˜æ‰‹ç»­è´¹ï¼ˆé€šå¸¸0.05%-0.3%ï¼‰

---

### ç¬¬ 2 é¢˜
**æ­£ç¡®ç­”æ¡ˆ**ï¼šD

**è§£æ**ï¼š
Hot Potato çš„å…³é”®ç‰¹å¾æ˜¯**ä¸å…·æœ‰ä»»ä½•èƒ½åŠ›**ï¼ˆno abilitiesï¼‰ã€‚è¿™æ„å‘³ç€ï¼š
- âŒ ä¸èƒ½å¤åˆ¶ï¼ˆno copyï¼‰
- âŒ ä¸èƒ½ä¸¢å¼ƒï¼ˆno dropï¼‰
- âŒ ä¸èƒ½å­˜å‚¨ï¼ˆno storeï¼‰
- âŒ ä¸èƒ½ä½œä¸ºé”®ï¼ˆno keyï¼‰

æ­£å› å¦‚æ­¤ï¼ŒHot Potato å¿…é¡»è¢«æ˜¾å¼å¤„ç†ï¼ˆè§£æ„ï¼‰ï¼Œä»è€Œåœ¨ç¼–è¯‘æ—¶å¼ºåˆ¶æ‰§è¡Œå½’è¿˜é€»è¾‘ã€‚

---

### ç¬¬ 3 é¢˜
**æ­£ç¡®ç­”æ¡ˆ**ï¼šC

**è§£æ**ï¼š
ç”±äº FlashLoan æ²¡æœ‰ `drop` èƒ½åŠ›ï¼Œ**ä¸èƒ½ç›´æ¥å¿½ç•¥ï¼ˆä¸¢å¼ƒï¼‰**ã€‚å¦‚æœå°è¯•å¿½ç•¥ï¼Œä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯ã€‚

å…è®¸çš„æ“ä½œï¼š
- âœ… A: ä¼ é€’ç»™å‡½æ•°ï¼ˆå¯ä»¥ç§»åŠ¨ï¼‰
- âœ… B: ä»å‡½æ•°è¿”å›ï¼ˆå¯ä»¥ç§»åŠ¨ï¼‰
- âœ… D: è§£æ„è·å–å­—æ®µï¼ˆè¿™æ˜¯å”¯ä¸€æ¶ˆè´¹å®ƒçš„æ–¹å¼ï¼‰

---

### ç¬¬ 4 é¢˜
**æ­£ç¡®ç­”æ¡ˆ**ï¼šC

**è§£æ**ï¼š
```
å€Ÿæ¬¾é‡‘é¢ = 10,000 USDC
æ‰‹ç»­è´¹ç‡ = 0.3% = 0.003
æ‰‹ç»­è´¹ = 10,000 Ã— 0.003 = 30 USDC
æ€»å½’è¿˜ = 10,000 + 30 = 10,030 USDC
```

---

### ç¬¬ 5 é¢˜
**æ­£ç¡®ç­”æ¡ˆ**ï¼šABD

**è§£æ**ï¼š
é—ªç”µè´·çš„å…¸å‹åº”ç”¨åœºæ™¯ï¼š
- âœ… A: å¥—åˆ©äº¤æ˜“ - åˆ©ç”¨ä»·å·®è·åˆ©
- âœ… B: æ¸…ç®—ä¸è‰¯å€ºåŠ¡ - æ— éœ€è‡ªæœ‰èµ„é‡‘
- âœ… D: æŠµæŠ¼å“äº’æ¢ - æ— ç¼åˆ‡æ¢æŠµæŠ¼å“ç±»å‹

ä¸é€‚åˆçš„åœºæ™¯ï¼š
- âŒ C: é•¿æœŸæŠ•èµ„ - å¿…é¡»åœ¨åŒä¸€äº¤æ˜“å½’è¿˜
- âŒ E: æ—¥å¸¸å¼€é”€ - æˆæœ¬å¤ªé«˜ï¼Œä¸é€‚ç”¨

---

### ç¬¬ 6 é¢˜
**æ­£ç¡®ç­”æ¡ˆ**ï¼šB

**è§£æ**ï¼š
ç”±äº FlashLoan æ²¡æœ‰ `drop` èƒ½åŠ›ï¼Œå®ƒ**ä¸èƒ½è¢«å¿½ç•¥**ã€‚Move ç¼–è¯‘å™¨ä¼šæ£€æµ‹åˆ° `flash_loan` å‚æ•°æœªè¢«ä½¿ç”¨ï¼ˆæœªè¢«è§£æ„æˆ–ä¼ é€’ï¼‰ï¼Œäº§ç”Ÿç¼–è¯‘é”™è¯¯ï¼š

```
error: unused value without 'drop' ability
```

è¿™æ­£æ˜¯ Hot Potato æ¨¡å¼çš„ç¼–è¯‘æ—¶å®‰å…¨ä¿è¯ï¼

---

### ç¬¬ 7 é¢˜
**æ­£ç¡®ç­”æ¡ˆ**ï¼šC

**è§£æ**ï¼š
é—ªç”µè´·å¯¹åè®®æ— é£é™©çš„åŸå› æ˜¯**äº¤æ˜“çš„åŸå­æ€§**ï¼š
- å¦‚æœå€Ÿæ¬¾äººæœªèƒ½åœ¨åŒä¸€äº¤æ˜“ä¸­å½’è¿˜è¶³é¢èµ„é‡‘
- æ•´ä¸ªäº¤æ˜“ä¼šè¢«åŒºå—é“¾å›æ»š
- å°±åƒä»æœªå‘ç”Ÿè¿‡ä¸€æ ·
- åè®®çš„èµ„é‡‘ä»æœªçœŸæ­£ç¦»å¼€è¿‡

è¿™æ˜¯åŒºå—é“¾çš„çŠ¶æ€å›æ»šæœºåˆ¶æä¾›çš„ä¿è¯ã€‚

---

### ç¬¬ 8 é¢˜
**æ­£ç¡®ç­”æ¡ˆ**ï¼šB

**è§£æ**ï¼š
æ’å®šä¹˜ç§¯ AMM çš„å…¬å¼æ¨å¯¼ï¼š

```
åŸºç¡€å…¬å¼ï¼šx Ã— y = k

è¾“å…¥ Î”xï¼Œè¾“å‡º Î”yï¼š
(x + Î”x) Ã— (y - Î”y) = k

å±•å¼€ï¼š
xÃ—y + Î”xÃ—y - xÃ—Î”y - Î”xÃ—Î”y = xÃ—y

ç®€åŒ–ï¼ˆå¿½ç•¥ Î”xÃ—Î”y å°é‡ï¼‰ï¼š
Î”y = (Î”x Ã— y) / (x + Î”x)

è€ƒè™‘ 0.3% æ‰‹ç»­è´¹ï¼ˆå®é™…äº¤æ˜“é‡ä¸º 99.7%ï¼‰ï¼š
Î”y = (Î”x Ã— 0.997 Ã— y) / (x + Î”x Ã— 0.997)
```

---

### ç¬¬ 9 é¢˜
**æ­£ç¡®ç­”æ¡ˆ**ï¼šD

**è§£æ**ï¼š
è®¡ç®—ç›ˆäºå¹³è¡¡ç‚¹ï¼š

```
ä»·å·® = 10.5 - 10 = 0.5 USDC/APT = 5%
æ€»æ‰‹ç»­è´¹ = 0.3% (é—ªç”µè´·) + 0.3% (DEX A) + 0.3% (DEX B) = 0.9%
å‡€ä»·å·® = 5% - 0.9% = 4.1%
```

ç”±äºå‡€ä»·å·®ä¸ºæ­£ï¼ˆ4.1% > 0ï¼‰ï¼Œæ‰€æœ‰é‡‘é¢éƒ½ä¼šç›ˆåˆ©ã€‚é‡‘é¢è¶Šå¤§ï¼Œç»å¯¹åˆ©æ¶¦è¶Šé«˜ã€‚

---

### ç¬¬ 10 é¢˜
**æ­£ç¡®ç­”æ¡ˆ**ï¼šACD

**è§£æ**ï¼š
æœ‰æ•ˆçš„é˜²æŠ¤æ–¹æ³•ï¼š
- âœ… A: TWAP - é˜²æ­¢å³æ—¶ä»·æ ¼æ“çºµ
- âœ… C: å¤šæºä»·æ ¼èšåˆ - å‡å°‘å•ç‚¹ä¾èµ–
- âœ… D: ä»£å¸é”å®šæœŸ - é˜²æ­¢é—ªç”µè´·æ²»ç†æ”»å‡»

æ— æ•ˆæˆ–ä¸åˆç†çš„æ–¹æ³•ï¼š
- âŒ B: å®Œå…¨ç¦æ­¢é—ªç”µè´· - å› å™åºŸé£Ÿï¼Œé—ªç”µè´·æœ¬èº«æœ‰ä»·å€¼
- âŒ E: 50%æ‰‹ç»­è´¹ - è¿‡é«˜ï¼Œä¼šæ‰¼æ€æ‰€æœ‰åˆç†ç”¨é€”

---

### ç¬¬ 11 é¢˜
**æ­£ç¡®ç­”æ¡ˆ**ï¼šC

**è§£æ**ï¼š
ä¸‰è§’å¥—åˆ©åŸç†ï¼š

```
é€šè¿‡ BTC è®¡ç®— APT çš„ç†è®ºä»·æ ¼ï¼š
å¦‚æœ APT/BTC = 0.0005ï¼ŒBTC/USDC = 20,000
åˆ™ APT/USDC ç†è®ºä»·æ ¼ = 0.0005 Ã— 20,000 = 10 USDC

å¥—åˆ©è·¯å¾„ï¼š
USDC â†’ (ä¾¿å®œçš„) APT â†’ BTC â†’ USDC

æ‰€ä»¥éœ€è¦ï¼šAPT/USDC æ± ä»·æ ¼ < ç†è®ºä»·æ ¼
```

å³é€‰é¡¹ C æ­£ç¡®ã€‚

---

### ç¬¬ 12 é¢˜
**æ­£ç¡®ç­”æ¡ˆ**ï¼šB

**è§£æ**ï¼š

```move
// A - é”™è¯¯ï¼šæ¡ä»¶åˆ†æ”¯æœªè¦†ç›–æ‰€æœ‰æƒ…å†µ
// å¦‚æœ some_condition = falseï¼Œflash_loan æœªè¢«å¤„ç†
public fun example_a(flash_loan: FlashLoan) {
    if (some_condition) {
        let FlashLoan { amount, fee } = flash_loan;
    }  // else åˆ†æ”¯ç¼ºå¤±ï¼ç¼–è¯‘é”™è¯¯
}

// B - æ­£ç¡®ï¼šè§£æ„ Hot Potato
public fun example_b(flash_loan: FlashLoan) {
    let FlashLoan { amount, fee } = flash_loan;
    // âœ… flash_loan è¢«æ¶ˆè´¹
}

// C - é”™è¯¯ï¼šè¯•å›¾å¤åˆ¶ Hot Potato
// FlashLoan æ²¡æœ‰ copy èƒ½åŠ›
public fun example_c(flash_loan: FlashLoan) {
    let copy = flash_loan;  // âŒ è¿™æ˜¯ç§»åŠ¨ï¼Œä¸æ˜¯å¤åˆ¶
    let FlashLoan { amount, fee } = flash_loan;  // âŒ flash_loan å·²è¢«ç§»åŠ¨
}
```

---

### ç¬¬ 13 é¢˜
**æ­£ç¡®ç­”æ¡ˆ**ï¼šB

**è§£æ**ï¼š
æ¸…ç®—æœºåˆ¶é€šå¸¸ç»™äºˆæ¸…ç®—äººé¢å¤–å¥–åŠ±ï¼š

```
åŸå§‹æŠµæŠ¼å“ = 10 ETH
æ¸…ç®—å¥–åŠ± = 10%
è·å¾—æŠµæŠ¼å“ = 10 ETH Ã— (1 + 10%) = 11 ETH
```

æ¸…ç®—äººæ”¯ä»˜ 50,000 USDCï¼Œè·å¾—ä»·å€¼ 55,000 USDC çš„ 11 ETHã€‚
æ‰£é™¤é—ªç”µè´·æ‰‹ç»­è´¹ 150 USDCï¼Œå‡€åˆ©æ¶¦çº¦ 4,850 USDCã€‚

---

### ç¬¬ 14 é¢˜
**æ­£ç¡®ç­”æ¡ˆ**ï¼šB

**è§£æ**ï¼š
å…³é”®çš„ä¸å˜é‡æ˜¯ï¼š**å½’è¿˜åä½™é¢è‡³å°‘å¢åŠ æ‰‹ç»­è´¹é‡‘é¢**

```move
assert!(balance_after >= balance_before + flash_loan.fee);
```

ä¸ºä»€ä¹ˆï¼Ÿ
- å€Ÿæ¬¾æ—¶æå–äº† `amount`ï¼Œä½™é¢å‡å°‘
- å½’è¿˜æ—¶åº”è¿˜ `amount + fee`ï¼Œä½™é¢åº”å¢åŠ  `fee`
- å¦‚æœä½™é¢å¢åŠ å°‘äº `fee`ï¼Œè¯´æ˜å½’è¿˜ä¸è¶³

å…¶ä»–é€‰é¡¹ï¼š
- Aé”™è¯¯ï¼šä½™é¢åº”è¯¥å¢åŠ ï¼Œä¸æ˜¯ç›¸ç­‰
- Cé”™è¯¯ï¼šä¸å¤Ÿå…·ä½“
- Dé”™è¯¯ï¼šåº”è¯¥å¢åŠ  `fee`ï¼Œä¸æ˜¯ `amount`

---

### ç¬¬ 15 é¢˜
**æ­£ç¡®ç­”æ¡ˆ**ï¼šABE

**è§£æ**ï¼š
é—ªç”µè´·æ‰‹ç»­è´¹çš„ä½œç”¨ï¼š
- âœ… A: ä¸ºæµåŠ¨æ€§æä¾›è€…åˆ›é€ æ”¶ç›Š - æ¿€åŠ±æä¾›æµåŠ¨æ€§
- âœ… B: é˜²æ­¢åƒåœ¾äº¤æ˜“ - å¢åŠ æ”»å‡»æˆæœ¬
- âœ… E: ä½œä¸ºåè®®æ”¶å…¥æ¥æº - å¯æŒç»­å‘å±•

ä¸æ˜¯æ‰‹ç»­è´¹çš„ä½œç”¨ï¼š
- âŒ C: é—ªç”µè´·æœ¬èº«å¯¹åè®®æ— é£é™©ï¼ˆäº¤æ˜“å›æ»šï¼‰
- âŒ D: å€Ÿæ¬¾é‡‘é¢ä»…å—æµåŠ¨æ€§é™åˆ¶

---

### ç¬¬ 16 é¢˜
**æ­£ç¡®ç­”æ¡ˆ**ï¼šC

**è§£æ**ï¼š
æœ€å¥½çš„ç­–ç•¥æ˜¯**ä»å¤šä¸ªæ± å­åˆ†æ‹†å€Ÿæ¬¾**ï¼š

```
éœ€è¦ï¼š100,000 USDC
æ± å­ Aï¼š60,000 USDC å¯ç”¨
æ± å­ Bï¼š50,000 USDC å¯ç”¨

æ–¹æ¡ˆï¼š
- ä»æ± å­ A å€Ÿ 60,000
- ä»æ± å­ B å€Ÿ 40,000
- æ€»è®¡ï¼š100,000 âœ…
```

è¿™å°±æ˜¯é—ªç”µè´·èšåˆå™¨çš„ä»·å€¼æ‰€åœ¨ï¼

---

### ç¬¬ 17 é¢˜
**æ­£ç¡®ç­”æ¡ˆ**ï¼šD

**è§£æ**ï¼š
é—ªç”µè´·çš„é™åˆ¶ï¼š**å¿…é¡»åœ¨åŒä¸€äº¤æ˜“ä¸­å½’è¿˜**

æ‰€ä»¥ä¸é€‚åˆï¼š
- âŒ D: é•¿æœŸæŒæœ‰ä»£å¸ - æ— æ³•åœ¨åŒä¸€äº¤æ˜“å½’è¿˜

é€‚åˆçš„åœºæ™¯ï¼ˆæ‰€æœ‰æ“ä½œåœ¨åŒä¸€äº¤æ˜“å®Œæˆï¼‰ï¼š
- âœ… A: å¥—åˆ© - å€Ÿâ†’æ¢â†’æ¢â†’è¿˜
- âœ… B: æ¸…ç®— - å€Ÿâ†’æ¸…ç®—â†’å–â†’è¿˜
- âœ… C: äº’æ¢æŠµæŠ¼å“ - å€Ÿâ†’è¿˜æ—§å€ºâ†’æ¢å¸â†’æŠµæŠ¼â†’å€Ÿæ–°å¸â†’è¿˜é—ªç”µè´·

---

### ç¬¬ 18 é¢˜
**æ­£ç¡®ç­”æ¡ˆ**ï¼šB

**è§£æ**ï¼š
ä½¿ç”¨åŸºç‚¹ï¼ˆbasis pointsï¼‰çš„åŸå› æ˜¯**é¿å…æµ®ç‚¹æ•°**ï¼š

```
é—®é¢˜ï¼šåŒºå—é“¾ä¸Šæ²¡æœ‰æµ®ç‚¹æ•°

âŒ æµ®ç‚¹æ•°å†™æ³•ï¼ˆä¸å¯è¡Œï¼‰ï¼š
fee_rate = 0.003  // 0.3%
fee = amount * 0.003

âœ… åŸºç‚¹å†™æ³•ï¼ˆå¯è¡Œï¼‰ï¼š
fee_rate = 30  // 30 åŸºç‚¹ = 0.3%
FEE_DENOMINATOR = 10000
fee = (amount * 30) / 10000
```

åŸºç‚¹ï¼ˆbasis point, bpï¼‰ï¼š
- 1 åŸºç‚¹ = 0.01%
- 100 åŸºç‚¹ = 1%
- 30 åŸºç‚¹ = 0.3%

---

### ç¬¬ 19 é¢˜
**æ­£ç¡®ç­”æ¡ˆ**ï¼šABCE

**è§£æ**ï¼š
èšåˆå™¨çš„ä¼˜åŠ¿ï¼š
- âœ… A: è‡ªåŠ¨é€‰æ‹©æ‰‹ç»­è´¹æœ€ä½çš„æ± å­ - èŠ‚çœæˆæœ¬
- âœ… B: æ”¯æŒä»å¤šä¸ªæ± å­å€Ÿæ¬¾ - å¢åŠ çµæ´»æ€§
- âœ… C: å¢åŠ å•æ¬¡å€Ÿæ¬¾æœ€å¤§é‡‘é¢ - çªç ´å•æ± é™åˆ¶
- âœ… E: ç®€åŒ–å€Ÿæ¬¾æµç¨‹ - ç”¨æˆ·æ— éœ€æ‰‹åŠ¨æ¯”è¾ƒ

ä¸æ˜¯ä¼˜åŠ¿ï¼š
- âŒ D: èšåˆå™¨ä¸ä¼šæ¶ˆé™¤å¥—åˆ©æœºä¼šï¼Œåè€Œå¯èƒ½åˆ›é€ æ›´å¤š

---

### ç¬¬ 20 é¢˜
**æ­£ç¡®ç­”æ¡ˆ**ï¼šD

**è§£æ**ï¼š
æ‰€æœ‰æƒ…å†µéƒ½ä¼šå¯¼è‡´äº¤æ˜“å¤±è´¥å¹¶å›æ»šï¼š

```
A. æ‰‹ç»­è´¹è®¡ç®—é”™è¯¯
   â†’ å½’è¿˜é‡‘é¢å¯èƒ½ä¸è¶³ â†’ abort

B. å½’è¿˜é‡‘é¢ä¸è¶³
   â†’ assert!(repay_amount >= amount + fee) å¤±è´¥ â†’ abort

C. å¥—åˆ©ç­–ç•¥äºæŸ
   â†’ æ— æ³•è·å¾—è¶³å¤Ÿçš„å¸å½’è¿˜ â†’ abort

ç”±äºæ˜¯åŒä¸€äº¤æ˜“ï¼Œå¤±è´¥åˆ™å…¨éƒ¨å›æ»š âœ…
```

è¿™å°±æ˜¯é—ªç”µè´·çš„å®‰å…¨ä¿è¯ï¼

---

## ğŸ“Š é€‰æ‹©é¢˜è¯„åˆ†

| é¢˜å· | ç­”æ¡ˆ | é¢˜å· | ç­”æ¡ˆ |
|------|------|------|------|
| 1 | B | 11 | C |
| 2 | D | 12 | B |
| 3 | C | 13 | B |
| 4 | C | 14 | B |
| 5 | ABD | 15 | ABE |
| 6 | B | 16 | C |
| 7 | C | 17 | D |
| 8 | B | 18 | B |
| 9 | D | 19 | ABCE |
| 10 | ACD | 20 | D |

---

## ğŸ’» ç¼–ç¨‹é¢˜ç­”æ¡ˆ

### ç¼–ç¨‹é¢˜ 1ï¼šHot Potato å®ç°

```move
module flash_loan::simple {
    use std::signer;
    use aptos_framework::coin::{Self, Coin};
    
    struct SimplePool<phantom CoinType> has key {
        reserves: Coin<CoinType>,
        fee_rate: u64,
    }
    
    /// Hot Potato - æ³¨æ„æ²¡æœ‰ä»»ä½•èƒ½åŠ›ï¼
    struct FlashLoan {
        amount: u64,
        fee: u64,
    }
    
    const E_INSUFFICIENT_LIQUIDITY: u64 = 1;
    const E_INSUFFICIENT_REPAYMENT: u64 = 2;
    const FEE_DENOMINATOR: u64 = 10000;
    
    /// åˆå§‹åŒ–æ± å­
    public fun initialize<CoinType>(
        admin: &signer,
        initial_liquidity: Coin<CoinType>,
        fee_rate: u64
    ) {
        let pool = SimplePool<CoinType> {
            reserves: initial_liquidity,
            fee_rate,
        };
        move_to(admin, pool);
    }
    
    /// å€Ÿæ¬¾ - åˆ›å»º Hot Potato
    public fun borrow<CoinType>(
        pool_addr: address,
        amount: u64
    ): (Coin<CoinType>, FlashLoan) acquires SimplePool {
        let pool = borrow_global_mut<SimplePool<CoinType>>(pool_addr);
        
        // æ£€æŸ¥æµåŠ¨æ€§
        assert!(
            coin::value(&pool.reserves) >= amount,
            E_INSUFFICIENT_LIQUIDITY
        );
        
        // è®¡ç®—æ‰‹ç»­è´¹
        let fee = calculate_fee(amount, pool.fee_rate);
        
        // æå–å¸
        let coins = coin::extract(&mut pool.reserves, amount);
        
        // åˆ›å»º Hot Potato
        let flash_loan = FlashLoan { amount, fee };
        
        (coins, flash_loan)
    }
    
    /// è¿˜æ¬¾ - æ¶ˆè´¹ Hot Potato
    public fun repay<CoinType>(
        pool_addr: address,
        coins: Coin<CoinType>,
        flash_loan: FlashLoan
    ) acquires SimplePool {
        // è§£æ„ Hot Potatoï¼ˆæ¶ˆè´¹å®ƒï¼‰
        let FlashLoan { amount, fee } = flash_loan;
        
        // æ£€æŸ¥å½’è¿˜é‡‘é¢
        let repay_amount = coin::value(&coins);
        assert!(
            repay_amount >= amount + fee,
            E_INSUFFICIENT_REPAYMENT
        );
        
        // å½’è¿˜åˆ°æ± å­
        let pool = borrow_global_mut<SimplePool<CoinType>>(pool_addr);
        coin::merge(&mut pool.reserves, coins);
    }
    
    /// è®¡ç®—æ‰‹ç»­è´¹
    fun calculate_fee(amount: u64, fee_rate: u64): u64 {
        (amount * fee_rate) / FEE_DENOMINATOR
    }
    
    #[test_only]
    public fun destroy_for_test(flash_loan: FlashLoan) {
        let FlashLoan { amount: _, fee: _ } = flash_loan;
    }
}
```

**è¯„åˆ†ç‚¹**ï¼š
- âœ… initializeï¼šæ­£ç¡®åˆ›å»ºæ± å­å¹¶ç§»åŠ¨åˆ°è´¦æˆ·ï¼ˆ2åˆ†ï¼‰
- âœ… borrowï¼šåˆ›å»º Hot Potato å¹¶è¿”å›ï¼ˆ3åˆ†ï¼‰
- âœ… repayï¼šè§£æ„ Hot Potatoï¼ˆ3åˆ†ï¼‰
- âœ… å®‰å…¨æ£€æŸ¥ï¼šæµåŠ¨æ€§å’Œå½’è¿˜é‡‘é¢æ£€æŸ¥ï¼ˆ1åˆ†ï¼‰
- âœ… calculate_feeï¼šæ­£ç¡®è®¡ç®—ï¼ˆ1åˆ†ï¼‰

---

### ç¼–ç¨‹é¢˜ 2ï¼šå¥—åˆ©è®¡ç®—å™¨

```move
module flash_loan::arbitrage_calculator {
    
    struct ArbitrageResult has drop {
        is_profitable: bool,
        gross_profit: u64,
        total_fees: u64,
        net_profit: u64,
    }
    
    const FEE_DENOMINATOR: u64 = 10000;
    
    /// AMM è¾“å‡ºè®¡ç®—ï¼ˆæ’å®šä¹˜ç§¯å…¬å¼ï¼‰
    public fun calculate_amm_output(
        amount_in: u64,
        reserve_in: u64,
        reserve_out: u64
    ): u64 {
        // 0.3% æ‰‹ç»­è´¹ â†’ 99.7% = 997/1000
        let amount_in_with_fee = amount_in * 997;
        let numerator = amount_in_with_fee * reserve_out;
        let denominator = (reserve_in * 1000) + amount_in_with_fee;
        
        numerator / denominator
    }
    
    /// è®¡ç®—å¥—åˆ©åˆ©æ¶¦
    public fun calculate_arbitrage_profit(
        borrow_amount: u64,
        flash_fee_rate: u64,
        dex_a_reserve_x: u64,
        dex_a_reserve_y: u64,
        dex_b_reserve_y: u64,
        dex_b_reserve_x: u64
    ): ArbitrageResult {
        // 1. è®¡ç®—é—ªç”µè´·æ‰‹ç»­è´¹
        let flash_fee = (borrow_amount * flash_fee_rate) / FEE_DENOMINATOR;
        
        // 2. DEX A: X â†’ Y
        let bought_y = calculate_amm_output(
            borrow_amount,
            dex_a_reserve_x,
            dex_a_reserve_y
        );
        
        // 3. DEX B: Y â†’ X
        let sold_x = calculate_amm_output(
            bought_y,
            dex_b_reserve_y,
            dex_b_reserve_x
        );
        
        // 4. è®¡ç®—åˆ©æ¶¦
        let total_cost = borrow_amount + flash_fee;
        
        if (sold_x > total_cost) {
            let net_profit = sold_x - total_cost;
            ArbitrageResult {
                is_profitable: true,
                gross_profit: sold_x - borrow_amount,
                total_fees: flash_fee,
                net_profit,
            }
        } else {
            ArbitrageResult {
                is_profitable: false,
                gross_profit: 0,
                total_fees: flash_fee,
                net_profit: 0,
            }
        }
    }
}
```

**è¯„åˆ†ç‚¹**ï¼š
- âœ… calculate_amm_outputï¼šæ­£ç¡®å®ç°æ’å®šä¹˜ç§¯å…¬å¼ï¼ˆ4åˆ†ï¼‰
  - æ­£ç¡®å¤„ç†æ‰‹ç»­è´¹ 997/1000ï¼ˆ2åˆ†ï¼‰
  - å…¬å¼æ­£ç¡®ï¼ˆ2åˆ†ï¼‰
- âœ… calculate_arbitrage_profitï¼šå®Œæ•´çš„å¥—åˆ©è®¡ç®—ï¼ˆ4åˆ†ï¼‰
  - æ­£ç¡®è®¡ç®—ä¸¤æ¬¡äº¤æ¢ï¼ˆ2åˆ†ï¼‰
  - æ­£ç¡®æ¯”è¾ƒæˆæœ¬å’Œæ”¶ç›Šï¼ˆ2åˆ†ï¼‰
- âœ… æ‰‹ç»­è´¹è®¡ç®—ï¼ˆ1åˆ†ï¼‰
- âœ… ç»“æœç»“æ„æ­£ç¡®ï¼ˆ1åˆ†ï¼‰

---

### ç¼–ç¨‹é¢˜ 3ï¼šèšåˆå™¨é€‰æ‹©é€»è¾‘

```move
module flash_loan::aggregator {
    use std::vector;
    
    struct PoolInfo has store, drop, copy {
        pool_address: address,
        fee_rate: u64,
        available_liquidity: u64,
    }
    
    struct Aggregator has key {
        pools: vector<PoolInfo>,
    }
    
    const E_NO_SUITABLE_POOL: u64 = 1;
    const FEE_DENOMINATOR: u64 = 10000;
    
    /// æŸ¥æ‰¾æœ€ä¼˜æ± å­
    public fun find_best_pool(
        pools: &vector<PoolInfo>,
        amount: u64
    ): (address, u64) {
        let best_pool = @0x0;
        let best_fee_rate = 0xFFFFFFFFFFFFFFFF;  // æœ€å¤§ u64
        let best_liquidity = 0;
        
        let i = 0;
        let len = vector::length(pools);
        
        while (i < len) {
            let pool = vector::borrow(pools, i);
            
            // æ£€æŸ¥æµåŠ¨æ€§æ˜¯å¦è¶³å¤Ÿ
            if (pool.available_liquidity >= amount) {
                // å¦‚æœæ‰‹ç»­è´¹æ›´ä½ï¼Œæˆ–æ‰‹ç»­è´¹ç›¸åŒä½†æµåŠ¨æ€§æ›´å¤§
                if (pool.fee_rate < best_fee_rate ||
                    (pool.fee_rate == best_fee_rate && 
                     pool.available_liquidity > best_liquidity)) {
                    best_pool = pool.pool_address;
                    best_fee_rate = pool.fee_rate;
                    best_liquidity = pool.available_liquidity;
                }
            }
            
            i = i + 1;
        };
        
        // æ£€æŸ¥æ˜¯å¦æ‰¾åˆ°åˆé€‚çš„æ± å­
        assert!(best_pool != @0x0, E_NO_SUITABLE_POOL);
        
        // è®¡ç®—æ‰‹ç»­è´¹
        let fee = (amount * best_fee_rate) / FEE_DENOMINATOR;
        
        (best_pool, fee)
    }
    
    /// åˆ†æ‹†å€Ÿæ¬¾ç­–ç•¥
    public fun split_borrow_plan(
        pools: &vector<PoolInfo>,
        amount: u64
    ): vector<(address, u64, u64)> {
        let plan = vector::empty<(address, u64, u64)>();
        let remaining = amount;
        
        // å¤åˆ¶æ± å­åˆ—è¡¨ç”¨äºæ’åº
        let sorted_pools = *pools;
        
        // ç®€å•çš„å†’æ³¡æ’åºï¼ˆæŒ‰æ‰‹ç»­è´¹ä»ä½åˆ°é«˜ï¼‰
        let len = vector::length(&sorted_pools);
        let i = 0;
        while (i < len) {
            let j = i + 1;
            while (j < len) {
                let pool_i = vector::borrow(&sorted_pools, i);
                let pool_j = vector::borrow(&sorted_pools, j);
                
                if (pool_j.fee_rate < pool_i.fee_rate) {
                    vector::swap(&mut sorted_pools, i, j);
                }
                
                j = j + 1;
            };
            i = i + 1;
        };
        
        // æŒ‰æ‰‹ç»­è´¹ä»ä½åˆ°é«˜ä¾æ¬¡å€Ÿæ¬¾
        i = 0;
        while (remaining > 0 && i < len) {
            let pool = vector::borrow(&sorted_pools, i);
            
            // ä»è¿™ä¸ªæ± å­å€Ÿå¤šå°‘ï¼Ÿ
            let borrow_from_this = if (pool.available_liquidity >= remaining) {
                remaining
            } else {
                pool.available_liquidity
            };
            
            if (borrow_from_this > 0) {
                let fee = (borrow_from_this * pool.fee_rate) / FEE_DENOMINATOR;
                vector::push_back(
                    &mut plan,
                    (pool.pool_address, borrow_from_this, fee)
                );
                remaining = remaining - borrow_from_this;
            }
            
            i = i + 1;
        };
        
        // æ£€æŸ¥æ˜¯å¦æˆåŠŸå€Ÿåˆ°è¶³å¤Ÿçš„é‡‘é¢
        assert!(remaining == 0, E_NO_SUITABLE_POOL);
        
        plan
    }
}
```

**è¯„åˆ†ç‚¹**ï¼š
- âœ… find_best_pool å®ç°ï¼ˆ5åˆ†ï¼‰
  - æ­£ç¡®è¿‡æ»¤æµåŠ¨æ€§ä¸è¶³ï¼ˆ2åˆ†ï¼‰
  - é€‰æ‹©æ‰‹ç»­è´¹æœ€ä½ï¼ˆ2åˆ†ï¼‰
  - æ‰‹ç»­è´¹ç›¸åŒæ—¶é€‰æµåŠ¨æ€§å¤§çš„ï¼ˆ1åˆ†ï¼‰
- âœ… split_borrow_plan å®ç°ï¼ˆ4åˆ†ï¼‰
  - æ­£ç¡®æ’åºæ± å­ï¼ˆ1åˆ†ï¼‰
  - æ­£ç¡®åˆ†é…å€Ÿæ¬¾é‡‘é¢ï¼ˆ2åˆ†ï¼‰
  - æ­£ç¡®è®¡ç®—æ‰‹ç»­è´¹ï¼ˆ1åˆ†ï¼‰
- âœ… è¾¹ç•Œæƒ…å†µå¤„ç†ï¼ˆ1åˆ†ï¼‰

---

## ğŸ“ˆ æ€»åˆ†ç»Ÿè®¡

### é€‰æ‹©é¢˜ï¼ˆ20åˆ†ï¼‰
æ¯é¢˜1åˆ†ï¼Œå…±20åˆ†

### ç¼–ç¨‹é¢˜ï¼ˆ30åˆ†ï¼‰
- ç¼–ç¨‹é¢˜1ï¼š10åˆ†
- ç¼–ç¨‹é¢˜2ï¼š10åˆ†
- ç¼–ç¨‹é¢˜3ï¼š10åˆ†

### æ€»åˆ†ï¼š50åˆ†

| åˆ†æ•° | ç­‰çº§ | è¯„ä»· |
|------|------|------|
| 45-50 | ä¼˜ç§€ | ğŸŒŸğŸŒŸğŸŒŸ å®Œå…¨æŒæ¡ |
| 38-44 | è‰¯å¥½ | ğŸŒŸğŸŒŸ ç†è§£é€å½» |
| 30-37 | åŠæ ¼ | ğŸŒŸ åŸºæœ¬æŒæ¡ |
| 0-29  | ä¸åŠæ ¼ | éœ€è¦é‡æ–°å­¦ä¹  |

---

## ğŸ’¡ å­¦ä¹ å»ºè®®

### å¦‚æœå¾—åˆ† < 30 åˆ†

1. **é‡æ–°å­¦ä¹ ç†è®º**
   - ä»”ç»†é˜…è¯» `01_ç†è®ºå­¦ä¹ /æ ¸å¿ƒæ¦‚å¿µ.md`
   - ç†è§£ Hot Potato çš„æœ¬è´¨
   - æŒæ¡æ’å®šä¹˜ç§¯å…¬å¼

2. **åŠ¨æ‰‹å®è·µ**
   - ä»ç®€å•çš„ Hot Potato ç¤ºä¾‹å¼€å§‹
   - é€æ­¥å¢åŠ å¤æ‚åº¦
   - è¿è¡Œæµ‹è¯•éªŒè¯ç†è§£

3. **é‡åšé”™é¢˜**
   - åˆ†æä¸ºä»€ä¹ˆç­”é”™
   - æ‰¾åˆ°çŸ¥è¯†ç›²ç‚¹
   - é’ˆå¯¹æ€§å­¦ä¹ 

### å¦‚æœå¾—åˆ† 30-44 åˆ†

1. **æ·±å…¥éš¾ç‚¹**
   - é‡ç‚¹å­¦ä¹ é”™è¯¯çš„é¢˜ç›®
   - ç†è§£å¥—åˆ©è®¡ç®—ç»†èŠ‚
   - æŒæ¡èšåˆå™¨è®¾è®¡

2. **ä¼˜åŒ–ä»£ç **
   - æ”¹è¿›ç®—æ³•æ•ˆç‡
   - æ·»åŠ æ›´å¤šå®‰å…¨æ£€æŸ¥
   - è€ƒè™‘è¾¹ç•Œæƒ…å†µ

3. **æ‰©å±•å­¦ä¹ **
   - ç ”ç©¶çœŸå®é¡¹ç›®ï¼ˆAave, Uniswapï¼‰
   - é˜…è¯»é—ªç”µè´·æ”»å‡»æ¡ˆä¾‹
   - å­¦ä¹ é«˜çº§ä¼˜åŒ–æŠ€å·§

### å¦‚æœå¾—åˆ† >= 45 åˆ†

æ­å–œï¼ä½ å·²ç»å¾ˆå¥½åœ°æŒæ¡äº†é—ªç”µè´·ï¼

**ä¸‹ä¸€æ­¥**ï¼š
1. å®ç°æ›´å¤æ‚çš„å¥—åˆ©ç­–ç•¥
2. ç ”ç©¶è·¨é“¾é—ªç”µè´·
3. å­¦ä¹  MEV ç›¸å…³çŸ¥è¯†ï¼ˆDay 32ï¼‰
4. æ„å»ºå®Œæ•´çš„å¥—åˆ©æœºå™¨äºº

---

## ğŸ“ å…³é”®çŸ¥è¯†ç‚¹æ€»ç»“

### 1. Hot Potato æ ¸å¿ƒ

```
æ²¡æœ‰ä»»ä½•èƒ½åŠ› = ç¼–è¯‘æ—¶å¼ºåˆ¶å¤„ç†
  â†“
å¿…é¡»æ˜¾å¼è§£æ„
  â†“
é—ªç”µè´·å¿…é¡»å½’è¿˜
```

### 2. å¥—åˆ©å…¬å¼

```
å‡€åˆ©æ¶¦ = å–å‡ºä»· - ä¹°å…¥ä»· - é—ªç”µè´·è´¹ - DEX è´¹ Ã— 2

ç›ˆåˆ©æ¡ä»¶ï¼š
ä»·å·® > æ€»æ‰‹ç»­è´¹ç‡
```

### 3. èšåˆå™¨ä»·å€¼

```
å•æ± é™åˆ¶ â†’ å¤šæ± èšåˆ â†’ æ›´å¤§é‡‘é¢ + æ›´ä½è´¹ç‡
```

### 4. å®‰å…¨è¦ç‚¹

```
âœ… Hot Potato é˜²é‡å…¥
âœ… ä¸å˜é‡æ£€æŸ¥
âœ… TWAP é˜²ä»·æ ¼æ“çºµ
âœ… æ—¶é—´é”é˜²æ²»ç†æ”»å‡»
```

---

**ç»§ç»­åŠ æ²¹ï¼æ˜å¤©æˆ‘ä»¬å°†å­¦ä¹ æ›´é«˜çº§çš„ MEV ç­–ç•¥ï¼** ğŸš€
